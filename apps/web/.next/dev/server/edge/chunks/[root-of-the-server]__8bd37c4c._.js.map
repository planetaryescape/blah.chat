{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/apps/web/src/middleware.ts"],"sourcesContent":["import { clerkMiddleware, createRouteMatcher } from \"@clerk/nextjs/server\";\nimport { NextResponse } from \"next/server\";\n\nconst isPublicRoute = createRouteMatcher([\n  \"/\",\n  \"/sign-in(.*)\",\n  \"/sign-up(.*)\",\n  \"/share(.*)\",\n  \"/api/webhooks/clerk\", // Clerk webhooks\n  \"/api/code-execution\", // Allow Convex internal calls\n]);\nconst isAdminRoute = createRouteMatcher([\"/admin(.*)\"]);\nexport default clerkMiddleware(async (auth, req) => {\n  const { userId, sessionClaims } = await auth();\n\n  // Redirect authenticated users from / to /app\n  if (userId && req.nextUrl.pathname === \"/\") {\n    return NextResponse.redirect(new URL(\"/app\", req.url));\n  }\n\n  // Admin route protection\n  if (isAdminRoute(req)) {\n    if (!userId) {\n      // Not authenticated, redirect to sign-in\n      return NextResponse.redirect(new URL(\"/sign-in\", req.url));\n    }\n\n    // Check for admin role in session claims publicMetadata\n    const isAdmin =\n      (sessionClaims?.publicMetadata as { isAdmin?: boolean })?.isAdmin ===\n      true;\n    if (!isAdmin) {\n      // Not an admin, redirect to /app\n      return NextResponse.redirect(new URL(\"/app\", req.url));\n    }\n  }\n\n  // Handle protected routes\n  if (!isPublicRoute(req)) {\n    // For /app route, check if user is authenticated before calling protect\n    // This prevents redirect loop when Clerk session exists but isn't fully ready\n    if (req.nextUrl.pathname === \"/app\") {\n      if (!userId) {\n        // Not authenticated, redirect to sign-in\n        return NextResponse.redirect(new URL(\"/sign-in\", req.url));\n      }\n      // Authenticated user on /app, allow access (don't call protect to avoid redirect loop)\n      return NextResponse.next();\n    }\n    // For other protected routes, use protect\n    await auth.protect();\n  }\n});\n\nexport const config = {\n  matcher: [\n    // Skip Next.js internals and all static files\n    \"/((?!_next|[^?]*\\\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)\",\n    // Always run for API routes\n    \"/(api|trpc)(.*)\",\n  ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AAAA;;;AAEA,MAAM,gBAAgB,IAAA,0RAAkB,EAAC;IACvC;IACA;IACA;IACA;IACA;IACA;CACD;AACD,MAAM,eAAe,IAAA,0RAAkB,EAAC;IAAC;CAAa;uCACvC,IAAA,0RAAe,EAAC,OAAO,MAAM;IAC1C,MAAM,EAAE,MAAM,EAAE,aAAa,EAAE,GAAG,MAAM;IAExC,8CAA8C;IAC9C,IAAI,UAAU,IAAI,OAAO,CAAC,QAAQ,KAAK,KAAK;QAC1C,OAAO,qQAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,QAAQ,IAAI,GAAG;IACtD;IAEA,yBAAyB;IACzB,IAAI,aAAa,MAAM;QACrB,IAAI,CAAC,QAAQ;YACX,yCAAyC;YACzC,OAAO,qQAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,YAAY,IAAI,GAAG;QAC1D;QAEA,wDAAwD;QACxD,MAAM,UACJ,AAAC,eAAe,gBAA0C,YAC1D;QACF,IAAI,CAAC,SAAS;YACZ,iCAAiC;YACjC,OAAO,qQAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,QAAQ,IAAI,GAAG;QACtD;IACF;IAEA,0BAA0B;IAC1B,IAAI,CAAC,cAAc,MAAM;QACvB,wEAAwE;QACxE,8EAA8E;QAC9E,IAAI,IAAI,OAAO,CAAC,QAAQ,KAAK,QAAQ;YACnC,IAAI,CAAC,QAAQ;gBACX,yCAAyC;gBACzC,OAAO,qQAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,YAAY,IAAI,GAAG;YAC1D;YACA,uFAAuF;YACvF,OAAO,qQAAY,CAAC,IAAI;QAC1B;QACA,0CAA0C;QAC1C,MAAM,KAAK,OAAO;IACpB;AACF;AAEO,MAAM,SAAS;IACpB,SAAS;QACP,8CAA8C;QAC9C;QACA,4BAA4B;QAC5B;KACD;AACH"}}]
}