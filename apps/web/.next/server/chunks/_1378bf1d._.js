module.exports=[944568,e=>{"use strict";e.s(["version",0,"1.31.2"])},784665,627844,841204,920876,110879,838771,e=>{"use strict";for(var t,s,i=[],r=[],n=Uint8Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=o.length;a<u;++a)i[a]=o[a],r[o.charCodeAt(a)]=a;function h(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var s=e.indexOf("=");-1===s&&(s=t);var i=s===t?0:4-s%4;return[s,i]}function l(e){var t=h(e),s=t[0],i=t[1];return(s+i)*3/4-i}function c(e){var t,s,i=h(e),o=i[0],a=i[1],u=new n((o+a)*3/4-a),l=0,c=a>0?o-4:o;for(s=0;s<c;s+=4)t=r[e.charCodeAt(s)]<<18|r[e.charCodeAt(s+1)]<<12|r[e.charCodeAt(s+2)]<<6|r[e.charCodeAt(s+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;return 2===a&&(t=r[e.charCodeAt(s)]<<2|r[e.charCodeAt(s+1)]>>4,u[l++]=255&t),1===a&&(t=r[e.charCodeAt(s)]<<10|r[e.charCodeAt(s+1)]<<4|r[e.charCodeAt(s+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t),u}function d(e){for(var t,s=e.length,r=s%3,n=[],o=0,a=s-r;o<a;o+=16383)n.push(function(e,t,s){for(var r,n=[],o=t;o<s;o+=3)r=(e[o]<<16&0xff0000)+(e[o+1]<<8&65280)+(255&e[o+2]),n.push(i[r>>18&63]+i[r>>12&63]+i[r>>6&63]+i[63&r]);return n.join("")}(e,o,o+16383>a?a:o+16383));return 1===r?n.push(i[(t=e[s-1])>>2]+i[t<<4&63]+"=="):2===r&&n.push(i[(t=(e[s-2]<<8)+e[s-1])>>10]+i[t>>4&63]+i[t<<2&63]+"="),n.join("")}function f(e){return d(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function g(e){if(void 0===e)return{};if(!y(e))throw Error(`The arguments to a Convex function must be an object. Received: ${e}`);return e}function p(e){if(void 0===e)throw Error("Client created with undefined deployment address. If you used an environment variable, check that it's set.");if("string"!=typeof e)throw Error(`Invalid deployment address: found ${e}".`);if(!(e.startsWith("http:")||e.startsWith("https:")))throw Error(`Invalid deployment address: Must start with "https://" or "http://". Found "${e}".`);try{new URL(e)}catch{throw Error(`Invalid deployment address: "${e}" is not a valid URL. If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}if(e.endsWith(".convex.site"))throw Error(`Invalid deployment address: "${e}" ends with .convex.site, which is used for HTTP Actions. Convex deployment URLs typically end with .convex.cloud? If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}function y(e){let t="object"==typeof e,s=Object.getPrototypeOf(e),i=null===s||s===Object.prototype||s?.constructor?.name==="Object";return t&&i}r[45]=62,r[95]=63,e.s(["byteLength",()=>l,"fromByteArray",()=>d,"fromByteArrayUrlSafeNoPadding",()=>f,"toByteArray",()=>c],627844),e.s(["isSimpleObject",()=>y,"parseArgs",()=>g,"validateDeploymentUrl",()=>p],841204);let m=BigInt("-9223372036854775808"),v=BigInt("9223372036854775807"),b=BigInt("0"),w=BigInt("8"),k=BigInt("256");function S(e){return Number.isNaN(e)||!Number.isFinite(e)||Object.is(e,-0)}let C=DataView.prototype.setBigInt64?function(e){if(e<m||v<e)throw Error(`BigInt ${e} does not fit into a 64-bit signed integer.`);let t=new ArrayBuffer(8);return new DataView(t).setBigInt64(0,e,!0),d(new Uint8Array(t))}:function(e){e<b&&(e-=m+m);let t=e.toString(16);t.length%2==1&&(t="0"+t);let s=new Uint8Array(new ArrayBuffer(8)),i=0;for(let r of t.match(/.{2}/g).reverse())s.set([parseInt(r,16)],i++),e>>=w;return d(s)},T=DataView.prototype.getBigInt64?function(e){let t=c(e);if(8!==t.byteLength)throw Error(`Received ${t.byteLength} bytes, expected 8 for $integer`);return new DataView(t.buffer).getBigInt64(0,!0)}:function(e){let t=c(e);if(8!==t.byteLength)throw Error(`Received ${t.byteLength} bytes, expected 8 for $integer`);let s=b,i=b;for(let e of t)s+=BigInt(e)*k**i,i++;return s>v&&(s+=m+m),s};function x(e){if(e.length>1024)throw Error(`Field name ${e} exceeds maximum field name length 1024.`);if(e.startsWith("$"))throw Error(`Field name ${e} starts with a '$', which is reserved.`);for(let t=0;t<e.length;t+=1){let s=e.charCodeAt(t);if(s<32||s>=127)throw Error(`Field name ${e} has invalid character '${e[t]}': Field names can only contain non-control ASCII characters`)}}function A(e){let t=JSON.stringify(e,(e,t)=>void 0===t?"undefined":"bigint"==typeof t?`${t.toString()}n`:t);if(t.length>16384){let e="[...truncated]",s=16384-e.length,i=t.codePointAt(s-1);return void 0!==i&&i>65535&&(s-=1),t.substring(0,s)+e}return t}function R(e,t,s,i){if(void 0===e){let e=s&&` (present at path ${s} in original object ${A(t)})`;throw Error(`undefined is not a valid Convex value${e}. To learn about Convex's supported types, see https://docs.convex.dev/using/types.`)}if(null===e)return e;if("bigint"==typeof e){if(e<m||v<e)throw Error(`BigInt ${e} does not fit into a 64-bit signed integer.`);return{$integer:C(e)}}if("number"==typeof e)if(!S(e))return e;else{let t=new ArrayBuffer(8);return new DataView(t).setFloat64(0,e,!0),{$float:d(new Uint8Array(t))}}if("boolean"==typeof e||"string"==typeof e)return e;if(e instanceof ArrayBuffer)return{$bytes:d(new Uint8Array(e))};if(Array.isArray(e))return e.map((e,i)=>R(e,t,s+`[${i}]`,!1));if(e instanceof Set)throw Error(q(s,"Set",[...e],t));if(e instanceof Map)throw Error(q(s,"Map",[...e],t));if(!y(e)){let i=e?.constructor?.name;throw Error(q(s,i?`${i} `:"",e,t))}let r={},n=Object.entries(e);for(let[e,o]of(n.sort(([e,t],[s,i])=>e===s?0:e<s?-1:1),n))void 0!==o?(x(e),r[e]=R(o,t,s+`.${e}`,!1)):i&&(x(e),r[e]=O(o,t,s+`.${e}`));return r}function q(e,t,s,i){return e?`${t}${A(s)} is not a supported Convex type (present at path ${e} in original object ${A(i)}). To learn about Convex's supported types, see https://docs.convex.dev/using/types.`:`${t}${A(s)} is not a supported Convex type.`}function O(e,t,s){if(void 0===e)return{$undefined:null};if(void 0===t)throw Error(`Programming error. Current value is ${A(e)} but original value is undefined`);return R(e,t,s,!1)}function $(e){return R(e,e,"",!1)}function I(e){return O(e,e,"")}function E(e){return R(e,e,"",!0)}e.s(["convexOrUndefinedToJson",()=>I,"convexToJson",()=>$,"jsonToConvex",()=>function e(t){if(null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t)return t;if(Array.isArray(t))return t.map(t=>e(t));if("object"!=typeof t)throw Error(`Unexpected type of ${t}`);let s=Object.entries(t);if(1===s.length){let e=s[0][0];if("$bytes"===e){if("string"!=typeof t.$bytes)throw Error(`Malformed $bytes field on ${t}`);return c(t.$bytes).buffer}if("$integer"===e){if("string"!=typeof t.$integer)throw Error(`Malformed $integer field on ${t}`);return T(t.$integer)}if("$float"===e){if("string"!=typeof t.$float)throw Error(`Malformed $float field on ${t}`);let e=c(t.$float);if(8!==e.byteLength)throw Error(`Received ${e.byteLength} bytes, expected 8 for $float`);let s=new DataView(e.buffer).getFloat64(0,!0);if(!S(s))throw Error(`Float ${s} should be encoded as a number`);return s}if("$set"===e)throw Error("Received a Set which is no longer supported as a Convex type.");if("$map"===e)throw Error("Received a Map which is no longer supported as a Convex type.")}let i={};for(let[s,r]of Object.entries(t))x(s),i[s]=e(r);return i},"patchValueToJson",()=>E,"stringifyValueForError",()=>A],920876);var M=Object.defineProperty,Q=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?M(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};function P(e,t){let s=void 0!==t?` for field "${t}"`:"";throw Error(`A validator is undefined${s} in ${e}. This is often caused by circular imports. See https://docs.convex.dev/error#undefined-validator for details.`)}class V{constructor({isOptional:e}){Q(this,"type"),Q(this,"fieldPaths"),Q(this,"isOptional"),Q(this,"isConvexValidator"),this.isOptional=e,this.isConvexValidator=!0}}class j extends V{constructor({isOptional:e,tableName:t}){if(super({isOptional:e}),Q(this,"tableName"),Q(this,"kind","id"),"string"!=typeof t)throw Error("v.id(tableName) requires a string");this.tableName=t}get json(){return{type:"id",tableName:this.tableName}}asOptional(){return new j({isOptional:"optional",tableName:this.tableName})}}class F extends V{constructor(){super(...arguments),Q(this,"kind","float64")}get json(){return{type:"number"}}asOptional(){return new F({isOptional:"optional"})}}class L extends V{constructor(){super(...arguments),Q(this,"kind","int64")}get json(){return{type:"bigint"}}asOptional(){return new L({isOptional:"optional"})}}class _ extends V{constructor(){super(...arguments),Q(this,"kind","boolean")}get json(){return{type:this.kind}}asOptional(){return new _({isOptional:"optional"})}}class N extends V{constructor(){super(...arguments),Q(this,"kind","bytes")}get json(){return{type:this.kind}}asOptional(){return new N({isOptional:"optional"})}}class D extends V{constructor(){super(...arguments),Q(this,"kind","string")}get json(){return{type:this.kind}}asOptional(){return new D({isOptional:"optional"})}}class B extends V{constructor(){super(...arguments),Q(this,"kind","null")}get json(){return{type:this.kind}}asOptional(){return new B({isOptional:"optional"})}}class U extends V{constructor(){super(...arguments),Q(this,"kind","any")}get json(){return{type:this.kind}}asOptional(){return new U({isOptional:"optional"})}}class J extends V{constructor({isOptional:e,fields:t}){super({isOptional:e}),Q(this,"fields"),Q(this,"kind","object"),globalThis.Object.entries(t).forEach(([e,t])=>{if(void 0===t&&P("v.object()",e),!t.isConvexValidator)throw Error("v.object() entries must be validators")}),this.fields=t}get json(){return{type:this.kind,value:globalThis.Object.fromEntries(globalThis.Object.entries(this.fields).map(([e,t])=>[e,{fieldType:t.json,optional:"optional"===t.isOptional}]))}}asOptional(){return new J({isOptional:"optional",fields:this.fields})}omit(...e){let t={...this.fields};for(let s of e)delete t[s];return new J({isOptional:this.isOptional,fields:t})}pick(...e){let t={};for(let s of e)t[s]=this.fields[s];return new J({isOptional:this.isOptional,fields:t})}partial(){let e={};for(let[t,s]of globalThis.Object.entries(this.fields))e[t]=s.asOptional();return new J({isOptional:this.isOptional,fields:e})}extend(e){return new J({isOptional:this.isOptional,fields:{...this.fields,...e}})}}class W extends V{constructor({isOptional:e,value:t}){if(super({isOptional:e}),Q(this,"value"),Q(this,"kind","literal"),"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t&&"bigint"!=typeof t)throw Error("v.literal(value) must be a string, number, or boolean");this.value=t}get json(){return{type:this.kind,value:$(this.value)}}asOptional(){return new W({isOptional:"optional",value:this.value})}}class z extends V{constructor({isOptional:e,element:t}){super({isOptional:e}),Q(this,"element"),Q(this,"kind","array"),void 0===t&&P("v.array()"),this.element=t}get json(){return{type:this.kind,value:this.element.json}}asOptional(){return new z({isOptional:"optional",element:this.element})}}class K extends V{constructor({isOptional:e,key:t,value:s}){if(super({isOptional:e}),Q(this,"key"),Q(this,"value"),Q(this,"kind","record"),void 0===t&&P("v.record()","key"),void 0===s&&P("v.record()","value"),"optional"===t.isOptional)throw Error("Record validator cannot have optional keys");if("optional"===s.isOptional)throw Error("Record validator cannot have optional values");if(!t.isConvexValidator||!s.isConvexValidator)throw Error("Key and value of v.record() but be validators");this.key=t,this.value=s}get json(){return{type:this.kind,keys:this.key.json,values:{fieldType:this.value.json,optional:!1}}}asOptional(){return new K({isOptional:"optional",key:this.key,value:this.value})}}class H extends V{constructor({isOptional:e,members:t}){super({isOptional:e}),Q(this,"members"),Q(this,"kind","union"),t.forEach((e,t)=>{if(void 0===e&&P("v.union()",`member at index ${t}`),!e.isConvexValidator)throw Error("All members of v.union() must be validators")}),this.members=t}get json(){return{type:this.kind,value:this.members.map(e=>e.json)}}asOptional(){return new H({isOptional:"optional",members:this.members})}}function G(e){return!!e.isConvexValidator}function X(e){return G(e)?e:Y.object(e)}let Y={id:e=>new j({isOptional:"required",tableName:e}),null:()=>new B({isOptional:"required"}),number:()=>new F({isOptional:"required"}),float64:()=>new F({isOptional:"required"}),bigint:()=>new L({isOptional:"required"}),int64:()=>new L({isOptional:"required"}),boolean:()=>new _({isOptional:"required"}),string:()=>new D({isOptional:"required"}),bytes:()=>new N({isOptional:"required"}),literal:e=>new W({isOptional:"required",value:e}),array:e=>new z({isOptional:"required",element:e}),object:e=>new J({isOptional:"required",fields:e}),record:(e,t)=>new K({isOptional:"required",key:e,value:t}),union:(...e)=>new H({isOptional:"required",members:e}),any:()=>new U({isOptional:"required"}),optional:e=>e.asOptional(),nullable:e=>Y.union(e,Y.null())};e.s(["asObjectValidator",()=>X,"isValidator",()=>G,"v",0,Y],110879),e.i(627844);var Z=Object.defineProperty,ee=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?Z(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};let et=Symbol.for("ConvexError");class es extends(s=Error,t=et,s){constructor(e){super("string"==typeof e?e:A(e)),ee(this,"name","ConvexError"),ee(this,"data"),ee(this,t,!0),this.data=e}}e.s(["ConvexError",()=>es],838771);let ei=()=>Array.from({length:4},()=>0);ei(),ei(),e.s([],784665)},184169,500639,617350,237294,e=>{"use strict";var t=Object.defineProperty,s=(e,s,i)=>{let r;return(r="symbol"!=typeof s?s+"":s)in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[r]=i};function i(e){switch(e){case"query":return"Q";case"mutation":return"M";case"action":return"A";case"any":return"?"}}class r{constructor(e){s(this,"_onLogLineFuncs"),s(this,"_verbose"),this._onLogLineFuncs={},this._verbose=e.verbose}addLogLineListener(e){let t=Math.random().toString(36).substring(2,15);for(let e=0;e<10&&void 0!==this._onLogLineFuncs[t];e++)t=Math.random().toString(36).substring(2,15);return this._onLogLineFuncs[t]=e,()=>{delete this._onLogLineFuncs[t]}}logVerbose(...e){if(this._verbose)for(let t of Object.values(this._onLogLineFuncs))t("debug",`${new Date().toISOString()}`,...e)}log(...e){for(let t of Object.values(this._onLogLineFuncs))t("info",...e)}warn(...e){for(let t of Object.values(this._onLogLineFuncs))t("warn",...e)}error(...e){for(let t of Object.values(this._onLogLineFuncs))t("error",...e)}}function n(e){let t=new r(e);return t.addLogLineListener((e,...t)=>{switch(e){case"debug":console.debug(...t);break;case"info":default:console.log(...t);break;case"warn":console.warn(...t);break;case"error":console.error(...t)}}),t}function o(e){return new r(e)}function a(e,t,s,r,n){let o=i(s);if("object"==typeof n&&(n=`ConvexError ${JSON.stringify(n.errorData,null,2)}`),"info"===t){let t=n.match(/^\[.*?\] /);if(null===t)return void e.error(`[CONVEX ${o}(${r})] Could not parse console.log`);let s=n.slice(1,t[0].length-2),i=n.slice(t[0].length);e.log(`%c[CONVEX ${o}(${r})] [${s}]`,"color:rgb(0, 145, 255)",i)}else e.error(`[CONVEX ${o}(${r})] ${n}`)}function u(e,t){let s=`[CONVEX FATAL ERROR] ${t}`;return e.error(s),Error(s)}function h(e,t,s){let r=i(e);return`[CONVEX ${r}(${t})] ${s.errorMessage}
  Called by client`}function l(e,t){return t.data=e.errorData,t}e.s(["createHybridErrorStacktrace",()=>h,"forwardData",()=>l,"instantiateDefaultLogger",()=>n,"instantiateNoopLogger",()=>o,"logFatalError",()=>u,"logForFunction",()=>a],184169),e.i(784665);var c=e.i(920876);function d(e){let t,s,i=e.split(":");return 1===i.length?(t=i[0],s="default"):(t=i.slice(0,i.length-1).join(":"),s=i[i.length-1]),t.endsWith(".js")&&(t=t.slice(0,-3)),`${t}:${s}`}function f(e,t){return JSON.stringify({udfPath:d(e),args:(0,c.convexToJson)(t)})}function g(e,t,s){let{initialNumItems:i,id:r}=s;return JSON.stringify({type:"paginated",udfPath:d(e),args:(0,c.convexToJson)(t),options:(0,c.convexToJson)({initialNumItems:i,id:r})})}function p(e){return"paginated"===JSON.parse(e).type}e.s(["canonicalizeUdfPath",()=>d,"serializePaginatedPathAndArgs",()=>g,"serializePathAndArgs",()=>f,"serializedQueryTokenIsPaginated",()=>p],500639);var y=Object.defineProperty,m=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?y(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};class v{constructor(){m(this,"nextQueryId"),m(this,"querySetVersion"),m(this,"querySet"),m(this,"queryIdToToken"),m(this,"identityVersion"),m(this,"auth"),m(this,"outstandingQueriesOlderThanRestart"),m(this,"outstandingAuthOlderThanRestart"),m(this,"paused"),m(this,"pendingQuerySetModifications"),this.nextQueryId=0,this.querySetVersion=0,this.identityVersion=0,this.querySet=new Map,this.queryIdToToken=new Map,this.outstandingQueriesOlderThanRestart=new Set,this.outstandingAuthOlderThanRestart=!1,this.paused=!1,this.pendingQuerySetModifications=new Map}hasSyncedPastLastReconnect(){return 0===this.outstandingQueriesOlderThanRestart.size&&!this.outstandingAuthOlderThanRestart}markAuthCompletion(){this.outstandingAuthOlderThanRestart=!1}subscribe(e,t,s,i){let r=d(e),n=f(r,t),o=this.querySet.get(n);if(void 0!==o)return o.numSubscribers+=1,{queryToken:n,modification:null,unsubscribe:()=>this.removeSubscriber(n)};{let e=this.nextQueryId++;this.querySet.set(n,{id:e,canonicalizedUdfPath:r,args:t,numSubscribers:1,journal:s,componentPath:i}),this.queryIdToToken.set(e,n);let o=this.querySetVersion,a=this.querySetVersion+1,u={type:"Add",queryId:e,udfPath:r,args:[(0,c.convexToJson)(t)],journal:s,componentPath:i};return this.paused?this.pendingQuerySetModifications.set(e,u):this.querySetVersion=a,{queryToken:n,modification:{type:"ModifyQuerySet",baseVersion:o,newVersion:a,modifications:[u]},unsubscribe:()=>this.removeSubscriber(n)}}}transition(e){for(let t of e.modifications)switch(t.type){case"QueryUpdated":case"QueryFailed":{this.outstandingQueriesOlderThanRestart.delete(t.queryId);let e=t.journal;if(void 0!==e){let s=this.queryIdToToken.get(t.queryId);void 0!==s&&(this.querySet.get(s).journal=e)}break}case"QueryRemoved":this.outstandingQueriesOlderThanRestart.delete(t.queryId);break;default:throw Error(`Invalid modification ${t.type}`)}}queryId(e,t){let s=f(d(e),t),i=this.querySet.get(s);return void 0!==i?i.id:null}isCurrentOrNewerAuthVersion(e){return e>=this.identityVersion}getAuth(){return this.auth}setAuth(e){this.auth={tokenType:"User",value:e};let t=this.identityVersion;return this.paused||(this.identityVersion=t+1),{type:"Authenticate",baseVersion:t,...this.auth}}setAdminAuth(e,t){let s={tokenType:"Admin",value:e,impersonating:t};this.auth=s;let i=this.identityVersion;return this.paused||(this.identityVersion=i+1),{type:"Authenticate",baseVersion:i,...s}}clearAuth(){this.auth=void 0,this.markAuthCompletion();let e=this.identityVersion;return this.paused||(this.identityVersion=e+1),{type:"Authenticate",tokenType:"None",baseVersion:e}}hasAuth(){return!!this.auth}isNewAuth(e){return this.auth?.value!==e}queryPath(e){let t=this.queryIdToToken.get(e);return t?this.querySet.get(t).canonicalizedUdfPath:null}queryArgs(e){let t=this.queryIdToToken.get(e);return t?this.querySet.get(t).args:null}queryToken(e){return this.queryIdToToken.get(e)??null}queryJournal(e){return this.querySet.get(e)?.journal}restart(e){this.unpause(),this.outstandingQueriesOlderThanRestart.clear();let t=[];for(let s of this.querySet.values()){let i={type:"Add",queryId:s.id,udfPath:s.canonicalizedUdfPath,args:[(0,c.convexToJson)(s.args)],journal:s.journal,componentPath:s.componentPath};t.push(i),e.has(s.id)||this.outstandingQueriesOlderThanRestart.add(s.id)}this.querySetVersion=1;let s={type:"ModifyQuerySet",baseVersion:0,newVersion:1,modifications:t};if(!this.auth)return this.identityVersion=0,[s,void 0];this.outstandingAuthOlderThanRestart=!0;let i={type:"Authenticate",baseVersion:0,...this.auth};return this.identityVersion=1,[s,i]}pause(){this.paused=!0}resume(){let e=this.pendingQuerySetModifications.size>0?{type:"ModifyQuerySet",baseVersion:this.querySetVersion,newVersion:++this.querySetVersion,modifications:Array.from(this.pendingQuerySetModifications.values())}:void 0,t=void 0!==this.auth?{type:"Authenticate",baseVersion:this.identityVersion++,...this.auth}:void 0;return this.unpause(),[e,t]}unpause(){this.paused=!1,this.pendingQuerySetModifications.clear()}removeSubscriber(e){let t=this.querySet.get(e);if(t.numSubscribers>1)return t.numSubscribers-=1,null;{this.querySet.delete(e),this.queryIdToToken.delete(t.id),this.outstandingQueriesOlderThanRestart.delete(t.id);let s=this.querySetVersion,i=this.querySetVersion+1,r={type:"Remove",queryId:t.id};return this.paused?this.pendingQuerySetModifications.has(t.id)?this.pendingQuerySetModifications.delete(t.id):this.pendingQuerySetModifications.set(t.id,r):this.querySetVersion=i,{type:"ModifyQuerySet",baseVersion:s,newVersion:i,modifications:[r]}}}}e.s(["LocalSyncState",()=>v],617350);var b=Object.defineProperty,w=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?b(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};class k{constructor(e,t){this.logger=e,this.markConnectionStateDirty=t,w(this,"inflightRequests"),w(this,"requestsOlderThanRestart"),w(this,"inflightMutationsCount",0),w(this,"inflightActionsCount",0),this.inflightRequests=new Map,this.requestsOlderThanRestart=new Set}request(e,t){let s=new Promise(s=>{this.inflightRequests.set(e.requestId,{message:e,status:{status:t?"Requested":"NotSent",requestedAt:new Date,onResult:s}}),"Mutation"===e.type?this.inflightMutationsCount++:"Action"===e.type&&this.inflightActionsCount++});return this.markConnectionStateDirty(),s}onResponse(e){let t,s,i=this.inflightRequests.get(e.requestId);if(void 0===i||"Completed"===i.status.status)return null;let r="Mutation"===i.message.type?"mutation":"action",n=i.message.udfPath;for(let t of e.logLines)a(this.logger,"info",r,n,t);let o=i.status;if(e.success)t={success:!0,logLines:e.logLines,value:(0,c.jsonToConvex)(e.result)},s=()=>o.onResult(t);else{let i=e.result,{errorData:u}=e;a(this.logger,"error",r,n,i),t={success:!1,errorMessage:i,errorData:void 0!==u?(0,c.jsonToConvex)(u):void 0,logLines:e.logLines},s=()=>o.onResult(t)}return"ActionResponse"!==e.type&&e.success?(i.status={status:"Completed",result:t,ts:e.ts,onResolve:s},null):(s(),this.inflightRequests.delete(e.requestId),this.requestsOlderThanRestart.delete(e.requestId),"Action"===i.message.type?this.inflightActionsCount--:"Mutation"===i.message.type&&this.inflightMutationsCount--,this.markConnectionStateDirty(),{requestId:e.requestId,result:t})}removeCompleted(e){let t=new Map;for(let[s,i]of this.inflightRequests.entries()){let r=i.status;"Completed"===r.status&&r.ts.lessThanOrEqual(e)&&(r.onResolve(),t.set(s,r.result),"Mutation"===i.message.type?this.inflightMutationsCount--:"Action"===i.message.type&&this.inflightActionsCount--,this.inflightRequests.delete(s),this.requestsOlderThanRestart.delete(s))}return t.size>0&&this.markConnectionStateDirty(),t}restart(){this.requestsOlderThanRestart=new Set(this.inflightRequests.keys());let e=[];for(let[t,s]of this.inflightRequests){if("NotSent"===s.status.status){s.status.status="Requested",e.push(s.message);continue}if("Mutation"===s.message.type)e.push(s.message);else if("Action"===s.message.type){if(this.inflightRequests.delete(t),this.requestsOlderThanRestart.delete(t),this.inflightActionsCount--,"Completed"===s.status.status)throw Error("Action should never be in 'Completed' state");s.status.onResult({success:!1,errorMessage:"Connection lost while action was in flight",logLines:[]})}}return this.markConnectionStateDirty(),e}resume(){let e=[];for(let[,t]of this.inflightRequests)if("NotSent"===t.status.status){t.status.status="Requested",e.push(t.message);continue}return e}hasIncompleteRequests(){for(let e of this.inflightRequests.values())if("Requested"===e.status.status)return!0;return!1}hasInflightRequests(){return this.inflightRequests.size>0}hasSyncedPastLastReconnect(){return 0===this.requestsOlderThanRestart.size}timeOfOldestInflightRequest(){if(0===this.inflightRequests.size)return null;let e=Date.now();for(let t of this.inflightRequests.values())"Completed"!==t.status.status&&t.status.requestedAt.getTime()<e&&(e=t.status.requestedAt.getTime());return new Date(e)}inflightMutations(){return this.inflightMutationsCount}inflightActions(){return this.inflightActionsCount}}e.s(["RequestManager",()=>k],237294)},68283,56531,e=>{"use strict";let t=Symbol.for("functionName");e.s(["functionName",0,t],56531);let s=Symbol.for("toReferencePath");function i(e,t){e[s]=t}function r(e){let i;if("string"==typeof e)i=e.startsWith("function://")?{functionHandle:e}:{name:e};else if(e[t])i={name:e[t]};else{let t=e[s]??null;if(!t)throw Error(`${e} is not a functionReference`);i={reference:t}}return i}e.s(["getFunctionAddress",()=>r,"setReferencePath",()=>i,"toReferencePath",0,s],68283)},938300,e=>{"use strict";var t=e.i(56531),s=e.i(68283);function i(e){let i=(0,s.getFunctionAddress)(e);if(void 0===i.name){if(void 0!==i.functionHandle)throw Error(`Expected function reference like "api.file.func" or "internal.file.func", but received function handle ${i.functionHandle}`);if(void 0!==i.reference)throw Error(`Expected function reference in the current component like "api.file.func" or "internal.file.func", but received reference ${i.reference}`);throw Error(`Expected function reference like "api.file.func" or "internal.file.func", but received ${JSON.stringify(i)}`)}if("string"==typeof e)return e;let r=e[t.functionName];if(!r)throw Error(`${e} is not a functionReference`);return r}let r=function e(s=[]){return new Proxy({},{get(i,r){if("string"==typeof r)return e([...s,r]);if(r===t.functionName){if(s.length<2){let e=["api",...s].join(".");throw Error(`API path is expected to be of the form \`api.moduleName.functionName\`. Found: \`${e}\``)}let e=s.slice(0,-1).join("/"),t=s[s.length-1];return"default"===t?e:e+":"+t}return r===Symbol.toStringTag?"FunctionReference":void 0}})}();e.s(["anyApi",0,r,"getFunctionName",()=>i])},450871,683499,e=>{"use strict";let t;var s=e.i(944568);e.i(784665);var i=e.i(920876),r=e.i(184169),n=e.i(617350),o=e.i(237294),a=e.i(938300),u=e.i(841204),h=e.i(500639),l=e.i(838771),c=Object.defineProperty,d=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?c(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};class f{constructor(e){d(this,"queryResults"),d(this,"modifiedQueries"),this.queryResults=e,this.modifiedQueries=[]}getQuery(e,...t){let s=(0,u.parseArgs)(t[0]),i=(0,a.getFunctionName)(e),r=this.queryResults.get((0,h.serializePathAndArgs)(i,s));if(void 0!==r)return f.queryValue(r.result)}getAllQueries(e){let t=[],s=(0,a.getFunctionName)(e);for(let e of this.queryResults.values())e.udfPath===(0,h.canonicalizeUdfPath)(s)&&t.push({args:e.args,value:f.queryValue(e.result)});return t}setQuery(e,t,s){let i=(0,u.parseArgs)(t),r=(0,a.getFunctionName)(e),n=(0,h.serializePathAndArgs)(r,i);this.queryResults.set(n,{udfPath:r,args:i,result:void 0===s?void 0:{success:!0,value:s,logLines:[]}}),this.modifiedQueries.push(n)}static queryValue(e){return void 0===e?void 0:e.success?e.value:void 0}}class g{constructor(){d(this,"queryResults"),d(this,"optimisticUpdates"),this.queryResults=new Map,this.optimisticUpdates=[]}ingestQueryResultsFromServer(e,t){this.optimisticUpdates=this.optimisticUpdates.filter(e=>!t.has(e.mutationId));let s=this.queryResults;this.queryResults=new Map(e);let i=new f(this.queryResults);for(let e of this.optimisticUpdates)e.update(i);let r=[];for(let[e,t]of this.queryResults){let i=s.get(e);(void 0===i||i.result!==t.result)&&r.push(e)}return r}applyOptimisticUpdate(e,t){this.optimisticUpdates.push({update:e,mutationId:t});let s=new f(this.queryResults);return e(s),s.modifiedQueries}rawQueryResult(e){let t=this.queryResults.get(e);if(void 0!==t)return t.result}queryResult(e){let t=this.queryResults.get(e);if(void 0===t)return;let s=t.result;if(void 0!==s){if(s.success)return s.value;if(void 0!==s.errorData)throw(0,r.forwardData)(s,new l.ConvexError((0,r.createHybridErrorStacktrace)("query",t.udfPath,s)));throw Error((0,r.createHybridErrorStacktrace)("query",t.udfPath,s))}}hasQueryResult(e){return void 0!==this.queryResults.get(e)}queryLogs(e){let t=this.queryResults.get(e);return t?.result?.logLines}}var p=Object.defineProperty,y=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?p(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};class m{constructor(e,t){y(this,"low"),y(this,"high"),y(this,"__isUnsignedLong__"),this.low=0|e,this.high=0|t,this.__isUnsignedLong__=!0}static isLong(e){return!0===(e&&e.__isUnsignedLong__)}static fromBytesLE(e){return new m(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24)}toBytesLE(){let e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]}static fromNumber(e){return isNaN(e)||e<0?v:e>=w?k:new m(e%b|0,e/b|0)}toString(){return(BigInt(this.high)*BigInt(b)+BigInt(this.low)).toString()}equals(e){return m.isLong(e)||(e=m.fromValue(e)),(this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low}notEquals(e){return!this.equals(e)}comp(e){return(m.isLong(e)||(e=m.fromValue(e)),this.equals(e))?0:e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1}lessThanOrEqual(e){return 0>=this.comp(e)}static fromValue(e){return"number"==typeof e?m.fromNumber(e):new m(e.low,e.high)}}let v=new m(0,0),b=0x100000000,w=0xffffffffffffffff,k=new m(-1,-1);e.s(["Long",()=>m],683499);var S=Object.defineProperty,C=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?S(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};class T{constructor(e,t){C(this,"version"),C(this,"remoteQuerySet"),C(this,"queryPath"),C(this,"logger"),this.version={querySet:0,ts:m.fromNumber(0),identity:0},this.remoteQuerySet=new Map,this.queryPath=e,this.logger=t}transition(e){let t=e.startVersion;if(this.version.querySet!==t.querySet||this.version.ts.notEquals(t.ts)||this.version.identity!==t.identity)throw Error(`Invalid start version: ${t.ts.toString()}:${t.querySet}:${t.identity}, transitioning from ${this.version.ts.toString()}:${this.version.querySet}:${this.version.identity}`);for(let t of e.modifications)switch(t.type){case"QueryUpdated":{let e=this.queryPath(t.queryId);if(e)for(let s of t.logLines)(0,r.logForFunction)(this.logger,"info","query",e,s);let s=(0,i.jsonToConvex)(t.value??null);this.remoteQuerySet.set(t.queryId,{success:!0,value:s,logLines:t.logLines});break}case"QueryFailed":{let e=this.queryPath(t.queryId);if(e)for(let s of t.logLines)(0,r.logForFunction)(this.logger,"info","query",e,s);let{errorData:s}=t;this.remoteQuerySet.set(t.queryId,{success:!1,errorMessage:t.errorMessage,errorData:void 0!==s?(0,i.jsonToConvex)(s):void 0,logLines:t.logLines});break}case"QueryRemoved":this.remoteQuerySet.delete(t.queryId);break;default:throw Error(`Invalid modification ${t.type}`)}this.version=e.endVersion}remoteQueryResults(){return this.remoteQuerySet}timestamp(){return this.version.ts}}var x=e.i(627844),x=x;function A(e){let t=x.toByteArray(e);return m.fromBytesLE(Array.from(t))}function R(e){switch(e.type){case"FatalError":case"AuthError":case"ActionResponse":case"TransitionChunk":case"Ping":return{...e};case"MutationResponse":if(e.success)return{...e,ts:A(e.ts)};return{...e};case"Transition":return{...e,startVersion:{...e.startVersion,ts:A(e.startVersion.ts)},endVersion:{...e.endVersion,ts:A(e.endVersion.ts)}}}}var q=Object.defineProperty,O=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?q(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};function $(){return(void 0===t&&(t=Date.now()),"undefined"!=typeof performance&&performance.now)?Math.round(t+performance.now()):Date.now()}function I(){return`t=${Math.round(($()-t)/100)/10}s`}let E={InternalServerError:{timeout:1e3},SubscriptionsWorkerFullError:{timeout:3e3},TooManyConcurrentRequests:{timeout:3e3},CommitterFullError:{timeout:3e3},AwsTooManyRequestsException:{timeout:3e3},ExecuteFullError:{timeout:3e3},SystemTimeoutError:{timeout:3e3},ExpiredInQueue:{timeout:3e3},VectorIndexesUnavailable:{timeout:1e3},SearchIndexesUnavailable:{timeout:1e3},TableSummariesUnavailable:{timeout:1e3},VectorIndexTooLarge:{timeout:3e3},SearchIndexTooLarge:{timeout:3e3},TooManyWritesInTimePeriod:{timeout:3e3}};class M{constructor(e,t,s,i,r,n){this.markConnectionStateDirty=r,this.debug=n,O(this,"socket"),O(this,"connectionCount"),O(this,"_hasEverConnected",!1),O(this,"lastCloseReason"),O(this,"transitionChunkBuffer",null),O(this,"defaultInitialBackoff"),O(this,"maxBackoff"),O(this,"retries"),O(this,"serverInactivityThreshold"),O(this,"reconnectDueToServerInactivityTimeout"),O(this,"uri"),O(this,"onOpen"),O(this,"onResume"),O(this,"onMessage"),O(this,"webSocketConstructor"),O(this,"logger"),O(this,"onServerDisconnectError"),this.webSocketConstructor=s,this.socket={state:"disconnected"},this.connectionCount=0,this.lastCloseReason="InitialConnect",this.defaultInitialBackoff=1e3,this.maxBackoff=16e3,this.retries=0,this.serverInactivityThreshold=6e4,this.reconnectDueToServerInactivityTimeout=null,this.uri=e,this.onOpen=t.onOpen,this.onResume=t.onResume,this.onMessage=t.onMessage,this.onServerDisconnectError=t.onServerDisconnectError,this.logger=i,this.connect()}setSocketState(e){this.socket=e,this._logVerbose(`socket state changed: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}`),this.markConnectionStateDirty()}assembleTransition(e){if(e.partNumber<0||e.partNumber>=e.totalParts||0===e.totalParts||this.transitionChunkBuffer&&(this.transitionChunkBuffer.totalParts!==e.totalParts||this.transitionChunkBuffer.transitionId!==e.transitionId))throw this.transitionChunkBuffer=null,Error("Invalid TransitionChunk");if(null===this.transitionChunkBuffer&&(this.transitionChunkBuffer={chunks:[],totalParts:e.totalParts,transitionId:e.transitionId}),e.partNumber!==this.transitionChunkBuffer.chunks.length){let t=this.transitionChunkBuffer.chunks.length;throw this.transitionChunkBuffer=null,Error(`TransitionChunk received out of order: expected part ${t}, got ${e.partNumber}`)}if(this.transitionChunkBuffer.chunks.push(e.chunk),this.transitionChunkBuffer.chunks.length===e.totalParts){let e=this.transitionChunkBuffer.chunks.join("");this.transitionChunkBuffer=null;let t=R(JSON.parse(e));if("Transition"!==t.type)throw Error(`Expected Transition, got ${t.type} after assembling chunks`);return t}return null}connect(){if("terminated"===this.socket.state)return;if("disconnected"!==this.socket.state&&"stopped"!==this.socket.state)throw Error("Didn't start connection from disconnected state: "+this.socket.state);let e=new this.webSocketConstructor(this.uri);this._logVerbose("constructed WebSocket"),this.setSocketState({state:"connecting",ws:e,paused:"no"}),this.resetServerInactivityTimeout(),e.onopen=()=>{if(this.logger.logVerbose("begin ws.onopen"),"connecting"!==this.socket.state)throw Error("onopen called with socket not in connecting state");this.setSocketState({state:"ready",ws:e,paused:"yes"===this.socket.paused?"uninitialized":"no"}),this.resetServerInactivityTimeout(),"no"===this.socket.paused&&(this._hasEverConnected=!0,this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason,clientTs:$()})),"InitialConnect"!==this.lastCloseReason&&(this.lastCloseReason?this.logger.log("WebSocket reconnected at",I(),"after disconnect due to",this.lastCloseReason):this.logger.log("WebSocket reconnected at",I())),this.connectionCount+=1,this.lastCloseReason=null},e.onerror=e=>{this.transitionChunkBuffer=null;let t=e.message;t&&this.logger.log(`WebSocket error message: ${t}`)},e.onmessage=e=>{this.resetServerInactivityTimeout();let t=e.data.length,s=R(JSON.parse(e.data));if(this._logVerbose(`received ws message with type ${s.type}`),"Ping"!==s.type){if("TransitionChunk"===s.type){let e=this.assembleTransition(s);if(!e)return;s=e,this._logVerbose(`assembled full ws message of type ${s.type}`)}null!==this.transitionChunkBuffer&&(this.transitionChunkBuffer=null,this.logger.log(`Received unexpected ${s.type} while buffering TransitionChunks`)),"Transition"===s.type&&this.reportLargeTransition({messageLength:t,transition:s}),this.onMessage(s).hasSyncedPastLastReconnect&&(this.retries=0,this.markConnectionStateDirty())}},e.onclose=e=>{if(this._logVerbose("begin ws.onclose"),this.transitionChunkBuffer=null,null===this.lastCloseReason&&(this.lastCloseReason=e.reason||`closed with code ${e.code}`),1e3!==e.code&&1001!==e.code&&1005!==e.code&&4040!==e.code){let t=`WebSocket closed with code ${e.code}`;e.reason&&(t+=`: ${e.reason}`),this.logger.log(t),this.onServerDisconnectError&&e.reason&&this.onServerDisconnectError(t)}let t=function(e){if(void 0===e)return"Unknown";for(let t of Object.keys(E))if(e.startsWith(t))return t;return"Unknown"}(e.reason);this.scheduleReconnect(t)}}socketState(){return this.socket.state}sendMessage(e){let t={type:e.type,..."Authenticate"===e.type&&"User"===e.tokenType?{value:`...${e.value.slice(-7)}`}:{}};if("ready"===this.socket.state&&"no"===this.socket.paused){let s=JSON.stringify(function(e){switch(e.type){case"Authenticate":case"ModifyQuerySet":case"Mutation":case"Action":case"Event":return{...e};case"Connect":let t;if(void 0===e.maxObservedTimestamp)return{...e,maxObservedTimestamp:void 0};return{...e,maxObservedTimestamp:(t=new Uint8Array(e.maxObservedTimestamp.toBytesLE()),x.fromByteArray(t))}}}(e)),i=!1;try{this.socket.ws.send(s),i=!0}catch(e){this.logger.log(`Failed to send message on WebSocket, reconnecting: ${e}`),this.closeAndReconnect("FailedToSendMessage")}return this._logVerbose(`${i?"sent":"failed to send"} message with type ${e.type}: ${JSON.stringify(t)}`),!0}return this._logVerbose(`message not sent (socket state: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}): ${JSON.stringify(t)}`),!1}resetServerInactivityTimeout(){"terminated"!==this.socket.state&&(null!==this.reconnectDueToServerInactivityTimeout&&(clearTimeout(this.reconnectDueToServerInactivityTimeout),this.reconnectDueToServerInactivityTimeout=null),this.reconnectDueToServerInactivityTimeout=setTimeout(()=>{this.closeAndReconnect("InactiveServer")},this.serverInactivityThreshold))}scheduleReconnect(e){this.socket={state:"disconnected"};let t=this.nextBackoff(e);this.markConnectionStateDirty(),this.logger.log(`Attempting reconnect in ${Math.round(t)}ms`),setTimeout(()=>this.connect(),t)}closeAndReconnect(e){switch(this._logVerbose(`begin closeAndReconnect with reason ${e}`),this.socket.state){case"disconnected":case"terminated":case"stopped":return;case"connecting":case"ready":this.lastCloseReason=e,this.close(),this.scheduleReconnect("client");return;default:this.socket}}close(){switch(this.transitionChunkBuffer=null,this.socket.state){case"disconnected":case"terminated":case"stopped":return Promise.resolve();case"connecting":{let e=this.socket.ws;return e.onmessage=e=>{this._logVerbose("Ignoring message received after close")},new Promise(t=>{e.onclose=()=>{this._logVerbose("Closed after connecting"),t()},e.onopen=()=>{this._logVerbose("Opened after connecting"),e.close()}})}case"ready":{this._logVerbose("ws.close called");let e=this.socket.ws;e.onmessage=e=>{this._logVerbose("Ignoring message received after close")};let t=new Promise(t=>{e.onclose=()=>{t()}});return e.close(),t}default:return this.socket,Promise.resolve()}}terminate(){switch(this.reconnectDueToServerInactivityTimeout&&clearTimeout(this.reconnectDueToServerInactivityTimeout),this.socket.state){case"terminated":case"stopped":case"disconnected":case"connecting":case"ready":{let e=this.close();return this.setSocketState({state:"terminated"}),e}default:throw this.socket,Error(`Invalid websocket state: ${this.socket.state}`)}}stop(){switch(this.socket.state){case"terminated":return Promise.resolve();case"connecting":case"stopped":case"disconnected":case"ready":{let e=this.close();return this.socket={state:"stopped"},e}default:return this.socket,Promise.resolve()}}tryRestart(){switch(this.socket.state){case"stopped":break;case"terminated":case"connecting":case"ready":case"disconnected":this.logger.logVerbose("Restart called without stopping first");return;default:this.socket}this.connect()}pause(){switch(this.socket.state){case"disconnected":case"stopped":case"terminated":return;case"connecting":case"ready":this.socket={...this.socket,paused:"yes"};return;default:return void this.socket}}resume(){switch(this.socket.state){case"connecting":this.socket={...this.socket,paused:"no"};return;case"ready":"uninitialized"===this.socket.paused?(this.socket={...this.socket,paused:"no"},this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason,clientTs:$()})):"yes"===this.socket.paused&&(this.socket={...this.socket,paused:"no"},this.onResume());return;case"terminated":case"stopped":case"disconnected":return;default:this.socket}this.connect()}connectionState(){return{isConnected:"ready"===this.socket.state,hasEverConnected:this._hasEverConnected,connectionCount:this.connectionCount,connectionRetries:this.retries}}_logVerbose(e){this.logger.logVerbose(e)}nextBackoff(e){let t=("client"===e?100:"Unknown"===e?this.defaultInitialBackoff:E[e].timeout)*Math.pow(2,this.retries);this.retries+=1;let s=Math.min(t,this.maxBackoff),i=s*(Math.random()-.5);return s+i}reportLargeTransition({transition:e,messageLength:t}){if(void 0===e.clientClockSkew||void 0===e.serverTs)return;let s=$()-e.clientClockSkew-e.serverTs/1e6,i=`${Math.round(s)}ms`,r=`${Math.round(t/1e4)/100}MB`,n=t/(s/1e3),o=`${Math.round(n/1e4)/100}MB per second`;this._logVerbose(`received ${r} transition in ${i} at ${o}`),t>2e7?this.logger.log(`received query results totaling more that 20MB (${r}) which will take a long time to download on slower connections`):s>2e4&&this.logger.log(`received query results totaling ${r} which took more than 20s to arrive (${i})`),this.debug&&this.sendMessage({type:"Event",eventType:"ClientReceivedTransition",event:{transitionTransitTime:s,messageLength:t}})}}class Q extends Error{}function P(e,t){let s;if("string"!=typeof e)throw new Q("Invalid token specified: must be a string");t||(t={});let i=+(!0!==t.header),r=e.split(".")[i];if("string"!=typeof r)throw new Q(`Invalid token specified: missing part #${i+1}`);try{s=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var s;return s=t,decodeURIComponent(atob(s).replace(/(.)/g,(e,t)=>{let s=t.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}catch{return atob(t)}}(r)}catch(e){throw new Q(`Invalid token specified: invalid base64 for part #${i+1} (${e.message})`)}try{return JSON.parse(s)}catch(e){throw new Q(`Invalid token specified: invalid json for part #${i+1} (${e.message})`)}}Q.prototype.name="InvalidTokenError";var V=Object.defineProperty,j=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?V(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};class F{constructor(e,t,s){j(this,"authState",{state:"noAuth"}),j(this,"configVersion",0),j(this,"syncState"),j(this,"authenticate"),j(this,"stopSocket"),j(this,"tryRestartSocket"),j(this,"pauseSocket"),j(this,"resumeSocket"),j(this,"clearAuth"),j(this,"logger"),j(this,"refreshTokenLeewaySeconds"),j(this,"tokenConfirmationAttempts",0),this.syncState=e,this.authenticate=t.authenticate,this.stopSocket=t.stopSocket,this.tryRestartSocket=t.tryRestartSocket,this.pauseSocket=t.pauseSocket,this.resumeSocket=t.resumeSocket,this.clearAuth=t.clearAuth,this.logger=s.logger,this.refreshTokenLeewaySeconds=s.refreshTokenLeewaySeconds}async setConfig(e,t){this.resetAuthState(),this._logVerbose("pausing WS for auth token fetch"),this.pauseSocket();let s=await this.fetchTokenAndGuardAgainstRace(e,{forceRefreshToken:!1});s.isFromOutdatedConfig||(s.value?(this.setAuthState({state:"waitingForServerConfirmationOfCachedToken",config:{fetchToken:e,onAuthChange:t},hasRetried:!1}),this.authenticate(s.value)):(this.setAuthState({state:"initialRefetch",config:{fetchToken:e,onAuthChange:t}}),await this.refetchToken()),this._logVerbose("resuming WS after auth token fetch"),this.resumeSocket())}onTransition(e){if(this.syncState.isCurrentOrNewerAuthVersion(e.endVersion.identity)&&!(e.endVersion.identity<=e.startVersion.identity)){if("waitingForServerConfirmationOfCachedToken"===this.authState.state){this._logVerbose("server confirmed auth token is valid"),this.refetchToken(),this.authState.config.onAuthChange(!0);return}"waitingForServerConfirmationOfFreshToken"===this.authState.state&&(this._logVerbose("server confirmed new auth token is valid"),this.scheduleTokenRefetch(this.authState.token),this.tokenConfirmationAttempts=0,this.authState.hadAuth||this.authState.config.onAuthChange(!0))}}onAuthError(e){if(!1===e.authUpdateAttempted&&("waitingForServerConfirmationOfFreshToken"===this.authState.state||"waitingForServerConfirmationOfCachedToken"===this.authState.state))return void this._logVerbose("ignoring non-auth token expired error");let{baseVersion:t}=e;this.syncState.isCurrentOrNewerAuthVersion(t+1)?this.tryToReauthenticate(e):this._logVerbose("ignoring auth error for previous auth attempt")}async tryToReauthenticate(e){if(this._logVerbose(`attempting to reauthenticate: ${e.error}`),"noAuth"===this.authState.state||"waitingForServerConfirmationOfFreshToken"===this.authState.state&&this.tokenConfirmationAttempts>=2){this.logger.error(`Failed to authenticate: "${e.error}", check your server auth config`),this.syncState.hasAuth()&&this.syncState.clearAuth(),"noAuth"!==this.authState.state&&this.setAndReportAuthFailed(this.authState.config.onAuthChange);return}"waitingForServerConfirmationOfFreshToken"===this.authState.state&&(this.tokenConfirmationAttempts++,this._logVerbose(`retrying reauthentication, ${2-this.tokenConfirmationAttempts} attempts remaining`)),await this.stopSocket();let t=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});t.isFromOutdatedConfig||(t.value&&this.syncState.isNewAuth(t.value)?(this.authenticate(t.value),this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",config:this.authState.config,token:t.value,hadAuth:"notRefetching"===this.authState.state||"waitingForScheduledRefetch"===this.authState.state})):(this._logVerbose("reauthentication failed, could not fetch a new token"),this.syncState.hasAuth()&&this.syncState.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this.tryRestartSocket())}async refetchToken(){if("noAuth"===this.authState.state)return;this._logVerbose("refetching auth token");let e=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});e.isFromOutdatedConfig||(e.value?this.syncState.isNewAuth(e.value)?(this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",hadAuth:this.syncState.hasAuth(),token:e.value,config:this.authState.config}),this.authenticate(e.value)):this.setAuthState({state:"notRefetching",config:this.authState.config}):(this._logVerbose("refetching token failed"),this.syncState.hasAuth()&&this.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this._logVerbose("restarting WS after auth token fetch (if currently stopped)"),this.tryRestartSocket())}scheduleTokenRefetch(e){if("noAuth"===this.authState.state)return;let t=this.decodeToken(e);if(!t)return void this.logger.error("Auth token is not a valid JWT, cannot refetch the token");let{iat:s,exp:i}=t;if(!s||!i)return void this.logger.error("Auth token does not have required fields, cannot refetch the token");let r=i-s;if(r<=2)return void this.logger.error("Auth token does not live long enough, cannot refetch the token");let n=Math.min(1728e6,(r-this.refreshTokenLeewaySeconds)*1e3);n<=0&&(this.logger.warn(`Refetching auth token immediately, configured leeway ${this.refreshTokenLeewaySeconds}s is larger than the token's lifetime ${r}s`),n=0);let o=setTimeout(()=>{this._logVerbose("running scheduled token refetch"),this.refetchToken()},n);this.setAuthState({state:"waitingForScheduledRefetch",refetchTokenTimeoutId:o,config:this.authState.config}),this._logVerbose(`scheduled preemptive auth token refetching in ${n}ms`)}async fetchTokenAndGuardAgainstRace(e,t){let s=++this.configVersion;this._logVerbose(`fetching token with config version ${s}`);let i=await e(t);return this.configVersion!==s?(this._logVerbose(`stale config version, expected ${s}, got ${this.configVersion}`),{isFromOutdatedConfig:!0}):{isFromOutdatedConfig:!1,value:i}}stop(){this.resetAuthState(),this.configVersion++,this._logVerbose(`config version bumped to ${this.configVersion}`)}setAndReportAuthFailed(e){e(!1),this.resetAuthState()}resetAuthState(){this.setAuthState({state:"noAuth"})}setAuthState(e){let t="waitingForServerConfirmationOfFreshToken"===e.state?{hadAuth:e.hadAuth,state:e.state,token:`...${e.token.slice(-7)}`}:{state:e.state};switch(this._logVerbose(`setting auth state to ${JSON.stringify(t)}`),e.state){case"waitingForScheduledRefetch":case"notRefetching":case"noAuth":this.tokenConfirmationAttempts=0}"waitingForScheduledRefetch"===this.authState.state&&(clearTimeout(this.authState.refetchTokenTimeoutId),this.syncState.markAuthCompletion()),this.authState=e}decodeToken(e){try{return P(e)}catch(e){return this._logVerbose(`Error decoding token: ${e instanceof Error?e.message:"Unknown error"}`),null}}_logVerbose(e){this.logger.logVerbose(`${e} [v${this.configVersion}]`)}}let L=["convexClientConstructed","convexWebSocketOpen","convexFirstMessageReceived"];function _(e){let t=e.name.slice(6);return{name:t=t.charAt(0).toLowerCase()+t.slice(1),startTime:e.startTime}}var N=Object.defineProperty,D=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?N(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};class B{constructor(e,t,i){let a;if(D(this,"address"),D(this,"state"),D(this,"requestManager"),D(this,"webSocketManager"),D(this,"authenticationManager"),D(this,"remoteQuerySet"),D(this,"optimisticQueryResults"),D(this,"_transitionHandlerCounter",0),D(this,"_nextRequestId"),D(this,"_onTransitionFns",new Map),D(this,"_sessionId"),D(this,"firstMessageReceived",!1),D(this,"debug"),D(this,"logger"),D(this,"maxObservedTimestamp"),D(this,"connectionStateSubscribers",new Map),D(this,"nextConnectionStateSubscriberId",0),D(this,"_lastPublishedConnectionState"),D(this,"markConnectionStateDirty",()=>{Promise.resolve().then(()=>{let e=this.connectionState();if(JSON.stringify(e)!==JSON.stringify(this._lastPublishedConnectionState))for(let t of(this._lastPublishedConnectionState=e,this.connectionStateSubscribers.values()))t(e)})}),D(this,"mark",e=>{var t;this.debug&&(t=this.sessionId,"undefined"!=typeof performance&&performance.mark&&performance.mark(e,{detail:{sessionId:t}}))}),"object"==typeof e)throw Error("Passing a ClientConfig object is no longer supported. Pass the URL of the Convex deployment as a string directly.");i?.skipConvexDeploymentUrlCheck!==!0&&(0,u.validateDeploymentUrl)(e);const h=(i={...i}).authRefreshTokenLeewaySeconds??2;let l=i.webSocketConstructor;if(!l&&"undefined"==typeof WebSocket)throw Error("No WebSocket global variable defined! To use Convex in an environment without WebSocket try the HTTP client: https://docs.convex.dev/api/classes/browser.ConvexHttpClient");l=l||WebSocket,this.debug=i.reportDebugInfoToConvex??!1,this.address=e,this.logger=!1===i.logger?(0,r.instantiateNoopLogger)({verbose:i.verbose??!1}):!0!==i.logger&&i.logger?i.logger:(0,r.instantiateDefaultLogger)({verbose:i.verbose??!1});const c=e.search("://");if(-1===c)throw Error("Provided address was not an absolute URL.");const d=e.substring(c+3),f=e.substring(0,c);if("http"===f)a="ws";else if("https"===f)a="wss";else throw Error(`Unknown parent protocol ${f}`);const p=`${a}://${d}/api/${s.version}/sync`;this.state=new n.LocalSyncState,this.remoteQuerySet=new T(e=>this.state.queryPath(e),this.logger),this.requestManager=new o.RequestManager(this.logger,this.markConnectionStateDirty);const y=()=>{this.webSocketManager.pause(),this.state.pause()};this.authenticationManager=new F(this.state,{authenticate:e=>{let t=this.state.setAuth(e);return this.webSocketManager.sendMessage(t),t.baseVersion},stopSocket:()=>this.webSocketManager.stop(),tryRestartSocket:()=>this.webSocketManager.tryRestart(),pauseSocket:y,resumeSocket:()=>this.webSocketManager.resume(),clearAuth:()=>{this.clearAuth()}},{logger:this.logger,refreshTokenLeewaySeconds:h}),this.optimisticQueryResults=new g,this.addOnTransitionHandler(e=>{t(e.queries.map(e=>e.token))}),this._nextRequestId=0,this._sessionId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});const{unsavedChangesWarning:m}=i;if(!0===m)throw Error("unsavedChangesWarning requested, but window.addEventListener not found! Remove {unsavedChangesWarning: true} from Convex client options.");this.webSocketManager=new M(p,{onOpen:e=>{this.mark("convexWebSocketOpen"),this.webSocketManager.sendMessage({...e,type:"Connect",sessionId:this._sessionId,maxObservedTimestamp:this.maxObservedTimestamp});let t=new Set(this.remoteQuerySet.remoteQueryResults().keys());this.remoteQuerySet=new T(e=>this.state.queryPath(e),this.logger);let[s,i]=this.state.restart(t);for(let e of(i&&this.webSocketManager.sendMessage(i),this.webSocketManager.sendMessage(s),this.requestManager.restart()))this.webSocketManager.sendMessage(e)},onResume:()=>{let[e,t]=this.state.resume();for(let s of(t&&this.webSocketManager.sendMessage(t),e&&this.webSocketManager.sendMessage(e),this.requestManager.resume()))this.webSocketManager.sendMessage(s)},onMessage:e=>{switch(!this.firstMessageReceived&&(this.firstMessageReceived=!0,this.mark("convexFirstMessageReceived"),this.reportMarks()),e.type){case"Transition":{this.observedTimestamp(e.endVersion.ts),this.authenticationManager.onTransition(e),this.remoteQuerySet.transition(e),this.state.transition(e);let t=this.requestManager.removeCompleted(this.remoteQuerySet.timestamp());this.notifyOnQueryResultChanges(t);break}case"MutationResponse":{e.success&&this.observedTimestamp(e.ts);let t=this.requestManager.onResponse(e);null!==t&&this.notifyOnQueryResultChanges(new Map([[t.requestId,t.result]]));break}case"ActionResponse":this.requestManager.onResponse(e);break;case"AuthError":this.authenticationManager.onAuthError(e);break;case"FatalError":{let t=(0,r.logFatalError)(this.logger,e.error);throw this.webSocketManager.terminate(),t}}return{hasSyncedPastLastReconnect:this.hasSyncedPastLastReconnect()}},onServerDisconnectError:i.onServerDisconnectError},l,this.logger,this.markConnectionStateDirty,this.debug),this.mark("convexClientConstructed"),i.expectAuth&&y()}hasSyncedPastLastReconnect(){return this.requestManager.hasSyncedPastLastReconnect()||this.state.hasSyncedPastLastReconnect()}observedTimestamp(e){(void 0===this.maxObservedTimestamp||this.maxObservedTimestamp.lessThanOrEqual(e))&&(this.maxObservedTimestamp=e)}getMaxObservedTimestamp(){return this.maxObservedTimestamp}notifyOnQueryResultChanges(e){let t=this.remoteQuerySet.remoteQueryResults(),s=new Map;for(let[e,i]of t){let t=this.state.queryToken(e);if(null!==t){let r={result:i,udfPath:this.state.queryPath(e),args:this.state.queryArgs(e)};s.set(t,r)}}let i=this.optimisticQueryResults.ingestQueryResultsFromServer(s,new Set(e.keys()));this.handleTransition({queries:i.map(e=>{let t=this.optimisticQueryResults.rawQueryResult(e);return{token:e,modification:{kind:"Updated",result:t}}}),reflectedMutations:Array.from(e).map(([e,t])=>({requestId:e,result:t})),timestamp:this.remoteQuerySet.timestamp()})}handleTransition(e){for(let t of this._onTransitionFns.values())t(e)}addOnTransitionHandler(e){let t=this._transitionHandlerCounter++;return this._onTransitionFns.set(t,e),()=>this._onTransitionFns.delete(t)}getCurrentAuthClaims(){let e=this.state.getAuth(),t={};if(e&&"User"===e.tokenType){try{t=e?P(e.value):{}}catch{t={}}return{token:e.value,decoded:t}}}setAuth(e,t){this.authenticationManager.setConfig(e,t)}hasAuth(){return this.state.hasAuth()}setAdminAuth(e,t){let s=this.state.setAdminAuth(e,t);this.webSocketManager.sendMessage(s)}clearAuth(){let e=this.state.clearAuth();this.webSocketManager.sendMessage(e)}subscribe(e,t,s){let i=(0,u.parseArgs)(t),{modification:r,queryToken:n,unsubscribe:o}=this.state.subscribe(e,i,s?.journal,s?.componentPath);return null!==r&&this.webSocketManager.sendMessage(r),{queryToken:n,unsubscribe:()=>{let e=o();e&&this.webSocketManager.sendMessage(e)}}}localQueryResult(e,t){let s=(0,u.parseArgs)(t),i=(0,h.serializePathAndArgs)(e,s);return this.optimisticQueryResults.queryResult(i)}localQueryResultByToken(e){return this.optimisticQueryResults.queryResult(e)}hasLocalQueryResultByToken(e){return this.optimisticQueryResults.hasQueryResult(e)}localQueryLogs(e,t){let s=(0,u.parseArgs)(t),i=(0,h.serializePathAndArgs)(e,s);return this.optimisticQueryResults.queryLogs(i)}queryJournal(e,t){let s=(0,u.parseArgs)(t),i=(0,h.serializePathAndArgs)(e,s);return this.state.queryJournal(i)}connectionState(){let e=this.webSocketManager.connectionState();return{hasInflightRequests:this.requestManager.hasInflightRequests(),isWebSocketConnected:e.isConnected,hasEverConnected:e.hasEverConnected,connectionCount:e.connectionCount,connectionRetries:e.connectionRetries,timeOfOldestInflightRequest:this.requestManager.timeOfOldestInflightRequest(),inflightMutations:this.requestManager.inflightMutations(),inflightActions:this.requestManager.inflightActions()}}subscribeToConnectionState(e){let t=this.nextConnectionStateSubscriberId++;return this.connectionStateSubscribers.set(t,e),()=>{this.connectionStateSubscribers.delete(t)}}async mutation(e,t,s){let i=await this.mutationInternal(e,t,s);if(!i.success){if(void 0!==i.errorData)throw(0,r.forwardData)(i,new l.ConvexError((0,r.createHybridErrorStacktrace)("mutation",e,i)));throw Error((0,r.createHybridErrorStacktrace)("mutation",e,i))}return i.value}async mutationInternal(e,t,s,i){let{mutationPromise:r}=this.enqueueMutation(e,t,s,i);return r}enqueueMutation(e,t,s,r){let n=(0,u.parseArgs)(t);this.tryReportLongDisconnect();let o=this.nextRequestId;if(this._nextRequestId++,void 0!==s){let e=s.optimisticUpdate;if(void 0!==e){let t=t=>{e(t,n)instanceof Promise&&this.logger.warn("Optimistic update handler returned a Promise. Optimistic updates should be synchronous.")},s=this.optimisticQueryResults.applyOptimisticUpdate(t,o).map(e=>{let t=this.localQueryResultByToken(e);return{token:e,modification:{kind:"Updated",result:void 0===t?void 0:{success:!0,value:t,logLines:[]}}}});this.handleTransition({queries:s,reflectedMutations:[],timestamp:this.remoteQuerySet.timestamp()})}}let a={type:"Mutation",requestId:o,udfPath:e,componentPath:r,args:[(0,i.convexToJson)(n)]},h=this.webSocketManager.sendMessage(a);return{requestId:o,mutationPromise:this.requestManager.request(a,h)}}async action(e,t){let s=await this.actionInternal(e,t);if(!s.success){if(void 0!==s.errorData)throw(0,r.forwardData)(s,new l.ConvexError((0,r.createHybridErrorStacktrace)("action",e,s)));throw Error((0,r.createHybridErrorStacktrace)("action",e,s))}return s.value}async actionInternal(e,t,s){let r=(0,u.parseArgs)(t),n=this.nextRequestId;this._nextRequestId++,this.tryReportLongDisconnect();let o={type:"Action",requestId:n,udfPath:e,componentPath:s,args:[(0,i.convexToJson)(r)]},a=this.webSocketManager.sendMessage(o);return this.requestManager.request(o,a)}async close(){return this.authenticationManager.stop(),this.webSocketManager.terminate()}get url(){return this.address}get nextRequestId(){return this._nextRequestId}get sessionId(){return this._sessionId}reportMarks(){if(this.debug){let e=function(e){if("undefined"==typeof performance||!performance.getEntriesByName)return[];let t=[];for(let s of L){let i=performance.getEntriesByName(s).filter(e=>"mark"===e.entryType).filter(t=>t.detail.sessionId===e);t.push(...i)}return t.map(_)}(this.sessionId);this.webSocketManager.sendMessage({type:"Event",eventType:"ClientConnect",event:e})}}tryReportLongDisconnect(){if(!this.debug)return;let e=this.connectionState().timeOfOldestInflightRequest;null===e||Date.now()-e.getTime()<=6e4||fetch(`${this.address}/api/debug_event`,{method:"POST",headers:{"Content-Type":"application/json","Convex-Client":`npm-${s.version}`},body:JSON.stringify({event:"LongWebsocketDisconnect"})}).then(e=>{e.ok||this.logger.warn("Analytics request failed with response:",e.body)}).catch(e=>{this.logger.warn("Analytics response failed with error:",e)})}}e.s(["BaseConvexClient",()=>B],450871)},979600,e=>{"use strict";let t;e.s(["ConvexClient",()=>g,"setDefaultWebSocketConstructor",()=>f],979600);var s=e.i(841204);e.i(607572);var i=e.i(450871),r=e.i(938300),n=e.i(500639);function o(e){if("object"!=typeof e||null===e||!Array.isArray(e.page)||"boolean"!=typeof e.isDone||"string"!=typeof e.continueCursor)throw Error(`Not a valid paginated query result: ${e?.toString()}`);return e}var a=e.i(683499),u=Object.defineProperty,h=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?u(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};class l{constructor(e,t){this.client=e,this.onTransition=t,h(this,"paginatedQuerySet",new Map),h(this,"lastTransitionTs"),this.lastTransitionTs=a.Long.fromNumber(0),this.client.addOnTransitionHandler(e=>this.onBaseTransition(e))}subscribe(e,t,s){let i=(0,n.canonicalizeUdfPath)(e),r=(0,n.serializePaginatedPathAndArgs)(i,t,s),o=()=>this.removePaginatedQuerySubscriber(r),a=this.paginatedQuerySet.get(r);return a?a.numSubscribers+=1:(this.paginatedQuerySet.set(r,{token:r,canonicalizedUdfPath:i,args:t,numSubscribers:1,options:{initialNumItems:s.initialNumItems},nextPageKey:0,pageKeys:[],pageKeyToQuery:new Map,ongoingSplits:new Map,skip:!1,id:s.id}),this.addPageToPaginatedQuery(r,null,s.initialNumItems)),{paginatedQueryToken:r,unsubscribe:o}}localQueryResult(e,t,s){let i=(0,n.canonicalizeUdfPath)(e),r=(0,n.serializePaginatedPathAndArgs)(i,t,s);return this.localQueryResultByToken(r)}localQueryResultByToken(e){let t,s=this.paginatedQuerySet.get(e);if(!s)return;let i=this.activePageQueryTokens(s);if(0===i.length)return{results:[],status:"LoadingFirstPage",loadMore:t=>this.loadMoreOfPaginatedQuery(e,t)};let r=[],n=!1,a=!1;for(let e of i){let t=this.client.localQueryResultByToken(e);if(void 0===t){n=!0,a=!1;continue}let s=o(t);r=r.concat(s.page),a=!!s.isDone}return t=n?0===r.length?"LoadingFirstPage":"LoadingMore":a?"Exhausted":"CanLoadMore",{results:r,status:t,loadMore:t=>this.loadMoreOfPaginatedQuery(e,t)}}onBaseTransition(e){let t=e.queries.map(e=>e.token),s=this.queriesContainingTokens(t),i=[];s.length>0&&(this.processPaginatedQuerySplits(s,e=>this.client.localQueryResultByToken(e)),i=s.map(e=>({token:e,modification:{kind:"Updated",result:this.localQueryResultByToken(e)}})));let r={...e,paginatedQueries:i};this.onTransition(r)}loadMoreOfPaginatedQuery(e,t){this.mustGetPaginatedQuery(e);let s=this.queryTokenForLastPageOfPaginatedQuery(e),i=this.client.localQueryResultByToken(s);if(!i)return!1;let r=o(i);if(r.isDone)return!1;this.addPageToPaginatedQuery(e,r.continueCursor,t);let n={timestamp:this.lastTransitionTs,reflectedMutations:[],queries:[],paginatedQueries:[{token:e,modification:{kind:"Updated",result:this.localQueryResultByToken(e)}}]};return this.onTransition(n),!0}queriesContainingTokens(e){if(0===e.length)return[];let t=[],s=new Set(e);for(let[e,i]of this.paginatedQuerySet)for(let r of this.allQueryTokens(i))if(s.has(r)){t.push(e);break}return t}processPaginatedQuerySplits(e,t){for(let s of e){let e=this.mustGetPaginatedQuery(s),{ongoingSplits:i,pageKeyToQuery:r,pageKeys:n}=e;for(let[s,[n,o]]of i)void 0!==t(r.get(n).queryToken)&&void 0!==t(r.get(o).queryToken)&&this.completePaginatedQuerySplit(e,s,n,o);for(let s of n){if(i.has(s))continue;let n=t(r.get(s).queryToken);if(!n)continue;let a=o(n);a.splitCursor&&("SplitRecommended"===a.pageStatus||"SplitRequired"===a.pageStatus||a.page.length>2*e.options.initialNumItems)&&this.splitPaginatedQueryPage(e,s,a.splitCursor,a.continueCursor)}}}splitPaginatedQueryPage(e,t,s,i){let r=e.nextPageKey++,n=e.nextPageKey++,o={cursor:i,numItems:e.options.initialNumItems,id:e.id},a=this.client.subscribe(e.canonicalizedUdfPath,{...e.args,paginationOpts:{...o,cursor:null,endCursor:s}});e.pageKeyToQuery.set(r,a);let u=this.client.subscribe(e.canonicalizedUdfPath,{...e.args,paginationOpts:{...o,cursor:s,endCursor:i}});e.pageKeyToQuery.set(n,u),e.ongoingSplits.set(t,[r,n])}addPageToPaginatedQuery(e,t,s){let i=this.mustGetPaginatedQuery(e),r=i.nextPageKey++,n={cursor:t,numItems:s,id:i.id},o={...i.args,paginationOpts:n},a=this.client.subscribe(i.canonicalizedUdfPath,o);return i.pageKeys.push(r),i.pageKeyToQuery.set(r,a),a}removePaginatedQuerySubscriber(e){let t=this.paginatedQuerySet.get(e);if(t&&(t.numSubscribers-=1,!(t.numSubscribers>0))){for(let e of t.pageKeyToQuery.values())e.unsubscribe();this.paginatedQuerySet.delete(e)}}completePaginatedQuerySplit(e,t,s,i){let r=e.pageKeyToQuery.get(t);e.pageKeyToQuery.delete(t);let n=e.pageKeys.indexOf(t);e.pageKeys.splice(n,1,s,i),e.ongoingSplits.delete(t),r.unsubscribe()}activePageQueryTokens(e){return e.pageKeys.map(t=>e.pageKeyToQuery.get(t).queryToken)}allQueryTokens(e){return Array.from(e.pageKeyToQuery.values()).map(e=>e.queryToken)}queryTokenForLastPageOfPaginatedQuery(e){let t=this.mustGetPaginatedQuery(e),s=t.pageKeys[t.pageKeys.length-1];if(void 0===s)throw Error(`No pages for paginated query ${e}`);return t.pageKeyToQuery.get(s).queryToken}mustGetPaginatedQuery(e){let t=this.paginatedQuerySet.get(e);if(!t)throw Error("paginated query no longer exists for token "+e);return t}}var c=Object.defineProperty,d=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?c(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};function f(e){t=e}class g{constructor(e,r={}){d(this,"listeners"),d(this,"_client"),d(this,"_paginatedClient"),d(this,"callNewListenersWithCurrentValuesTimer"),d(this,"_closed"),d(this,"_disabled"),!0!==r.skipConvexDeploymentUrlCheck&&(0,s.validateDeploymentUrl)(e);const{disabled:n,...o}=r;this._closed=!1,this._disabled=!!n,!t||"webSocketConstructor"in o||"undefined"!=typeof WebSocket||(o.webSocketConstructor=t),"unsavedChangesWarning"in o||(o.unsavedChangesWarning=!1),this.disabled||(this._client=new i.BaseConvexClient(e,()=>{},o),this._paginatedClient=new l(this._client,e=>this._transition(e))),this.listeners=new Set}get closed(){return this._closed}get client(){if(this._client)return this._client;throw Error("ConvexClient is disabled")}get paginatedClient(){if(this._paginatedClient)return this._paginatedClient;throw Error("ConvexClient is disabled")}get disabled(){return this._disabled}onUpdate(e,t,s,i){if(this.disabled)return this.createDisabledUnsubscribe();let{queryToken:n,unsubscribe:o}=this.client.subscribe((0,r.getFunctionName)(e),t),a={queryToken:n,callback:s,onError:i,unsubscribe:o,hasEverRun:!1,query:e,args:t,paginationOptions:void 0};this.listeners.add(a),this.queryResultReady(n)&&void 0===this.callNewListenersWithCurrentValuesTimer&&(this.callNewListenersWithCurrentValuesTimer=setTimeout(()=>this.callNewListenersWithCurrentValues(),0));let u={unsubscribe:()=>{this.closed||(this.listeners.delete(a),o())},getCurrentValue:()=>this.client.localQueryResultByToken(n),getQueryLogs:()=>this.client.localQueryLogs(n)},h=u.unsubscribe;return Object.assign(h,u),h}onPaginatedUpdate_experimental(e,t,s,i,n){if(this.disabled)return this.createDisabledUnsubscribe();let o={initialNumItems:s.initialNumItems,id:-1},{paginatedQueryToken:a,unsubscribe:u}=this.paginatedClient.subscribe((0,r.getFunctionName)(e),t,o),h={queryToken:a,callback:i,onError:n,unsubscribe:u,hasEverRun:!1,query:e,args:t,paginationOptions:o};this.listeners.add(h),this.paginatedClient.localQueryResultByToken(a)&&void 0===this.callNewListenersWithCurrentValuesTimer&&(this.callNewListenersWithCurrentValuesTimer=setTimeout(()=>this.callNewListenersWithCurrentValues(),0));let l={unsubscribe:()=>{this.closed||(this.listeners.delete(h),u())},getCurrentValue:()=>this.paginatedClient.localQueryResult((0,r.getFunctionName)(e),t,o),getQueryLogs:()=>[]},c=l.unsubscribe;return Object.assign(c,l),c}callNewListenersWithCurrentValues(){this.callNewListenersWithCurrentValuesTimer=void 0,this._transition({queries:[],paginatedQueries:[]},!0)}queryResultReady(e){return this.client.hasLocalQueryResultByToken(e)}createDisabledUnsubscribe(){let e=()=>{};return Object.assign(e,{unsubscribe:e,getCurrentValue:()=>void 0,getQueryLogs:()=>void 0}),e}async close(){if(!this.disabled)return this.listeners.clear(),this._closed=!0,this._paginatedClient&&(this._paginatedClient=void 0),this.client.close()}getAuth(){if(!this.disabled)return this.client.getCurrentAuthClaims()}setAuth(e,t){this.disabled||this.client.setAuth(e,t??(()=>{}))}setAdminAuth(e,t){if(this.closed)throw Error("ConvexClient has already been closed.");this.disabled||this.client.setAdminAuth(e,t)}_transition({queries:e,paginatedQueries:t},s=!1){let i=[...e.map(e=>e.token),...t.map(e=>e.token)];for(let e of this.listeners){let{callback:t,queryToken:r,onError:o,hasEverRun:a}=e,u=(0,n.serializedQueryTokenIsPaginated)(r),h=u?!!this.paginatedClient.localQueryResultByToken(r):this.client.hasLocalQueryResultByToken(r);if(i.includes(r)||s&&!a&&h){let s;e.hasEverRun=!0;try{s=u?this.paginatedClient.localQueryResultByToken(r):this.client.localQueryResultByToken(r)}catch(e){if(!(e instanceof Error))throw e;o?o(e,"Second argument to onUpdate onError is reserved for later use"):Promise.reject(e);continue}t(s,"Second argument to onUpdate callback is reserved for later use")}}}async mutation(e,t,s){if(this.disabled)throw Error("ConvexClient is disabled");return await this.client.mutation((0,r.getFunctionName)(e),t,s)}async action(e,t){if(this.disabled)throw Error("ConvexClient is disabled");return await this.client.action((0,r.getFunctionName)(e),t)}async query(e,t){if(this.disabled)throw Error("ConvexClient is disabled");let s=this.client.localQueryResult((0,r.getFunctionName)(e),t);return void 0!==s?Promise.resolve(s):new Promise((s,i)=>{let{unsubscribe:r}=this.onUpdate(e,t,e=>{r(),s(e)},e=>{r(),i(e)})})}connectionState(){if(this.disabled)throw Error("ConvexClient is disabled");return this.client.connectionState()}subscribeToConnectionState(e){return this.disabled?()=>{}:this.client.subscribeToConnectionState(e)}}},607572,483145,e=>{"use strict";let t;e.s([],607572),e.i(450871),e.i(979600);var s=e.i(938300),i=e.i(841204),r=e.i(944568);e.i(784665);var n=e.i(838771),o=e.i(920876),a=e.i(184169),u=Object.defineProperty,h=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?u(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};class l{constructor(e,t){if(h(this,"address"),h(this,"auth"),h(this,"adminAuth"),h(this,"encodedTsPromise"),h(this,"debug"),h(this,"fetchOptions"),h(this,"fetch"),h(this,"logger"),h(this,"mutationQueue",[]),h(this,"isProcessingQueue",!1),"boolean"==typeof t)throw Error("skipConvexDeploymentUrlCheck as the second argument is no longer supported. Please pass an options object, `{ skipConvexDeploymentUrlCheck: true }`.");!0!==(t??{}).skipConvexDeploymentUrlCheck&&(0,i.validateDeploymentUrl)(e),this.logger=t?.logger===!1?(0,a.instantiateNoopLogger)({verbose:!1}):t?.logger!==!0&&t?.logger?t.logger:(0,a.instantiateDefaultLogger)({verbose:!1}),this.address=e,this.debug=!0,this.auth=void 0,this.adminAuth=void 0,this.fetch=t?.fetch,t?.auth&&this.setAuth(t.auth)}backendUrl(){return`${this.address}/api`}get url(){return this.address}setAuth(e){this.clearAuth(),this.auth=e}setAdminAuth(e,t){if(this.clearAuth(),void 0!==t){let s=btoa(String.fromCodePoint(...new TextEncoder().encode(JSON.stringify(t))));this.adminAuth=`${e}:${s}`}else this.adminAuth=e}clearAuth(){this.auth=void 0,this.adminAuth=void 0}setDebug(e){this.debug=e}setFetchOptions(e){this.fetchOptions=e}async consistentQuery(e,...t){let s=(0,i.parseArgs)(t[0]),r=this.getTimestamp();return await this.queryInner(e,s,{timestampPromise:r})}async getTimestamp(){return this.encodedTsPromise?this.encodedTsPromise:this.encodedTsPromise=this.getTimestampInner()}async getTimestampInner(){let e=this.fetch||t||fetch,s={"Content-Type":"application/json","Convex-Client":`npm-${r.version}`},i=await e(`${this.address}/api/query_ts`,{...this.fetchOptions,method:"POST",headers:s});if(!i.ok)throw Error(await i.text());let{ts:n}=await i.json();return n}async query(e,...t){let s=(0,i.parseArgs)(t[0]);return await this.queryInner(e,s,{})}async queryInner(e,i,u){let h=(0,s.getFunctionName)(e),l=[(0,o.convexToJson)(i)],d={"Content-Type":"application/json","Convex-Client":`npm-${r.version}`};this.adminAuth?d.Authorization=`Convex ${this.adminAuth}`:this.auth&&(d.Authorization=`Bearer ${this.auth}`);let f=this.fetch||t||fetch,g=u.timestampPromise?await u.timestampPromise:void 0,p=JSON.stringify({path:h,format:"convex_encoded_json",args:l,...g?{ts:g}:{}}),y=g?`${this.address}/api/query_at_ts`:`${this.address}/api/query`,m=await f(y,{...this.fetchOptions,body:p,method:"POST",headers:d});if(!m.ok&&560!==m.status)throw Error(await m.text());let v=await m.json();if(this.debug)for(let e of v.logLines??[])(0,a.logForFunction)(this.logger,"info","query",h,e);switch(v.status){case"success":return(0,o.jsonToConvex)(v.value);case"error":if(void 0!==v.errorData)throw c(v.errorData,new n.ConvexError(v.errorMessage));throw Error(v.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(v)}`)}}async mutationInner(e,i){let u=(0,s.getFunctionName)(e),h=JSON.stringify({path:u,format:"convex_encoded_json",args:[(0,o.convexToJson)(i)]}),l={"Content-Type":"application/json","Convex-Client":`npm-${r.version}`};this.adminAuth?l.Authorization=`Convex ${this.adminAuth}`:this.auth&&(l.Authorization=`Bearer ${this.auth}`);let d=this.fetch||t||fetch,f=await d(`${this.address}/api/mutation`,{...this.fetchOptions,body:h,method:"POST",headers:l});if(!f.ok&&560!==f.status)throw Error(await f.text());let g=await f.json();if(this.debug)for(let e of g.logLines??[])(0,a.logForFunction)(this.logger,"info","mutation",u,e);switch(g.status){case"success":return(0,o.jsonToConvex)(g.value);case"error":if(void 0!==g.errorData)throw c(g.errorData,new n.ConvexError(g.errorMessage));throw Error(g.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(g)}`)}}async processMutationQueue(){if(!this.isProcessingQueue){for(this.isProcessingQueue=!0;this.mutationQueue.length>0;){let{mutation:e,args:t,resolve:s,reject:i}=this.mutationQueue.shift();try{let i=await this.mutationInner(e,t);s(i)}catch(e){i(e)}}this.isProcessingQueue=!1}}enqueueMutation(e,t){return new Promise((s,i)=>{this.mutationQueue.push({mutation:e,args:t,resolve:s,reject:i}),this.processMutationQueue()})}async mutation(e,...t){let[s,r]=t,n=(0,i.parseArgs)(s);return r?.skipQueue?await this.mutationInner(e,n):await this.enqueueMutation(e,n)}async action(e,...u){let h=(0,i.parseArgs)(u[0]),l=(0,s.getFunctionName)(e),d=JSON.stringify({path:l,format:"convex_encoded_json",args:[(0,o.convexToJson)(h)]}),f={"Content-Type":"application/json","Convex-Client":`npm-${r.version}`};this.adminAuth?f.Authorization=`Convex ${this.adminAuth}`:this.auth&&(f.Authorization=`Bearer ${this.auth}`);let g=this.fetch||t||fetch,p=await g(`${this.address}/api/action`,{...this.fetchOptions,body:d,method:"POST",headers:f});if(!p.ok&&560!==p.status)throw Error(await p.text());let y=await p.json();if(this.debug)for(let e of y.logLines??[])(0,a.logForFunction)(this.logger,"info","action",l,e);switch(y.status){case"success":return(0,o.jsonToConvex)(y.value);case"error":if(void 0!==y.errorData)throw c(y.errorData,new n.ConvexError(y.errorMessage));throw Error(y.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(y)}`)}}async function(e,u,...h){let l=(0,i.parseArgs)(h[0]),d="string"==typeof e?e:(0,s.getFunctionName)(e),f=JSON.stringify({componentPath:u,path:d,format:"convex_encoded_json",args:(0,o.convexToJson)(l)}),g={"Content-Type":"application/json","Convex-Client":`npm-${r.version}`};this.adminAuth?g.Authorization=`Convex ${this.adminAuth}`:this.auth&&(g.Authorization=`Bearer ${this.auth}`);let p=this.fetch||t||fetch,y=await p(`${this.address}/api/function`,{...this.fetchOptions,body:f,method:"POST",headers:g});if(!y.ok&&560!==y.status)throw Error(await y.text());let m=await y.json();if(this.debug)for(let e of m.logLines??[])(0,a.logForFunction)(this.logger,"info","any",d,e);switch(m.status){case"success":return(0,o.jsonToConvex)(m.value);case"error":if(void 0!==m.errorData)throw c(m.errorData,new n.ConvexError(m.errorMessage));throw Error(m.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(m)}`)}}}function c(e,t){return t.data=(0,o.jsonToConvex)(e),t}e.s(["ConvexHttpClient",()=>l],483145)},594652,e=>{"use strict";e.s([])},917574,e=>{"use strict";var t=e.i(838771),s=e.i(920876);function i(e,t){if("undefined"==typeof Convex||void 0===Convex.syscall)throw Error("The Convex database and auth objects are being used outside of a Convex backend. Did you mean to use `useQuery` or `useMutation` to call a Convex function?");return JSON.parse(Convex.syscall(e,JSON.stringify(t)))}async function r(e,i){let r;if("undefined"==typeof Convex||void 0===Convex.asyncSyscall)throw Error("The Convex database and auth objects are being used outside of a Convex backend. Did you mean to use `useQuery` or `useMutation` to call a Convex function?");try{r=await Convex.asyncSyscall(e,JSON.stringify(i))}catch(e){if(void 0!==e.data){let i=new t.ConvexError(e.message);throw i.data=(0,s.jsonToConvex)(e.data),i}throw Error(e.message)}return JSON.parse(r)}function n(e,t){if("undefined"==typeof Convex||void 0===Convex.jsSyscall)throw Error("The Convex database and auth objects are being used outside of a Convex backend. Did you mean to use `useQuery` or `useMutation` to call a Convex function?");return Convex.jsSyscall(e,t)}e.s(["performAsyncSyscall",()=>r,"performJsSyscall",()=>n,"performSyscall",()=>i])},552321,761749,925233,819280,e=>{"use strict";e.i(784665);var t=e.i(920876),s=e.i(110879),i=e.i(944568),r=e.i(917574);function n(e,t,s,i){if(void 0===e)throw TypeError(`Must provide arg ${t} \`${i}\` to \`${s}\``)}e.i(841204),e.i(68283);var o=Object.defineProperty,a=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?o(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};class u{constructor(){a(this,"_isExpression"),a(this,"_value")}}var h=Object.defineProperty;class l extends u{constructor(e){super(),((e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?h(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(this,"inner"),this.inner=e}serialize(){return this.inner}}function c(e){return e instanceof l?e.serialize():{$literal:(0,t.convexOrUndefinedToJson)(e)}}let d={eq:(e,t)=>new l({$eq:[c(e),c(t)]}),neq:(e,t)=>new l({$neq:[c(e),c(t)]}),lt:(e,t)=>new l({$lt:[c(e),c(t)]}),lte:(e,t)=>new l({$lte:[c(e),c(t)]}),gt:(e,t)=>new l({$gt:[c(e),c(t)]}),gte:(e,t)=>new l({$gte:[c(e),c(t)]}),add:(e,t)=>new l({$add:[c(e),c(t)]}),sub:(e,t)=>new l({$sub:[c(e),c(t)]}),mul:(e,t)=>new l({$mul:[c(e),c(t)]}),div:(e,t)=>new l({$div:[c(e),c(t)]}),mod:(e,t)=>new l({$mod:[c(e),c(t)]}),neg:e=>new l({$neg:c(e)}),and:(...e)=>new l({$and:e.map(c)}),or:(...e)=>new l({$or:e.map(c)}),not:e=>new l({$not:c(e)}),field:e=>new l({$field:e})};var f=Object.defineProperty;class g{constructor(){((e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?f(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(this,"_isSearchFilter")}}e.s(["SearchFilter",()=>g],761749);var p=Object.defineProperty,y=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?p(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};function m(e){throw Error("consumed"===e?"This query is closed and can't emit any more values.":"This query has been chained with another operator and can't be reused.")}class v{constructor(e){y(this,"state"),y(this,"tableNameForErrorMessages"),this.state={type:"preparing",query:e},"FullTableScan"===e.source.type?this.tableNameForErrorMessages=e.source.tableName:this.tableNameForErrorMessages=e.source.indexName.split(".")[0]}takeQuery(){if("preparing"!==this.state.type)throw Error("A query can only be chained once and can't be chained after iteration begins.");let e=this.state.query;return this.state={type:"closed"},e}startQuery(){if("executing"===this.state.type)throw Error("Iteration can only begin on a query once.");("closed"===this.state.type||"consumed"===this.state.type)&&m(this.state.type);let e=this.state.query,{queryId:t}=(0,r.performSyscall)("1.0/queryStream",{query:e,version:i.version});return this.state={type:"executing",queryId:t},t}closeQuery(){if("executing"===this.state.type){let e=this.state.queryId;(0,r.performSyscall)("1.0/queryCleanup",{queryId:e})}this.state={type:"consumed"}}order(e){n(e,1,"order","order");let t=this.takeQuery();if("Search"===t.source.type)throw Error("Search queries must always be in relevance order. Can not set order manually.");if(null!==t.source.order)throw Error("Queries may only specify order at most once");return t.source.order=e,new v(t)}filter(e){n(e,1,"filter","predicate");let t=this.takeQuery();if(t.operators.length>=256)throw Error("Can't construct query with more than 256 operators");return t.operators.push({filter:c(e(d))}),new v(t)}limit(e){n(e,1,"limit","n");let t=this.takeQuery();return t.operators.push({limit:e}),new v(t)}[Symbol.asyncIterator](){return this.startQuery(),this}async next(){("closed"===this.state.type||"consumed"===this.state.type)&&m(this.state.type);let e="preparing"===this.state.type?this.startQuery():this.state.queryId,{value:s,done:i}=await (0,r.performAsyncSyscall)("1.0/queryStreamNext",{queryId:e});return i&&this.closeQuery(),{value:(0,t.jsonToConvex)(s),done:i}}return(){return this.closeQuery(),Promise.resolve({done:!0,value:void 0})}async paginate(e){if(n(e,1,"paginate","options"),"number"!=typeof e?.numItems||e.numItems<0)throw Error(`\`options.numItems\` must be a positive number. Received \`${e?.numItems}\`.`);let s=this.takeQuery(),o=e.numItems,a=e.cursor,u=e?.endCursor??null,h=e.maximumRowsRead??null,{page:l,isDone:c,continueCursor:d,splitCursor:f,pageStatus:g}=await (0,r.performAsyncSyscall)("1.0/queryPage",{query:s,cursor:a,endCursor:u,pageSize:o,maximumRowsRead:h,maximumBytesRead:e.maximumBytesRead,version:i.version});return{page:l.map(e=>(0,t.jsonToConvex)(e)),isDone:c,continueCursor:d,splitCursor:f,pageStatus:g}}async collect(){let e=[];for await(let t of this)e.push(t);return e}async take(e){n(e,1,"take","n");if(!Number.isInteger(e)||e<0)throw TypeError("Arg 1 `n` to `take` must be a non-negative integer");return this.limit(e).collect()}async first(){let e=await this.take(1);return 0===e.length?null:e[0]}async unique(){let e=await this.take(2);if(0===e.length)return null;if(2===e.length)throw Error(`unique() query returned more than one result from table ${this.tableNameForErrorMessages}:
 [${e[0]._id}, ${e[1]._id}, ...]`);return e[0]}}e.s([],552321),s.v.object({numItems:s.v.number(),cursor:s.v.union(s.v.string(),s.v.null()),endCursor:s.v.optional(s.v.union(s.v.string(),s.v.null())),id:s.v.optional(s.v.number()),maximumRowsRead:s.v.optional(s.v.number()),maximumBytesRead:s.v.optional(s.v.number())}),e.s([],925233),e.s([],819280)},362889,978901,e=>{"use strict";e.i(594652),e.i(552321),e.i(925233),e.i(761749),e.i(819280);var t=e.i(938300);e.i(841204),e.i(784665),e.i(920876),e.i(917574),e.i(944568);var s=e.i(68283),i=Object.defineProperty,r=e.i(110879),n=Object.defineProperty,o=(e,t,s)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?n(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s};class a{constructor(e){o(this,"indexes"),o(this,"stagedDbIndexes"),o(this,"searchIndexes"),o(this,"stagedSearchIndexes"),o(this,"vectorIndexes"),o(this,"stagedVectorIndexes"),o(this,"validator"),this.indexes=[],this.stagedDbIndexes=[],this.searchIndexes=[],this.stagedSearchIndexes=[],this.vectorIndexes=[],this.stagedVectorIndexes=[],this.validator=e}" indexes"(){return this.indexes}index(e,t){return Array.isArray(t)?this.indexes.push({indexDescriptor:e,fields:t}):t.staged?this.stagedDbIndexes.push({indexDescriptor:e,fields:t.fields}):this.indexes.push({indexDescriptor:e,fields:t.fields}),this}searchIndex(e,t){return t.staged?this.stagedSearchIndexes.push({indexDescriptor:e,searchField:t.searchField,filterFields:t.filterFields||[]}):this.searchIndexes.push({indexDescriptor:e,searchField:t.searchField,filterFields:t.filterFields||[]}),this}vectorIndex(e,t){return t.staged?this.stagedVectorIndexes.push({indexDescriptor:e,vectorField:t.vectorField,dimensions:t.dimensions,filterFields:t.filterFields||[]}):this.vectorIndexes.push({indexDescriptor:e,vectorField:t.vectorField,dimensions:t.dimensions,filterFields:t.filterFields||[]}),this}self(){return this}export(){let e=this.validator.json;if("object"!=typeof e)throw Error("Invalid validator: please make sure that the parameter of `defineTable` is valid (see https://docs.convex.dev/database/schemas)");return{indexes:this.indexes,stagedDbIndexes:this.stagedDbIndexes,searchIndexes:this.searchIndexes,stagedSearchIndexes:this.stagedSearchIndexes,vectorIndexes:this.vectorIndexes,stagedVectorIndexes:this.stagedVectorIndexes,documentType:e}}}function u(e){return new a((0,r.isValidator)(e)?e:r.v.object(e))}new class e{constructor(e,t){o(this,"tables"),o(this,"strictTableNameTypes"),o(this,"schemaValidation"),this.tables=e,this.schemaValidation=t?.schemaValidation===void 0||t.schemaValidation}export(){return JSON.stringify({tables:Object.entries(this.tables).map(([e,t])=>{let{indexes:s,stagedDbIndexes:i,searchIndexes:r,stagedSearchIndexes:n,vectorIndexes:o,stagedVectorIndexes:a,documentType:u}=t.export();return{tableName:e,indexes:s,stagedDbIndexes:i,searchIndexes:r,stagedSearchIndexes:n,vectorIndexes:o,stagedVectorIndexes:a,documentType:u}}),schemaValidation:this.schemaValidation})}}({_scheduled_functions:u({name:r.v.string(),args:r.v.array(r.v.any()),scheduledTime:r.v.float64(),completedTime:r.v.optional(r.v.float64()),state:r.v.union(r.v.object({kind:r.v.literal("pending")}),r.v.object({kind:r.v.literal("inProgress")}),r.v.object({kind:r.v.literal("success")}),r.v.object({kind:r.v.literal("failed"),error:r.v.string()}),r.v.object({kind:r.v.literal("canceled")}))}),_storage:u({sha256:r.v.string(),size:r.v.float64(),contentType:r.v.optional(r.v.string())})},void 0),e.s([],978901);let h=t.anyApi,l=t.anyApi;(function e(t,i){return new Proxy({},{get(r,n){if("string"==typeof n)return e(t,[...i,n]);if(n===s.toReferencePath){if(i.length<1){let e=[t,...i].join(".");throw Error(`API path is expected to be of the form \`${t}.childComponent.functionName\`. Found: \`${e}\``)}return"_reference/childComponent/"+i.join("/")}}})})("components",[]),e.s(["api",0,h,"internal",0,l],362889)}];

//# sourceMappingURL=_1378bf1d._.js.map