module.exports=[948217,a=>{"use strict";var b=a.i(367146),c=a.i(700760);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-auto",children:(0,b.jsx)("table",{"data-slot":"table",className:(0,c.cn)("w-full caption-bottom text-sm",a),...d})})}function e({className:a,...d}){return(0,b.jsx)("thead",{"data-slot":"table-header",className:(0,c.cn)("[&_tr]:border-b",a),...d})}function f({className:a,...d}){return(0,b.jsx)("tbody",{"data-slot":"table-body",className:(0,c.cn)("[&_tr:last-child]:border-0",a),...d})}function g({className:a,...d}){return(0,b.jsx)("tr",{"data-slot":"table-row",className:(0,c.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",a),...d})}function h({className:a,...d}){return(0,b.jsx)("th",{"data-slot":"table-head",className:(0,c.cn)("text-muted-foreground h-10 px-2 text-left align-middle font-medium [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...d})}function i({className:a,...d}){return(0,b.jsx)("td",{"data-slot":"table-cell",className:(0,c.cn)("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...d})}a.s(["Table",()=>d,"TableBody",()=>f,"TableCell",()=>i,"TableHead",()=>h,"TableHeader",()=>e,"TableRow",()=>g])},108301,a=>{"use strict";var b=a.i(537500);function c(a,c,d,e){var f=this,g=(0,b.useRef)(null),h=(0,b.useRef)(0),i=(0,b.useRef)(0),j=(0,b.useRef)(null),k=(0,b.useRef)([]),l=(0,b.useRef)(),m=(0,b.useRef)(),n=(0,b.useRef)(a),o=(0,b.useRef)(!0);n.current=a;var p=!c&&0!==c&&!1;if("function"!=typeof a)throw TypeError("Expected a function");c=+c||0;var q=!!(d=d||{}).leading,r=!("trailing"in d)||!!d.trailing,s="maxWait"in d,t="debounceOnServer"in d&&!!d.debounceOnServer,u=s?Math.max(+d.maxWait||0,c):null;return(0,b.useEffect)(function(){return o.current=!0,function(){o.current=!1}},[]),(0,b.useMemo)(function(){var a=function(a){var b=k.current,c=l.current;return k.current=l.current=null,h.current=a,i.current=i.current||a,m.current=n.current.apply(c,b)},b=function(a,b){p&&cancelAnimationFrame(j.current),j.current=setTimeout(a,b)},d=function(a){if(!o.current)return!1;var b=a-g.current;return!g.current||b>=c||b<0||s&&a-h.current>=u},v=function(b){return j.current=null,r&&k.current?a(b):(k.current=l.current=null,m.current)},w=function a(){var e=Date.now();if(q&&i.current===h.current&&x(),d(e))return v(e);if(o.current){var f=c-(e-g.current);b(a,s?Math.min(f,u-(e-h.current)):f)}},x=function(){e&&e({})},y=function(){if(t){var e=Date.now(),i=d(e);if(k.current=[].slice.call(arguments),l.current=f,g.current=e,i){if(!j.current&&o.current)return h.current=g.current,b(w,c),q?a(g.current):m.current;if(s)return b(w,c),a(g.current)}return j.current||b(w,c),m.current}};return y.cancel=function(){var a=j.current;a&&clearTimeout(j.current),h.current=0,k.current=g.current=l.current=j.current=null,a&&e&&e({})},y.isPending=function(){return!!j.current},y.flush=function(){return j.current?v(Date.now()):m.current},y},[q,s,c,u,r,p,!1,t,e])}a.s(["useDebouncedCallback",()=>c])},632713,a=>{"use strict";var b=a.i(367146),c=a.i(130487),d=a.i(502210),e=a.i(175311),f=a.i(913425);a.i(16243);var g=a.i(182234),h=a.i(509423),i=a.i(315638),j=a.i(657882);let k=(0,a.i(366705).default)("layout-list",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]]);var l=a.i(452549),m=a.i(687336),n=a.i(158540),o=a.i(286028),p=a.i(851943),q=a.i(502311),r=a.i(537500),s=a.i(108301),t=a.i(539524),u=a.i(928503),v=a.i(948217),w=a.i(700760);function x({params:a}){let{id:x}=(0,r.use)(a),y=(0,q.useRouter)(),[z,A]=(0,r.useState)(""),[B,C]=(0,r.useState)(!1),[D,E]=(0,r.useState)(null),[F,G]=(0,r.useState)("list"),[H,I]=(0,r.useState)([]),[J,K]=(0,r.useState)({pageIndex:0,pageSize:20}),L=(0,r.useRef)(null),M=(0,r.useRef)(null),N=(0,g.useQuery)(c.api.conversations.list,{projectId:x}),O=(0,g.useAction)(c.api["conversations/hybridSearch"].hybridSearch),P=(0,g.useMutation)(c.api.conversations.create),Q=(0,g.useMutation)(c.api.projects.addConversation),R=(0,s.useDebouncedCallback)(async a=>{if(!a.trim()){E(null),C(!1);return}C(!0);try{let b=await O({query:a.trim(),projectId:x,limit:50});E(b)}catch(b){if(console.error("Hybrid search failed:",b),N){let b=a.toLowerCase();E(N.filter(a=>a.title?.toLowerCase().includes(b)||a.model?.toLowerCase().includes(b)))}}finally{C(!1)}},400);(0,r.useEffect)(()=>{R(z)},[z,R]);let S=null!==D?D:N,T=(0,r.useMemo)(()=>S?S.map(a=>({_id:a._id,title:a.title||"Untitled Chat",model:a.model,messageCount:a.messageCount||0,lastMessageAt:a.lastMessageAt||a.createdAt,createdAt:a.createdAt,pinned:a.pinned||!1})):[],[S]),U=(0,r.useMemo)(()=>[{id:"pinned",accessorKey:"pinned",header:"",size:40,cell:({row:a})=>a.original.pinned?(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-primary inline-block",title:"Pinned"}):null},{accessorKey:"title",header:({column:a})=>(0,b.jsxs)(t.Button,{variant:"ghost",className:"p-0 hover:bg-transparent",onClick:()=>a.toggleSorting("asc"===a.getIsSorted()),children:["Title",(0,b.jsx)(i.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>(0,b.jsx)("span",{className:"font-medium truncate max-w-[300px] block",children:a.original.title})},{accessorKey:"model",header:"Model",cell:({row:a})=>(0,b.jsx)("span",{className:"text-muted-foreground text-sm truncate max-w-[150px] block",children:a.original.model.split(":")[1]||a.original.model})},{accessorKey:"messageCount",header:({column:a})=>(0,b.jsxs)(t.Button,{variant:"ghost",className:"p-0 hover:bg-transparent justify-end w-full",onClick:()=>a.toggleSorting("asc"===a.getIsSorted()),children:["Messages",(0,b.jsx)(i.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>(0,b.jsx)("div",{className:"text-right text-muted-foreground",children:a.original.messageCount})},{accessorKey:"lastMessageAt",header:({column:a})=>(0,b.jsxs)(t.Button,{variant:"ghost",className:"p-0 hover:bg-transparent justify-end w-full",onClick:()=>a.toggleSorting("asc"===a.getIsSorted()),children:["Last Active",(0,b.jsx)(i.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>(0,b.jsx)("div",{className:"text-right text-muted-foreground text-sm font-mono",children:(0,h.formatDistanceToNow)(a.original.lastMessageAt,{addSuffix:!0})})}],[]),V=(0,d.useReactTable)({data:T,columns:U,state:{sorting:H,pagination:J},onSortingChange:I,onPaginationChange:K,getCoreRowModel:(0,e.getCoreRowModel)(),getSortedRowModel:(0,e.getSortedRowModel)(),getPaginationRowModel:(0,e.getPaginationRowModel)(),manualPagination:!1}),W=V.getRowModel().rows,X=W.length>50,Y=(0,r.useCallback)(()=>56,[]),Z=(0,f.useVirtualizer)({count:W.length,getScrollElement:()=>L.current,estimateSize:Y,overscan:10,enabled:X}),$=async()=>{try{let a=await P({model:"zai:glm-4.6v-flash",title:"New Project Chat"});await Q({projectId:x,conversationId:a}),y.push(`/chat/${a}`)}catch(a){console.error("Failed to create chat:",a)}},_=a=>{y.push(`/chat/${a}`)};return void 0===N?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsx)(l.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):(0,b.jsxs)("div",{className:"flex flex-col h-full bg-background/50 backdrop-blur-xl overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex-shrink-0",children:[(0,b.jsxs)("header",{className:"flex items-center justify-between p-6 border-b bg-background/40",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold tracking-tight",children:"Conversations"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Chats linked to this project"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center bg-secondary/50 rounded-lg p-0.5 border",children:[(0,b.jsx)(t.Button,{variant:"ghost",size:"icon",className:(0,w.cn)("h-8 w-8 rounded-md","list"===F&&"bg-background shadow-sm text-foreground"),onClick:()=>G("list"),children:(0,b.jsx)(k,{className:"h-4 w-4"})}),(0,b.jsx)(t.Button,{variant:"ghost",size:"icon",className:(0,w.cn)("h-8 w-8 rounded-md","grid"===F&&"bg-background shadow-sm text-foreground"),onClick:()=>G("grid"),children:(0,b.jsx)(j.LayoutGrid,{className:"h-4 w-4"})})]}),(0,b.jsxs)(t.Button,{onClick:$,children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"}),"New Chat"]})]})]}),(0,b.jsxs)("div",{className:"p-4 border-b bg-muted/5",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(o.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(u.Input,{ref:M,placeholder:"Search conversations (hybrid: title + message content)...",value:z,onChange:a=>{A(a.target.value)},className:"pl-9 pr-10 bg-background/50 border-muted-foreground/20 focus:bg-background transition-colors"}),B&&(0,b.jsx)(l.Loader2,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 animate-spin text-muted-foreground"}),!B&&z&&(0,b.jsx)("button",{onClick:()=>{A(""),E(null),M.current?.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground text-sm",children:"âœ•"})]}),z&&null!==D&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Found ",D.length," result",1!==D.length?"s":"",' for "',z,'"']})]})]}),0===T.length?(0,b.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center py-20 text-muted-foreground",children:[(0,b.jsx)(m.MessageSquare,{className:"h-10 w-10 mb-4 opacity-20"}),(0,b.jsx)("p",{className:"mb-4",children:z?`No conversations matching "${z}"`:"No conversations linked to this project yet."}),!z&&(0,b.jsx)(t.Button,{variant:"outline",onClick:$,children:"Start a New Chat"})]}):"grid"===F?(0,b.jsx)("div",{className:"flex-1 overflow-auto p-6",children:(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:T.map(a=>(0,b.jsxs)(p.default,{href:`/chat/${a._id}`,className:"group relative flex flex-col justify-between p-5 h-40 rounded-xl border bg-card hover:bg-secondary/10 transition-all hover:shadow-md hover:border-primary/20",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,b.jsx)("h3",{className:"font-semibold text-foreground/90 truncate pr-2 group-hover:text-primary transition-colors",children:a.title}),a.pinned&&(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-primary shrink-0 mt-2"})]}),(0,b.jsx)("span",{className:"inline-flex items-center rounded-full bg-secondary px-2 py-0.5 text-xs font-medium text-secondary-foreground opacity-70",children:a.model})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,b.jsxs)("span",{className:"text-xs text-muted-foreground/60",children:[a.messageCount," messages"]}),(0,b.jsx)("span",{className:"text-xs font-mono text-muted-foreground/60",children:(0,h.formatDistanceToNow)(a.lastMessageAt,{addSuffix:!0})})]})]},a._id))})}):(0,b.jsx)("div",{className:"flex-1 flex flex-col min-h-0 px-6 pb-0",children:(0,b.jsx)("div",{className:"border rounded-lg flex-1 flex flex-col min-h-0 overflow-hidden mt-4",children:X?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"flex-shrink-0 sticky top-0 z-10 bg-background border-b",children:V.getHeaderGroups().map(a=>(0,b.jsx)("div",{className:"flex",children:a.headers.map(a=>(0,b.jsx)("div",{className:"flex-1 px-4 py-3 text-sm font-medium",style:{width:a.getSize()},children:a.isPlaceholder?null:(0,d.flexRender)(a.column.columnDef.header,a.getContext())},a.id))},a.id))}),(0,b.jsx)("div",{ref:L,className:"flex-1 overflow-auto relative",children:(0,b.jsx)("div",{style:{height:`${Z.getTotalSize()}px`,position:"relative"},children:Z.getVirtualItems().map(a=>{let c=W[a.index];return(0,b.jsx)("div",{"data-index":a.index,ref:Z.measureElement,className:"flex cursor-pointer hover:bg-muted/50 border-b absolute left-0 w-full",style:{transform:`translateY(${a.start}px)`},onClick:()=>_(c.original._id),children:c.getVisibleCells().map(a=>(0,b.jsx)("div",{className:"flex-1 px-4 py-3",style:{width:a.column.getSize()},children:(0,d.flexRender)(a.column.columnDef.cell,a.getContext())},a.id))},c.id)})})})]}):(0,b.jsx)("div",{className:"flex-1 overflow-auto",children:(0,b.jsxs)(v.Table,{children:[(0,b.jsx)(v.TableHeader,{children:V.getHeaderGroups().map(a=>(0,b.jsx)(v.TableRow,{children:a.headers.map(a=>(0,b.jsx)(v.TableHead,{children:a.isPlaceholder?null:(0,d.flexRender)(a.column.columnDef.header,a.getContext())},a.id))},a.id))}),(0,b.jsx)(v.TableBody,{children:W.length?W.map(a=>(0,b.jsx)(v.TableRow,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>_(a.original._id),children:a.getVisibleCells().map(a=>(0,b.jsx)(v.TableCell,{children:(0,d.flexRender)(a.column.columnDef.cell,a.getContext())},a.id))},a.id)):(0,b.jsx)(v.TableRow,{children:(0,b.jsx)(v.TableCell,{colSpan:U.length,className:"h-24 text-center",children:"No conversations found."})})})]})})})}),"list"===F&&T.length>0&&(0,b.jsx)("div",{className:"flex-shrink-0 px-6 py-4 border-t bg-background/60",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",W.length," of ",T.length," conversations",z&&" (filtered)"]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(t.Button,{variant:"outline",size:"sm",onClick:()=>V.previousPage(),disabled:!V.getCanPreviousPage(),children:"Previous"}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Page ",V.getState().pagination.pageIndex+1," of"," ",V.getPageCount()]}),(0,b.jsx)(t.Button,{variant:"outline",size:"sm",onClick:()=>V.nextPage(),disabled:!V.getCanNextPage(),children:"Next"}),(0,b.jsx)("select",{value:J.pageSize,onChange:a=>V.setPageSize(Number(a.target.value)),className:"h-8 rounded-md border border-input bg-background px-3 text-sm",children:[10,20,50,100].map(a=>(0,b.jsxs)("option",{value:a,children:[a," per page"]},a))})]})]})})]})}a.s(["default",()=>x],632713)}];

//# sourceMappingURL=_3ea298da._.js.map