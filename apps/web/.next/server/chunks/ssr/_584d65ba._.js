module.exports=[840347,a=>{"use strict";var b=a.i(367146),c=a.i(130487);a.i(16243);var d=a.i(182234),e=a.i(23944),f=a.i(537500),g=a.i(539524),h=a.i(609448),i=a.i(478343),j=a.i(247028),k=a.i(114589),l=a.i(36565),m=f;class n extends m.Component{constructor(a){super(a),this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,b){console.error("Canvas error:",a,b)}handleRetry=()=>{this.setState({hasError:!1,error:void 0})};render(){return this.state.hasError?this.props.fallback??(0,b.jsxs)("div",{className:"h-full flex flex-col items-center justify-center gap-4 p-8 text-center",children:[(0,b.jsx)(k.AlertTriangle,{className:"w-12 h-12 text-destructive"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold mb-1",children:"Something went wrong"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"The Canvas editor encountered an error."}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground font-mono mb-4 max-w-md break-all",children:this.state.error?.message})]}),(0,b.jsxs)(g.Button,{onClick:this.handleRetry,variant:"outline",children:[(0,b.jsx)(l.RefreshCw,{className:"w-4 h-4 mr-2"}),"Try Again"]})]}):this.props.children}}var o=a.i(730843),p=a.i(54797),q=a.i(789884),r=a.i(366705);let s=(0,r.default)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);var t=a.i(105698);let u=(0,r.default)("redo-2",[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]]);var v=a.i(971310),w=a.i(154360),x=a.i(723979),y=a.i(477430);function z(a){let b=(0,d.useQuery)(c.api.canvas.documents.get,a?{documentId:a}:"skip"),e=(0,d.useQuery)(c.api.canvas.history.getHistory,a?{documentId:a,limit:50}:"skip"),g=(0,d.useMutation)(c.api.canvas.documents.updateContent),h=b?.version??0,i=(0,f.useMemo)(()=>e?.length?Math.max(...e.map(a=>a.version)):h,[e,h]),j=h>1,k=h<i,l=h<i,m=(0,f.useCallback)(async()=>{if(!a||h<=1||!e)return;let b=e.find(a=>a.version===h-1);b&&await g({documentId:a,content:b.content,source:"user_edit",diff:"Undo"})},[a,h,e,g]),n=(0,f.useCallback)(async()=>{if(!a||!e?.length||h>=Math.max(...e.map(a=>a.version)))return;let b=e.find(a=>a.version===h+1);b&&await g({documentId:a,content:b.content,source:"user_edit",diff:"Redo"})},[a,h,e,g]),o=(0,f.useCallback)(async b=>{if(!a||!e)return;let c=e.find(a=>a.version===b);c&&await g({documentId:a,content:c.content,source:"user_edit",diff:`Restore v${b}`})},[a,e,g]);return{history:e,currentVersion:h,latestVersion:i,isViewingOldVersion:l,canUndo:j,canRedo:k,undo:m,redo:n,jumpToVersion:o}}var A=a.i(700760);function B({documentId:a,isSaving:e=!1,className:i,onDelete:j}){let{setShowHistoryPanel:k}=(0,h.useCanvasContext)(),[m,n]=(0,f.useState)(!1),r=(0,d.useQuery)(c.api.canvas.documents.get,a?{documentId:a}:"skip"),{canUndo:B,canRedo:C,undo:D,redo:E,currentVersion:F,latestVersion:G,isViewingOldVersion:H,jumpToVersion:I}=z(a??void 0),J=async()=>{r?.content&&(await navigator.clipboard.writeText(r.content),n(!0),setTimeout(()=>n(!1),2e3))};return(0,b.jsxs)("div",{className:(0,A.cn)("flex items-center gap-1 px-2 py-1 border-b border-border bg-muted/30",i),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,b.jsx)("span",{children:r?.documentType==="code"?r.language??"plaintext":"Document"}),(0,b.jsx)("span",{className:"text-muted-foreground/50",children:"|"}),(0,b.jsxs)("span",{className:H?"text-amber-500":"",children:["v",F,H&&` of ${G}`]})]}),H&&(0,b.jsxs)(y.Tooltip,{children:[(0,b.jsx)(y.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",className:"h-6 px-2 text-xs ml-2 gap-1",onClick:()=>I(G),children:[(0,b.jsx)(l.RefreshCw,{className:"h-3 w-3"}),"Latest"]})}),(0,b.jsxs)(y.TooltipContent,{children:["Jump to latest version (v",G,")"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-0.5 ml-2",children:[(0,b.jsxs)(y.Tooltip,{children:[(0,b.jsx)(y.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",disabled:!B,onClick:D,children:(0,b.jsx)(w.Undo2,{className:"h-3.5 w-3.5"})})}),(0,b.jsx)(y.TooltipContent,{children:"Undo version"})]}),(0,b.jsxs)(y.Tooltip,{children:[(0,b.jsx)(y.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",disabled:!C,onClick:E,children:(0,b.jsx)(u,{className:"h-3.5 w-3.5"})})}),(0,b.jsx)(y.TooltipContent,{children:"Redo version"})]})]}),(0,b.jsx)("div",{className:"flex-1"}),(0,b.jsx)("span",{className:(0,A.cn)("text-xs mr-2",e?"text-muted-foreground animate-pulse":"text-green-500"),children:e?"Saving...":"Saved"}),(0,b.jsxs)(y.Tooltip,{children:[(0,b.jsx)(y.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:J,children:m?(0,b.jsx)(o.Check,{className:"h-3.5 w-3.5 text-green-500"}):(0,b.jsx)(p.Copy,{className:"h-3.5 w-3.5"})})}),(0,b.jsx)(y.TooltipContent,{children:m?"Copied!":"Copy to clipboard"})]}),(0,b.jsxs)(y.Tooltip,{children:[(0,b.jsx)(y.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{if(!r)return;let a={typescript:".ts",javascript:".js",python:".py",rust:".rs",go:".go",java:".java",csharp:".cs",cpp:".cpp",c:".c",html:".html",css:".css",json:".json",yaml:".yaml",markdown:".md",sql:".sql",shell:".sh",bash:".sh"}[r.language??""]??".txt",b=new Blob([r.content],{type:"text/plain"}),c=URL.createObjectURL(b),d=window.document.createElement("a");d.href=c,d.download=`${r.title}${a}`,d.click(),URL.revokeObjectURL(c)},children:(0,b.jsx)(q.Download,{className:"h-3.5 w-3.5"})})}),(0,b.jsx)(y.TooltipContent,{children:"Download file"})]}),(0,b.jsxs)(y.Tooltip,{children:[(0,b.jsx)(y.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>k(!0),children:(0,b.jsx)(s,{className:"h-3.5 w-3.5"})})}),(0,b.jsx)(y.TooltipContent,{children:"View history"})]}),(0,b.jsxs)(x.DropdownMenu,{children:[(0,b.jsx)(x.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",children:(0,b.jsx)(t.MoreHorizontal,{className:"h-3.5 w-3.5"})})}),(0,b.jsxs)(x.DropdownMenuContent,{align:"end",children:[(0,b.jsxs)(x.DropdownMenuItem,{onClick:()=>k(!0),children:[(0,b.jsx)(s,{className:"h-4 w-4 mr-2"}),"View history"]}),(0,b.jsx)(x.DropdownMenuSeparator,{}),(0,b.jsxs)(x.DropdownMenuItem,{className:"text-destructive",onClick:j,children:[(0,b.jsx)(v.Trash2,{className:"h-4 w-4 mr-2"}),"Delete document"]})]})]})]})}let C=(0,i.default)(async()=>{},{loadableGenerated:{modules:[202966]},ssr:!1,loading:()=>(0,b.jsx)("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Loading editor..."]})})});function D({document:a,onEditorReady:e,onDelete:g}){let h=(0,f.useRef)(null),i=(0,d.useMutation)(c.api.canvas.documents.updateContent),[k,l]=(0,f.useState)(a.content),[m]=(0,j.useDebounceValue)(k,500),o=(0,f.useRef)(a.content);(0,f.useEffect)(()=>{a.content!==o.current&&(h.current&&h.current.setValue(a.content),l(a.content),o.current=a.content)},[a.content]),(0,f.useEffect)(()=>{m!==a.content&&i({documentId:a._id,content:m,source:"user_edit"}).catch(console.error)},[m,a._id,a.content,i]);let p=(0,f.useCallback)(a=>{h.current=a,e?.(a)},[e]),q=k!==a.content;return(0,b.jsx)(n,{children:(0,b.jsxs)("div",{className:"h-full flex flex-col",children:[(0,b.jsx)(B,{documentId:a._id,isSaving:q,onDelete:g}),(0,b.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,b.jsx)(C,{height:"100%",language:a.language??("prose"===a.documentType?"markdown":"typescript"),value:k,onChange:a=>l(a??""),onMount:p,theme:"vs-dark",options:{fontSize:14,lineNumbers:"on",minimap:{enabled:"code"===a.documentType},wordWrap:"prose"===a.documentType?"on":"off",scrollBeyondLastLine:!1,automaticLayout:!0,codeLens:!1,inlayHints:{enabled:"off"}},loading:(0,b.jsx)("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:"Loading editor..."})})})]})})}var E=a.i(648615),F=a.i(116245),G=a.i(175212),H=a.i(227759);function I({open:a,onClose:c,conflict:d,onResolve:e}){let[h,i]=(0,f.useState)(!1),j=a=>{e(a),c()};return(0,b.jsx)(H.Dialog,{open:a,onOpenChange:a=>!a&&c(),children:(0,b.jsxs)(H.DialogContent,{className:"max-w-2xl",children:[(0,b.jsxs)(H.DialogHeader,{children:[(0,b.jsxs)(H.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(k.AlertTriangle,{className:"w-5 h-5 text-yellow-500"}),"Edit Conflict Detected"]}),(0,b.jsxs)(H.DialogDescription,{children:[d.description,d.lineRange&&(0,b.jsxs)("span",{className:"block mt-1 text-xs",children:["Lines ",d.lineRange.start,"-",d.lineRange.end]})]})]}),h&&(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 my-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2 text-sm font-medium",children:[(0,b.jsx)(F.FileText,{className:"w-4 h-4"}),"Your Version"]}),(0,b.jsx)("pre",{className:"p-3 rounded bg-muted text-xs overflow-auto max-h-48 whitespace-pre-wrap",children:d.userContent||"(empty)"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2 text-sm font-medium",children:[(0,b.jsx)(E.Bot,{className:"w-4 h-4"}),"AI Version"]}),(0,b.jsx)("pre",{className:"p-3 rounded bg-muted text-xs overflow-auto max-h-48 whitespace-pre-wrap",children:d.aiContent||"(empty)"})]})]}),(0,b.jsxs)(H.DialogFooter,{className:"flex-col sm:flex-row gap-2",children:[(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>i(!h),children:[h?"Hide":"Show"," Comparison"]}),(0,b.jsxs)("div",{className:"flex gap-2 ml-auto",children:[(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>j("user"),children:[(0,b.jsx)(F.FileText,{className:"w-4 h-4 mr-2"}),"Keep Mine"]}),(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>j("ai"),children:[(0,b.jsx)(E.Bot,{className:"w-4 h-4 mr-2"}),"Use AI's"]}),(0,b.jsxs)(g.Button,{size:"sm",onClick:()=>j("merge"),children:[(0,b.jsx)(G.GitMerge,{className:"w-4 h-4 mr-2"}),"Merge Both"]})]})]})]})})}var J=a.i(509423),K=a.i(353788),L=a.i(863116),M=a.i(276670);function N({documentId:a}){let{setShowHistoryPanel:c}=(0,h.useCanvasContext)(),{history:d,currentVersion:f,jumpToVersion:i}=z(a);return d?(0,b.jsxs)("div",{className:"h-full flex flex-col border-l border-border bg-muted/20",children:[(0,b.jsxs)("div",{className:"p-3 border-b border-border flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"font-medium text-sm",children:"Version History"}),(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>c(!1),children:(0,b.jsx)(e.X,{className:"h-4 w-4"})})]}),(0,b.jsx)(M.ScrollArea,{className:"flex-1",children:(0,b.jsxs)("div",{className:"p-2 space-y-1",children:[d.map(a=>(0,b.jsx)("div",{className:(0,A.cn)("p-3 rounded-lg border transition-colors",a.version===f?"border-primary bg-primary/5":"border-transparent hover:bg-muted/50"),children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:["llm_diff"===a.source?(0,b.jsx)(E.Bot,{className:"w-4 h-4 text-primary shrink-0"}):(0,b.jsx)(L.User,{className:"w-4 h-4 shrink-0"}),(0,b.jsxs)("span",{className:"font-medium",children:["v",a.version]}),a.version===f&&(0,b.jsx)("span",{className:"text-xs text-primary",children:"(current)"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-xs text-muted-foreground",children:[(0,b.jsx)(K.Clock,{className:"w-3 h-3"}),(0,J.formatDistanceToNow)(a.createdAt,{addSuffix:!0})]}),a.diff&&(0,b.jsx)("p",{className:"mt-1 text-xs text-muted-foreground truncate",children:function(a){try{let b=JSON.parse(a);if("string"==typeof b)return b;if(b.changeDescription)return b.changeDescription;if(b.operations?.length)return`${b.operations.length} change(s)`;return"Changes applied"}catch{return"string"==typeof a?a:"Changes applied"}}(a.diff)})]}),a.version!==f&&(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 shrink-0",onClick:()=>i(a.version),title:`Restore v${a.version}`,children:(0,b.jsx)(w.Undo2,{className:"w-4 h-4"})})]})},a._id)),0===d.length&&(0,b.jsx)("div",{className:"text-center text-sm text-muted-foreground py-8",children:"No history available"})]})})]}):(0,b.jsx)("div",{className:"h-full flex items-center justify-center p-4 text-muted-foreground text-sm",children:"Loading history..."})}function O({documentId:a,onClose:i}){let j=(0,f.useRef)(null),{pendingConflict:k,setPendingConflict:l,showHistoryPanel:m}=(0,h.useCanvasContext)(),n=(0,d.useQuery)(c.api.canvas.documents.get,{documentId:a}),o=(0,d.useMutation)(c.api.canvas.documents.updateContent),p=(0,f.useCallback)(async a=>{let b;if(k&&n){switch(a){case"user":b=k.userContent;break;case"ai":b=k.aiContent;break;case"merge":var c,d;c=k.userContent,d=k.aiContent,b=`${c}

---

${d}`}await o({documentId:k.documentId,content:b,source:"user_edit",diff:`Conflict resolved: ${a}`}),l(null)}},[k,n,o,l]);return n?(0,b.jsxs)("div",{className:"h-full border-l bg-card flex",children:[(0,b.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,b.jsx)("h3",{className:"font-semibold text-sm truncate",children:n.title}),n.language&&(0,b.jsx)("span",{className:"text-xs px-2 py-0.5 rounded bg-muted text-muted-foreground shrink-0",children:n.language})]}),(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",onClick:i,className:"h-8 w-8 shrink-0",children:(0,b.jsx)(e.X,{className:"h-4 w-4"})})]}),(0,b.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,b.jsx)(D,{document:n,onEditorReady:a=>{j.current=a}})}),(0,b.jsxs)("div",{className:"p-4 border-t text-xs text-muted-foreground",children:["Version ",n.version," • ",n.documentType]})]}),m&&(0,b.jsx)("div",{className:"w-64 shrink-0",children:(0,b.jsx)(N,{documentId:a})}),k&&(0,b.jsx)(I,{open:!!k,onClose:()=>l(null),conflict:{description:k.description,userContent:k.userContent,aiContent:k.aiContent,lineRange:k.lineRange},onResolve:p})]}):(0,b.jsx)("div",{className:"h-full border-l bg-card flex items-center justify-center",children:(0,b.jsx)("div",{className:"animate-pulse text-muted-foreground",children:"Loading..."})})}a.s(["CanvasPanel",()=>O],840347)},442751,a=>{"use strict";var b=a.i(367146),c=a.i(215179),d=a.i(358176),e=a.i(130487);a.i(16243);var f=a.i(182234),g=a.i(429649),h=a.i(502311),i=a.i(968177),j=a.i(539524),k=a.i(165004);function l({conversationId:a}){let c=(0,h.useRouter)(),d=(0,f.useQuery)(e.api.conversations.getChildBranches,{conversationId:a});return d&&0!==d.length?(0,b.jsxs)(k.Popover,{children:[(0,b.jsx)(k.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(j.Button,{variant:"outline",size:"sm",className:"h-7 gap-1.5 text-xs font-medium",children:[(0,b.jsx)(g.GitBranch,{className:"h-3 w-3"}),(0,b.jsx)(i.Badge,{variant:"secondary",className:"h-4 min-w-4 px-1 text-[10px] rounded-full",children:d.length})]})}),(0,b.jsx)(k.PopoverContent,{align:"end",className:"w-72 p-2",children:(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("p",{className:"text-xs font-medium text-muted-foreground px-2 py-1",children:["Branched conversations (",d.length,")"]}),(0,b.jsx)("div",{className:"space-y-0.5",children:d.map(a=>(0,b.jsx)(j.Button,{variant:"ghost",size:"sm",className:"w-full justify-start h-auto py-2 px-2 text-left font-normal",onClick:()=>{c.push(`/chat/${a._id}`)},children:(0,b.jsxs)("div",{className:"flex items-start gap-2 w-full min-w-0",children:[(0,b.jsx)(g.GitBranch,{className:"h-3.5 w-3.5 mt-0.5 flex-shrink-0 text-muted-foreground"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm truncate",children:a.title}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:new Date(a.createdAt).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})},a._id))})]})})]}):null}var m=a.i(477430),n=a.i(711106);function o({conversationId:a,modelId:c}){let d=(0,f.useQuery)(e.api.conversations.getTokenUsage,{conversationId:a}),g=(0,n.getModelConfig)(c),h=g?.contextWindow??128e3;if(!d)return null;let{systemTokens:i,messagesTokens:j,memoriesTokens:k,totalTokens:l}=d,o=Math.min(100,Math.round(l/h*100)),p=o>=95?"critical":o>=85?"warning":o>=70?"caution":"safe",q=2*Math.PI*8.75,r=q-o/100*q;return(0,b.jsx)(m.TooltipProvider,{children:(0,b.jsxs)(m.Tooltip,{children:[(0,b.jsx)(m.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:"flex items-center gap-1.5 cursor-pointer",children:[(0,b.jsxs)("svg",{width:20,height:20,viewBox:"0 0 20 20",className:"-rotate-90",children:[(0,b.jsx)("circle",{cx:10,cy:10,r:8.75,fill:"none",strokeWidth:2.5,className:"stroke-muted-foreground/30"}),(0,b.jsx)("circle",{cx:10,cy:10,r:8.75,fill:"none",strokeWidth:2.5,strokeLinecap:"round",strokeDasharray:q,strokeDashoffset:r,className:(()=>{switch(p){case"critical":return"stroke-destructive";case"warning":return"stroke-yellow-500";case"caution":return"stroke-yellow-400";default:return"stroke-primary"}})()})]}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground tabular-nums",children:[o,"%"]})]})}),(0,b.jsx)(m.TooltipContent,{side:"bottom",className:"max-w-sm",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"font-semibold",children:"Context Window Usage"}),(0,b.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between gap-4",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"System prompts:"}),(0,b.jsx)("span",{className:"tabular-nums",children:i.toLocaleString()})]}),(0,b.jsxs)("div",{className:"flex justify-between gap-4",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Memories:"}),(0,b.jsx)("span",{className:"tabular-nums",children:k.toLocaleString()})]}),(0,b.jsxs)("div",{className:"flex justify-between gap-4",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Messages:"}),(0,b.jsx)("span",{className:"tabular-nums",children:j.toLocaleString()})]}),(0,b.jsxs)("div",{className:"flex justify-between gap-4 pt-1 border-t",children:[(0,b.jsx)("span",{className:"font-medium",children:"Total Usage:"}),(0,b.jsxs)("span",{className:"tabular-nums font-medium",children:[l.toLocaleString()," (",o,"%)"]})]}),(0,b.jsxs)("div",{className:"flex justify-between gap-4",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Context Limit:"}),(0,b.jsx)("span",{className:"tabular-nums",children:h.toLocaleString()})]})]}),"critical"===p&&(0,b.jsxs)("div",{className:"pt-2 text-sm text-destructive",children:[(0,b.jsx)("strong",{children:"Critical:"})," Context nearly full. Consider starting a new conversation."]}),"warning"===p&&(0,b.jsxs)("div",{className:"pt-2 text-sm text-yellow-600",children:[(0,b.jsx)("strong",{children:"Warning:"})," Context filling up. New conversation recommended soon."]})]})})]})})}var p=a.i(553812),q=a.i(484222),r=a.i(525662),s=a.i(730843),t=a.i(54797),u=a.i(402202),v=a.i(452549),w=a.i(367303),x=a.i(105698),y=a.i(118747),z=a.i(674779),A=a.i(651386),B=a.i(374838),C=a.i(971310),D=a.i(537500),E=a.i(753884),F=a.i(723979),G=a.i(712109),H=a.i(375523),I=a.i(772949),J=a.i(638600),K=a.i(502101),L=a.i(284990);function M({conversation:a}){let c=(0,h.useRouter)(),[d,g]=(0,D.useState)(!1),[i,k]=(0,D.useState)(!1),[l,n]=(0,D.useState)(!1),[o,M]=(0,D.useState)(!1),N=(0,G.useConversationActions)(a._id,"header_menu"),{showSlides:O}=(0,H.useFeatureToggles)(),P=(0,f.useMutation)(e.api.memories.triggerExtraction),Q=(0,f.useQuery)(e.api.messages.list,{conversationId:a._id}),R=(0,f.useQuery)(e.api.sources.operations.getByConversation,{conversationId:a._id}),S=async()=>{n(!0);try{await P({conversationId:a._id}),E.toast.success("Memory extraction started! This may take a few moments."),J.analytics.track("memory_extraction_triggered",{source:"manual",conversationId:a._id})}catch(a){E.toast.error("Failed to start extraction")}finally{setTimeout(()=>n(!1),3e3)}},T=async()=>{if(!Q)return;let b=new Map;if(R)for(let a of R){let c=b.get(a.messageId)||[];c.push(a),b.set(a.messageId,c)}let c=function(a,b,c){let d=`# ${a.title}

`;for(let e of(d+=`*Created: ${new Date(a.createdAt).toLocaleString()}*

---

`,b)){let a="user"===e.role?"You":"assistant"===e.role?"Assistant":"System";d+=`**${a}:**

${e.content}

`;let b=c?.get(e._id);if(b?.length){for(let a of(d+=`**Sources:**
`,b))d+=`- [${a.position}] [${a.title||a.url}](${a.url})
`;d+=`
`}}return d}(a,Q,b);await navigator.clipboard.writeText(c),M(!0),E.toast.success("Conversation copied to clipboard"),setTimeout(()=>M(!1),2e3),J.analytics.track("conversation_copied",{conversationId:a._id,messageCount:Q.length})};(0,f.useQuery)(e.api.users.getCurrentUser);let U=(0,f.useMutation)(e.api.users.updatePreferences),V=(0,I.useUserPreference)("chatWidth"),W=(0,I.useUserPreference)("showMessageStatistics"),X=(0,I.useUserPreference)("showComparisonStatistics"),Y=async a=>{try{await U({preferences:{chatWidth:a}}),E.toast.success("Chat width updated")}catch(a){console.error("[ConversationHeaderMenu] Failed to update width:",a),E.toast.error(a instanceof Error?a.message:"Failed to update width")}},Z=async a=>{try{await U({preferences:{showMessageStatistics:a}}),E.toast.success(a?"Statistics enabled":"Statistics hidden"),J.analytics.track("ui_preference_changed",{setting:"show_message_statistics",value:a,source:"header_menu"})}catch(a){console.error("[ConversationHeaderMenu] Failed to update message statistics:",a),E.toast.error(a instanceof Error?a.message:"Failed to update statistics")}},$=async a=>{try{await U({preferences:{showComparisonStatistics:a}}),E.toast.success(a?"Comparison stats enabled":"Comparison stats hidden"),J.analytics.track("ui_preference_changed",{setting:"show_comparison_statistics",value:a,source:"header_menu"})}catch(a){console.error("[ConversationHeaderMenu] Failed to update comparison statistics:",a),E.toast.error(a instanceof Error?a.message:"Failed to update comparison statistics")}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(F.DropdownMenu,{children:[(0,b.jsxs)(m.Tooltip,{children:[(0,b.jsx)(m.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(F.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(j.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[(0,b.jsx)(x.MoreHorizontal,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"sr-only",children:"Conversation options"})]})})}),(0,b.jsx)(m.TooltipContent,{children:"Conversation options"})]}),(0,b.jsxs)(F.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,b.jsxs)(F.DropdownMenuItem,{onClick:a=>{a.stopPropagation(),g(!0)},children:[(0,b.jsx)(u.Edit,{className:"mr-2 h-4 w-4"}),"Rename"]}),(0,b.jsx)(F.DropdownMenuSeparator,{}),(0,b.jsxs)(F.DropdownMenuItem,{disabled:!a.pinned&&0===a.messageCount,onClick:b=>{b.stopPropagation(),N.handleTogglePin(a.pinned)},children:[(0,b.jsx)(y.Pin,{className:"mr-2 h-4 w-4"}),a.pinned?"Unpin":0===a.messageCount?"Cannot pin empty":"Pin"]}),(0,b.jsxs)(F.DropdownMenuItem,{onClick:b=>{b.stopPropagation(),N.handleToggleStar(a.starred)},children:[(0,b.jsx)(B.Star,{className:"mr-2 h-4 w-4"}),a.starred?"Unstar":"Star"]}),(0,b.jsxs)(F.DropdownMenuItem,{onClick:a=>{a.stopPropagation(),N.handleArchive()},children:[(0,b.jsx)(p.Archive,{className:"mr-2 h-4 w-4"}),"Archive"]}),(0,b.jsxs)(F.DropdownMenuItem,{onClick:a=>{a.stopPropagation(),T()},disabled:!Q?.length,children:[o?(0,b.jsx)(s.Check,{className:"mr-2 h-4 w-4"}):(0,b.jsx)(t.Copy,{className:"mr-2 h-4 w-4"}),o?"Copied!":"Copy conversation"]}),O&&(0,b.jsxs)(F.DropdownMenuItem,{onClick:b=>{b.stopPropagation(),c.push(`/slides/new?conversationId=${a._id}`)},children:[(0,b.jsx)(z.Presentation,{className:"mr-2 h-4 w-4"}),"Create Presentation"]}),(0,b.jsxs)(F.DropdownMenuItem,{onClick:a=>{a.stopPropagation(),N.handleAutoRename()},children:[(0,b.jsx)(A.Sparkles,{className:"mr-2 h-4 w-4"}),"Auto-rename"]}),!a.isIncognito&&(a.messageCount??0)>=3&&(0,b.jsxs)(F.DropdownMenuItem,{onClick:a=>{a.stopPropagation(),S()},disabled:l,children:[l?(0,b.jsx)(v.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,b.jsx)(r.Brain,{className:"mr-2 h-4 w-4"}),l?"Extracting...":"Extract Memories"]}),(0,b.jsx)(F.DropdownMenuSeparator,{}),(0,b.jsxs)(F.DropdownMenuSub,{children:[(0,b.jsxs)(F.DropdownMenuSubTrigger,{children:[(0,b.jsx)(w.Maximize2,{className:"mr-2 h-4 w-4"}),"Chat Width"]}),(0,b.jsxs)(F.DropdownMenuSubContent,{children:[(0,b.jsx)(F.DropdownMenuLabel,{children:"Layout Width"}),(0,b.jsxs)(F.DropdownMenuRadioGroup,{value:V||"standard",onValueChange:a=>Y(a),children:[(0,b.jsx)(F.DropdownMenuRadioItem,{value:"narrow",children:"Narrow (672px)"}),(0,b.jsx)(F.DropdownMenuRadioItem,{value:"standard",children:"Standard (896px)"}),(0,b.jsx)(F.DropdownMenuRadioItem,{value:"wide",children:"Wide (1152px)"}),(0,b.jsx)(F.DropdownMenuRadioItem,{value:"full",children:"Full Width (95%)"})]})]})]}),(0,b.jsxs)(F.DropdownMenuSub,{children:[(0,b.jsxs)(F.DropdownMenuSubTrigger,{children:[(0,b.jsx)(q.BarChart3,{className:"mr-2 h-4 w-4"}),"Statistics"]}),(0,b.jsxs)(F.DropdownMenuSubContent,{children:[(0,b.jsx)(F.DropdownMenuLabel,{children:"Display Options"}),(0,b.jsx)(F.DropdownMenuCheckboxItem,{checked:W??!1,onCheckedChange:Z,children:"Message Statistics"}),(0,b.jsx)(F.DropdownMenuCheckboxItem,{checked:X??!1,onCheckedChange:$,children:"Comparison Statistics"})]})]}),(0,b.jsx)(F.DropdownMenuSeparator,{}),(0,b.jsxs)(F.DropdownMenuItem,{onClick:a=>{a.stopPropagation(),k(!0)},className:"text-destructive focus:text-destructive",children:[(0,b.jsx)(C.Trash2,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]}),(0,b.jsx)(L.RenameDialog,{conversation:a,open:d,onOpenChange:g}),(0,b.jsx)(K.DeleteConversationDialog,{open:i,onOpenChange:k,onConfirm:N.handleDelete,conversationTitle:a.title})]})}var N=a.i(439828),O=a.i(828288),P=a.i(700760);function Q({conversationId:a,className:c}){let[d,g]=(0,D.useState)(!1),i=(0,f.useMutation)(e.api.conversations.deleteConversation),k=(0,h.useRouter)(),l=async()=>{g(!0);try{await i({conversationId:a}),E.toast.success("Conversation wiped"),k.push("/")}catch(a){console.error("Failed to wipe conversation:",a),E.toast.error("Failed to wipe conversation")}finally{g(!1)}};return(0,b.jsxs)(O.AlertDialog,{children:[(0,b.jsxs)(m.Tooltip,{children:[(0,b.jsx)(m.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(O.AlertDialogTrigger,{asChild:!0,children:(0,b.jsx)(j.Button,{variant:"ghost",size:"icon",disabled:d,className:(0,P.cn)("h-7 w-7 shrink-0","text-orange-400/60 hover:text-orange-400","hover:bg-orange-500/10","transition-colors duration-200",c),children:(0,b.jsx)(N.Flame,{className:"size-4"})})})}),(0,b.jsx)(m.TooltipContent,{side:"bottom",children:"Wipe conversation now"})]}),(0,b.jsxs)(O.AlertDialogContent,{children:[(0,b.jsxs)(O.AlertDialogHeader,{children:[(0,b.jsxs)(O.AlertDialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(N.Flame,{className:"size-5 text-orange-400"}),"Wipe Incognito Chat"]}),(0,b.jsx)(O.AlertDialogDescription,{children:"This will permanently delete this conversation and all its messages. This action cannot be undone."})]}),(0,b.jsxs)(O.AlertDialogFooter,{children:[(0,b.jsx)(O.AlertDialogCancel,{children:"Cancel"}),(0,b.jsxs)(O.AlertDialogAction,{onClick:l,className:"bg-orange-500 hover:bg-orange-600 text-white",children:[(0,b.jsx)(N.Flame,{className:"size-4 mr-2"}),"Wipe Now"]})]})]})]})}var R=a.i(455273);function S({className:a}){return(0,b.jsxs)(m.Tooltip,{children:[(0,b.jsx)(m.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)(i.Badge,{variant:"outline",className:(0,P.cn)("h-7 text-xs px-3 rounded-full cursor-default select-none","border-violet-500/30 bg-violet-500/5","text-violet-400","transition-colors duration-200",a),children:[(0,b.jsx)(R.Ghost,{className:"size-3 mr-1.5 opacity-80"}),"Incognito"]})}),(0,b.jsx)(m.TooltipContent,{side:"bottom",children:(0,b.jsx)("p",{className:"text-xs",children:"Ephemeral chat - no memories saved"})})]})}var T=a.i(910967),U=a.i(651197);function V({modelId:a,isComparison:c=!1,comparisonCount:d=0,onClick:e,className:f}){if(c)return(0,b.jsxs)(j.Button,{variant:"outline",size:"sm",onClick:e,title:"Manage comparison models",className:(0,P.cn)("gap-2 h-7 text-xs border-primary/20 bg-primary/2 hover:bg-primary/10 px-3 rounded-full transition-colors min-w-0 w-auto font-medium text-primary/80 hover:text-primary/80 cursor-pointer",f),children:[(0,b.jsx)(T.Grid,{className:"w-3 h-3"}),(0,b.jsxs)("span",{className:"hidden sm:inline",children:["Comparing ",d," models"]}),(0,b.jsx)("span",{className:"sm:hidden",children:d})]});if(!a)return null;let g=(0,n.getModelConfig)(a);if(!g)return null;let h=(0,U.getModelIcon)(a);return(0,b.jsxs)(j.Button,{variant:"outline",size:"sm",onClick:e,title:"Change AI model (⌘J)",className:(0,P.cn)("gap-2 h-7 text-xs border-primary/20 bg-primary/2 hover:bg-primary/10 px-3 rounded-full transition-colors min-w-0 w-auto font-medium text-primary/80 hover:text-primary/80 cursor-pointer",f),children:[(0,b.jsx)(h,{className:"w-3 h-3"}),(0,b.jsx)("span",{className:"hidden sm:inline truncate max-w-[200px]",children:g.name})]})}var W=a.i(231464),X=a.i(227759),Y=a.i(928503),Z=a.i(658547),$=a.i(547885),_=a.i(105008);function aa({conversationId:a}){let[c,d]=(0,D.useState)(!1),[g,h]=(0,D.useState)(""),[i,k]=(0,D.useState)(7),[l,m]=(0,D.useState)(!1),[n,o]=(0,D.useState)(null),[p,q]=(0,D.useState)(!1),r=(0,f.useQuery)(e.api.shares.getByConversation,{conversationId:a}),u=(0,f.useAction)(e.api.shares.create),v=(0,f.useMutation)(e.api.shares.toggle);(0,D.useEffect)(()=>{r?.shareId&&o(`${window.location.origin}/share/${r.shareId}`)},[r]);let w=async()=>{try{let b=await u({conversationId:a,password:g||void 0,expiresIn:i,anonymizeUsernames:l}),c=`${window.location.origin}/share/${b}`;o(c),J.analytics.track("conversation_shared",{hasPassword:!!g,hasExpiry:!!i,expiresIn:i,anonymizeEnabled:l})}catch(a){console.error("Failed to create share:",a)}},x=async()=>{n&&(await navigator.clipboard.writeText(n),q(!0),setTimeout(()=>q(!1),2e3))},y=async b=>{try{await v({conversationId:a,isActive:b})}catch(a){console.error("Failed to toggle share:",a)}};return(0,b.jsxs)(X.Dialog,{open:c,onOpenChange:d,children:[(0,b.jsx)(X.DialogTrigger,{asChild:!0,children:(0,b.jsx)(j.Button,{variant:"ghost",size:"sm",children:(0,b.jsx)(W.Share2,{className:"h-4 w-4"})})}),(0,b.jsxs)(X.DialogContent,{children:[(0,b.jsxs)(X.DialogHeader,{children:[(0,b.jsx)(X.DialogTitle,{children:"Share Conversation"}),(0,b.jsx)(X.DialogDescription,{children:"Create a shareable link to this conversation"})]}),n?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(Z.Label,{htmlFor:"share-toggle",children:"Sharing enabled"}),(0,b.jsx)(_.Switch,{id:"share-toggle",checked:r?.isActive??!0,onCheckedChange:y})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(Y.Input,{value:n,readOnly:!0}),(0,b.jsx)(j.Button,{onClick:x,size:"icon",children:p?(0,b.jsx)(s.Check,{className:"h-4 w-4"}):(0,b.jsx)(t.Copy,{className:"h-4 w-4"})})]}),r?.isActive===!1?(0,b.jsx)("p",{className:"text-sm text-destructive",children:'⚠️ Sharing is disabled. Anyone with the link will see a "revoked" message.'}):(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Anyone with this link can view the conversation",r?.password&&" (password required)",r?.expiresAt&&` (expires ${new Date(r.expiresAt).toLocaleDateString()})`,"."]})]}):(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(Z.Label,{htmlFor:"password",children:"Password (optional)"}),(0,b.jsx)(Y.Input,{id:"password",type:"password",placeholder:"Leave empty for no password",value:g,onChange:a=>h(a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(Z.Label,{htmlFor:"expires",children:"Expires in"}),(0,b.jsxs)($.Select,{value:i?.toString()||"never",onValueChange:a=>k("never"===a?void 0:Number(a)),children:[(0,b.jsx)($.SelectTrigger,{id:"expires",children:(0,b.jsx)($.SelectValue,{})}),(0,b.jsxs)($.SelectContent,{children:[(0,b.jsx)($.SelectItem,{value:"1",children:"1 day"}),(0,b.jsx)($.SelectItem,{value:"7",children:"7 days"}),(0,b.jsx)($.SelectItem,{value:"30",children:"30 days"}),(0,b.jsx)($.SelectItem,{value:"never",children:"Never"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(Z.Label,{htmlFor:"anonymize",children:"Anonymize usernames"}),(0,b.jsx)(_.Switch,{id:"anonymize",checked:l,onCheckedChange:m})]})]}),(0,b.jsx)(X.DialogFooter,{children:n?(0,b.jsx)(j.Button,{onClick:()=>{d(!1),r||(o(null),h(""),k(7),m(!1)),q(!1)},children:"Done"}):(0,b.jsx)(j.Button,{onClick:w,children:"Create Share Link"})})]})]})}var ab=a.i(625852);function ac({conversationId:a,currentProjectId:c}){let d=(0,f.useQuery)(e.api.projects.list),g=(0,f.useMutation)(e.api.projects.assignConversations),h=(0,D.useRef)(c||"none"),i=async b=>{b!==h.current&&(h.current=b,await g({projectId:"none"===b?null:b,conversationIds:[a]}))};return d&&0!==d.length?(0,b.jsxs)($.Select,{value:c||"none",onValueChange:i,children:[(0,b.jsx)($.SelectTrigger,{className:"w-auto sm:w-[200px] px-2 sm:px-3 max-w-[180px] min-w-0","aria-label":"Select Project",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[(0,b.jsx)(ab.FolderOpen,{className:"w-4 h-4 shrink-0"}),(0,b.jsx)("span",{className:"hidden sm:block truncate min-w-0 flex-1",children:(0,b.jsx)($.SelectValue,{placeholder:"No project"})})]})}),(0,b.jsxs)($.SelectContent,{children:[(0,b.jsx)($.SelectItem,{value:"none",children:"No project"}),d?.map(a=>(0,b.jsx)($.SelectItem,{value:a._id,children:(0,b.jsx)("span",{className:"truncate",title:a.name,children:a.name})},a._id))]})]}):null}function ad({conversation:a,conversationId:e,selectedModel:f,modelLoading:g,hasMessages:h,isFirst:i,isLast:k,isComparisonActive:m,comparisonModelCount:n,showProjects:p,onNavigatePrevious:q,onNavigateNext:r,onModelBadgeClick:s,onComparisonBadgeClick:t}){return(0,b.jsxs)("header",{className:"flex items-center gap-4 border-b px-4 py-3 shrink-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(j.Button,{variant:"ghost",size:"icon",onClick:q,disabled:i,className:"h-7 w-7 shrink-0 cursor-pointer",title:"Previous conversation (⌘[)",children:(0,b.jsx)(c.ChevronLeft,{className:"w-4 h-4"})}),(0,b.jsx)(j.Button,{variant:"ghost",size:"icon",onClick:r,disabled:k,className:"h-7 w-7 shrink-0 cursor-pointer",title:"Next conversation (⌘])",children:(0,b.jsx)(d.ChevronRight,{className:"w-4 h-4"})})]}),(0,b.jsx)("div",{className:"flex items-center gap-1 flex-1 min-w-0",children:(0,b.jsx)("h1",{className:"text-lg font-semibold truncate",children:a?.title||"New Chat"})}),(0,b.jsxs)("div",{className:"hidden sm:flex items-center gap-2",children:[!g&&f&&(0,b.jsx)(V,{modelId:m?void 0:f,isComparison:m,comparisonCount:n,onClick:m?t:s}),a?.isIncognito&&(0,b.jsx)(S,{})]}),p&&!a?.isIncognito&&(0,b.jsx)(ac,{conversationId:e,currentProjectId:a?.projectId??void 0}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[h&&e&&(0,b.jsx)(o,{conversationId:e,modelId:f}),e&&(0,b.jsx)(l,{conversationId:e}),h&&e&&!a?.isIncognito&&(0,b.jsx)(aa,{conversationId:e}),a?.isIncognito&&(0,b.jsx)(Q,{conversationId:e}),a&&(0,b.jsx)(M,{conversation:a})]})]})}a.s(["ChatHeader",()=>ad],442751)},820493,a=>{"use strict";var b=a.i(367146),c=a.i(130487);a.i(16243);var d=a.i(182234),e=a.i(354420),f=a.i(529395),g=a.i(366705);let h=(0,g.default)("expand",[["path",{d:"m15 15 6 6",key:"1s409w"}],["path",{d:"m15 9 6-6",key:"ko1vev"}],["path",{d:"M21 16v5h-5",key:"1ck2sf"}],["path",{d:"M21 8V3h-5",key:"1qoq8a"}],["path",{d:"M3 16v5h5",key:"1t08am"}],["path",{d:"m3 21 6-6",key:"wwnumi"}],["path",{d:"M3 8V3h5",key:"1ln10m"}],["path",{d:"M9 9 3 3",key:"v551iv"}]]);var i=a.i(452549);let j=(0,g.default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var k=a.i(105530),l=a.i(901555),m=a.i(537500),n=a.i(539524),o=a.i(197463),p=a.i(477430),q=a.i(63263),r=a.i(711106),s=a.i(638600);a.i(259296);var t=a.i(680486),u=a.i(700760);let v={narrow:"max-w-2xl",standard:"max-w-4xl",wide:"max-w-6xl",full:"max-w-[95%]"};var w=a.i(626283);let x=(0,g.default)("file-spreadsheet",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);var y=a.i(116245),z=a.i(822735),A=a.i(89847),B=a.i(23944);let C={pdf:"from-red-500/20 to-red-600/10 border-red-500/20",doc:"from-blue-500/20 to-blue-600/10 border-blue-500/20",docx:"from-blue-500/20 to-blue-600/10 border-blue-500/20",xls:"from-green-500/20 to-green-600/10 border-green-500/20",xlsx:"from-green-500/20 to-green-600/10 border-green-500/20",csv:"from-green-500/20 to-green-600/10 border-green-500/20",txt:"from-zinc-500/20 to-zinc-600/10 border-zinc-500/20",default:"from-muted/50 to-muted/30 border-border/50"};function D(a){return a.split(".").pop()?.toLowerCase()||""}function E(a){return a<1024?`${a} B`:a<1048576?`${(a/1024).toFixed(1)} KB`:`${(a/1048576).toFixed(1)} MB`}function F({attachments:a,onRemove:c}){return(0,b.jsx)("div",{className:"flex gap-2 flex-wrap",children:(0,b.jsx)(e.AnimatePresence,{mode:"popLayout",children:a.map((a,d)=>(0,b.jsx)(f.motion.div,{initial:{opacity:0,y:8,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-8,scale:.95},transition:{duration:.2,delay:.05*d,ease:[.4,0,.2,1]},children:"image"===a.type?(0,b.jsx)(G,{attachment:a,onRemove:()=>c(d)}):"audio"===a.type?(0,b.jsx)(H,{attachment:a,onRemove:()=>c(d)}):(0,b.jsx)(I,{attachment:a,onRemove:()=>c(d)})},`${a.storageId}-${d}`))})})}function G({attachment:a,onRemove:e}){let f=(0,d.useQuery)(c.api.files.getFileUrl,{storageId:a.storageId});return(0,b.jsxs)("div",{className:"relative group overflow-hidden rounded-xl w-16 h-16 bg-muted/30 border border-border/30",children:[f?(0,b.jsx)("img",{src:f,alt:a.name,className:"object-cover w-full h-full transition-transform duration-200 group-hover:scale-110"}):(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,b.jsx)(z.Image,{className:"w-6 h-6 text-muted-foreground/50"})}),(0,b.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),(0,b.jsx)(n.Button,{type:"button",variant:"ghost",size:"icon",onClick:e,className:"absolute top-1 right-1 h-5 w-5 p-0 rounded-full bg-black/50 text-white opacity-0 group-hover:opacity-100 transition-opacity hover:bg-black/70","aria-label":`Remove ${a.name}`,children:(0,b.jsx)(B.X,{className:"w-3 h-3"})}),(0,b.jsx)("span",{className:"absolute bottom-1 left-1 text-[10px] text-white/80 bg-black/40 px-1 rounded opacity-0 group-hover:opacity-100 transition-opacity",children:E(a.size)})]})}function H({attachment:a,onRemove:c}){return(0,b.jsxs)("div",{className:"relative group flex items-center gap-2 px-3 py-2 rounded-full bg-gradient-to-r from-violet-500/20 to-violet-600/10 border border-violet-500/20",children:[(0,b.jsx)("div",{className:"w-6 h-6 rounded-full bg-violet-500/20 flex items-center justify-center",children:(0,b.jsx)(A.Mic,{className:"w-3.5 h-3.5 text-violet-400"})}),(0,b.jsxs)("div",{className:"max-w-[100px] min-w-0",children:[(0,b.jsx)("p",{className:"text-xs font-medium truncate text-foreground/90",children:a.name}),(0,b.jsx)("p",{className:"text-[10px] text-muted-foreground",children:E(a.size)})]}),(0,b.jsx)(n.Button,{type:"button",variant:"ghost",size:"icon",onClick:c,className:"h-5 w-5 p-0 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-violet-500/20","aria-label":`Remove ${a.name}`,children:(0,b.jsx)(B.X,{className:"w-3 h-3"})})]})}function I({attachment:a,onRemove:c}){var d;let e,f=C[D(a.name)]||C.default,g=(d=a.mimeType,e=D(a.name),d.includes("spreadsheet")||["xls","xlsx","csv"].includes(e)?x:d.includes("pdf")||d.includes("document")||["doc","docx","txt","pdf"].includes(e)?y.FileText:w.FileIcon);return(0,b.jsxs)("div",{className:(0,u.cn)("relative group flex items-center gap-2 px-3 py-2 rounded-full bg-gradient-to-r border",f),children:[(0,b.jsx)(g,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),(0,b.jsxs)("div",{className:"max-w-[100px] min-w-0",children:[(0,b.jsx)("p",{className:"text-xs font-medium truncate text-foreground/90",children:a.name}),(0,b.jsx)("p",{className:"text-[10px] text-muted-foreground",children:E(a.size)})]}),(0,b.jsx)(n.Button,{type:"button",variant:"ghost",size:"icon",onClick:c,className:"h-5 w-5 p-0 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-muted/50","aria-label":`Remove ${a.name}`,children:(0,b.jsx)(B.X,{className:"w-3 h-3"})})]})}function J({stream:a,height:c=120,className:d}){let e=(0,m.useRef)(null),f=(0,m.useRef)(null),g=(0,m.useRef)(null),h=(0,m.useRef)(null),i=(0,m.useRef)("");return(0,m.useEffect)(()=>{let a=document.createElement("div");a.style.color="var(--primary)",a.style.display="none",document.body.appendChild(a),i.current=getComputedStyle(a).color,document.body.removeChild(a)},[]),(0,m.useEffect)(()=>{if(!a)return;let b=new AudioContext,c=b.createAnalyser(),d=b.createMediaStreamSource(a);c.fftSize=512,c.smoothingTimeConstant=.85,d.connect(c),h.current=b,f.current=c;let j=new Uint8Array(c.frequencyBinCount),k=e.current;if(!k)return;let l=k.getContext("2d");if(!l)return;let m=window.devicePixelRatio||1,n=k.getBoundingClientRect();k.width=n.width*m,k.height=n.height*m,l.scale(m,m);let o=(n.width-320)/2,p=()=>{c.getByteFrequencyData(j),l.clearRect(0,0,n.width,n.height);let a=Math.floor(j.length/64);for(let b=0;b<64;b++){let c=j[b*a]/255,d=Math.max(4,c*(.8*n.height)),e=o+5*b,f=(n.height-d)/2,g=.6+.4*c;if(i.current.startsWith("rgb")){let a=i.current.match(/\d+/g);a&&a.length>=3?l.fillStyle=`rgba(${a[0]}, ${a[1]}, ${a[2]}, ${g})`:l.fillStyle=i.current}else l.fillStyle=i.current,l.globalAlpha=g;l.beginPath(),l.roundRect(e,f,3,d,1.5),l.fill(),l.globalAlpha=1}g.current=requestAnimationFrame(p)};return p(),()=>{g.current&&cancelAnimationFrame(g.current),d.disconnect(),c.disconnect(),b.close()}},[a]),(0,b.jsx)("canvas",{ref:e,className:(0,u.cn)("w-full h-full",d),style:{height:"100%",width:"100%"}})}var K=a.i(227759);function L({open:a,onOpenChange:c,value:d,onChange:e,onSubmit:f,placeholder:g}){let h=(0,m.useRef)(null);return(0,m.useEffect)(()=>{a&&h.current&&(h.current.focus(),h.current.setSelectionRange(d.length,d.length))},[a,d.length]),(0,b.jsx)(K.Dialog,{open:a,onOpenChange:c,children:(0,b.jsxs)(K.DialogContent,{className:"max-w-3xl h-[80vh] flex flex-col gap-0 p-0",children:[(0,b.jsx)(K.DialogHeader,{className:"px-4 py-3 border-b shrink-0",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(K.DialogTitle,{className:"text-sm font-medium text-muted-foreground",children:"Edit message"}),(0,b.jsx)(n.Button,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>c(!1),children:(0,b.jsx)(B.X,{className:"h-4 w-4"})})]})}),(0,b.jsx)("div",{className:"flex-1 p-4 overflow-hidden",children:(0,b.jsx)(o.Textarea,{ref:h,value:d,onChange:a=>e(a.target.value),onKeyDown:a=>{(a.metaKey||a.ctrlKey)&&"Enter"===a.key&&(a.preventDefault(),f()),"Escape"===a.key&&(a.preventDefault(),c(!1))},placeholder:g,className:"h-full w-full resize-none border-0 bg-transparent focus-visible:ring-0 text-base"})}),(0,b.jsxs)("div",{className:"px-4 py-3 border-t shrink-0 flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:[d.length," characters"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"⌘ + Enter to send"}),(0,b.jsx)(n.Button,{onClick:f,disabled:!d.trim(),size:"sm",children:"Send"})]})]})]})})}var M=a.i(158540),N=a.i(134818),O=a.i(753884);function P({conversationId:a,attachments:e,onAttachmentsChange:f,onUploadComplete:g,maxSizeMB:h=10,uploading:j,setUploading:k}){let l=(0,d.useMutation)(c.api.files.generateUploadUrl),o=(0,d.useMutation)(c.api.files.saveFile),p=(0,m.useCallback)(async b=>{k(!0);try{let c=[];for(let d of b){if(d.size>1024*h*1024){O.toast.error(`${d.name} exceeds ${h}MB limit`);continue}let b=await l(),e=await fetch(b,{method:"POST",headers:{"Content-Type":d.type},body:d}),{storageId:f}=await e.json();await o({storageId:f,name:d.name,mimeType:d.type,size:d.size,conversationId:a});let g="file";d.type.startsWith("image/")?g="image":d.type.startsWith("audio/")&&(g="audio"),c.push({type:g,name:d.name,storageId:f,mimeType:d.type,size:d.size}),s.analytics.track("attachment_uploaded",{type:g,size:d.size,mimeType:d.type,countPerMessage:1})}f([...e,...c]),O.toast.success(`Uploaded ${c.length} file${1===c.length?"":"s"}`),g?.()}catch(a){console.error("Upload failed:",a),O.toast.error("Failed to upload files")}finally{k(!1)}},[e,a,l,h,f,g,o,k]),{getRootProps:q,getInputProps:r}=(0,N.useDropzone)({onDrop:p,disabled:j,maxSize:1024*h*1024,noClick:!1,noKeyboard:!1});return(0,b.jsxs)(n.Button,{type:"button",variant:"ghost",size:"icon",...q(),disabled:j,title:"Attach files",className:"h-8 w-8 rounded-full text-muted-foreground hover:text-foreground hover:bg-muted/50 transition-colors",children:[(0,b.jsx)("input",{...r()}),j?(0,b.jsx)(i.Loader2,{className:"w-5 h-5 animate-spin"}):(0,b.jsx)(M.Plus,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"sr-only",children:"Attach files"})]})}var Q=a.i(214754),R=a.i(851943),S=a.i(968177);let T=(0,g.default)("arrow-left-right",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);var U=a.i(494110);function V({onStartComparison:a,isActive:c,selectedModels:d=[],open:e,onOpenChange:f}){let[g,h]=(0,m.useState)(!1),i=f||h;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(p.Tooltip,{children:[(0,b.jsx)(p.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)(n.Button,{variant:"ghost",disabled:c,title:"Compare models",onClick:()=>i(!0),className:"h-7 text-xs border border-primary/20 bg-primary/2 hover:bg-primary/10 text-primary/80 hover:text-primary/80 cursor-pointer px-3 rounded-full transition-colors min-w-0 w-auto font-medium gap-1.5","data-tour":"comparison",children:[(0,b.jsx)(T,{className:"w-3.5 h-3.5"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Compare"})]})}),(0,b.jsx)(p.TooltipContent,{children:(0,b.jsx)("p",{children:"Compare models"})})]}),(0,b.jsx)(U.QuickModelSwitcher,{currentModel:"",onSelectModel:()=>{},open:void 0!==e?e:g,onOpenChange:i,mode:"multiple",selectedModels:d,onSelectedModelsChange:b=>{a(b),i(!1)}})]})}var W=a.i(726260),X=a.i(134186);function Y({keys:a}){let c=function(){let[a,b]=(0,m.useState)("Ctrl");return(0,m.useEffect)(()=>{b((0,X.getServerSafeModifierKey)())},[]),a}(),d=a.map(a=>"mod"===a?c:a);return(0,b.jsx)("kbd",{className:"inline-flex h-5 select-none items-center gap-1 rounded border bg-background/50 px-1.5 font-mono text-[10px] font-medium text-muted-foreground",children:d.map((a,c)=>(0,b.jsxs)("span",{children:[c>0&&(0,b.jsx)("span",{className:"mx-0.5",children:"+"}),a]},a))})}var Z=a.i(726481);function $({isEmpty:a,hasContent:c}){let{isMobile:d}=(0,q.useMobileDetect)();return d?null:(0,b.jsxs)(p.Tooltip,{children:[(0,b.jsx)(p.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(n.Button,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground/60 hover:text-muted-foreground hover:bg-transparent","aria-label":"Keyboard shortcuts",children:(0,b.jsx)(W.Keyboard,{className:"h-4 w-4"})})}),(0,b.jsxs)(p.TooltipContent,{side:"top",align:"end",className:"p-3 space-y-2",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-foreground mb-2",children:"Shortcuts"}),c?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(_,{keys:["Enter"],label:"Send message"}),(0,b.jsx)(_,{keys:["Shift","Enter"],label:"New line"})]}):a?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aa,{keys:["mod","K"],label:"Commands"}),(0,b.jsx)(_,{keys:["Alt","N"],label:"New chat"})]}):(0,b.jsx)(_,{keys:["Shift","Enter"],label:"New line"})]})]})}function _({keys:a,label:c}){return(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4 text-xs",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:c}),(0,b.jsx)(Z.ShortcutBadge,{keys:a})]})}function aa({keys:a,label:c}){return(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4 text-xs",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:c}),(0,b.jsx)(Y,{keys:a})]})}var ab=a.i(469110),ac=a.i(547885);let ad=[{value:"none",label:"No Reasoning"},{value:"low",label:"Low Reasoning"},{value:"medium",label:"Medium Reasoning"},{value:"high",label:"High Reasoning"}];function ae({value:a,onChange:c,className:d}){return(0,b.jsxs)(ac.Select,{value:a,onValueChange:b=>{c(b),s.analytics.track("thinking_effort_selected",{effort:b,previousEffort:a})},children:[(0,b.jsx)(ac.SelectTrigger,{className:(0,u.cn)("h-7 text-xs border border-primary/20 bg-primary/5 hover:bg-primary/10 text-primary px-3 rounded-full transition-colors min-w-0 w-auto font-medium gap-1",d),children:(0,b.jsx)(ac.SelectValue,{placeholder:"Reasoning effort",children:(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)(ab.Zap,{className:"w-3.5 h-3.5"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:ad.find(b=>b.value===a)?.label})]})})}),(0,b.jsx)(ac.SelectContent,{children:ad.map(a=>(0,b.jsx)(ac.SelectItem,{value:a.value,className:"text-xs",children:a.label},a.value))})]})}function af({isComparisonMode:a,selectedModels:c,onExitComparison:d,onStartComparison:e,comparisonDialogOpen:f,onComparisonDialogOpenChange:g,selectedModel:h,onModelChange:i,modelSelectorOpen:j,onModelSelectorOpenChange:k,supportsThinking:l,thinkingEffort:m,onThinkingEffortChange:o,isEmpty:p,hasContent:q}){return(0,b.jsxs)("div",{className:"px-3 pb-2 flex justify-between items-center gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[a&&d?(0,b.jsxs)(S.Badge,{variant:"secondary",className:"flex items-center gap-1.5 pr-1 text-xs font-medium",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Comparing"}),(0,b.jsx)("span",{className:"text-foreground",children:c.length}),(0,b.jsx)(n.Button,{size:"icon",variant:"ghost",className:"h-4 w-4 p-0 hover:bg-muted/50 rounded-full",onClick:d,"aria-label":"Exit comparison mode",children:(0,b.jsx)(B.X,{className:"w-3 h-3"})})]}):(0,b.jsx)(U.QuickModelSwitcher,{currentModel:h,onSelectModel:i,open:j??!1,onOpenChange:k??(()=>{}),mode:"single",showTrigger:!0}),l&&m&&o&&!a&&(0,b.jsx)(ae,{value:m,onChange:o})]}),(0,b.jsxs)("div",{className:"flex items-center gap-0.5",children:[e&&(0,b.jsx)(V,{onStartComparison:e,isActive:a,selectedModels:c,open:f,onOpenChange:g}),(0,b.jsx)($,{isEmpty:p,hasContent:q}),(0,b.jsx)(ag,{})]})]})}function ag(){return(0,b.jsxs)(p.Tooltip,{children:[(0,b.jsx)(p.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(n.Button,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground/40 hover:text-muted-foreground/60 hover:bg-transparent","aria-label":"AI information",children:(0,b.jsx)(Q.Info,{className:"h-3.5 w-3.5"})})}),(0,b.jsx)(p.TooltipContent,{side:"top",align:"end",className:"max-w-xs",children:(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["AI can make mistakes."," ",(0,b.jsx)(R.default,{href:"/ai-info",className:"underline hover:text-foreground transition-colors",children:"Verify important info"}),"."]})})]})}var ah=a.i(868990);function ai({quote:a,onDismiss:c}){return(0,b.jsxs)("div",{className:"mx-2 mt-2 p-3 rounded-xl bg-muted/50 dark:bg-white/5 border border-border/50 dark:border-white/10 flex items-start gap-3 group relative",children:[(0,b.jsx)("div",{className:"shrink-0 mt-0.5",children:(0,b.jsx)(ah.Quote,{className:"w-4 h-4 text-primary/70"})}),(0,b.jsx)("div",{className:"flex-1 min-w-0",children:(0,b.jsx)("p",{className:"text-sm text-foreground/90 line-clamp-3 leading-relaxed font-medium",children:a})}),(0,b.jsx)(n.Button,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6 -mr-1 -mt-1 opacity-60 group-hover:opacity-100 transition-opacity",onClick:c,children:(0,b.jsx)(B.X,{className:"w-3 h-3"})})]})}var aj=a.i(698734),ak=a.i(353788);function al({open:a,onOpenChange:c,limit:d}){let[e,f]=(0,m.useState)("");return(0,m.useEffect)(()=>{let b=()=>{let a=new Date,b=new Date(a);b.setDate(b.getDate()+1),b.setHours(0,0,0,0);let c=b.getTime()-a.getTime(),d=Math.floor(c/36e5),e=Math.floor(c%36e5/6e4);f(`${d}h ${e}m`)};if(a){b();let a=setInterval(b,6e4);return()=>clearInterval(a)}},[a]),(0,b.jsx)(K.Dialog,{open:a,onOpenChange:c,children:(0,b.jsxs)(K.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsxs)(K.DialogHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)("div",{className:"p-2 rounded-full bg-destructive/10",children:(0,b.jsx)(aj.AlertCircle,{className:"w-5 h-5 text-destructive"})}),(0,b.jsx)(K.DialogTitle,{children:"Daily Limit Reached"})]}),(0,b.jsxs)(K.DialogDescription,{className:"text-left space-y-3 pt-2",children:[(0,b.jsxs)("p",{children:["You've reached your daily limit of"," ",(0,b.jsxs)("strong",{children:[d," messages"]}),"."]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-muted/50 border",children:[(0,b.jsx)(ak.Clock,{className:"w-4 h-4 text-muted-foreground"}),(0,b.jsxs)("span",{className:"text-sm",children:["Resets in"," ",(0,b.jsx)("strong",{className:"text-foreground",children:e})]})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Your message count resets at midnight (local time). Come back tomorrow to continue chatting!"})]})]}),(0,b.jsx)("div",{className:"flex justify-end mt-2",children:(0,b.jsx)(n.Button,{onClick:()=>c(!1),children:"Got it"})})]})})}var am=a.i(772949);let an=(0,m.forwardRef)(({onTranscript:a,onRecordingStateChange:e,isDisabled:f},g)=>{let[h,i]=(0,m.useState)(!1),[j,k]=(0,m.useState)(!1),l=(0,m.useRef)(null),o=(0,m.useRef)([]),p=(0,m.useRef)(null),q=(0,m.useRef)(null),r=(0,d.useQuery)(c.api.users.getCurrentUser),t=(0,d.useAction)(c.api.transcription.transcribeAudio),v=(0,d.useMutation)(c.api.files.generateUploadUrl),w=(0,am.useUserPreference)("sttEnabled"),x=(0,am.useUserPreference)("sttProvider"),y=(0,m.useCallback)(async()=>{if(!w)return void O.toast.error("Voice input disabled in settings");try{let b=await navigator.mediaDevices.getUserMedia({audio:!0});p.current=b;let c=new MediaRecorder(b,{mimeType:"audio/webm;codecs=opus"});o.current=[],c.ondataavailable=a=>{a.data.size>0&&o.current.push(a.data)},c.onstop=async()=>{k(!0),e?.(!1);let b=new Blob(o.current,{type:"audio/webm"});s.analytics.track("voice_recording_stopped",{durationMs:b.size/16});try{let c=await v(),d=await fetch(c,{method:"POST",headers:{"Content-Type":b.type},body:b});if(!d.ok)throw Error("Failed to upload audio file");let{storageId:e}=await d.json(),f=new Promise((a,b)=>setTimeout(()=>b(Error("TIMEOUT")),95e3)),g=t({storageId:e,mimeType:"audio/webm"}),h=await Promise.race([g,f]),i="send"===q.current;a(h,i),s.analytics.track("transcription_completed",{autoSendUsed:i})}catch(c){console.error("Transcription failed:",c);let b=c instanceof Error?c.message:String(c);"TIMEOUT"===b?O.toast.error("Transcription timed out. Try recording a shorter message."):O.toast.error(b||"STT not working right now"),a("",!1)}finally{k(!1),q.current=null}},c.start(),l.current=c,i(!0),e?.(!0,b),s.analytics.track("voice_recording_started")}catch(a){console.error("MediaRecorder failed:",a),O.toast.error("Microphone access denied")}},[w,t,a,e,v]),z=(0,m.useCallback)(a=>{h&&l.current&&(q.current=a,l.current.stop(),p.current&&(p.current.getTracks().forEach(a=>a.stop()),p.current=null),i(!1))},[h]),B=(0,m.useCallback)(()=>{h?z("preview"):y()},[h,y,z]);return((0,m.useImperativeHandle)(g,()=>({stopRecording:z}),[z]),w)?(0,b.jsx)(n.Button,{type:"button",variant:"ghost",size:"icon",onClick:B,disabled:f||j||!r,"aria-label":h?"Stop recording":`Start voice input (${x})`,className:(0,u.cn)("h-8 w-8 rounded-full transition-all duration-300",h?"bg-primary text-primary-foreground hover:bg-primary/90":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:(0,b.jsxs)("div",{className:"relative w-4 h-4 flex items-center justify-center","aria-hidden":"true",children:[(0,b.jsx)("div",{className:(0,u.cn)("absolute inset-0 flex items-center justify-center transition-all duration-300 transform",h?"opacity-100 scale-100 rotate-0":"opacity-0 scale-50 rotate-90"),children:(0,b.jsx)("div",{className:"h-3 w-3 bg-current rounded-[2px]"})}),(0,b.jsx)("div",{className:(0,u.cn)("absolute inset-0 flex items-center justify-center transition-all duration-300 transform",h?"opacity-0 scale-50 -rotate-90":"opacity-100 scale-100 rotate-0"),children:(0,b.jsx)(A.Mic,{className:"w-4 h-4"})})]})}):null});an.displayName="VoiceInput";let ao=(0,m.memo)(function({conversationId:a,isGenerating:g,selectedModel:w,onModelChange:x,thinkingEffort:y,onThinkingEffortChange:z,attachments:A,chatWidth:B,onAttachmentsChange:C,isComparisonMode:D=!1,selectedModels:E=[],onStartComparison:G,onExitComparison:H,isEmpty:I=!1,modelSelectorOpen:K,onModelSelectorOpenChange:M,comparisonDialogOpen:N,onComparisonDialogOpenChange:O,onOptimisticUpdate:Q}){let[R,S]=(0,m.useState)(""),[T,U]=(0,m.useState)(!1),[V,W]=(0,m.useState)(!1),[X,Y]=(0,m.useState)(!1),[Z,$]=(0,m.useState)(null),[_,aa]=(0,m.useState)(!1),[ab,ac]=(0,m.useState)(!1),[ad,ae]=(0,m.useState)(!1),[ag,ah]=(0,m.useState)(!1),[aj,ak]=(0,m.useState)(!1),[am,ao]=(0,m.useState)(null),[ap,aq]=(0,m.useState)(null),ar=(0,m.useRef)(null),as=(0,m.useRef)(null),at=(0,m.useRef)(null),au=(0,m.useRef)(0),{isMobile:av,isTouchDevice:aw}=(0,q.useMobileDetect)(),ax=function(a){let[b,c]=(0,m.useState)(!1);return(0,m.useEffect)(()=>{c(!1)},[a]),b}("webkitSpeechRecognition"),{mutate:ay}=(0,t.useSendMessage)(Q),az=(0,d.useMutation)(c.api.chat.stopGeneration),aA=(0,d.useQuery)(c.api.messages.getLastAssistantMessage,{conversationId:a}),aB=(0,r.getModelConfig)(w);aB?.capabilities?.includes("vision");let aC=!!aB?.reasoning,aD=async b=>{if(b.preventDefault(),g||!R.trim()&&!ap||T||V)return;U(!0);let c=R.trim(),d=[...A];ay({conversationId:a,content:ap?`> ${ap}

${c}`:c,...D?{models:E}:{modelId:w},thinkingEffort:y,attachments:A.length>0?A:void 0},{onError:a=>{ar.current?.value?.trim()||(S(c),aq(ap),C(d)),a instanceof Error&&a.message.includes("Daily message limit")&&ah(!0)}}),S(""),aq(null),C([]),U(!1),av||setTimeout(()=>ar.current?.focus(),0)},{handleKeyDown:aE}=function({input:a,setInput:b,textareaRef:c,onSubmit:d}){return{handleKeyDown:e=>{if("Enter"!==e.key||e.shiftKey||(e.preventDefault(),d(e)),(e.metaKey||e.ctrlKey)&&"$"===e.key){e.preventDefault();let d=c.current;if(!d)return;let f=d.selectionStart,g=d.selectionEnd;b(a.substring(0,f)+"$$\n\n$$"+a.substring(g)),setTimeout(()=>{d.focus(),d.selectionStart=d.selectionEnd=f+3},0)}}}}({input:R,setInput:S,textareaRef:ar,onSubmit:aD});!function({textareaRef:a,setInput:b,setQuote:c,isEmpty:d,isMobile:e,isTouchDevice:f,lastAssistantMessageId:g,lastAssistantMessageStatus:h,lastCompletedMessageId:i,setLastCompletedMessageId:j}){(0,m.useEffect)(()=>{let c=c=>{b(c.detail),a.current?.focus()};return window.addEventListener("insert-prompt",c),()=>{window.removeEventListener("insert-prompt",c)}},[b,a]),(0,m.useEffect)(()=>{let b=b=>{c(b.detail),a.current?.focus()};return window.addEventListener("quote-selection",b),()=>{window.removeEventListener("quote-selection",b)}},[c,a]),(0,m.useEffect)(()=>{let b=()=>{a.current?.focus()};return window.addEventListener("focus-chat-input",b),()=>{window.removeEventListener("focus-chat-input",b)}},[a]);let k=(0,m.useRef)(!1);(0,m.useEffect)(()=>{if(d&&!e&&!f&&a.current&&!k.current){k.current=!0;let b=setTimeout(()=>{a.current?.focus()},300);return()=>clearTimeout(b)}},[d,e,f,a]);let l=(0,m.useRef)(null);(0,m.useEffect)(()=>(l.current&&(clearTimeout(l.current),l.current=null),e||"complete"!==h||g===i||document.activeElement?.tagName==="INPUT"||document.activeElement?.tagName==="TEXTAREA"||(j(g),l.current=setTimeout(()=>{document.activeElement?.tagName!=="INPUT"&&document.activeElement?.tagName!=="TEXTAREA"&&a.current?.focus(),l.current=null},100)),()=>{l.current&&(clearTimeout(l.current),l.current=null)}),[h,g,i,j,e,a])}({textareaRef:ar,setInput:S,setQuote:aq,isEmpty:I,isMobile:av,isTouchDevice:aw,lastAssistantMessageId:aA?._id,lastAssistantMessageStatus:aA?.status,lastCompletedMessageId:am,setLastCompletedMessageId:ao});let aF=async b=>{b.preventDefault(),b.stopPropagation();try{await az({conversationId:a}),s.analytics.track("generation_stopped",{model:w,source:"stop_button"})}catch(a){console.error("Failed to stop generation:",a)}};(0,m.useEffect)(()=>{let a=ar.current;a&&(a.style.height="auto",a.style.height=`${Math.min(a.scrollHeight,200)}px`)},[R]);let aG=()=>{let a=(0,r.getModelConfig)(w);return a?.capabilities?.includes("vision")?"Describe an image or upload a file...":a?.capabilities?.includes("thinking")||a?.capabilities?.includes("extended-thinking")?"Ask me to reason through a problem...":"Message blah.chat..."},aH=R.trim().length>0||ap,aI=(aH||X||g)&&!T&&!V,aJ=!aH&&!g&&ax&&!X,aK=R.length>100;return(0,b.jsxs)("div",{className:(0,u.cn)("w-full mx-auto px-2 sm:px-4 pb-4 sm:pb-6 !pb-[calc(1rem+env(safe-area-inset-bottom))] transition-[max-width] duration-300 ease-out",function(a,b=!1){return b?v.full:v[a||"standard"]}(B,!1)),children:[(0,b.jsxs)("form",{ref:as,onSubmit:aD,onDragEnter:a=>{a.preventDefault(),a.stopPropagation(),au.current++,a.dataTransfer.types.includes("Files")&&ae(!0)},onDragLeave:a=>{a.preventDefault(),a.stopPropagation(),au.current--,0===au.current&&ae(!1)},onDragOver:a=>{a.preventDefault(),a.stopPropagation()},onDrop:a=>{a.preventDefault(),a.stopPropagation(),au.current=0,ae(!1)},role:"search","aria-label":"Send message to AI",className:(0,u.cn)("relative flex flex-col gap-2 p-2 transition-all duration-300 ease-out","bg-background/60 backdrop-blur-xl","border border-white/[0.06] dark:border-white/[0.08]","rounded-3xl","shadow-[0_1px_2px_rgba(0,0,0,0.04),0_4px_8px_rgba(0,0,0,0.06),0_8px_16px_rgba(0,0,0,0.04)]",ab&&["ring-1 ring-primary/20","shadow-[0_0_0_1px_rgba(var(--primary-rgb),0.1),0_2px_8px_rgba(var(--primary-rgb),0.08),0_8px_24px_rgba(var(--primary-rgb),0.06)]","border-primary/20"],!ab&&"hover:border-white/[0.1] hover:shadow-[0_1px_2px_rgba(0,0,0,0.04),0_4px_12px_rgba(0,0,0,0.08),0_12px_24px_rgba(0,0,0,0.06)]"),children:[(0,b.jsx)(e.AnimatePresence,{children:ad&&(0,b.jsxs)(f.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"absolute inset-0 z-10 rounded-3xl overflow-hidden pointer-events-none",children:[(0,b.jsx)("div",{className:"absolute inset-0 border-2 border-dashed border-primary/50 rounded-3xl animate-pulse"}),(0,b.jsx)("div",{className:"absolute inset-0 bg-primary/5 backdrop-blur-sm flex items-center justify-center",children:(0,b.jsxs)(f.motion.div,{initial:{y:4,opacity:0},animate:{y:0,opacity:1},transition:{delay:.05},className:"flex flex-col items-center gap-2",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:(0,b.jsx)(l.Upload,{className:"w-6 h-6 text-primary"})}),(0,b.jsx)("span",{className:"text-sm font-medium text-primary",children:"Drop files here"})]})})]})}),ap&&(0,b.jsx)(ai,{quote:ap,onDismiss:()=>aq(null)}),A.length>0&&(0,b.jsx)("div",{className:"px-3 pt-2",children:(0,b.jsx)(F,{attachments:A,onRemove:a=>C(A.filter((b,c)=>c!==a))})}),(0,b.jsxs)("div",{className:"flex gap-2 items-end px-2",children:[(0,b.jsx)("div",{className:"pb-1.5 flex-shrink-0",children:(0,b.jsxs)(p.Tooltip,{children:[(0,b.jsx)(p.TooltipTrigger,{asChild:!0,children:(0,b.jsx)("div",{children:(0,b.jsx)(P,{conversationId:a,attachments:A,onAttachmentsChange:C,onUploadComplete:()=>ar.current?.focus(),uploading:V,setUploading:W})})}),(0,b.jsx)(p.TooltipContent,{side:"top",children:(0,b.jsx)("p",{children:"Attach files"})})]})}),(0,b.jsx)("div",{className:"flex-1 min-w-0 relative",children:X?(0,b.jsxs)("div",{className:"relative min-h-[50px] flex items-center justify-center rounded-xl overflow-hidden",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/5 via-primary/10 to-primary/5 animate-pulse"}),(0,b.jsx)("div",{className:"absolute inset-0 border border-primary/20 rounded-xl"}),(0,b.jsx)(J,{stream:Z,height:50,className:"absolute inset-0 w-full h-full"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(o.Textarea,{ref:ar,"data-testid":"chat-input",value:R,onChange:a=>S(a.target.value),onKeyDown:aE,onFocus:()=>ac(!0),onBlur:()=>ac(!1),placeholder:aG(),"aria-label":"Message input","aria-describedby":"input-hint","aria-multiline":"true",className:"resize-none min-h-[50px] max-h-[200px] py-3 px-2 pr-8 bg-transparent border-0 shadow-none focus-visible:ring-0 text-base placeholder:text-muted-foreground/50",rows:1,disabled:T||V,"data-tour":"input"}),aK&&(0,b.jsxs)(p.Tooltip,{children:[(0,b.jsx)(p.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(n.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>ak(!0),className:"absolute top-2 right-1 h-6 w-6 text-muted-foreground/50 hover:text-muted-foreground hover:bg-transparent","aria-label":"Expand input",children:(0,b.jsx)(h,{className:"w-3.5 h-3.5"})})}),(0,b.jsx)(p.TooltipContent,{side:"top",children:(0,b.jsx)("p",{children:"Expand editor"})})]})]})}),(0,b.jsx)("div",{id:"input-hint",className:"sr-only",children:"Type your message. Press Enter to send, Shift+Enter for new line."}),(0,b.jsx)("div",{className:"pb-1.5 flex-shrink-0 flex items-center gap-1",children:aJ?(0,b.jsxs)(p.Tooltip,{children:[(0,b.jsx)(p.TooltipTrigger,{asChild:!0,children:(0,b.jsx)("div",{children:(0,b.jsx)(an,{ref:at,onTranscript:async(b,c)=>{if(aa(!1),c&&b.trim()){U(!0);try{await ay({conversationId:a,content:b.trim(),...D?{models:E}:{modelId:w},thinkingEffort:y,attachments:A.length>0?A:void 0}),C([])}catch(a){a instanceof Error&&a.message.includes("Daily message limit")?ah(!0):console.error("Failed to send message:",a)}finally{U(!1)}}else S(a=>a.trim()?`${a} ${b}`:b)},onRecordingStateChange:(a,b)=>{Y(a),$(b||null),!a&&b&&aa(!0)},isDisabled:T||V})})}),(0,b.jsx)(p.TooltipContent,{children:(0,b.jsx)("p",{children:"Voice input"})})]}):(0,b.jsx)(f.motion.div,{whileHover:aI?{scale:1.05}:void 0,whileTap:aI?{scale:.95,rotate:-2}:void 0,transition:{type:"spring",stiffness:400,damping:17},children:(0,b.jsx)(n.Button,{type:g||X?"button":"submit",size:"icon",onClick:g?aF:X?()=>at.current?.stopRecording("send"):void 0,"data-testid":"send-button","aria-label":g?"Stop generating response":X?"Stop recording and send":"Send message",className:(0,u.cn)("h-10 w-10 rounded-full transition-all duration-200",aI?["bg-primary text-primary-foreground","shadow-[0_2px_8px_rgba(var(--primary-rgb),0.25)]","hover:shadow-[0_4px_16px_rgba(var(--primary-rgb),0.35)]"]:"bg-muted/50 text-muted-foreground/50"),disabled:!aI,children:T?(0,b.jsx)(i.Loader2,{className:"w-5 h-5 animate-spin","aria-hidden":"true"}):g?(0,b.jsx)(k.Square,{className:"w-4 h-4 fill-current","aria-hidden":"true"}):(0,b.jsx)(j,{className:"w-5 h-5 ml-0.5","aria-hidden":"true"})})})})]}),(0,b.jsx)(af,{isComparisonMode:D,selectedModels:E,onExitComparison:H,onStartComparison:G,comparisonDialogOpen:N,onComparisonDialogOpenChange:O,selectedModel:w,onModelChange:x,modelSelectorOpen:K,onModelSelectorOpenChange:M,supportsThinking:aC,thinkingEffort:y,onThinkingEffortChange:z,isEmpty:I,hasContent:R.length>0})]}),(0,b.jsx)(al,{open:ag,onOpenChange:ah,limit:50}),(0,b.jsx)(L,{open:aj,onOpenChange:ak,value:R,onChange:S,onSubmit:()=>{ak(!1),as.current?.requestSubmit()},placeholder:aG()})]})});a.s(["ChatInput",0,ao],820493)},95944,a=>{"use strict";let b=(0,a.i(366705).default)("arrow-right-left",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);a.s(["ArrowRightLeft",()=>b],95944)},653936,a=>a.a(async(b,c)=>{try{var d=a.i(367146),e=a.i(130487);a.i(16243);var f=a.i(182234),g=a.i(95944),h=a.i(452549),i=a.i(537500),j=a.i(968177),k=a.i(539524),l=a.i(227759),m=a.i(349977),n=a.i(638600),o=a.i(165298),p=b([o]);function q({open:a,onOpenChange:b,currentModelId:c,suggestedModelId:p,currentResponse:q,onSwitch:r,conversationId:s,userMessage:t}){let[u,v]=(0,i.useState)(""),[w,x]=(0,i.useState)(!0),[y,z]=(0,i.useState)(0),A=m.MODEL_CONFIG[c],B=m.MODEL_CONFIG[p],C=(0,f.useMutation)(e.api.conversations.dismissModelRecommendation),D=(0,f.useMutation)(e.api.users.updatePreferences),E=(0,i.useRef)(null),F=(0,i.useRef)(null),G=(0,i.useRef)(null),H=(0,f.useAction)(e.api.ai.modelTriage.generatePreview),I=(0,i.useCallback)(async()=>{x(!0);try{let a=await H({conversationId:s,suggestedModelId:p,userMessage:t});v(a.content),n.analytics.track("recommendation_preview_completed",{conversationId:s,currentModel:c,suggestedModel:p,generationTimeMs:Date.now()-y,responseLength:a.content.length,timestamp:Date.now()}),n.analytics.track("recommendation_preview_compared",{conversationId:s,currentModel:c,suggestedModel:p,userSpentTimeComparingMs:Date.now()-y,timestamp:Date.now()})}catch(a){console.error("Failed to generate preview:",a),v("Failed to generate preview. Please try again.")}finally{x(!1)}},[H,s,p,t,c,y]);(0,i.useEffect)(()=>{a&&(z(Date.now()),I())},[a,I]),(0,i.useEffect)(()=>{let a=E.current,b=F.current;if(!a||!b)return;let c=()=>{if("right"===G.current)return;G.current="left";let c=a.scrollTop/(a.scrollHeight-a.clientHeight);b.scrollHeight>b.clientHeight&&(b.scrollTop=c*(b.scrollHeight-b.clientHeight)),window.requestAnimationFrame(()=>{"left"===G.current&&(G.current=null)})},d=()=>{if("left"===G.current)return;G.current="right";let c=b.scrollTop/(b.scrollHeight-b.clientHeight);a.scrollHeight>a.clientHeight&&(a.scrollTop=c*(a.scrollHeight-a.clientHeight)),window.requestAnimationFrame(()=>{"right"===G.current&&(G.current=null)})};return a.addEventListener("scroll",c),b.addEventListener("scroll",d),()=>{a.removeEventListener("scroll",c),b.removeEventListener("scroll",d)}},[]);let J=async()=>{if(!B||!A)return;let a=Math.round((1-(B.pricing.input+B.pricing.output)/(A.pricing.input+A.pricing.output))*100);n.analytics.track("recommendation_accepted",{conversationId:s,from:c,to:p,savings:a,viaPreview:!0,userSpentTimeComparingMs:Date.now()-y,timestamp:Date.now()}),r(p);try{await C({conversationId:s})}catch(a){console.error("Failed to dismiss recommendation:",a)}try{console.log("[ModelPreviewModal] Updating preferences:",{newChatModelSelection:"fixed",defaultModel:p}),await D({preferences:{newChatModelSelection:"fixed",defaultModel:p}}),console.log("[ModelPreviewModal] Preferences updated successfully"),n.analytics.track("model_preference_updated",{event:"recommendation_switch",modelId:p})}catch(a){console.error("[ModelPreviewModal] Failed to update global preference:",a)}window.dispatchEvent(new CustomEvent("focus-chat-input")),b(!1)},K=Math.round((1-(B.pricing.input+B.pricing.output)/(A.pricing.input+A.pricing.output))*100);return A&&B?(0,d.jsx)(l.Dialog,{open:a,onOpenChange:b,children:(0,d.jsxs)(l.DialogContent,{className:"w-full max-w-[96vw] xl:max-w-[1600px] h-[92vh] flex flex-col p-0 gap-0 overflow-hidden border-surface-glass-border bg-background/95 backdrop-blur-xl",children:[(0,d.jsx)(l.DialogHeader,{className:"px-8 py-5 border-b shrink-0 flex flex-row items-center justify-between bg-muted/30",children:(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsx)("div",{className:"p-2.5 rounded-full bg-primary/10 text-primary",children:(0,d.jsx)(g.ArrowRightLeft,{className:"w-5 h-5"})}),(0,d.jsxs)("div",{children:[(0,d.jsx)(l.DialogTitle,{className:"text-xl font-semibold tracking-tight",children:"Model Comparison"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground mt-1.5 font-normal",children:"Review how the suggested model responds to your request"})]})]})}),(0,d.jsxs)("div",{className:"flex-1 min-h-0 grid grid-cols-1 xl:grid-cols-2 divide-y xl:divide-y-0 xl:divide-x divide-border overflow-hidden bg-muted/5 relative",children:[(0,d.jsxs)("div",{className:"flex flex-col min-h-0 bg-background/50 h-full",children:[(0,d.jsxs)("div",{className:"p-4 px-6 border-b flex items-center justify-between bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-10 shadow-sm",children:[(0,d.jsx)("div",{className:"flex items-center gap-4",children:(0,d.jsxs)("div",{className:"font-semibold text-foreground flex items-center gap-3 text-lg",children:[A.name,(0,d.jsx)(j.Badge,{variant:"secondary",className:"text-[10px] font-mono tracking-wider px-2 py-0.5 uppercase opacity-80",children:"Current"})]})}),(0,d.jsxs)("div",{className:"flex flex-col items-end text-xs gap-0.5",children:[(0,d.jsxs)("span",{className:"text-foreground font-mono font-medium text-sm",children:["$",((A.pricing.input+A.pricing.output)/2).toFixed(2)," ","/ 1M"]}),(0,d.jsx)("span",{className:"text-muted-foreground/60",children:"Estimated Cost"})]})]}),(0,d.jsx)("div",{ref:E,className:"flex-1 overflow-y-auto",children:(0,d.jsx)("div",{className:"max-w-none p-8 md:p-10",children:(0,d.jsx)(o.MarkdownContent,{content:q})})})]}),(0,d.jsxs)("div",{className:"flex flex-col min-h-0 bg-background h-full relative group",children:[(0,d.jsxs)("div",{className:"p-4 px-6 border-b flex items-center justify-between bg-blue-50/10 backdrop-blur supports-[backdrop-filter]:bg-blue-50/5 sticky top-0 z-10 shadow-sm",children:[(0,d.jsx)("div",{className:"flex items-center gap-4",children:(0,d.jsxs)("div",{className:"font-semibold text-foreground flex items-center gap-3 text-lg",children:[B.name,(0,d.jsxs)(j.Badge,{className:"bg-green-500/15 text-green-700 dark:text-green-400 hover:bg-green-500/25 border-green-500/20 text-[10px] font-mono tracking-wider px-2 py-0.5 uppercase",children:[K,"% Cheaper"]})]})}),(0,d.jsxs)("div",{className:"flex flex-col items-end text-xs gap-0.5",children:[(0,d.jsxs)("span",{className:"text-green-600 dark:text-green-400 font-mono font-medium text-sm",children:["$",((B.pricing.input+B.pricing.output)/2).toFixed(2)," ","/ 1M"]}),(0,d.jsx)("span",{className:"text-muted-foreground/60",children:"Estimated Cost"})]})]}),(0,d.jsx)("div",{ref:F,className:"flex-1 overflow-y-auto bg-gradient-to-b from-blue-50/5 to-transparent",children:w?(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center h-full gap-5 text-muted-foreground p-10",children:[(0,d.jsx)(h.Loader2,{className:"h-10 w-10 animate-spin text-primary/50"}),(0,d.jsx)("p",{className:"text-sm font-medium animate-pulse tracking-wide",children:"Generating comparison response..."})]}):(0,d.jsx)("div",{className:"max-w-none p-8 md:p-10",children:(0,d.jsx)(o.MarkdownContent,{content:u})})})]})]}),(0,d.jsx)(l.DialogFooter,{className:"border-t p-6 bg-background/95 backdrop-blur shrink-0 flex flex-col xl:flex-row !justify-end gap-4 items-center z-20 shadow-[0_-5px_20px_-10px_rgba(0,0,0,0.1)]",children:(0,d.jsxs)("div",{className:"flex items-center gap-4 w-full xl:w-auto justify-end",children:[(0,d.jsx)(k.Button,{variant:"ghost",onClick:()=>b(!1),className:"text-muted-foreground hover:text-foreground px-6",children:"Cancel"}),(0,d.jsxs)(k.Button,{onClick:J,disabled:w,size:"lg",className:"bg-primary hover:bg-primary/90 text-primary-foreground shadow-lg shadow-primary/20 flex-1 xl:flex-none min-w-[200px] font-medium",children:["Switch to ",B.name]})]})})]})}):null}[o]=p.then?(await p)():p,a.s(["ModelPreviewModal",()=>q]),c()}catch(a){c(a)}},!1),781961,a=>{"use strict";var b=a.i(367146),c=a.i(354420),d=a.i(529395),e=a.i(922947),f=a.i(23944),g=a.i(537500),h=a.i(539524),i=a.i(638600);function j({modelId:a,modelName:j,onSetDefault:k,onDismiss:l,conversationId:m}){return(0,g.useEffect)(()=>{i.analytics.track("set_default_prompt_shown",{conversationId:m,modelId:a,afterAcceptingRecommendation:!0,timestamp:Date.now()})},[m,a]),(0,b.jsx)(c.AnimatePresence,{children:(0,b.jsx)(d.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3,ease:"easeOut"},className:"mx-auto mb-4 max-w-3xl rounded-xl border border-green-500/30 bg-gradient-to-r from-green-500/10 to-emerald-500/10 p-4 shadow-lg",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"mt-0.5 rounded-lg bg-green-500/20 p-2",children:(0,b.jsx)(e.CheckCircle,{className:"h-4 w-4 text-green-400"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("p",{className:"text-sm font-medium text-green-200",children:[j," worked great! 💚"]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Make it your default model for future chats?"})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(h.Button,{size:"sm",onClick:()=>{i.analytics.track("set_default_accepted",{conversationId:m,modelId:a,timestamp:Date.now()}),k()},className:"bg-green-500 hover:bg-green-600 text-white",children:"Set as default"}),(0,b.jsx)(h.Button,{size:"sm",variant:"ghost",onClick:()=>{i.analytics.track("set_default_dismissed",{conversationId:m,modelId:a,timestamp:Date.now()}),l()},className:"text-muted-foreground hover:text-foreground",children:(0,b.jsx)(f.X,{className:"h-4 w-4"})})]})]})})})}a.s(["SetDefaultModelPrompt",()=>j])},771293,a=>{"use strict";var b=a.i(367146),c=a.i(452549),d=a.i(961884),e=a.i(404761),f=a.i(397079),g=a.i(23944),h=a.i(537500),i=a.i(539524),j=a.i(248557),k=a.i(133231),l=a.i(700760);function m(a){if(!Number.isFinite(a)||a<0)return"0:00";let b=Math.floor(a/60),c=Math.floor(a%60).toString().padStart(2,"0");return`${b}:${c}`}let n=[.5,.75,1,1.25,1.5,1.75,2];function o({className:a}){let{state:o,pause:p,resume:q,stop:r,seekBy:s,seekTo:t,setSpeed:u,close:v}=(0,k.useTTSPlayer)(),{isVisible:w,isLoading:x,isPlaying:y,duration:z,currentTime:A,speed:B}=o,C=(0,h.useMemo)(()=>z&&z>0?z:Math.max(A,1),[z,A]),D=(0,h.useCallback)(()=>{x||(y?p():q())},[x,y,p,q]),E=(0,h.useCallback)(a=>{let b,c=n.indexOf(B);b="up"===a?(c+1)%n.length:(c-1+n.length)%n.length,u(n[b])},[B,u]);return((0,h.useEffect)(()=>{if(!w)return;let a=a=>{if(document.activeElement?.tagName!=="INPUT"&&document.activeElement?.tagName!=="TEXTAREA"&&document.activeElement?.getAttribute("contenteditable")!=="true")switch(a.key.toLowerCase()){case" ":a.preventDefault(),D();break;case"escape":a.preventDefault(),v();break;case"l":a.preventDefault(),s(15);break;case"h":a.preventDefault(),s(-15);break;case"k":a.preventDefault(),E("up");break;case"j":a.preventDefault(),E("down")}};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[w,D,v,s,E]),w||x)?(0,b.jsx)("div",{className:(0,l.cn)("pointer-events-none fixed left-0 right-0 top-[76px] z-40 px-4","flex justify-center",a),children:(0,b.jsxs)("div",{className:(0,l.cn)("pointer-events-auto flex w-full max-w-lg flex-col gap-0 overflow-hidden","rounded-2xl border border-white/20 bg-background/80 shadow-2xl backdrop-blur-xl","dark:border-white/10 dark:bg-black/60","transform transition-all duration-300 ease-out animate-in fade-in slide-in-from-top-4"),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between border-b border-white/5 bg-white/5 px-4 py-2.5",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 overflow-hidden text-xs text-muted-foreground",children:[(0,b.jsxs)("span",{children:[(0,b.jsx)("kbd",{className:"rounded bg-secondary px-1.5 py-0.5 font-mono text-[10px]",children:"Space"})," ","Play/Pause"]}),(0,b.jsxs)("span",{children:[(0,b.jsx)("kbd",{className:"rounded bg-secondary px-1.5 py-0.5 font-mono text-[10px]",children:"K"}),"/",(0,b.jsx)("kbd",{className:"rounded bg-secondary px-1.5 py-0.5 font-mono text-[10px]",children:"J"})," ","Speed"]}),(0,b.jsxs)("span",{children:[(0,b.jsx)("kbd",{className:"rounded bg-secondary px-1.5 py-0.5 font-mono text-[10px]",children:"H"}),"/",(0,b.jsx)("kbd",{className:"rounded bg-secondary px-1.5 py-0.5 font-mono text-[10px]",children:"L"})," ","±15s"]})]}),(0,b.jsx)(i.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 shrink-0 rounded-full text-muted-foreground hover:bg-white/10 hover:text-foreground",onClick:v,title:"Close (Esc)",children:(0,b.jsx)(g.X,{className:"h-3.5 w-3.5"})})]}),(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("div",{className:"mb-4 flex items-center gap-3",children:[(0,b.jsx)("span",{className:"w-9 text-right text-xs tabular-nums text-muted-foreground",children:m(A)}),(0,b.jsx)(j.Slider,{value:[Math.min(A,C)],min:0,max:C,step:.1,onValueChange:([a])=>t(a),className:"mt-0.5 flex-1 cursor-pointer","aria-label":"Seek"}),(0,b.jsx)("span",{className:"w-9 text-xs tabular-nums text-muted-foreground",children:m(z)})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(i.Button,{variant:"ghost",size:"sm",className:(0,l.cn)("h-8 min-w-[3rem] px-0 text-xs font-medium text-muted-foreground hover:text-foreground","rounded-full bg-secondary/50 hover:bg-secondary"),onClick:()=>E("up"),title:"Change Speed (J/K)",children:[B,"x"]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(i.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full text-foreground/80 hover:bg-primary/10 hover:text-primary",onClick:()=>s(-15),disabled:x,title:"Rewind 15s (H)",children:(0,b.jsx)(f.RotateCcw,{className:"h-4 w-4"})}),(0,b.jsx)(i.Button,{size:"icon",className:"h-12 w-12 rounded-full shadow-lg shadow-primary/20 transition-transform active:scale-95",onClick:D,disabled:x,title:y?"Pause (Space)":"Play (Space)",children:x?(0,b.jsx)(c.Loader2,{className:"h-5 w-5 animate-spin"}):y?(0,b.jsx)(d.Pause,{className:"h-5 w-5 fill-current"}):(0,b.jsx)(e.Play,{className:"h-5 w-5 fill-current ml-0.5"})}),(0,b.jsx)(i.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full text-foreground/80 hover:bg-primary/10 hover:text-primary",onClick:()=>s(15),disabled:x,title:"Forward 15s (L)",children:(0,b.jsx)("div",{className:"relative",children:(0,b.jsx)(f.RotateCcw,{className:"h-4 w-4 scale-x-[-1]"})})})]}),(0,b.jsx)("div",{className:"w-[3rem]"})]})]})]})}):null}a.s(["TTSPlayerBar",()=>o])},391767,a=>{"use strict";var b=a.i(537500);function c(a={}){let{threshold:d=100,animationDuration:e=400,disableAutoScroll:f=!1}=a,g=(0,b.useRef)(null),h=(0,b.useRef)(!1),i=(0,b.useRef)(void 0),[j,k]=(0,b.useState)(!1),[l,m]=(0,b.useState)(!0),[n,o]=(0,b.useState)(!1),[p,q]=(0,b.useState)(!1),r=(0,b.useRef)(j),s=(0,b.useRef)(l),t=(0,b.useRef)(f);(0,b.useLayoutEffect)(()=>{r.current=j},[j]),(0,b.useLayoutEffect)(()=>{s.current=l},[l]),(0,b.useLayoutEffect)(()=>{t.current=f},[f]),(0,b.useEffect)(()=>{let a=window.matchMedia("(prefers-reduced-motion: reduce)");q(a.matches);let b=a=>q(a.matches);return a.addEventListener("change",b),()=>a.removeEventListener("change",b)},[]);let u=(0,b.useCallback)(a=>a.scrollHeight-a.scrollTop-a.clientHeight<d,[d]),v=(0,b.useCallback)((a="smooth")=>{let b=g.current;if(!b)return!1;h.current=!0;let c=p?"auto":a,d=b.scrollHeight-b.clientHeight;return b.scrollTo({top:d,behavior:c}),setTimeout(()=>{if(h.current=!1,!b)return;let a=u(b);m(a),a||j||requestAnimationFrame(()=>{b&&b.scrollTo({top:b.scrollHeight-b.clientHeight,behavior:"auto"})})},"smooth"===c?e:0),!0},[e,u,j,p]);(0,b.useEffect)(()=>{let a=g.current;if(!a)return;let b=()=>{let b=u(a);m(b),b||h.current?b&&(k(!1),o(!1)):(k(!0),o(!0))};return a.addEventListener("scroll",b,{passive:!0}),()=>a.removeEventListener("scroll",b)},[u]);let w=(0,b.useRef)(v);return(0,b.useEffect)(()=>{w.current=v},[v]),(0,b.useEffect)(()=>{let a=g.current;if(!a)return;let b=new MutationObserver(()=>{t.current||r.current||!s.current||(i.current&&cancelAnimationFrame(i.current),i.current=requestAnimationFrame(()=>{w.current("auto")}))});return b.observe(a,{childList:!0,subtree:!0,characterData:!0}),()=>{b.disconnect(),i.current&&cancelAnimationFrame(i.current)}},[]),{containerRef:g,scrollToBottom:v,showScrollButton:n,isAtBottom:l}}a.s(["useAutoScroll",()=>c])},610715,a=>{"use strict";var b=a.i(537500);function c({containerRef:a,conversationId:c,messageCount:d,highlightMessageId:e,messages:f}){let g=(0,b.useRef)(null),h=(0,b.useRef)(d);(0,b.useEffect)(()=>{let b;if(e||!c||0===d||g.current===c)return;let f=0,h=()=>{let d=a.current;if(d&&d.scrollHeight>d.clientHeight){d.scrollTop=d.scrollHeight,g.current=c;return}++f<20&&(b=setTimeout(h,50))},i=requestAnimationFrame(h);return()=>{cancelAnimationFrame(i),clearTimeout(b)}},[c,e,d,a]),(0,b.useEffect)(()=>{let b=h.current;if(d>b){let c=f.slice(b).find(a=>"user"===a.role);c&&requestAnimationFrame(()=>{let b=document.getElementById(`message-${c._id}`),d=a.current;if(b&&d){let a=d.getBoundingClientRect(),c=b.getBoundingClientRect().top-a.top+d.scrollTop;d.scrollTo({top:Math.max(0,c-50),behavior:"smooth"})}})}h.current=d},[f,d,a])}a.s(["useConversationScroll",()=>c])},187587,a=>{"use strict";var b=a.i(537500);function c({highlightMessageId:a,grouped:c,containerRef:d,virtualizer:e}){let f=(0,b.useRef)(!1);(0,b.useEffect)(()=>{if(!a||f.current)return;let b=c.findIndex(b=>"message"===b.type?b.data._id===a:"comparison"===b.type&&(b.userMessage._id===a||b.assistantMessages.some(b=>b._id===a)));-1!==b&&(requestAnimationFrame(()=>{e.scrollToIndex(b,{align:"start",behavior:"smooth"})}),setTimeout(()=>{let b=document.getElementById(`message-${a}`),c=d.current;if(b&&c){let a=c.getBoundingClientRect(),d=b.getBoundingClientRect().top-a.top+c.scrollTop;c.scrollTo({top:Math.max(0,d-80),behavior:"smooth"}),b.classList.add("message-highlight"),setTimeout(()=>b.classList.remove("message-highlight"),1200)}},300),f.current=!0)},[a,c,e,d]),(0,b.useEffect)(()=>{f.current=!1},[a])}a.s(["useHighlightScroll",()=>c])},193001,a=>{"use strict";var b=a.i(537500);function c(a){return(0,b.useMemo)(()=>{let b=a.filter(a=>!("assistant"===a.role&&a.consolidatedMessageId)),c={};for(let a of b)a.comparisonGroupId&&(c[a.comparisonGroupId]||=[],c[a.comparisonGroupId].push(a));let d=[],e=new Set;for(let a of b)if(a.comparisonGroupId){if(!e.has(a.comparisonGroupId)){let b=c[a.comparisonGroupId],f=b.find(a=>"user"===a.role),g=b.filter(a=>"assistant"===a.role);f&&g.length>0?d.push({type:"comparison",id:a.comparisonGroupId,userMessage:f,assistantMessages:g,timestamp:Math.min(...b.map(a=>a.createdAt))}):f&&d.push({type:"message",data:f}),e.add(a.comparisonGroupId)}}else d.push({type:"message",data:a});return d},[a])}a.s(["useMessageGrouping",()=>c])},85523,a=>{"use strict";let b;var c=a.i(130487),d=a.i(506492),e=a.i(300601),f=a.i(905664),g=a.i(8206),h=a.i(844232),i=a.i(808334),j=a.i(293212),k=class extends g.Subscribable{constructor(a,b){super(),this.options=b,this.#a=a,this.#b=null,this.#c=(0,h.pendingThenable)(),this.bindMethods(),this.setOptions(b)}#a;#d=void 0;#e=void 0;#f=void 0;#g;#h;#c;#b;#i;#j;#k;#l;#m;#n;#o=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#d.addObserver(this),l(this.#d,this.options)?this.#p():this.updateResult(),this.#q())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return m(this.#d,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return m(this.#d,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#r(),this.#s(),this.#d.removeObserver(this)}setOptions(a){let b=this.options,c=this.#d;if(this.options=this.#a.defaultQueryOptions(a),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof(0,i.resolveEnabled)(this.options.enabled,this.#d))throw Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#t(),this.#d.setOptions(this.options),b._defaulted&&!(0,i.shallowEqualObjects)(this.options,b)&&this.#a.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#d,observer:this});let d=this.hasListeners();d&&n(this.#d,c,this.options,b)&&this.#p(),this.updateResult(),d&&(this.#d!==c||(0,i.resolveEnabled)(this.options.enabled,this.#d)!==(0,i.resolveEnabled)(b.enabled,this.#d)||(0,i.resolveStaleTime)(this.options.staleTime,this.#d)!==(0,i.resolveStaleTime)(b.staleTime,this.#d))&&this.#u();let e=this.#v();d&&(this.#d!==c||(0,i.resolveEnabled)(this.options.enabled,this.#d)!==(0,i.resolveEnabled)(b.enabled,this.#d)||e!==this.#n)&&this.#w(e)}getOptimisticResult(a){var b,c;let d=this.#a.getQueryCache().build(this.#a,a),e=this.createResult(d,a);return b=this,c=e,(0,i.shallowEqualObjects)(b.getCurrentResult(),c)||(this.#f=e,this.#h=this.options,this.#g=this.#d.state),e}getCurrentResult(){return this.#f}trackResult(a,b){return new Proxy(a,{get:(a,c)=>(this.trackProp(c),b?.(c),"promise"===c&&(this.trackProp("data"),this.options.experimental_prefetchInRender||"pending"!==this.#c.status||this.#c.reject(Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(a,c))})}trackProp(a){this.#o.add(a)}getCurrentQuery(){return this.#d}refetch({...a}={}){return this.fetch({...a})}fetchOptimistic(a){let b=this.#a.defaultQueryOptions(a),c=this.#a.getQueryCache().build(this.#a,b);return c.fetch().then(()=>this.createResult(c,b))}fetch(a){return this.#p({...a,cancelRefetch:a.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#f))}#p(a){this.#t();let b=this.#d.fetch(this.options,a);return a?.throwOnError||(b=b.catch(i.noop)),b}#u(){this.#r();let a=(0,i.resolveStaleTime)(this.options.staleTime,this.#d);if(i.isServer||this.#f.isStale||!(0,i.isValidTimeout)(a))return;let b=(0,i.timeUntilStale)(this.#f.dataUpdatedAt,a);this.#l=j.timeoutManager.setTimeout(()=>{this.#f.isStale||this.updateResult()},b+1)}#v(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#d):this.options.refetchInterval)??!1}#w(a){this.#s(),this.#n=a,!i.isServer&&!1!==(0,i.resolveEnabled)(this.options.enabled,this.#d)&&(0,i.isValidTimeout)(this.#n)&&0!==this.#n&&(this.#m=j.timeoutManager.setInterval(()=>{(this.options.refetchIntervalInBackground||d.focusManager.isFocused())&&this.#p()},this.#n))}#q(){this.#u(),this.#w(this.#v())}#r(){this.#l&&(j.timeoutManager.clearTimeout(this.#l),this.#l=void 0)}#s(){this.#m&&(j.timeoutManager.clearInterval(this.#m),this.#m=void 0)}createResult(a,b){let c,d=this.#d,e=this.options,g=this.#f,j=this.#g,k=this.#h,m=a!==d?a.state:this.#e,{state:p}=a,q={...p},r=!1;if(b._optimisticResults){let c=this.hasListeners(),g=!c&&l(a,b),h=c&&n(a,d,b,e);(g||h)&&(q={...q,...(0,f.fetchState)(p.data,a.options)}),"isRestoring"===b._optimisticResults&&(q.fetchStatus="idle")}let{error:s,errorUpdatedAt:t,status:u}=q;c=q.data;let v=!1;if(void 0!==b.placeholderData&&void 0===c&&"pending"===u){let a;g?.isPlaceholderData&&b.placeholderData===k?.placeholderData?(a=g.data,v=!0):a="function"==typeof b.placeholderData?b.placeholderData(this.#k?.state.data,this.#k):b.placeholderData,void 0!==a&&(u="success",c=(0,i.replaceData)(g?.data,a,b),r=!0)}if(b.select&&void 0!==c&&!v)if(g&&c===j?.data&&b.select===this.#i)c=this.#j;else try{this.#i=b.select,c=b.select(c),c=(0,i.replaceData)(g?.data,c,b),this.#j=c,this.#b=null}catch(a){this.#b=a}this.#b&&(s=this.#b,c=this.#j,t=Date.now(),u="error");let w="fetching"===q.fetchStatus,x="pending"===u,y="error"===u,z=x&&w,A=void 0!==c,B={status:u,fetchStatus:q.fetchStatus,isPending:x,isSuccess:"success"===u,isError:y,isInitialLoading:z,isLoading:z,data:c,dataUpdatedAt:q.dataUpdatedAt,error:s,errorUpdatedAt:t,failureCount:q.fetchFailureCount,failureReason:q.fetchFailureReason,errorUpdateCount:q.errorUpdateCount,isFetched:q.dataUpdateCount>0||q.errorUpdateCount>0,isFetchedAfterMount:q.dataUpdateCount>m.dataUpdateCount||q.errorUpdateCount>m.errorUpdateCount,isFetching:w,isRefetching:w&&!x,isLoadingError:y&&!A,isPaused:"paused"===q.fetchStatus,isPlaceholderData:r,isRefetchError:y&&A,isStale:o(a,b),refetch:this.refetch,promise:this.#c,isEnabled:!1!==(0,i.resolveEnabled)(b.enabled,a)};if(this.options.experimental_prefetchInRender){let b=a=>{"error"===B.status?a.reject(B.error):void 0!==B.data&&a.resolve(B.data)},c=()=>{b(this.#c=B.promise=(0,h.pendingThenable)())},e=this.#c;switch(e.status){case"pending":a.queryHash===d.queryHash&&b(e);break;case"fulfilled":("error"===B.status||B.data!==e.value)&&c();break;case"rejected":("error"!==B.status||B.error!==e.reason)&&c()}}return B}updateResult(){let a=this.#f,b=this.createResult(this.#d,this.options);if(this.#g=this.#d.state,this.#h=this.options,void 0!==this.#g.data&&(this.#k=this.#d),(0,i.shallowEqualObjects)(b,a))return;this.#f=b;let c=()=>{if(!a)return!0;let{notifyOnChangeProps:b}=this.options,c="function"==typeof b?b():b;if("all"===c||!c&&!this.#o.size)return!0;let d=new Set(c??this.#o);return this.options.throwOnError&&d.add("error"),Object.keys(this.#f).some(b=>this.#f[b]!==a[b]&&d.has(b))};this.#x({listeners:c()})}#t(){let a=this.#a.getQueryCache().build(this.#a,this.options);if(a===this.#d)return;let b=this.#d;this.#d=a,this.#e=a.state,this.hasListeners()&&(b?.removeObserver(this),a.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#q()}#x(a){e.notifyManager.batch(()=>{a.listeners&&this.listeners.forEach(a=>{a(this.#f)}),this.#a.getQueryCache().notify({query:this.#d,type:"observerResultsUpdated"})})}};function l(a,b){return!1!==(0,i.resolveEnabled)(b.enabled,a)&&void 0===a.state.data&&("error"!==a.state.status||!1!==b.retryOnMount)||void 0!==a.state.data&&m(a,b,b.refetchOnMount)}function m(a,b,c){if(!1!==(0,i.resolveEnabled)(b.enabled,a)&&"static"!==(0,i.resolveStaleTime)(b.staleTime,a)){let d="function"==typeof c?c(a):c;return"always"===d||!1!==d&&o(a,b)}return!1}function n(a,b,c,d){return(a!==b||!1===(0,i.resolveEnabled)(d.enabled,a))&&(!c.suspense||"error"!==a.state.status)&&o(a,c)}function o(a,b){return!1!==(0,i.resolveEnabled)(b.enabled,a)&&a.isStaleByTime((0,i.resolveStaleTime)(b.staleTime,a))}var p=a.i(537500),q=a.i(965265);a.i(367146);var r=p.createContext((b=!1,{clearReset:()=>{b=!1},reset:()=>{b=!0},isReset:()=>b})),s=p.createContext(!1);s.Provider;var t=(a,b,c)=>b.fetchOptimistic(a).catch(()=>{c.clearReset()});a.i(16243);var u=a.i(182234),v=a.i(18124),w=a.i(134186);function x(a={}){let{page:b=1,pageSize:d=20,archived:f=!1}=a,g=(0,w.shouldUseConvex)(),h=(0,v.useApiClient)(),j=(0,u.useQuery)(c.api.conversations.list,g&&!f?{}:"skip"),l=function(a,b,c){let d=p.useContext(s),f=p.useContext(r),g=(0,q.useQueryClient)(c),h=g.defaultQueryOptions(a);if(g.getDefaultOptions().queries?._experimental_beforeQuery?.(h),h._optimisticResults=d?"isRestoring":"optimistic",h.suspense){let a=a=>"static"===a?a:Math.max(a??1e3,1e3),b=h.staleTime;h.staleTime="function"==typeof b?(...c)=>a(b(...c)):a(b),"number"==typeof h.gcTime&&(h.gcTime=Math.max(h.gcTime,1e3))}(h.suspense||h.throwOnError||h.experimental_prefetchInRender)&&!f.isReset()&&(h.retryOnMount=!1),p.useEffect(()=>{f.clearReset()},[f]);let j=!g.getQueryCache().get(h.queryHash),[k]=p.useState(()=>new b(g,h)),l=k.getOptimisticResult(h),m=!d&&!1!==a.subscribed;if(p.useSyncExternalStore(p.useCallback(a=>{let b=m?k.subscribe(e.notifyManager.batchCalls(a)):i.noop;return k.updateResult(),b},[k,m]),()=>k.getCurrentResult(),()=>k.getCurrentResult()),p.useEffect(()=>{k.setOptions(h)},[h,k]),h?.suspense&&l.isPending)throw t(h,k,f);if((({result:a,errorResetBoundary:b,throwOnError:c,query:d,suspense:e})=>a.isError&&!b.isReset()&&!a.isFetching&&d&&(e&&void 0===a.data||(0,i.shouldThrowError)(c,[a.error,d])))({result:l,errorResetBoundary:f,throwOnError:h.throwOnError,query:g.getQueryCache().get(h.queryHash),suspense:h.suspense}))throw l.error;if(g.getDefaultOptions().queries?._experimental_afterQuery?.(h,l),h.experimental_prefetchInRender&&!i.isServer&&l.isLoading&&l.isFetching&&!d){let a=j?t(h,k,f):g.getQueryCache().get(h.queryHash)?.promise;a?.catch(i.noop).finally(()=>{k.updateResult()})}return h.notifyOnChangeProps?l:k.trackResult(l)}({queryKey:["conversations",{page:b,pageSize:d,archived:f}],queryFn:async()=>{let a=new URLSearchParams({page:String(b),pageSize:String(d),archived:String(f)});return h.get(`/conversations?${a}`)},enabled:!g,staleTime:3e4},k,void 0);return g?{data:j?{items:j,pagination:{page:1,pageSize:j.length,total:j.length,hasNext:!1}}:void 0,isLoading:void 0===j,error:null,refetch:()=>Promise.resolve()}:{data:l.data,isLoading:l.isLoading,error:l.error,refetch:l.refetch}}a.s(["useConversations",()=>x],85523)},691343,a=>{"use strict";var b=a.i(711106);let c={"gpt-5":["Analyze this architecture diagram and suggest improvements","Debug React useEffect infinite loop with async dependencies","Extract structured data from handwritten notes","Compare these two UI mockups and list differences","Review this PR for security vulnerabilities and best practices","Refactor this component to follow React composition patterns","Explain TCP/IP handshake like I'm interviewing for senior engineer","Write comprehensive test cases for this authentication flow","Prove: sum of first n cubes equals (n(n+1)/2)²","Find the logic error in this distributed consensus algorithm","Debug race condition in concurrent Rust code","Analyze failure scenario in blockchain consensus","Derive Black-Scholes equation from first principles","Find edge case causing intermittent deadlock","Prove correctness of this sorting algorithm variant","Optimize this dynamic programming solution","Design distributed caching system for 1M requests/sec","Analyze architectural tradeoffs for microservices migration","Review API design for RESTful best practices","Refactor monolith to event-driven architecture"]},d={thinking:["Prove: $$\\sum_{i=1}^{n} i = \\frac{n(n+1)}{2}$$ using mathematical induction","Derive quadratic formula from $$ax^2 + bx + c = 0$$","Find the subtle bug in this encryption logic: `AES-GCM` with fixed IV","Debug infinite recursion in `dfs` traversal: provide fixed code"],vision:["Extract structured JSON data from this invoice image","Identify accessibility violations in this UI design screenshot","Analyze the trend in this sales chart and predict next month","Transcribe this handwritten medical note into text"],fast:["Summarize this article in 3 bullet points","Write a regex to validate US phone numbers: `(555) 123-4567`","Fix this TypeScript error: `Property 'id' does not exist on type 'User'`","Generate 5 creative names for a coffee shop app"],general:["Explain photosynthesis: $$\\ce{6CO2 + 6H2O ->[light] C6H12O6 + 6O2}$$","Compare PostgreSQL vs MongoDB for high-write logging system","Refactor this nested callback code to `async/await`","Solve for mass in $$E = mc^2$$ given Energy = 50J"]};function e(a){if(!a)return{category:"general",prompts:d.general,source:"default"};if(a in c)return{category:"suggested",prompts:c[a],source:"exact-model"};let e=(0,b.getModelConfig)(a);if(!e)return{category:"general",prompts:d.general,source:"default"};if(e.capabilities.includes("thinking")||e.capabilities.includes("extended-thinking")||e.reasoning)return{category:"thinking",prompts:d.thinking,source:"capability"};if(e.capabilities.includes("vision"))return{category:"vision",prompts:d.vision,source:"capability"};let f=e.name.toLowerCase();return f.includes("mini")||f.includes("flash")||f.includes("nano")?{category:"fast",prompts:d.fast,source:"capability"}:{category:"general",prompts:d.general,source:"capability"}}a.s(["CAPABILITY_PROMPTS",()=>d,"getPromptsForModel",()=>e])},975334,a=>a.a(async(b,c)=>{try{var d=a.i(367146),e=a.i(234705),f=a.i(525662),g=a.i(192128),h=a.i(954439),i=a.i(651386),j=a.i(469110),k=a.i(537500),l=a.i(539524),m=a.i(691343),n=a.i(700760),o=a.i(165298),p=b([o]);[o]=p.then?(await p)():p;let r={morning:["Good morning","Morning","Ready to start the day"],afternoon:["Good afternoon","How's the day going","Afternoon"],evening:["Good evening","Evening work session","How can I help tonight"]};function q({onClick:a,selectedModel:b,conversationCount:c,nickname:p}){let q=(0,m.getPromptsForModel)(b),[s,t]=(0,k.useState)(q.category),u=(0,k.useMemo)(()=>{let a,b=r[(a=new Date().getHours())<12?"morning":a<17?"afternoon":"evening"];return b[Math.floor(Math.random()*b.length)]},[]);if((0,k.useEffect)(()=>{t(q.category)},[q.category]),(c??0)>=2){let a=p?`${u}, ${p}`:u;return(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[50vh] px-8 text-center animate-message-enter w-full",children:[(0,d.jsx)("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold mb-8 bg-linear-to-br from-foreground to-muted-foreground bg-clip-text text-transparent",children:a}),(0,d.jsxs)("div",{className:"hidden sm:flex gap-4 md:gap-6 text-xs text-muted-foreground/60 animate-in fade-in duration-700 delay-300 flex-wrap justify-center",children:[(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,d.jsxs)("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[(0,d.jsx)("span",{className:"text-xs",children:"⌘"}),"J"]}),(0,d.jsx)("span",{children:"models"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,d.jsxs)("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[(0,d.jsx)("span",{className:"text-xs",children:"⌘"}),"K"]}),(0,d.jsx)("span",{children:"commands"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,d.jsxs)("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[(0,d.jsx)("span",{className:"text-xs",children:"⌘"}),";"]}),(0,d.jsx)("span",{children:"templates"})]})]})]})}let v=[..."exact-model"===q.source?[{key:"suggested",label:"Suggested",icon:i.Sparkles,prompts:q.prompts}]:[],{key:"thinking",label:"Thinking",icon:f.Brain,prompts:m.CAPABILITY_PROMPTS.thinking},{key:"vision",label:"Vision",icon:h.Eye,prompts:m.CAPABILITY_PROMPTS.vision},{key:"fast",label:"Fast",icon:j.Zap,prompts:m.CAPABILITY_PROMPTS.fast},{key:"general",label:"General",icon:g.Code2,prompts:m.CAPABILITY_PROMPTS.general}],w=v.find(a=>a.key===s)?.prompts||q.prompts;return(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[50vh] px-4 text-center animate-message-enter",children:[(0,d.jsx)("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold mb-6 sm:mb-8 bg-linear-to-br from-foreground to-muted-foreground bg-clip-text text-transparent",children:"How can I help you?"}),(0,d.jsx)("div",{className:"hidden sm:flex flex-wrap gap-2 justify-center mb-12 max-w-2xl",children:v.map(a=>{let b=a.icon;return(0,d.jsxs)(l.Button,{variant:"outline",className:(0,n.cn)("rounded-full gap-2 px-4 h-9 transition-all duration-300 border-white/10 hover:scale-105 cursor-pointer",s===a.key?"bg-primary/20 text-primary border-primary/20 hover:bg-primary/30":"bg-background/40 hover:bg-background/80 hover:border-white/20"),onClick:()=>t(a.key),children:[(0,d.jsx)(b,{className:"w-4 h-4"}),(0,d.jsx)("span",{className:"text-sm font-medium",children:a.label})]},a.key)})}),(0,d.jsx)("div",{className:"grid gap-1.5 sm:gap-2 w-full max-w-full sm:max-w-md text-left mb-6 sm:mb-8 px-2 sm:px-0",children:w.slice(0,4).map((b,c)=>(0,d.jsxs)("div",{role:"button",tabIndex:0,onClick:()=>a(b),onKeyDown:c=>{("Enter"===c.key||" "===c.key)&&(c.preventDefault(),a(b))},className:"group flex h-16 items-center justify-between p-2 sm:p-3 rounded-lg sm:rounded-xl hover:bg-white/5 transition-all duration-200 border border-transparent hover:border-white/5 text-xs sm:text-sm text-muted-foreground hover:text-foreground cursor-pointer",style:{animationDelay:`${100*c}ms`},children:[(0,d.jsx)("div",{className:"line-clamp-2 text-left",children:(0,d.jsx)(o.MarkdownContent,{content:b})}),(0,d.jsx)(e.ArrowRight,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 opacity-0 -translate-x-2 group-hover:translate-x-0 group-hover:opacity-50 transition-all duration-300 shrink-0 ml-1.5 sm:ml-3"})]},b))}),(0,d.jsxs)("div",{className:"hidden sm:flex gap-6 text-xs text-muted-foreground/60 animate-in fade-in duration-700 delay-500",children:[(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,d.jsxs)("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[(0,d.jsx)("span",{className:"text-xs",children:"⌘"}),"J"]}),(0,d.jsx)("span",{children:"models"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,d.jsxs)("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[(0,d.jsx)("span",{className:"text-xs",children:"⌘"}),"K"]}),(0,d.jsx)("span",{children:"commands"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,d.jsxs)("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[(0,d.jsx)("span",{className:"text-xs",children:"⌘"}),";"]}),(0,d.jsx)("span",{children:"templates"})]})]})]})}a.s(["EmptyScreen",()=>q]),c()}catch(a){c(a)}},!1),270730,a=>a.a(async(b,c)=>{try{var d=a.i(367146),e=a.i(913425),f=a.i(991770),g=a.i(539524),h=a.i(391767),i=a.i(610715),j=a.i(187587),k=a.i(193001),l=a.i(772949),m=a.i(85523),n=a.i(700760),o=a.i(460241),p=a.i(180100),q=a.i(975334),r=b([o,p,q]);function s({messages:a,selectedModel:b,onVote:c,onConsolidate:r,onToggleModelNames:s,showModelNames:t,chatWidth:u,highlightMessageId:v,isCollaborative:w,isGenerating:x}){let{containerRef:y,scrollToBottom:z,showScrollButton:A}=(0,h.useAutoScroll)({threshold:100,animationDuration:400,disableAutoScroll:!0}),{data:B}=(0,m.useConversations)(),C=B?.items?.length??0,D=(0,l.useUserPreference)("customInstructions"),E=D?.nickname||"",F=a[0]?.conversationId,G=(0,k.useMessageGrouping)(a),H=(0,e.useVirtualizer)({count:G.length,getScrollElement:()=>y.current,estimateSize:()=>150,overscan:5}),I=H.getVirtualItems();return((0,j.useHighlightScroll)({highlightMessageId:v,grouped:G,containerRef:y,virtualizer:H}),(0,i.useConversationScroll)({containerRef:y,conversationId:F,messageCount:a.length,highlightMessageId:v,messages:a}),0===a.length)?(0,d.jsx)("div",{className:"flex items-center justify-center h-full w-full",children:(0,d.jsx)(q.EmptyScreen,{selectedModel:b,conversationCount:C,nickname:E,onClick:a=>{let b=new CustomEvent("insert-prompt",{detail:a});window.dispatchEvent(b)}})}):(0,d.jsxs)("div",{className:"flex-1 max-h-full min-h-0 min-w-0 relative flex flex-col overflow-hidden",children:[(0,d.jsx)("div",{ref:y,role:"log","aria-live":"polite","aria-label":"Chat message history","aria-atomic":"false",className:"flex-1 w-full min-w-0 min-h-0 overflow-y-auto relative",style:{contain:"layout style paint",contentVisibility:"auto"},children:(0,d.jsx)("div",{className:(0,n.cn)(x&&"pb-[80vh]"),style:{height:`${H.getTotalSize()}px`,width:"100%",position:"relative"},children:I.map(a=>{let b=G[a.index],e="message"===b.type;return(0,d.jsx)("div",{"data-index":a.index,ref:H.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${a.start}px)`},children:(0,d.jsx)("div",{className:(0,n.cn)("grid gap-4 px-4 py-2 transition-all duration-300 ease-out","narrow"===u&&"grid-cols-[1fr_min(42rem,100%)_1fr]","standard"===u&&"grid-cols-[1fr_min(56rem,100%)_1fr]","wide"===u&&"grid-cols-[1fr_min(72rem,100%)_1fr]","full"===u&&"grid-cols-[1fr_min(92%,100%)_1fr]",!u&&"grid-cols-[1fr_min(56rem,100%)_1fr]"),children:e?(0,d.jsx)("div",{className:"col-start-2",children:(0,d.jsx)(o.ChatMessage,{message:b.data,nextMessage:(()=>{if(a.index+1>=G.length)return;let b=G[a.index+1];return"message"===b.type?b.data:void 0})(),isCollaborative:w,senderUser:b.data.senderUser})}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"col-start-2",children:(0,d.jsx)(o.ChatMessage,{message:b.userMessage,isCollaborative:w,senderUser:b.userMessage.senderUser})}),(0,d.jsx)("div",{className:"col-span-full mt-4",children:(0,d.jsx)(p.ComparisonView,{assistantMessages:b.assistantMessages,comparisonGroupId:b.id,showModelNames:t,onVote:c||(()=>{}),onConsolidate:r||(()=>{}),onToggleModelNames:s||(()=>{})})})]})})},a.key)})})}),A&&(0,d.jsxs)(g.Button,{variant:"outline",size:"sm",className:"absolute bottom-4 left-1/2 -translate-x-1/2 shadow-lg transition-all duration-200 z-10 gap-1",onClick:()=>z("smooth"),"aria-label":"Scroll to bottom",children:["Scroll to bottom",(0,d.jsx)(f.ArrowDown,{className:"w-3 h-3","aria-hidden":"true"})]})]})}[o,p,q]=r.then?(await r)():r,a.s(["VirtualizedMessageList",()=>s]),c()}catch(a){c(a)}},!1),101532,a=>{"use strict";var b=a.i(367146),c=a.i(130487),d=a.i(334432);a.i(16243);var e=a.i(182234),f=a.i(116245),g=a.i(286028),h=a.i(651386),i=a.i(502311),j=a.i(537500),k=a.i(371135),l=a.i(23480),m=a.i(638600),n=a.i(700760),o=a.i(117175);let p=[{id:"all",label:"All Templates"},{id:"coding",label:"Coding"},{id:"writing",label:"Writing"},{id:"analysis",label:"Analysis"},{id:"creative",label:"Creative"}];function q({open:a,onOpenChange:q,onSelectTemplate:r,mode:s="navigate"}){let t=(0,i.useRouter)(),[u,v]=(0,j.useState)("all"),w=(0,o.useTemplateStore)(a=>a.setTemplateText),x=(0,e.useQuery)(c.api.templates.list,{}),y=(0,e.useMutation)(c.api.templates.incrementUsage),z=(0,j.useRef)(a);(0,j.useEffect)(()=>{let b=a&&!z.current;z.current=a,b&&m.analytics.track("template_switcher_opened",{mode:s})},[a,s]);let A=(0,j.useMemo)(()=>{if(!x)return{builtIn:[],user:[]};let a="all"===u?x:x.filter(a=>a.category===u);return{builtIn:a.filter(a=>a.isBuiltIn),user:a.filter(a=>!a.isBuiltIn)}},[x,u]),B=async a=>{try{await y({id:a._id})}catch(a){console.error("Failed to increment usage:",a)}m.analytics.track("template_selected",{templateId:a._id,templateName:a.name,mode:s}),"insert"===s&&r?(r(a.prompt),q(!1),setTimeout(()=>{window.dispatchEvent(new CustomEvent("focus-chat-input"))},50)):(q(!1),w(a.prompt,a.name),t.push("/chat?from=template"))},C=a=>{let c=(0,b.jsxs)(k.CommandItem,{value:a._id,keywords:[a.name,a.category,a.description||""],onSelect:()=>B(a),className:(0,n.cn)("group flex items-center justify-between px-3 py-3 rounded-lg cursor-pointer aria-selected:bg-muted/50 transition-colors"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[(0,b.jsx)("div",{className:(0,n.cn)("flex items-center justify-center w-8 h-8 rounded-lg border shrink-0",a.isBuiltIn?"bg-amber-500/10 text-amber-600 dark:text-amber-500 border-amber-500/30":"bg-primary/10 text-primary border-primary/30"),children:a.isBuiltIn?(0,b.jsx)(h.Sparkles,{className:"w-4 h-4"}):(0,b.jsx)(f.FileText,{className:"w-4 h-4"})}),(0,b.jsxs)("div",{className:"flex flex-col min-w-0 gap-0.5",children:[(0,b.jsx)("span",{className:"font-medium text-sm truncate text-foreground",children:a.name}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground truncate",children:a.description||`${a.prompt.slice(0,60)}...`})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 pl-2 text-xs text-muted-foreground/50",children:[(0,b.jsx)("span",{className:"capitalize",children:a.category}),a.usageCount>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"text-muted-foreground/30",children:"•"}),(0,b.jsxs)("span",{children:[a.usageCount," uses"]})]})]})]},a._id);return(0,b.jsxs)(l.HoverCard,{openDelay:300,children:[(0,b.jsx)(l.HoverCardTrigger,{asChild:!0,children:c}),(0,b.jsx)(l.HoverCardContent,{side:"right",align:"start",className:"w-80 p-4",sideOffset:10,children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h4",{className:"font-medium",children:a.name}),a.description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.description}),(0,b.jsx)("div",{className:"bg-muted/50 rounded-lg p-3 max-h-40 overflow-y-auto",children:(0,b.jsx)("p",{className:"text-xs text-muted-foreground whitespace-pre-wrap",children:a.prompt})})]})})]},a._id)};return(0,b.jsxs)(k.CommandDialog,{open:a,onOpenChange:q,commandProps:{filter:(a,b,c)=>{let e=`${a} ${c?.join(" ")||""}`;return(0,d.default)(e,b)}},className:"max-w-[95vw] md:max-w-3xl h-[80vh] md:h-[500px] p-0 gap-0 overflow-hidden bg-background/95 backdrop-blur-xl border-border/50 shadow-2xl",children:[(0,b.jsxs)("div",{className:"flex items-center border-b px-4 py-3 shrink-0",children:[(0,b.jsx)(g.Search,{className:"w-4 h-4 mr-2 text-muted-foreground"}),(0,b.jsx)(k.CommandInput,{placeholder:`Search ${"all"===u?"":`${u} `}templates...`,className:"flex-1 h-9 bg-transparent border-0 ring-0 focus:ring-0 text-sm"})]}),(0,b.jsxs)("div",{className:"flex h-[400px] overflow-hidden",children:[(0,b.jsxs)("div",{className:"w-[160px] border-r bg-muted/30 p-2 flex flex-col gap-1 shrink-0 overflow-y-auto",children:[(0,b.jsx)("div",{className:"px-2 py-1.5 text-xs font-medium text-muted-foreground uppercase tracking-wider mb-1",children:"Categories"}),p.map(a=>{let c=u===a.id;return(0,b.jsx)("button",{type:"button",onClick:()=>v(a.id),className:(0,n.cn)("w-full flex items-center px-2.5 py-2 rounded-md text-sm transition-colors text-left",c?"bg-primary/10 text-primary font-medium":"text-muted-foreground hover:bg-muted/50 hover:text-foreground"),children:a.label},a.id)})]}),(0,b.jsx)("div",{className:"flex-1 flex flex-col min-w-0 bg-background/50",children:(0,b.jsxs)(k.CommandList,{className:"max-h-[400px] overflow-y-auto p-2",children:[(0,b.jsx)(k.CommandEmpty,{children:"No templates found."}),A.user.length>0&&(0,b.jsx)(k.CommandGroup,{heading:"Your Templates",children:A.user.map(a=>C(a))}),A.user.length>0&&A.builtIn.length>0&&(0,b.jsx)(k.CommandSeparator,{}),A.builtIn.length>0&&(0,b.jsx)(k.CommandGroup,{heading:"Built-in Templates",children:A.builtIn.map(a=>C(a))})]})})]}),(0,b.jsxs)("div",{className:"border-t px-4 py-2 flex items-center justify-between text-xs text-muted-foreground",children:[(0,b.jsxs)("span",{children:["Press ",(0,b.jsx)("kbd",{className:"px-1 py-0.5 rounded bg-muted",children:"↵"})," to select"]}),(0,b.jsxs)("span",{children:[(0,b.jsx)("kbd",{className:"px-1 py-0.5 rounded bg-muted",children:"⌘;"})," to open"]})]})]})}a.s(["QuickTemplateSwitcher",()=>q])},510217,a=>{"use strict";let b;var c=a.i(367146),d=a.i(389235),d=d,e=a.i(537500);function f(a,b="Assertion error"){if(!a)throw Error(b)}function g({group:a}){let{orientation:b,panels:c}=a;return c.reduce((a,c)=>a+="horizontal"===b?c.element.offsetWidth:c.element.offsetHeight,0)}function h(a,b){return b.sort("horizontal"===a?i:j)}function i(a,b){let c=a.element.offsetLeft-b.element.offsetLeft;return 0!==c?c:a.element.offsetWidth-b.element.offsetWidth}function j(a,b){let c=a.element.offsetTop-b.element.offsetTop;return 0!==c?c:a.element.offsetHeight-b.element.offsetHeight}function k(a){return null!==a&&"object"==typeof a&&"nodeType"in a&&a.nodeType===Node.ELEMENT_NODE}function l(a,b){return{x:a.x>=b.left&&a.x<=b.right?0:Math.min(Math.abs(a.x-b.left),Math.abs(a.x-b.right)),y:a.y>=b.top&&a.y<=b.bottom?0:Math.min(Math.abs(a.y-b.top),Math.abs(a.y-b.bottom))}}function m(a){let{element:b,orientation:c,panels:d,separators:e}=a,i=h(c,Array.from(b.children).filter(k).map(a=>({element:a}))).map(({element:a})=>a),j=[],m=!1,n,o=[];for(let b of i)if(b.hasAttribute("data-panel")){let e=d.find(a=>a.element===b);if(e){if(n){let d,h=n.element.getBoundingClientRect(),i=b.getBoundingClientRect();if(m){let a="horizontal"===c?new DOMRect(h.right,h.top,0,h.height):new DOMRect(h.left,h.bottom,h.width,0),b="horizontal"===c?new DOMRect(i.left,i.top,0,i.height):new DOMRect(i.left,i.top,i.width,0);switch(o.length){case 0:d=[a,b];break;case 1:{let e=o[0],g=function({orientation:a,rects:b,targetRect:c}){let d={x:c.x+c.width/2,y:c.y+c.height/2},e,g=Number.MAX_VALUE;for(let c of b){let{x:b,y:f}=l(d,c),h="horizontal"===a?b:f;h<g&&(g=h,e=c)}return f(e,"No rect found"),e}({orientation:c,rects:[h,i],targetRect:e.element.getBoundingClientRect()});d=[e,g===h?b:a];break}default:d=o}}else d=o.length?o:["horizontal"===c?new DOMRect(h.right,i.top,i.left-h.right,i.height):new DOMRect(i.left,h.bottom,i.width,i.top-h.bottom)];for(let b of d)j.push({group:a,groupSize:g({group:a}),panels:[n,e],separator:"width"in b?void 0:b,rect:"width"in b?b:b.element.getBoundingClientRect()})}m=!1,n=e,o=[]}}else if(b.hasAttribute("data-separator")){let a=e.find(a=>a.element===b);a?o.push(a):(n=void 0,o=[])}else m=!0;return j}function n({groupSize:a,panelElement:b,styleProp:c}){let d,[e,f]=function(a){switch(typeof a){case"number":return[a,"px"];case"string":{let b=parseFloat(a);return a.endsWith("%")?[b,"%"]:a.endsWith("px")?[b,"px"]:a.endsWith("rem")?[b,"rem"]:a.endsWith("em")?[b,"em"]:a.endsWith("vh")?[b,"vh"]:a.endsWith("vw")?[b,"vw"]:[b,"%"]}}}(c);switch(f){case"%":d=e/100*a;break;case"px":d=e;break;case"rem":d=e*parseFloat(getComputedStyle(b.ownerDocument.body).fontSize);break;case"em":d=e*parseFloat(getComputedStyle(b).fontSize);break;case"vh":d=e/100*window.innerHeight;break;case"vw":d=e/100*window.innerWidth}return d}function o(a){return parseFloat(a.toFixed(3))}function p(a){let{panels:b}=a,c=g({group:a});return 0===c?b.map(a=>({collapsedSize:0,collapsible:!0===a.panelConstraints.collapsible,defaultSize:void 0,minSize:0,maxSize:100,panelId:a.id})):b.map(a=>{let b,{element:d,panelConstraints:e}=a,f=0;e.collapsedSize&&(f=o(n({groupSize:c,panelElement:d,styleProp:e.collapsedSize})/c*100)),e.defaultSize&&(b=o(n({groupSize:c,panelElement:d,styleProp:e.defaultSize})/c*100));let g=0;e.minSize&&(g=o(n({groupSize:c,panelElement:d,styleProp:e.minSize})/c*100));let h=100;return e.maxSize&&(h=o(n({groupSize:c,panelElement:d,styleProp:e.maxSize})/c*100)),{collapsedSize:f,collapsible:!0===e.collapsible,defaultSize:b,minSize:g,maxSize:h,panelId:a.id}})}function q(a,b,c=0){return Math.abs(o(a)-o(b))<=c}let r={cursorFlags:0,interactionState:{state:"inactive"},mountedGroups:new Map},s=new class{#y={};addListener(a,b){let c=this.#y[a];return void 0===c?this.#y[a]=[b]:c.includes(b)||c.push(b),()=>{this.removeListener(a,b)}}emit(a,b){let c=this.#y[a];if(void 0!==c)if(1===c.length)c[0].call(null,b);else{let a=!1,d=null,e=Array.from(c);for(let c=0;c<e.length;c++){let f=e[c];try{f.call(null,b)}catch(b){null===d&&(a=!0,d=b)}}if(a)throw d}}removeAllListeners(){this.#y={}}removeListener(a,b){let c=this.#y[a];if(void 0!==c){let a=c.indexOf(b);a>=0&&c.splice(a,1)}}};function t(a){let b="function"==typeof a?a(r):a;if(r===b)return r;let c=r;return r={...r,...b},void 0!==b.cursorFlags&&s.emit("cursorFlagsChange",r.cursorFlags),void 0!==b.interactionState&&s.emit("interactionStateChange",r.interactionState),void 0!==b.mountedGroups&&(r.mountedGroups.forEach((a,b)=>{a.derivedPanelConstraints.forEach(d=>{if(d.collapsible){let{layout:e}=c.mountedGroups.get(b)??{};if(e){let c=q(d.collapsedSize,a.layout[d.panelId]),f=q(d.collapsedSize,e[d.panelId]);c&&!f&&(b.inMemoryLastExpandedPanelSizes[d.panelId]=e[d.panelId])}}})}),s.emit("mountedGroupsChange",r.mountedGroups)),r}function u(a,b){return q(a,b)?0:a>b?1:-1}function v({panelConstraints:a,size:b}){let{collapsedSize:c=0,collapsible:d,maxSize:e=100,minSize:f=0}=a;return 0>u(b,f)&&(b=d&&0>u(b,(c+f)/2)?c:f),o(b=Math.min(e,b))}function w({delta:a,initialLayout:b,panelConstraints:c,pivotIndices:d,prevLayout:e,trigger:g}){if(q(a,0))return b;let h=Object.values(b),i=Object.values(e),j=[...h],[k,l]=d;f(null!=k,"Invalid first pivot index"),f(null!=l,"Invalid second pivot index");let m=0;if("keyboard"===g){{let b=a<0?l:k,d=c[b];f(d,`Panel constraints not found for index ${b}`);let{collapsedSize:e=0,collapsible:g,minSize:i=0}=d;if(g){let c=h[b];if(f(null!=c,`Previous layout not found for panel index ${b}`),q(c,e)){let b=i-c;u(b,Math.abs(a))>0&&(a=a<0?0-b:b)}}}{let b=a<0?k:l,d=c[b];f(d,`No panel constraints found for index ${b}`);let{collapsedSize:e=0,collapsible:g,minSize:i=0}=d;if(g){let c=h[b];if(f(null!=c,`Previous layout not found for panel index ${b}`),q(c,i)){let b=c-e;u(b,Math.abs(a))>0&&(a=a<0?0-b:b)}}}}{let b=a<0?1:-1,d=a<0?l:k,e=0;for(;;){let a=h[d];if(f(null!=a,`Previous layout not found for panel index ${d}`),e+=v({panelConstraints:c[d],size:100})-a,(d+=b)<0||d>=c.length)break}let g=Math.min(Math.abs(a),Math.abs(e));a=a<0?0-g:g}{let b=a<0?k:l;for(;b>=0&&b<c.length;){let d=Math.abs(a)-Math.abs(m),e=h[b];f(null!=e,`Previous layout not found for panel index ${b}`);let g=e-d,i=v({panelConstraints:c[b],size:g});if(!q(e,i)&&(m+=e-i,j[b]=i,m.toFixed(3).localeCompare(Math.abs(a).toFixed(3),void 0,{numeric:!0})>=0))break;a<0?b--:b++}}if(function(a,b){if(a.length!==b.length)return!1;for(let c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0}(i,j))return e;{let b=a<0?l:k,d=h[b];f(null!=d,`Previous layout not found for panel index ${b}`);let e=d+m,g=v({panelConstraints:c[b],size:e});if(j[b]=g,!q(g,e)){let b=e-g,d=a<0?l:k;for(;d>=0&&d<c.length;){let e=j[d];f(null!=e,`Previous layout not found for panel index ${d}`);let g=e+b,h=v({panelConstraints:c[d],size:g});if(q(e,h)||(b-=h-e,j[d]=h),q(b,0))break;a>0?d--:d++}}}if(!q(Object.values(j).reduce((a,b)=>b+a,0),100,.1))return e;let n=Object.keys(e);return j.reduce((a,b,c)=>(a[n[c]]=b,a),{})}function x(a){let b=a.parentElement;f(b,"Parent group element not found");let{mountedGroups:c}=r;for(let[a]of c)if(a.element===b)return a;throw Error("Could not find parent Group for separator element")}function y(a,b){if(Object.keys(a).length!==Object.keys(b).length)return!1;for(let c in a)if(void 0===b[c]||0!==u(a[c],b[c]))return!1;return!0}function z({layout:a,panelConstraints:b}){let c=[...Object.values(a)],d=c.reduce((a,b)=>a+b,0);if(c.length!==b.length)throw Error(`Invalid ${b.length} panel layout: ${c.map(a=>`${a}%`).join(", ")}`);if(!q(d,100)&&c.length>0)for(let a=0;a<b.length;a++){let b=c[a];f(null!=b,`No layout data found for index ${a}`);let e=100/d*b;c[a]=e}let e=0;for(let a=0;a<b.length;a++){let d=c[a];f(null!=d,`No layout data found for index ${a}`);let g=v({panelConstraints:b[a],size:d});d!=g&&(e+=d-g,c[a]=g)}if(!q(e,0))for(let a=0;a<b.length;a++){let d=c[a];f(null!=d,`No layout data found for index ${a}`);let g=d+e,h=v({panelConstraints:b[a],size:g});if(d!==h&&(e-=h-d,c[a]=h,q(e,0)))break}let g=Object.keys(a);return c.reduce((a,b,c)=>(a[g[c]]=b,a),{})}function A({groupId:a}){let b=()=>{let{mountedGroups:b}=r;for(let[c,d]of b)if(c.id===a)return{group:c,...d};throw Error(`Could not find Group with id "${a}"`)};return{getLayout(){let{defaultLayoutDeferred:a,layout:c}=b();return a?{}:c},setLayout(a){let{defaultLayoutDeferred:c,derivedPanelConstraints:d,group:e,layout:f,separatorToPanels:g}=b(),h=z({layout:a,panelConstraints:d});return c?f:(y(f,h)||t(a=>({mountedGroups:new Map(a.mountedGroups).set(e,{defaultLayoutDeferred:c,derivedPanelConstraints:d,layout:h,separatorToPanels:g})})),h)}}}function B(a){let{mountedGroups:b}=r,c=b.get(a);return f(c,`Mounted Group ${a.id} not found`),c}function C(a,b){let c=x(a),d=B(c),e=c.separators.find(b=>b.element===a);f(e,"Matching separator not found");let g=d.separatorToPanels.get(e);f(g,"Matching panels not found");let h=g.map(a=>c.panels.indexOf(a)),i=A({groupId:c.id}).getLayout(),j=z({layout:w({delta:b,initialLayout:i,panelConstraints:d.derivedPanelConstraints,pivotIndices:h,prevLayout:i,trigger:"keyboard"}),panelConstraints:d.derivedPanelConstraints});y(i,j)||t(a=>({mountedGroups:new Map(a.mountedGroups).set(c,{defaultLayoutDeferred:d.defaultLayoutDeferred,derivedPanelConstraints:d.derivedPanelConstraints,layout:j,separatorToPanels:d.separatorToPanels})}))}function D(a){if(a.defaultPrevented)return;let b=a.currentTarget,c=x(b);if(!c.disabled)switch(a.key){case"ArrowDown":a.preventDefault(),"vertical"===c.orientation&&C(b,5);break;case"ArrowLeft":a.preventDefault(),"horizontal"===c.orientation&&C(b,-5);break;case"ArrowRight":a.preventDefault(),"horizontal"===c.orientation&&C(b,5);break;case"ArrowUp":a.preventDefault(),"vertical"===c.orientation&&C(b,-5);break;case"End":a.preventDefault(),C(b,100);break;case"Enter":{a.preventDefault();let c=x(b),{derivedPanelConstraints:d,layout:e,separatorToPanels:g}=B(c),h=c.separators.find(a=>a.element===b);f(h,"Matching separator not found");let i=g.get(h);f(i,"Matching panels not found");let j=i[0],k=d.find(a=>a.panelId===j.id);if(f(k,"Panel metadata not found"),k.collapsible){let a=e[j.id];C(b,(k.collapsedSize===a?c.inMemoryLastExpandedPanelSizes[j.id]??k.minSize:k.collapsedSize)-a)}break}case"F6":{a.preventDefault();let c=x(b).separators.map(a=>a.element),d=Array.from(c).findIndex(b=>b===a.currentTarget);f(null!==d,"Index not found");let e=a.shiftKey?d>0?d-1:c.length-1:d+1<c.length?d+1:0;c[e].focus();break}case"Home":a.preventDefault(),C(b,-100)}}let E=a=>a,F=()=>{},G=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function H(a){let b=a.length;for(;b--;){let c=a[b];if(f(c,"Missing node"),function(a){let b,c=getComputedStyle(a);return!!("fixed"===c.position||"auto"!==c.zIndex&&("static"!==c.position||"flex"===(b=getComputedStyle(K(a)??a).display)||"inline-flex"===b)||1>+c.opacity||"transform"in c&&"none"!==c.transform||"webkitTransform"in c&&"none"!==c.webkitTransform||"mixBlendMode"in c&&"normal"!==c.mixBlendMode||"filter"in c&&"none"!==c.filter||"webkitFilter"in c&&"none"!==c.webkitFilter||"isolation"in c&&"isolate"===c.isolation||G.test(c.willChange)||"touch"===c.webkitOverflowScrolling)}(c))return c}return null}function I(a){return a&&Number(getComputedStyle(a).zIndex)||0}function J(a){let b=[];for(;a;)b.push(a),a=K(a);return b}function K(a){let{parentNode:b}=a;return null!==b&&"object"==typeof b&&"nodeType"in b&&b.nodeType===Node.DOCUMENT_FRAGMENT_NODE?b.host:b}function L(a,c){let d=[];return c.forEach((c,e)=>{if(e.disabled)return;let g=(void 0===b&&(b="function"==typeof matchMedia&&!!matchMedia("(pointer:coarse)").matches),b)?10:5,h=m(e),i=function(a,b,c){let d,e={x:1/0,y:1/0};for(let f of b){let b=l(c,f.rect);switch(a){case"horizontal":b.x<=e.x&&(d=f,e=b);break;case"vertical":b.y<=e.y&&(d=f,e=b)}}return d?{distance:e,hitRegion:d}:void 0}(e.orientation,h,{x:a.clientX,y:a.clientY});i&&i.distance.x<=g&&i.distance.y<=g&&function({groupElement:a,hitRegion:b,pointerEventTarget:c}){if(!k(c)||c.contains(a)||a.contains(c))return!0;if(function(a,b){let c;if(a===b)throw Error("Cannot compare node with itself");let d={a:J(a),b:J(b)};for(;d.a.at(-1)===d.b.at(-1);)a=d.a.pop(),b=d.b.pop(),c=a;f(c,"Stacking order can only be calculated for elements with a common ancestor");let e={a:I(H(d.a)),b:I(H(d.b))};if(e.a===e.b){let a=c.childNodes,b={a:d.a.at(-1),b:d.b.at(-1)},e=a.length;for(;e--;){let c=a[e];if(c===b.a)return 1;if(c===b.b)return -1}}return Math.sign(e.a-e.b)}(c,a)>0){let e=c;for(;e;){var d;if(e.contains(a))break;if(d=e.getBoundingClientRect(),d.x<b.x+b.width&&d.x+d.width>b.x&&d.y<b.y+b.height&&d.y+d.height>b.y)return!1;e=e.parentElement}}return!0}({groupElement:e.element,hitRegion:i.hitRegion.rect,pointerEventTarget:a.target})&&d.push(i.hitRegion)}),d}function M(a){if(a.defaultPrevented)return;let{mountedGroups:b}=r,c=L(a,b),d=new Set,e=new Set,f=new Set,g=new Map,h=!1;c.forEach(a=>{d.add(a.group),a.panels.forEach(a=>{e.add(a)}),a.separator&&(f.add(a.separator),h||(h=!0,a.separator.element.focus()));let c=b.get(a.group);c&&g.set(a.group,c.layout)}),t({interactionState:{hitRegions:c,initialLayoutMap:g,pointerDownAtPoint:{x:a.clientX,y:a.clientY},state:"active"}}),c.length&&a.preventDefault()}let N=new WeakMap;function O(a){if(null===a.defaultView)return;let{prevStyle:b,styleSheet:c}=N.get(a)??{};void 0===c&&(c=new a.defaultView.CSSStyleSheet,a.adoptedStyleSheets=[c]);let{cursorFlags:d,interactionState:e}=r;switch(e.state){case"active":case"hover":{let a=function({cursorFlags:a,groups:b,state:c}){let d=0,e=0;switch(c){case"active":case"hover":b.forEach(a=>{if(!a.disableCursor)switch(a.orientation){case"horizontal":d++;break;case"vertical":e++}})}if(0===d&&0===e)return null;if("active"===c){let b=(4&a)!=0,c=(8&a)!=0;if(a){if((1&a)!=0)return b?"se-resize":c?"ne-resize":"e-resize";if((2&a)!=0)return b?"sw-resize":c?"nw-resize":"w-resize";if(b)return"s-resize";if(c)return"n-resize"}}return d>0&&e>0?"move":d>0?"ew-resize":"ns-resize"}({cursorFlags:d,groups:e.hitRegions.map(a=>a.group),state:e.state}),f=`*{cursor: ${a} !important; ${"active"===e.state?"touch-action: none;":""} }`;if(b===f)return;b=f,a?0===c.cssRules.length?c.insertRule(f):c.replaceSync(f):1===c.cssRules.length&&c.deleteRule(0);break}case"inactive":b=void 0,1===c.cssRules.length&&c.deleteRule(0)}N.set(a,{prevStyle:b,styleSheet:c})}function P({document:a,event:b,hitRegions:c,initialLayoutMap:d,mountedGroups:e,pointerDownAtPoint:f}){let g=0,h=new Map(e);c.forEach(a=>{let{group:c,groupSize:i}=a,{disableCursor:j,orientation:k,panels:l}=c,m=0;m=f?"horizontal"===k?(b.clientX-f.x)/i*100:(b.clientY-f.y)/i*100:"horizontal"===k?b.clientX<0?-100:100:b.clientY<0?-100:100;let n=d.get(c),{defaultLayoutDeferred:o,derivedPanelConstraints:p,layout:q,separatorToPanels:r}=e.get(c)??{defaultLayoutDeferred:!1};if(p&&n&&q&&r){let b=w({delta:m,initialLayout:n,panelConstraints:p,pivotIndices:a.panels.map(a=>l.indexOf(a)),prevLayout:q,trigger:"mouse-or-touch"});if(y(b,q)){if(0!==m&&!j)switch(k){case"horizontal":g|=m<0?1:2;break;case"vertical":g|=m<0?4:8}}else{h.set(a.group,{defaultLayoutDeferred:o,derivedPanelConstraints:p,layout:b,separatorToPanels:r});let c=a.group.panels.map(({id:a})=>a).join(",");a.group.inMemoryLayouts[c]=b}}}),t({cursorFlags:g,mountedGroups:h}),O(a)}function Q(a){let{interactionState:b,mountedGroups:c}=r;"active"===b.state&&P({document:a.currentTarget,event:a,hitRegions:b.hitRegions,initialLayoutMap:b.initialLayoutMap,mountedGroups:c})}function R(a){if(a.defaultPrevented)return;let{interactionState:b,mountedGroups:c}=r;if("active"===b.state){if(0===a.buttons)return void t(a=>"inactive"===a.interactionState.state?a:{cursorFlags:0,interactionState:{state:"inactive"}});P({document:a.currentTarget,event:a,hitRegions:b.hitRegions,initialLayoutMap:b.initialLayoutMap,mountedGroups:c,pointerDownAtPoint:b.pointerDownAtPoint})}else{let d=L(a,c);0===d.length?"inactive"!==b.state&&t({interactionState:{state:"inactive"}}):t({interactionState:{hitRegions:d,state:"hover"}}),O(a.currentTarget)}}function S(a){if(a.defaultPrevented)return;a.preventDefault();let{interactionState:b}=r;"active"===b.state&&(t({cursorFlags:0,interactionState:{state:"inactive"}}),O(a.currentTarget))}function T(a){let b=0,c=0,d={};for(let e of a)if(void 0!==e.defaultSize){b++;let a=o(e.defaultSize);c+=a,d[e.panelId]=a}else d[e.panelId]=void 0;let e=a.length-b;if(0!==e){let b=o((100-c)/e);for(let c of a)void 0===c.defaultSize&&(d[c.panelId]=b)}return d}let U=new Map;function V(a){let b=(0,e.useId)();return`${a??b}`}let W=e.useEffect;function X(a){let b=(0,e.useRef)(a);return W(()=>{b.current=a},[a]),(0,e.useCallback)(a=>b.current?.(a),[b])}function Y(...a){return X(b=>{a.forEach(a=>{if(a)switch(typeof a){case"function":a(b);break;case"object":a.current=b}})})}let Z="--react-resizable-panels--panel--pointer-events";function $(a,b){let c=a.replace(/[^a-zA-Z0-9\-_]/g,""),d=b.replace(/[^a-zA-Z0-9\-_]/g,"");return`--react-resizable-panels--${c}--${d}`}let _=(0,e.createContext)(null);function aa({children:a,className:b,defaultLayout:d,disableCursor:i,disabled:j,elementRef:k,groupRef:l,id:n,onLayoutChange:q,orientation:u="horizontal",style:v,...w}){var x;let B,C,F=(0,e.useRef)({}),G=X(a=>{y(F.current,a)||(F.current=a,q?.(a))}),H=V(n),[I,J]=(0,e.useState)(!1),[K,L]=(0,e.useState)(null),[N,O]=(0,e.useState)(d??{}),[P,aa]=(0,e.useState)([]),[ab,ac]=(0,e.useState)([]),ad=(0,e.useRef)({lastExpandedPanelSizes:{},layouts:{}}),ae=Y(L,k);B=(0,e.useRef)({getLayout:()=>({}),setLayout:E}),(0,e.useImperativeHandle)(l,()=>B.current,[]),W(()=>{Object.assign(B.current,A({groupId:H}))});let af=(0,e.useMemo)(()=>({id:H,orientation:u,registerPanel:a=>(aa(b=>h(u,[...b,a])),()=>{aa(b=>b.filter(b=>b!==a))}),registerSeparator:a=>(ac(b=>h(u,[...b,a])),()=>{ac(b=>b.filter(b=>b!==a))})}),[H,u]),ag=(x={defaultLayout:d,disableCursor:i},C=(0,e.useRef)({...x}),W(()=>{for(let a in x)C.current[a]=x[a]},[x]),C.current),ah=(0,e.useRef)(null);W(()=>{let a,b,c,d,e,h,i,k,l,n,q,v;if(null===K)return;let w={defaultLayout:ag.defaultLayout,disableCursor:!!ag.disableCursor,disabled:!!j,element:K,id:H,inMemoryLastExpandedPanelSizes:ad.current.lastExpandedPanelSizes,inMemoryLayouts:ad.current.layouts,orientation:u,panels:P,separators:ab};ah.current=w;let x=(a=!0,f(w.element.ownerDocument.defaultView,"Cannot register an unmounted Group"),b=w.element.ownerDocument.defaultView.ResizeObserver,c=new Set,d=new Set,(e=new b(b=>{for(let c of b){let{borderBoxSize:b,target:d}=c;if(d===w.element){if(a){if(0===g({group:w}))return;t(a=>{let b=a.mountedGroups.get(w);if(b){let c=p(w),d=b.defaultLayoutDeferred?T(c):b.layout,e=z({layout:d,panelConstraints:c});return!b.defaultLayoutDeferred&&y(d,e)&&function(a,b){if(Object.keys(a).length!==Object.keys(b).length)return!1;for(let c in a)if(a[c]!==b[c])return!1;return!0}(b.derivedPanelConstraints,c)?a:{mountedGroups:new Map(a.mountedGroups).set(w,{defaultLayoutDeferred:!1,derivedPanelConstraints:c,layout:e,separatorToPanels:b.separatorToPanels})}}return a})}}else!function(a,b,c){let d=c[0];if(!d)return;let e=a.panels.find(a=>a.element===b);if(!e||!e.onResize)return;let f=g({group:a});e.onResize({asPercentage:o(d.inlineSize/f*100),inPixels:d.inlineSize},e.id)}(w,d,b)}})).observe(w.element),w.panels.forEach(a=>{f(!c.has(a.id),`Panel ids must be unique; id "${a.id}" was used more than once`),c.add(a.id),a.onResize&&e.observe(a.element)}),h=g({group:w}),i=p(w),k=w.panels.map(({id:a})=>a).join(","),(l=w.defaultLayout)&&(function(a,b){let c=a.map(a=>a.id),d=Object.keys(b);if(c.length!==d.length)return!1;for(let a of c)if(!d.includes(a))return!1;return!0}(w.panels,l)||(l=void 0)),n=z({layout:w.inMemoryLayouts[k]??l??T(i),panelConstraints:i}),q=m(w),v=w.element.ownerDocument,t(a=>{let b=new Map;return U.set(v,(U.get(v)??0)+1),q.forEach(a=>{a.separator&&b.set(a.separator,a.panels)}),{mountedGroups:new Map(a.mountedGroups).set(w,{defaultLayoutDeferred:0===h,derivedPanelConstraints:i,layout:n,separatorToPanels:b})}}),w.separators.forEach(a=>{f(!d.has(a.id),`Separator ids must be unique; id "${a.id}" was used more than once`),d.add(a.id),a.element.addEventListener("keydown",D)}),1===U.get(v)&&(v.addEventListener("pointerdown",M),v.addEventListener("pointerleave",Q),v.addEventListener("pointermove",R),v.addEventListener("pointerup",S)),function(){a=!1,U.set(v,Math.max(0,(U.get(v)??0)-1)),t(a=>{let b=new Map(a.mountedGroups);return b.delete(w),{mountedGroups:b}}),w.separators.forEach(a=>{a.element.removeEventListener("keydown",D)}),U.get(v)||(v.removeEventListener("pointerdown",M),v.removeEventListener("pointerleave",Q),v.removeEventListener("pointermove",R),v.removeEventListener("pointerup",S)),e.disconnect()}),A=r.mountedGroups.get(w);if(A){let{defaultLayoutDeferred:a,derivedPanelConstraints:b,layout:c}=A;!a&&b.length>0&&(O(c),G?.(c))}let B=s.addListener("interactionStateChange",a=>{"active"===a.state?J(a.hitRegions.some(a=>a.group===w)):J(!1)}),C=s.addListener("mountedGroupsChange",a=>{let b=a.get(w);if(b){let{defaultLayoutDeferred:a,derivedPanelConstraints:c,layout:d}=b;if(a||0===c.length)return;O(d),G?.(d)}});return()=>{ah.current=null,x(),B(),C()}},[j,K,H,G,u,P,ab,ag]),(0,e.useEffect)(()=>{let a=ah.current;a&&(a.defaultLayout=d,a.disableCursor=!!i)});let ai={[Z]:I?"none":void 0};for(let a in N){let b=$(H,a),c=N[a];ai[b]=c}return(0,c.jsx)(_.Provider,{value:af,children:(0,c.jsx)("div",{...w,"aria-orientation":u,className:b,"data-group":!0,"data-testid":H,id:H,ref:ae,style:{...v,...ai,display:"flex",flexDirection:"horizontal"===u?"row":"column",flexWrap:"nowrap"},children:a})})}function ab(){let a=(0,e.useContext)(_);return f(a,"Group Context not found; did you render a Panel or Separator outside of a Group?"),a}function ac({children:a,className:b,collapsedSize:d="0%",collapsible:f=!1,defaultSize:h,elementRef:i,id:j,maxSize:k="100%",minSize:l="0%",onResize:m,panelRef:n,style:p,...s}){let u=!!j,v=V(j),[x,A]=(0,e.useState)(null),B=Y(A,i),{id:C,registerPanel:D}=ab(),E=null!==m,G=X(a=>{m?.(a,j)});W(()=>{if(null!==x)return D({element:x,id:v,idIsStable:u,onResize:E?G:void 0,panelConstraints:{collapsedSize:d,collapsible:f,defaultSize:h,maxSize:k,minSize:l}})},[d,f,h,x,E,v,u,k,l,G,D]),function(a,b){let{id:c}=ab(),d=(0,e.useRef)({collapse:F,expand:F,getSize:()=>({asPercentage:0,inPixels:0}),isCollapsed:()=>!1,resize:F});(0,e.useImperativeHandle)(b,()=>d.current,[]),W(()=>{Object.assign(d.current,function({groupId:a,panelId:b}){let c=()=>{let{mountedGroups:b}=r;for(let[c,{defaultLayoutDeferred:d,derivedPanelConstraints:e,layout:f,separatorToPanels:g}]of b)if(c.id===a)return{defaultLayoutDeferred:d,derivedPanelConstraints:e,group:c,layout:f,separatorToPanels:g};throw Error(`Group ${a} not found`)},d=()=>{let a=c().derivedPanelConstraints.find(a=>a.panelId===b);if(void 0!==a)return a;throw Error(`Panel constraints not found for Panel ${b}`)},e=()=>{let a=c().layout[b];if(void 0!==a)return a;throw Error(`Layout not found for Panel ${b}`)},f=a=>{let d=e();if(a===d)return;let{defaultLayoutDeferred:f,derivedPanelConstraints:g,group:h,layout:i,separatorToPanels:j}=c(),k=h.panels.findIndex(a=>a.id===b),l=k===h.panels.length-1,m=z({layout:w({delta:l?d-a:a-d,initialLayout:i,panelConstraints:g,pivotIndices:l?[k-1,k]:[k,k+1],prevLayout:i,trigger:"imperative-api"}),panelConstraints:g});y(i,m)||t(a=>({mountedGroups:new Map(a.mountedGroups).set(h,{defaultLayoutDeferred:f,derivedPanelConstraints:g,layout:m,separatorToPanels:j})}))};return{collapse:()=>{let{collapsible:a,collapsedSize:b}=d(),c=e();a&&c!==b&&f(b)},expand:()=>{let{collapsible:a,collapsedSize:b,minSize:c}=d(),g=e();a&&g===b&&f(c)},getSize:()=>{let{group:a}=c(),d=e(),{element:f}=(()=>{let a=c().group.panels.find(a=>a.id===b);if(void 0!==a)return a;throw Error(`Layout not found for Panel ${b}`)})();return{asPercentage:d,inPixels:"horizontal"===a.orientation?f.offsetWidth:f.offsetHeight}},isCollapsed:()=>{let{collapsible:a,collapsedSize:b}=d(),c=e();return a&&q(b,c)},resize:a=>{if(e()!==a){let b;switch(typeof a){case"number":{let{group:d}=c();b=o(a/g({group:d})*100);break}case"string":b=parseFloat(a)}f(b)}}}}({groupId:c,panelId:a}))})}(v,n);let H=$(C,v);return(0,c.jsx)("div",{...s,"data-panel":!0,"data-testid":v,id:v,ref:B,style:{...ad,flexBasis:0,flexGrow:`var(${H}, 1)`,flexShrink:1,overflow:"hidden",pointerEvents:`var(${Z})`},children:(0,c.jsx)("div",{className:b,style:{width:"100%",height:"100%",...p},children:a})})}let ad={minHeight:"unset",maxHeight:"unset",height:"unset",minWidth:"unset",maxWidth:"unset",width:"unset",flex:"unset",flexBasis:"unset",flexShrink:"unset",flexGrow:"unset",border:"unset",borderWidth:"unset",padding:"unset",margin:"unset"};function ae({children:a,className:b,elementRef:d,id:f,style:g,...h}){let i=V(f),[j,k]=(0,e.useState)({}),[l,m]=(0,e.useState)("inactive"),[n,o]=(0,e.useState)(null),p=Y(o,d),{id:q,orientation:r,registerSeparator:t}=ab();return W(()=>{if(null!==n){let a={element:n,id:i},b=t(a),c=s.addListener("interactionStateChange",b=>{m("inactive"!==b.state&&b.hitRegions.some(b=>b.separator===a)?b.state:"inactive")}),d=s.addListener("mountedGroupsChange",b=>{b.forEach(({derivedPanelConstraints:b,layout:c,separatorToPanels:d},e)=>{if(e.id===q){let f=d.get(a);if(f){let a=f[0],d=e.panels.indexOf(a);k(function({layout:a,panelConstraints:b,panelId:c,panelIndex:d}){let e,f,g=a[c],h=b.find(a=>a.panelId===c);if(h){let i=h.maxSize,j=f=h.collapsible?h.collapsedSize:h.minSize,k=[d,d+1];f=z({layout:w({delta:j-g,initialLayout:a,panelConstraints:b,pivotIndices:k,prevLayout:a,trigger:"keyboard"}),panelConstraints:b})[c],e=z({layout:w({delta:i-g,initialLayout:a,panelConstraints:b,pivotIndices:k,prevLayout:a,trigger:"keyboard"}),panelConstraints:b})[c]}return{valueControls:c,valueMax:e,valueMin:f,valueNow:g}}({layout:c,panelConstraints:b,panelId:a.id,panelIndex:d}))}}})});return()=>{c(),d(),b()}}},[n,q,i,t]),(0,c.jsx)("div",{...h,"aria-controls":j.valueControls,"aria-orientation":"horizontal"===r?"vertical":"horizontal","aria-valuemax":j.valueMax,"aria-valuemin":j.valueMin,"aria-valuenow":j.valueNow,children:a,className:b,"data-separator":l,"data-testid":i,id:i,ref:p,role:"separator",style:{flexBasis:"auto",...g,flexGrow:0,flexShrink:0},tabIndex:0})}var af=a.i(700760);function ag({className:a,...b}){return(0,c.jsx)(aa,{"data-slot":"resizable-panel-group",className:(0,af.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",a),...b})}function ah({...a}){return(0,c.jsx)(ac,{"data-slot":"resizable-panel",...a})}function ai({withHandle:a,className:b,...e}){return(0,c.jsx)(ae,{"data-slot":"resizable-handle",className:(0,af.cn)("bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:translate-x-0 data-[panel-group-direction=vertical]:after:-translate-y-1/2 [&[data-panel-group-direction=vertical]>div]:rotate-90",b),...e,children:a&&(0,c.jsx)("div",{className:"bg-border z-10 flex h-4 w-3 items-center justify-center rounded-xs border",children:(0,c.jsx)(d.default,{className:"size-2.5"})})})}a.s(["ResizableHandle",()=>ai,"ResizablePanel",()=>ah,"ResizablePanelGroup",()=>ag],510217)},427288,a=>{"use strict";var b=a.i(537500);function c({conversationId:a,isDocumentMode:c,documentId:d,activeCanvasDocumentId:e,setDocumentId:f}){let g=(0,b.useRef)(a),h=(0,b.useRef)(!1),i=(0,b.useCallback)(()=>{h.current=!0,f(null)},[f]);return(0,b.useEffect)(()=>{!c&&d&&f(null)},[c,d,f]),(0,b.useEffect)(()=>{g.current!==a&&(g.current=a,h.current=!1,d&&f(null))},[a,d,f]),(0,b.useEffect)(()=>{e&&!d&&c&&!h.current&&f(e)},[e,d,f,c]),{handleClose:i}}a.s(["useCanvasAutoSync",()=>c])},155965,a=>{"use strict";var b=a.i(537500);function c({onOpenQuickSwitcher:a,onOpenTemplateSelector:c}){(0,b.useEffect)(()=>(window.addEventListener("open-quick-model-switcher",a),()=>window.removeEventListener("open-quick-model-switcher",a)),[a]),(0,b.useEffect)(()=>(window.addEventListener("open-quick-template-switcher",c),()=>window.removeEventListener("open-quick-template-switcher",c)),[c])}a.s(["useChatKeyboardShortcuts",()=>c])},811160,a=>{"use strict";var b=a.i(130487);a.i(16243);var c=a.i(182234),d=a.i(537500),e=a.i(225878),f=a.i(711106);function g({conversationId:a,conversation:g,user:h,defaultModel:i}){let j=(0,c.useMutation)(b.api.conversations.updateModel),[k,l]=(0,d.useState)(null),{selectedModel:m,modelLoading:n}=(0,d.useMemo)(()=>{let a=void 0!==h;if(void 0===g||!a)return{selectedModel:"",modelLoading:!0};e.DEFAULT_MODEL_ID;return{selectedModel:g?.model&&(0,f.isValidModel)(g.model)?g.model:i&&(0,f.isValidModel)(i)?i:e.DEFAULT_MODEL_ID,modelLoading:!1}},[g,h,i]);return{selectedModel:m,displayModel:k||m,modelLoading:n,optimisticModel:k,handleModelChange:(0,d.useCallback)(async b=>{if(l(b),a)try{await j({conversationId:a,model:b}),l(null)}catch(a){console.error("Failed to persist model:",a),l(null)}},[a,j])}}a.s(["useChatModelSelection",()=>g])},274969,a=>{"use strict";var b=a.i(130487);a.i(16243);var c=a.i(182234),d=a.i(502311),e=a.i(537500);function f({conversationId:a,messages:f}){let g=(0,d.useRouter)(),h=(0,c.useMutation)(b.api.votes.recordVote),i=(0,c.useMutation)(b.api.conversations.createConsolidationConversation),j=(0,c.useMutation)(b.api.conversations.consolidateInSameChat),k=(0,c.useMutation)(b.api.conversations.updateModel);return{handleVote:(0,e.useCallback)(async(a,b)=>{let c=f?.find(b=>!("_optimistic"in b)&&b._id===a);c?.comparisonGroupId&&await h({comparisonGroupId:c.comparisonGroupId,winnerId:c._id,rating:b})},[f,h]),handleConsolidate:(0,e.useCallback)(async(b,c)=>{let d=f?.find(a=>a.comparisonGroupId);if(d?.comparisonGroupId)if("same-chat"===c)await j({conversationId:a,comparisonGroupId:d.comparisonGroupId,consolidationModel:b}),await k({conversationId:a,model:b});else{let{conversationId:a}=await i({comparisonGroupId:d.comparisonGroupId,consolidationModel:b});g.push(`/chat/${a}`)}},[a,f,j,i,k,g])}}a.s(["useComparisonHandlers",()=>f])},993859,a=>{"use strict";var b=a.i(537500),c=a.i(638600);function d(){let[a,d]=(0,b.useState)(!1),[e,f]=(0,b.useState)([]),[g,h]=(0,b.useState)(null);return{isActive:a,selectedModels:e,activeComparisonId:g,startComparison:(0,b.useCallback)(a=>a.length<2?(console.warn("Cannot start comparison: Select at least 2 models"),!1):a.length>4?(console.warn("Cannot start comparison: Maximum 4 models allowed"),!1):(f(a),d(!0),c.analytics.track("comparison_started",{modelCount:a.length,models:a.join(",")}),!0),[]),exitComparison:(0,b.useCallback)(()=>{d(!1),f([]),h(null),c.analytics.track("comparison_exited",{})},[]),setActiveComparisonId:h}}a.s(["useComparisonMode",()=>d])},682902,a=>{"use strict";var b=a.i(502311),c=a.i(537500);function d({conversationId:a,filteredConversations:d}){let e=(0,b.useRouter)(),{currentIndex:f,isFirst:g,isLast:h,sortedConversations:i}=(0,c.useMemo)(()=>{if(!d?.length||!a)return{currentIndex:-1,isFirst:!0,isLast:!0,sortedConversations:[]};let b=[...d].sort((a,b)=>b._creationTime-a._creationTime),c=b.findIndex(b=>b._id===a);return{currentIndex:c,isFirst:c<=0,isLast:c>=b.length-1,sortedConversations:b}},[d,a]),j=(0,c.useCallback)(()=>{if(g||0===i.length)return;let a=Math.max(f-1,0);e.push(`/chat/${i[a]._id}`)},[g,i,f,e]),k=(0,c.useCallback)(()=>{if(h||0===i.length)return;let a=Math.min(f+1,i.length-1);e.push(`/chat/${i[a]._id}`)},[h,i,f,e]);return{currentIndex:f,isFirst:g,isLast:h,navigateToPrevious:j,navigateToNext:k}}a.s(["useConversationNavigation",()=>d])},162011,a=>{"use strict";var b=a.i(130487);a.i(16243);var c=a.i(182234),d=a.i(537500);function e({conversation:a,messages:e,onModelChange:f}){let[g,h]=(0,d.useState)(!1),[i,j]=(0,d.useState)(null),[k,l]=(0,d.useState)(!1),[m,n]=(0,d.useState)(null),[o,p]=(0,d.useState)(null),q=(0,c.useMutation)(b.api.users.updatePreferences),r=(0,d.useCallback)(async a=>{await f(a),n(a),p(Date.now())},[f]),s=(0,d.useCallback)(a=>{j(a),h(!0)},[]),t=(0,d.useCallback)(async()=>{m&&(await q({preferences:{defaultModel:m}}),l(!1))},[m,q]);return(0,d.useEffect)(()=>{if(m&&o&&e&&e.length>0){let b=e[e.length-1];if("assistant"===b.role&&"complete"===b.status&&a?.model===m&&b._creationTime>o){let a=setTimeout(()=>{l(!0)},2e3);return()=>clearTimeout(a)}}},[e,m,o,a?.model]),(0,d.useEffect)(()=>{let a=a=>{j(a.detail.modelId),h(!0)};return window.addEventListener("open-model-preview",a),()=>window.removeEventListener("open-model-preview",a)},[]),{previewModalOpen:g,setPreviewModalOpen:h,previewModelId:i,showSetDefaultPrompt:k,switchedModelId:m,handleSwitchModel:r,handlePreviewModel:s,handleSetAsDefault:t,dismissSetDefaultPrompt:()=>l(!1)}}a.s(["useModelRecommendation",()=>e])},614337,a=>{"use strict";var b=a.i(537500);function c({serverMessages:a}){let[c,d]=(0,b.useState)([]),e=(0,b.useCallback)(a=>{d(b=>[...b,...a])},[]);return{messages:(0,b.useMemo)(()=>{let b=a||[];if(0===c.length)return b;let d=c.filter(a=>!b.some(b=>!(b.role!==a.role||Math.abs(b.createdAt-a.createdAt)>=5e3)&&("assistant"!==a.role||!a.model||b.model===a.model)));return[...b,...d].sort((a,b)=>a.createdAt-b.createdAt)},[a,c]),addOptimisticMessages:e}}a.s(["useOptimisticMessages",()=>c])},170488,a=>{"use strict";var b=a.i(502311),c=a.i(537500);function d(){let a=(0,b.useRouter)(),d=(0,b.useSearchParams)();(0,c.useEffect)(()=>{if("true"!==d.get("insertTemplate"))return;let b=sessionStorage.getItem("pending-template-text");b&&(sessionStorage.removeItem("pending-template-text"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("insert-prompt",{detail:b})),window.dispatchEvent(new CustomEvent("focus-chat-input"))},100));let c=new URL(window.location.href);c.searchParams.delete("insertTemplate"),a.replace(c.pathname+c.search,{scroll:!1})},[d,a])}a.s(["useTemplateInsertion",()=>d])},318714,a=>a.a(async(b,c)=>{try{var d=a.i(367146),e=a.i(130487);a.i(208756);var f=a.i(486722),g=a.i(354420),h=a.i(529395),i=a.i(502311),j=a.i(689024),k=a.i(537500),l=a.i(840347),m=a.i(442751),n=a.i(820493),o=a.i(174596),p=a.i(653936),q=a.i(401517),r=a.i(494110),s=a.i(781961),t=a.i(771293),u=a.i(270730),v=a.i(101532),w=a.i(539524),x=a.i(510217),y=a.i(609448),z=a.i(86086),A=a.i(133231),B=a.i(427288),C=a.i(155965),D=a.i(811160),E=a.i(274969),F=a.i(993859),G=a.i(682902),H=a.i(375523),I=a.i(63263),J=a.i(162011),K=a.i(614337),L=a.i(170488),M=a.i(772949),N=a.i(349977),O=a.i(711106),P=b([p,u]);function Q({params:a}){let b=(0,k.use)(a).conversationId,c=(0,i.useRouter)(),P=(0,i.useSearchParams)().get("messageId")??void 0,{filteredConversations:Q}=(0,z.useConversationContext)(),{documentId:R,setDocumentId:S}=(0,y.useCanvasContext)(),T=(0,f.useQuery)(e.api.canvas.documents.getByConversation,b?{conversationId:b}:"skip"),U=(0,f.useQuery)(e.api.conversations.get,b?{conversationId:b}:"skip"),{results:V,status:W,loadMore:X}=(0,f.usePaginatedQuery)(e.api.messages.listPaginated,b?{conversationId:b}:"skip",{initialNumItems:50}),Y=(0,f.useQuery)(e.api.users.getCurrentUser),Z=U?.mode==="document",{handleClose:$}=(0,B.useCanvasAutoSync)({conversationId:b,isDocumentMode:Z,documentId:R,activeCanvasDocumentId:T?._id,setDocumentId:S}),{messages:_,addOptimisticMessages:aa}=(0,K.useOptimisticMessages)({serverMessages:V}),ab=(0,f.useQuery)(e.api.users.getUserPreference,{key:"chatWidth"}),ac=void 0===ab,ad=ab||"standard",ae=(0,M.useUserPreference)("defaultModel"),af=(0,M.useUserPreference)("showModelNamesDuringComparison"),ag=(0,M.useUserPreference)("ttsSpeed"),ah=(0,H.useFeatureToggles)(),{selectedModel:ai,displayModel:aj,modelLoading:ak,handleModelChange:al}=(0,D.useChatModelSelection)({conversationId:b,conversation:U,user:Y,defaultModel:ae}),[am,an]=(0,k.useState)("none"),[ao,ap]=(0,k.useState)([]),[aq,ar]=(0,j.useQueryState)("showModelNames",j.parseAsBoolean.withDefault(af)),[as,at]=(0,k.useState)(!1),[au,av]=(0,k.useState)(!1),[aw,ax]=(0,k.useState)(!1),[ay,az]=(0,k.useState)(!1),aA=(0,k.useRef)(null),{isActive:aB,selectedModels:aC,startComparison:aD,exitComparison:aE}=(0,F.useComparisonMode)(),{isMobile:aF,isTouchDevice:aG}=(0,I.useMobileDetect)(),{handleVote:aH,handleConsolidate:aI}=(0,E.useComparisonHandlers)({conversationId:b,messages:_}),aJ=(0,J.useModelRecommendation)({conversation:U,messages:_,onModelChange:al});(0,C.useChatKeyboardShortcuts)({onOpenQuickSwitcher:(0,k.useCallback)(()=>ax(!0),[]),onOpenTemplateSelector:(0,k.useCallback)(()=>az(!0),[])}),(0,L.useTemplateInsertion)(),(0,k.useEffect)(()=>{if(!aA.current||"CanLoadMore"!==W)return;let a=new IntersectionObserver(a=>{a[0].isIntersecting&&"CanLoadMore"===W&&X(50)},{threshold:1});return a.observe(aA.current),()=>a.disconnect()},[W,X]);let aK=(0,k.useRef)(!1);(0,k.useEffect)(()=>{if(void 0===U){aK.current=!1;return}aK.current=!0,null===U&&c.push("/app")},[U,c]),(0,k.useEffect)(()=>{if(!b||aF||aG)return;let a=setTimeout(()=>{window.dispatchEvent(new CustomEvent("focus-chat-input"))},50);return()=>clearTimeout(a)},[b,aF,aG]);let aL=_?.some(a=>"assistant"===a.role&&["pending","generating"].includes(a.status||""))??!1,aM=(0,O.getModelConfig)(aj),aN=!!aM?.reasoning||aM?.capabilities?.includes("thinking"),aO=(_?.length??0)>0,{isFirst:aP,isLast:aQ,navigateToPrevious:aR,navigateToNext:aS}=(0,G.useConversationNavigation)({conversationId:b,filteredConversations:Q}),aT=void 0===V||"LoadingFirstPage"===W||ac;return(0,d.jsx)(A.TTSProvider,{defaultSpeed:ag,children:(0,d.jsxs)(x.ResizablePanelGroup,{orientation:"horizontal",className:"flex-1 min-h-0",id:"chat-canvas-layout",children:[(0,d.jsx)(x.ResizablePanel,{defaultSize:R?45:100,minSize:30,children:(0,d.jsxs)("div",{className:"flex flex-col h-full",children:[(0,d.jsx)(m.ChatHeader,{conversation:U,conversationId:b,selectedModel:aj,modelLoading:ak,hasMessages:aO,isFirst:aP,isLast:aQ,isComparisonActive:aB,comparisonModelCount:aC.length,showProjects:ah.showProjects,onNavigatePrevious:aR,onNavigateNext:aS,onModelBadgeClick:()=>at(!0),onComparisonBadgeClick:()=>av(!0)}),(0,d.jsx)(t.TTSPlayerBar,{}),(0,d.jsx)(g.AnimatePresence,{mode:"popLayout",children:aT?(0,d.jsx)(h.motion.div,{initial:{opacity:1},exit:{opacity:0},transition:{duration:.15},children:(0,d.jsx)(o.MessageListSkeleton,{chatWidth:ad})},"skeleton"):(0,d.jsxs)(h.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"flex-1 flex flex-col min-h-0",children:["CanLoadMore"===W&&(0,d.jsx)("div",{className:"flex justify-center p-4",children:(0,d.jsx)(w.Button,{variant:"ghost",size:"sm",onClick:()=>X(50),className:"text-sm",children:"Load older messages"})}),"LoadingMore"===W&&(0,d.jsx)("div",{className:"flex justify-center p-4",children:(0,d.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading more messages..."})}),(0,d.jsx)("div",{ref:aA,className:"h-px"}),(0,d.jsx)(u.VirtualizedMessageList,{messages:_,selectedModel:aj,chatWidth:ad,isGenerating:aL,onVote:aH,onConsolidate:aI,onToggleModelNames:()=>ar(!aq),showModelNames:aq??!1,highlightMessageId:P,isCollaborative:U?.isCollaborative}),U?.modelRecommendation&&!U.modelRecommendation.dismissed&&(0,d.jsx)(q.ModelRecommendationBanner,{recommendation:U.modelRecommendation,conversationId:b,onSwitch:aJ.handleSwitchModel,onPreview:aJ.handlePreviewModel}),aJ.showSetDefaultPrompt&&aJ.switchedModelId&&(0,d.jsx)(s.SetDefaultModelPrompt,{modelId:aJ.switchedModelId,modelName:N.MODEL_CONFIG[aJ.switchedModelId]?.name??aJ.switchedModelId,conversationId:b,onSetDefault:aJ.handleSetAsDefault,onDismiss:aJ.dismissSetDefaultPrompt}),aJ.previewModalOpen&&aJ.previewModelId&&U?.modelRecommendation&&(0,d.jsx)(p.ModelPreviewModal,{open:aJ.previewModalOpen,onOpenChange:aJ.setPreviewModalOpen,currentModelId:U.modelRecommendation.currentModelId,suggestedModelId:aJ.previewModelId,currentResponse:_?.find(a=>"assistant"===a.role)?.content??"",onSwitch:aJ.handleSwitchModel,conversationId:b,userMessage:_?.find(a=>"user"===a.role)?.content??""}),(0,d.jsx)(r.QuickModelSwitcher,{open:aw,onOpenChange:ax,currentModel:ai,onSelectModel:al}),(0,d.jsx)(v.QuickTemplateSwitcher,{open:ay,onOpenChange:az,mode:"insert",onSelectTemplate:a=>{window.dispatchEvent(new CustomEvent("insert-prompt",{detail:a}))}})]},`messages-${b}`)}),(0,d.jsx)("div",{className:"flex shrink-0",children:(0,d.jsx)(n.ChatInput,{conversationId:b,chatWidth:ad,isGenerating:aL,selectedModel:aj,onModelChange:al,thinkingEffort:aN?am:void 0,onThinkingEffortChange:an,attachments:ao,onAttachmentsChange:ap,isComparisonMode:aB,selectedModels:aC,onStartComparison:aD,onExitComparison:aE,isEmpty:_?.length===0,modelSelectorOpen:as,onModelSelectorOpenChange:at,comparisonDialogOpen:au,onComparisonDialogOpenChange:av,onOptimisticUpdate:aa})})]})}),R&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(x.ResizableHandle,{withHandle:!0}),(0,d.jsx)(x.ResizablePanel,{defaultSize:55,minSize:25,children:(0,d.jsx)(l.CanvasPanel,{documentId:R,onClose:$})})]})]})})}function R({params:a}){return(0,d.jsx)(Q,{params:a})}[p,u]=P.then?(await P)():P,a.s(["default",()=>R]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=_584d65ba._.js.map