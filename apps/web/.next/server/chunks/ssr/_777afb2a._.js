module.exports=[359275,a=>{"use strict";let b=(0,a.i(366705).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);a.s(["Calendar",()=>b],359275)},2269,a=>{"use strict";var b=a.i(537500),c=a.i(367146);function d(a,e=[]){let f=[],g=()=>{let c=f.map(a=>b.createContext(a));return function(d){let e=d?.[a]||c;return b.useMemo(()=>({[`__scope${a}`]:{...d,[a]:e}}),[d,e])}};return g.scopeName=a,[function(d,e){let g=b.createContext(e);g.displayName=d+"Context";let h=f.length;f=[...f,e];let i=d=>{let{scope:e,children:f,...i}=d,j=e?.[a]?.[h]||g,k=b.useMemo(()=>i,Object.values(i));return(0,c.jsx)(j.Provider,{value:k,children:f})};return i.displayName=d+"Provider",[i,function(c,f){let i=f?.[a]?.[h]||g,j=b.useContext(i);if(j)return j;if(void 0!==e)return e;throw Error(`\`${c}\` must be used within \`${d}\``)}]},function(...a){let c=a[0];if(1===a.length)return c;let d=()=>{let d=a.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){let e=d.reduce((b,{useScope:c,scopeName:d})=>{let e=c(a)[`__scope${d}`];return{...b,...e}},{});return b.useMemo(()=>({[`__scope${c.scopeName}`]:e}),[e])}};return d.scopeName=c.scopeName,d}(g,...e)]}a.s(["createContextScope",()=>d])},448645,a=>{"use strict";var b=a.i(367146),c=a.i(537500),d=a.i(2269),e=a.i(246936),f=a.i(973989),g=a.i(75714),h=a.i(839665);function i(){return()=>{}}var j="Avatar",[k,l]=(0,d.createContextScope)(j),[m,n]=k(j),o=c.forwardRef((a,d)=>{let{__scopeAvatar:e,...f}=a,[h,i]=c.useState("idle");return(0,b.jsx)(m,{scope:e,imageLoadingStatus:h,onImageLoadingStatusChange:i,children:(0,b.jsx)(g.Primitive.span,{...f,ref:d})})});o.displayName=j;var p="AvatarImage",q=c.forwardRef((a,d)=>{let{__scopeAvatar:j,src:k,onLoadingStatusChange:l=()=>{},...m}=a,o=n(p,j),q=function(a,{referrerPolicy:b,crossOrigin:d}){let e=(0,h.useSyncExternalStore)(i,()=>!0,()=>!1),g=c.useRef(null),j=e?(g.current||(g.current=new window.Image),g.current):null,[k,l]=c.useState(()=>t(j,a));return(0,f.useLayoutEffect)(()=>{l(t(j,a))},[j,a]),(0,f.useLayoutEffect)(()=>{let a=a=>()=>{l(a)};if(!j)return;let c=a("loaded"),e=a("error");return j.addEventListener("load",c),j.addEventListener("error",e),b&&(j.referrerPolicy=b),"string"==typeof d&&(j.crossOrigin=d),()=>{j.removeEventListener("load",c),j.removeEventListener("error",e)}},[j,d,b]),k}(k,m),r=(0,e.useCallbackRef)(a=>{l(a),o.onImageLoadingStatusChange(a)});return(0,f.useLayoutEffect)(()=>{"idle"!==q&&r(q)},[q,r]),"loaded"===q?(0,b.jsx)(g.Primitive.img,{...m,ref:d,src:k}):null});q.displayName=p;var r="AvatarFallback",s=c.forwardRef((a,d)=>{let{__scopeAvatar:e,delayMs:f,...h}=a,i=n(r,e),[j,k]=c.useState(void 0===f);return c.useEffect(()=>{if(void 0!==f){let a=window.setTimeout(()=>k(!0),f);return()=>window.clearTimeout(a)}},[f]),j&&"loaded"!==i.imageLoadingStatus?(0,b.jsx)(g.Primitive.span,{...h,ref:d}):null});function t(a,b){return a?b?(a.src!==b&&(a.src=b),a.complete&&a.naturalWidth>0?"loaded":"loading"):"error":"idle"}s.displayName=r;var u=a.i(700760);function v({className:a,...c}){return(0,b.jsx)(o,{"data-slot":"avatar",className:(0,u.cn)("relative flex size-8 shrink-0 overflow-hidden rounded-full",a),...c})}function w({className:a,...c}){return(0,b.jsx)(q,{"data-slot":"avatar-image",className:(0,u.cn)("aspect-square size-full",a),...c})}function x({className:a,...c}){return(0,b.jsx)(s,{"data-slot":"avatar-fallback",className:(0,u.cn)("bg-muted flex size-full items-center justify-center rounded-full",a),...c})}a.s(["Avatar",()=>v,"AvatarFallback",()=>x,"AvatarImage",()=>w],448645)},230677,371510,a=>{"use strict";var b=a.i(367146),c=a.i(585291),d=a.i(359275),e=a.i(537500),f=a.i(539524),g=a.i(165004),h=a.i(700760),i=a.i(544169),j=a.i(266186);function k(a){return(0,c.format)(a,"yyyy-MM-dd")}function l(a=30){var b,c;let d,e=new Date;return{startDate:k((b=-a,c=void 0,d=(0,j.toDate)(e,c?.in),isNaN(b)?(0,i.constructFrom)(c?.in||e,NaN):(b&&d.setDate(d.getDate()+b),d))),endDate:k(e)}}function m(a,b=1){if(a<1e3)return a.toString();let c=Math.floor(Math.log10(a)/3),d=a/10**(3*c);return`${d.toFixed(b)}${["K","M","B","T"][c-1]}`}function n(a,b=2){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:b,maximumFractionDigits:b}).format(a)}a.s(["formatCompactNumber",()=>m,"formatCurrency",()=>n,"formatDateToISO",()=>k,"getLastNDays",()=>l],371510);let o={"7d":{label:"7 days",days:7},"30d":{label:"30 days",days:30},"90d":{label:"90 days",days:90}};function p({value:a,onChange:i,className:j}){let[m,n]=(0,e.useState)("30d"),[p,q]=(0,e.useState)(a.startDate),[r,s]=(0,e.useState)(a.endDate);(0,e.useEffect)(()=>{q(a.startDate),s(a.endDate)},[a]);let t=a=>{try{return(0,c.format)(new Date(a),"MMM d, yyyy")}catch{return a}};return(0,b.jsxs)("div",{className:(0,h.cn)("flex items-center gap-2",j),children:[Object.keys(o).map(a=>(0,b.jsx)(f.Button,{variant:m===a?"default":"outline",size:"sm",onClick:()=>{i(l(o[a].days)),n(a)},className:"min-w-[80px]",children:o[a].label},a)),(0,b.jsxs)(g.Popover,{children:[(0,b.jsx)(g.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(f.Button,{variant:null===m?"default":"outline",size:"sm",className:"min-w-[200px] justify-start text-left font-normal",children:[(0,b.jsx)(d.Calendar,{className:"mr-2 h-4 w-4"}),null===m?(0,b.jsxs)("span",{children:[t(a.startDate)," -"," ",t(a.endDate)]}):(0,b.jsx)("span",{className:"text-muted-foreground",children:"Custom"})]})}),(0,b.jsx)(g.PopoverContent,{className:"w-auto p-4",align:"end",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"start-date",className:"text-sm font-medium mb-2 block",children:"Start Date"}),(0,b.jsx)("input",{id:"start-date",type:"date",value:p,onChange:a=>q(a.target.value),max:r,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"end-date",className:"text-sm font-medium mb-2 block",children:"End Date"}),(0,b.jsx)("input",{id:"end-date",type:"date",value:r,onChange:a=>s(a.target.value),min:p,max:k(new Date),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"})]}),(0,b.jsx)(f.Button,{onClick:()=>{i({startDate:p,endDate:r}),n(null)},className:"w-full",children:"Apply"})]})})]})]})}a.s(["DateRangePicker",()=>p],230677)},75887,a=>{"use strict";var b=a.i(367146),c=a.i(130487),d=a.i(502210),e=a.i(175311),f=a.i(913425);a.i(16243);var g=a.i(182234),h=a.i(509423),i=a.i(315638),j=a.i(524761),k=a.i(376332),l=a.i(502311),m=a.i(537500),n=a.i(753884),o=a.i(230677),p=a.i(448645),q=a.i(968177),r=a.i(539524),s=a.i(547885),t=a.i(452309),u=a.i(105008),v=a.i(371510);function w(){return(0,b.jsxs)("div",{className:"p-6 space-y-4",children:[(0,b.jsx)(t.Skeleton,{className:"h-8 w-48"}),(0,b.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,c)=>(0,b.jsx)(t.Skeleton,{className:"h-16 w-full"},c))})]})}function x(){let a=(0,l.useRouter)(),t=(0,g.useMutation)(c.api.admin.updateUserRole),x=(0,g.useMutation)(c.api.admin.updateUserTier),[y,z]=(0,m.useState)(()=>(0,v.getLastNDays)(30)),[A,B]=(0,m.useState)([{id:"totalSpent",desc:!0}]),[C,D]=(0,m.useState)({pageIndex:0,pageSize:50}),E=(0,m.useRef)(null),F=(0,g.useQuery)(c.api.admin.listUsers),G=(0,g.useQuery)(c.api.usage.queries.getAllUsersUsageSummary,{startDate:y.startDate,endDate:y.endDate}),H=(0,m.useCallback)(async(a,b)=>{try{await t({userId:a,isAdmin:b}),n.toast.success(b?"Admin role granted":"Admin role revoked")}catch(a){n.toast.error(a.message||"Failed to update role")}},[t]),I=(0,m.useCallback)(async(a,b)=>{try{await x({userId:a,tier:b}),n.toast.success(`User tier updated to ${b}`)}catch(a){n.toast.error(a.message||"Failed to update tier")}},[x]),J=(0,m.useMemo)(()=>{if(!F||!G)return[];let a=new Map(G.map(a=>[a.userId,a]));return F.map(b=>({...b,tier:b.tier,usage:a.get(b._id)||{totalCost:0,totalTokens:0,totalRequests:0}}))},[F,G]),K=(0,m.useMemo)(()=>[{id:"user",accessorFn:a=>a.name,header:"User",cell:({row:a})=>(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(p.Avatar,{className:"h-8 w-8",children:[(0,b.jsx)(p.AvatarImage,{src:a.original.imageUrl||void 0,alt:a.original.name}),(0,b.jsx)(p.AvatarFallback,{children:a.original.name.charAt(0).toUpperCase()})]}),(0,b.jsx)("span",{className:"font-medium",children:a.original.name})]})},{accessorKey:"email",header:"Email",cell:({row:a})=>(0,b.jsx)("span",{className:"text-muted-foreground",children:a.original.email})},{accessorKey:"createdAt",header:"Joined",cell:({row:a})=>(0,b.jsx)("span",{className:"text-muted-foreground",children:(0,h.formatDistanceToNow)(a.original.createdAt,{addSuffix:!0})})},{id:"totalSpent",accessorFn:a=>a.usage.totalCost,header:({column:a})=>(0,b.jsxs)(r.Button,{variant:"ghost",className:"text-right w-full justify-end",onClick:()=>a.toggleSorting("asc"===a.getIsSorted()),children:["Total Spent",(0,b.jsx)(i.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>(0,b.jsx)("div",{className:"text-right font-medium",children:(0,v.formatCurrency)(a.original.usage.totalCost)})},{id:"totalTokens",accessorFn:a=>a.usage.totalTokens,header:({column:a})=>(0,b.jsxs)(r.Button,{variant:"ghost",className:"text-right w-full justify-end",onClick:()=>a.toggleSorting("asc"===a.getIsSorted()),children:["Total Tokens",(0,b.jsx)(i.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>(0,b.jsx)("div",{className:"text-right font-medium",children:(0,v.formatCompactNumber)(a.original.usage.totalTokens)})},{id:"admin",header:()=>(0,b.jsx)("div",{className:"text-right",children:"Admin"}),cell:({row:a})=>(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",onClick:a=>a.stopPropagation(),children:[a.original.isAdmin&&(0,b.jsx)(j.Shield,{className:"h-4 w-4 text-primary"}),(0,b.jsx)(u.Switch,{checked:a.original.isAdmin,onCheckedChange:b=>H(a.original._id,b)})]})},{id:"tier",header:()=>(0,b.jsx)("div",{className:"text-right",children:"Tier"}),cell:({row:a})=>(0,b.jsx)("div",{className:"flex items-center justify-end",onClick:a=>a.stopPropagation(),children:(0,b.jsxs)(s.Select,{value:a.original.tier||"free",onValueChange:b=>I(a.original._id,b),children:[(0,b.jsx)(s.SelectTrigger,{className:"w-24 h-8",children:(0,b.jsx)(s.SelectValue,{})}),(0,b.jsxs)(s.SelectContent,{children:[(0,b.jsx)(s.SelectItem,{value:"free",children:"Free"}),(0,b.jsx)(s.SelectItem,{value:"tier1",children:"Tier 1"}),(0,b.jsx)(s.SelectItem,{value:"tier2",children:"Tier 2"})]})]})})}],[H,I]),L=(0,d.useReactTable)({data:J,columns:K,state:{sorting:A,pagination:C},onSortingChange:B,onPaginationChange:D,getCoreRowModel:(0,e.getCoreRowModel)(),getSortedRowModel:(0,e.getSortedRowModel)(),getPaginationRowModel:(0,e.getPaginationRowModel)(),manualPagination:!1}),M=L.getRowModel().rows,N=M.length>50,O=(0,m.useCallback)(()=>73,[]),P=(0,f.useVirtualizer)({count:M.length,getScrollElement:()=>E.current,estimateSize:O,overscan:10,enabled:N});return F&&G?(0,b.jsxs)("div",{className:"h-[calc(100vh-theme(spacing.16))] flex flex-col overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex-shrink-0 px-6 pt-6 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(k.Users,{className:"h-6 w-6"}),(0,b.jsx)("h1",{className:"text-2xl font-semibold",children:"User Management"})]}),(0,b.jsxs)(q.Badge,{variant:"secondary",children:[F.length," users"]})]}),(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsx)(o.DateRangePicker,{value:y,onChange:z})})]}),(0,b.jsx)("div",{className:"flex-1 flex flex-col min-h-0 px-6 pb-0",children:(0,b.jsx)("div",{className:"border rounded-lg flex-1 flex flex-col min-h-0 overflow-hidden",children:N?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"flex-shrink-0 sticky top-0 z-10 bg-background border-b",children:L.getHeaderGroups().map(a=>(0,b.jsx)("div",{className:"flex",children:a.headers.map(a=>(0,b.jsx)("div",{className:"flex-1 px-4 py-3 text-sm font-medium",style:{width:a.getSize()},children:a.isPlaceholder?null:(0,d.flexRender)(a.column.columnDef.header,a.getContext())},a.id))},a.id))}),(0,b.jsx)("div",{ref:E,className:"flex-1 overflow-auto relative",children:(0,b.jsx)("div",{style:{height:`${P.getTotalSize()}px`,position:"relative"},children:P.getVirtualItems().map(c=>{let e=M[c.index];return(0,b.jsx)("div",{"data-index":c.index,ref:P.measureElement,className:"flex cursor-pointer hover:bg-muted/50 border-b absolute left-0 w-full",style:{transform:`translateY(${c.start}px)`},onClick:()=>a.push(`/admin/users/${e.original._id}`),children:e.getVisibleCells().map(a=>(0,b.jsx)("div",{className:"flex-1 px-4 py-3",style:{width:a.column.getSize()},children:(0,d.flexRender)(a.column.columnDef.cell,a.getContext())},a.id))},e.id)})})})]}):(0,b.jsx)("div",{className:"flex-1 overflow-auto",children:(0,b.jsxs)("table",{className:"w-full caption-bottom text-sm",children:[(0,b.jsx)("thead",{className:"[&_tr]:border-b",children:L.getHeaderGroups().map(a=>(0,b.jsx)("tr",{className:"border-b",children:a.headers.map(a=>(0,b.jsx)("th",{className:"sticky top-0 bg-background z-10 h-10 px-4 text-left align-middle font-medium text-muted-foreground",children:a.isPlaceholder?null:(0,d.flexRender)(a.column.columnDef.header,a.getContext())},a.id))},a.id))}),(0,b.jsx)("tbody",{className:"[&_tr:last-child]:border-0",children:L.getRowModel().rows.length?L.getRowModel().rows.map(c=>(0,b.jsx)("tr",{className:"border-b cursor-pointer hover:bg-muted/50",onClick:()=>a.push(`/admin/users/${c.original._id}`),children:c.getVisibleCells().map(a=>(0,b.jsx)("td",{className:"p-4 align-middle",children:(0,d.flexRender)(a.column.columnDef.cell,a.getContext())},a.id))},c.id)):(0,b.jsx)("tr",{className:"border-b",children:(0,b.jsx)("td",{colSpan:K.length,className:"h-24 text-center p-4 align-middle",children:"No users found."})})})]})})})}),(0,b.jsx)("div",{className:"flex-shrink-0 px-6 pb-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",L.getRowModel().rows.length," of ",J.length," ","users"]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(r.Button,{variant:"outline",size:"sm",onClick:()=>L.previousPage(),disabled:!L.getCanPreviousPage(),children:"Previous"}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Page ",L.getState().pagination.pageIndex+1," of"," ",L.getPageCount()]}),(0,b.jsx)(r.Button,{variant:"outline",size:"sm",onClick:()=>L.nextPage(),disabled:!L.getCanNextPage(),children:"Next"}),(0,b.jsx)("select",{value:C.pageSize,onChange:a=>L.setPageSize(Number(a.target.value)),className:"h-8 rounded-md border border-input bg-background px-3 text-sm",children:[20,50,100].map(a=>(0,b.jsxs)("option",{value:a,children:[a," per page"]},a))})]})]})})]}):(0,b.jsx)(w,{})}function y(){return(0,b.jsx)(m.Suspense,{fallback:(0,b.jsx)(w,{}),children:(0,b.jsx)(x,{})})}a.s(["default",()=>y])}];

//# sourceMappingURL=_777afb2a._.js.map