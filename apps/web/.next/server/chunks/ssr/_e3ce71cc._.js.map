{"version":3,"sources":["../../../../../../node_modules/.bun/lucide-react%400.555.0%2B83d5fd7b249dbeef/node_modules/lucide-react/src/icons/refresh-cw.ts","../../../../../../apps/web/src/components/auth/UserSyncError.tsx","../../../../../../apps/web/src/app/%28main%29/app/page.tsx","../../../../../../node_modules/.bun/lucide-react%400.555.0%2B83d5fd7b249dbeef/node_modules/lucide-react/src/icons/log-out.ts"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8', key: 'v9h5vc' }],\n  ['path', { d: 'M21 3v5h-5', key: '1q7to0' }],\n  ['path', { d: 'M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16', key: '3uifl3' }],\n  ['path', { d: 'M8 16H3v5', key: '1cv678' }],\n];\n\n/**\n * @component @name RefreshCw\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMyAxMmE5IDkgMCAwIDEgOS05IDkuNzUgOS43NSAwIDAgMSA2Ljc0IDIuNzRMMjEgOCIgLz4KICA8cGF0aCBkPSJNMjEgM3Y1aC01IiAvPgogIDxwYXRoIGQ9Ik0yMSAxMmE5IDkgMCAwIDEtOSA5IDkuNzUgOS43NSAwIDAgMS02Ljc0LTIuNzRMMyAxNiIgLz4KICA8cGF0aCBkPSJNOCAxNkgzdjUiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/refresh-cw\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst RefreshCw = createLucideIcon('refresh-cw', __iconNode);\n\nexport default RefreshCw;\n","\"use client\";\n\nimport { useClerk, useUser } from \"@clerk/nextjs\";\nimport { AlertTriangle, LogOut, RefreshCw } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\n/**\n * UserSyncError Component\n *\n * Displays when a user is authenticated via Clerk but has no corresponding\n * user record in Convex (webhook failure scenario).\n *\n * Shows different messages based on environment:\n * - Development: Detailed message with Clerk ID for debugging\n * - Production: Simple error message with support contact\n */\nexport function UserSyncError() {\n  const { signOut } = useClerk();\n  const { user } = useUser();\n  const isDev = process.env.NODE_ENV === \"development\";\n\n  const handleSignOut = () => {\n    signOut({ redirectUrl: \"/\" });\n  };\n\n  const handleRefresh = () => {\n    window.location.reload();\n  };\n\n  return (\n    <div className=\"flex min-h-screen items-center justify-center p-4\">\n      <div className=\"max-w-md w-full space-y-6 text-center\">\n        <div className=\"mx-auto w-16 h-16 rounded-full bg-destructive/10 flex items-center justify-center\">\n          <AlertTriangle className=\"h-8 w-8 text-destructive\" />\n        </div>\n\n        <div className=\"space-y-2\">\n          <h1 className=\"text-2xl font-semibold tracking-tight\">\n            Account Setup Incomplete\n          </h1>\n\n          {isDev ? (\n            <div className=\"space-y-3 text-left bg-muted/50 rounded-lg p-4 mt-4\">\n              <p className=\"text-sm text-muted-foreground\">\n                <strong className=\"text-foreground\">Development Mode:</strong>{\" \"}\n                Your user record wasn&apos;t synced to Convex. This usually\n                means the Clerk webhook didn&apos;t fire.\n              </p>\n              <p className=\"text-sm text-muted-foreground\">\n                <strong>Possible causes:</strong>\n              </p>\n              <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-1\">\n                <li>Webhook not configured in Clerk dashboard</li>\n                <li>No tunnel exposing localhost to Clerk</li>\n                <li>\n                  Missing{\" \"}\n                  <code className=\"bg-muted px-1 rounded\">\n                    CLERK_WEBHOOK_SECRET\n                  </code>\n                </li>\n              </ul>\n              {user?.id && (\n                <p className=\"text-xs text-muted-foreground/70 font-mono mt-2\">\n                  Clerk ID: {user.id}\n                </p>\n              )}\n            </div>\n          ) : (\n            <p className=\"text-muted-foreground\">\n              Something went wrong setting up your account. Please try again or\n              contact support if the issue persists.\n            </p>\n          )}\n        </div>\n\n        <div className=\"flex flex-col gap-3 pt-4\">\n          <Button onClick={handleRefresh} variant=\"outline\" className=\"w-full\">\n            <RefreshCw className=\"h-4 w-4 mr-2\" />\n            Refresh Page\n          </Button>\n          <Button onClick={handleSignOut} variant=\"ghost\" className=\"w-full\">\n            <LogOut className=\"h-4 w-4 mr-2\" />\n            Sign Out\n          </Button>\n        </div>\n\n        {!isDev && (\n          <p className=\"text-xs text-muted-foreground\">\n            If this issue continues, please contact{\" \"}\n            <a\n              href=\"mailto:support@blah.chat\"\n              className=\"text-primary hover:underline\"\n            >\n              support@blah.chat\n            </a>\n          </p>\n        )}\n      </div>\n    </div>\n  );\n}\n","\"use client\";\n\nimport { api } from \"@blah-chat/backend/convex/_generated/api\";\nimport { useAuth } from \"@clerk/nextjs\";\nimport {\n  Authenticated,\n  Unauthenticated,\n  useConvexAuth,\n  useQuery,\n} from \"convex/react\";\nimport { useRouter } from \"next/navigation\";\nimport { useEffect, useRef } from \"react\";\nimport { UserSyncError } from \"@/components/auth/UserSyncError\";\nimport { useNewChat } from \"@/hooks/useNewChat\";\n\nexport default function AppPage() {\n  const router = useRouter();\n  const { isSignedIn, isLoaded: clerkLoaded } = useAuth();\n  const { isAuthenticated, isLoading: authLoading } = useConvexAuth();\n  const { startNewChat } = useNewChat();\n  const navigationStarted = useRef(false);\n\n  // Check if user exists in Convex (webhook sync)\n  // undefined = loading, null = not found (webhook failed), object = user exists\n  const convexUser = useQuery(\n    api.users.getCurrentUser,\n    isAuthenticated ? {} : \"skip\",\n  );\n\n  // Redirect unauthenticated users to sign-in (check Clerk auth first)\n  useEffect(() => {\n    if (clerkLoaded && !isSignedIn) {\n      router.push(\"/sign-in\");\n    }\n  }, [clerkLoaded, isSignedIn, router]);\n\n  // Navigate to chat when authenticated AND user exists in Convex\n  // Only proceed if Clerk auth is ready and user is signed in\n  useEffect(() => {\n    if (!clerkLoaded || !isSignedIn) return; // Wait for Clerk auth\n    if (authLoading || !isAuthenticated) return; // Wait for Convex auth\n    if (convexUser === undefined) return; // Still loading user data\n    if (convexUser === null) return; // User doesn't exist - show error (don't redirect)\n    if (navigationStarted.current) return; // Prevent double navigation\n\n    navigationStarted.current = true;\n    startNewChat();\n  }, [\n    clerkLoaded,\n    isSignedIn,\n    isAuthenticated,\n    authLoading,\n    convexUser,\n    startNewChat,\n  ]);\n\n  // Show error if authenticated but no Convex user (webhook failure)\n  if (isSignedIn && isAuthenticated && convexUser === null) {\n    return <UserSyncError />;\n  }\n\n  // Show loading while Clerk or Convex auth is initializing\n  if (!clerkLoaded || (isSignedIn && authLoading)) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <p className=\"text-muted-foreground\">Loading...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen\">\n      <Authenticated>\n        <p className=\"text-muted-foreground\">Loading...</p>\n      </Authenticated>\n      <Unauthenticated>\n        <p className=\"text-muted-foreground\">Redirecting to sign in...</p>\n      </Unauthenticated>\n    </div>\n  );\n}\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'm16 17 5-5-5-5', key: '1bji2h' }],\n  ['path', { d: 'M21 12H9', key: 'dn1m92' }],\n  ['path', { d: 'M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4', key: '1uf3rs' }],\n];\n\n/**\n * @component @name LogOut\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMTYgMTcgNS01LTUtNSIgLz4KICA8cGF0aCBkPSJNMjEgMTJIOSIgLz4KICA8cGF0aCBkPSJNOSAyMUg1YTIgMiAwIDAgMS0yLTJWNWEyIDIgMCAwIDEgMi0yaDQiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/log-out\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst LogOut = createLucideIcon('log-out', __iconNode);\n\nexport default LogOut;\n"],"names":[],"mappings":"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","ignoreList":[0,3]}