module.exports=[316852,a=>{"use strict";var b=a.i(367146),c=a.i(130487);a.i(16243);var d=a.i(182234),e=a.i(585291),f=a.i(698734),g=a.i(885737),h=a.i(116245),i=a.i(931282),j=a.i(452549);let k=(0,a.i(366705).default)("music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);var l=a.i(158540),m=a.i(901555),n=a.i(851943),o=a.i(689024),p=a.i(537500),q=a.i(134818),r=a.i(753884),s=a.i(353788),t=a.i(789884),u=a.i(23944),v=a.i(539524),w=a.i(351244),x=a.i(176013),y=a.i(700760);function z({chunk:a,isHighlighted:c}){let[d,e]=(0,p.useState)(!1),f=(0,p.useRef)(null);(0,p.useEffect)(()=>{c&&f.current&&(e(!0),setTimeout(()=>{f.current?.scrollIntoView({behavior:"smooth",block:"center"})},100))},[c]);let g=a.content.length>200,i=d?a.content:a.content.slice(0,200)+(g?"...":""),j=void 0!==a.startPage?a.startPage===a.endPage?`Page ${a.startPage}`:`Pages ${a.startPage}-${a.endPage}`:null;return(0,b.jsxs)("div",{ref:f,id:`chunk-${a._id}`,className:(0,y.cn)("border rounded-lg p-3 transition-all duration-300",c?"ring-2 ring-primary bg-primary/5 border-primary/50 chunk-highlight":"border-border/50 bg-muted/30 hover:bg-muted/50"),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,b.jsx)(h.FileText,{className:"h-3 w-3"}),(0,b.jsxs)("span",{className:"font-medium",children:["Chunk ",a.chunkIndex+1]}),j&&(0,b.jsx)("span",{className:"bg-muted px-1.5 py-0.5 rounded text-[10px]",children:j}),a.section&&(0,b.jsx)("span",{className:"text-[10px] truncate max-w-[100px]",children:a.section})]}),(0,b.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:[a.tokenCount," tokens"]})]}),(0,b.jsx)("div",{className:(0,y.cn)("text-sm font-mono bg-background/50 rounded p-2 whitespace-pre-wrap break-words",!d&&"line-clamp-4"),children:i}),g&&(0,b.jsx)("button",{type:"button",onClick:()=>e(!d),className:"mt-2 text-xs text-primary hover:underline flex items-center gap-1",children:d?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(x.ChevronUp,{className:"h-3 w-3"}),"Show less"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.ChevronDown,{className:"h-3 w-3"}),"Show more (",a.content.length-200," more chars)"]})})]})}function A({fileId:a,highlightChunkId:e,onClose:i}){var k;let l=(0,d.useQuery)(c.api.files.getFileWithChunks,{fileId:a});return void 0===l?(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,b.jsx)(j.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):null===l?(0,b.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center gap-2 text-muted-foreground",children:[(0,b.jsx)(f.AlertCircle,{className:"h-8 w-8"}),(0,b.jsx)("p",{children:"File not found"}),(0,b.jsx)(v.Button,{variant:"ghost",size:"sm",onClick:i,children:"Close"})]}):(0,b.jsxs)("div",{className:"flex flex-col h-full border-l bg-background",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,b.jsx)(h.FileText,{className:"h-5 w-5 text-muted-foreground shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("h2",{className:"font-medium truncate",children:l.name}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(k=l.size)<1024?`${k} B`:k<1048576?`${(k/1024).toFixed(1)} KB`:`${(k/1048576).toFixed(1)} MB`," • ",l.mimeType]})]})]}),(0,b.jsx)(v.Button,{variant:"ghost",size:"icon",onClick:i,children:(0,b.jsx)(u.X,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"p-4 border-b bg-muted/30",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"Status"}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5 mt-0.5",children:[(a=>{switch(a){case"completed":return(0,b.jsx)(g.CheckCircle2,{className:"h-4 w-4 text-green-500"});case"processing":return(0,b.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin text-blue-500"});case"failed":return(0,b.jsx)(f.AlertCircle,{className:"h-4 w-4 text-red-500"});default:return(0,b.jsx)(s.Clock,{className:"h-4 w-4 text-muted-foreground"})}})(l.embeddingStatus||"pending"),(0,b.jsx)("span",{children:(a=>{switch(a){case"completed":return"Indexed";case"processing":return"Processing...";case"failed":return"Failed";default:return"Pending"}})(l.embeddingStatus||"pending")})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"Chunks"}),(0,b.jsx)("p",{className:"mt-0.5",children:l.chunks?.length||0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"Added"}),(0,b.jsx)("p",{className:"mt-0.5",children:new Date(l.createdAt).toLocaleDateString()})]}),l.url&&(0,b.jsx)("div",{children:(0,b.jsxs)("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-primary hover:underline text-xs mt-0.5",children:[(0,b.jsx)(t.Download,{className:"h-3 w-3"}),"Download"]})})]}),l.embeddingError&&(0,b.jsx)("div",{className:"mt-3 p-2 bg-red-500/10 border border-red-500/20 rounded text-xs text-red-500",children:l.embeddingError})]}),(0,b.jsx)("div",{className:"flex-1 min-h-0 overflow-auto",children:(0,b.jsx)("div",{className:"p-4 space-y-3",children:l.chunks&&l.chunks.length>0?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:["Content Chunks (",l.chunks.length,")"]}),l.chunks.map(a=>(0,b.jsx)(z,{chunk:a,isHighlighted:e===a._id},a._id))]}):(0,b.jsxs)("div",{className:"text-center text-muted-foreground py-8",children:[(0,b.jsx)(h.FileText,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,b.jsx)("p",{className:"text-sm",children:"No content chunks available"}),(0,b.jsx)("p",{className:"text-xs mt-1",children:"pending"===l.embeddingStatus?"File is waiting to be processed":"processing"===l.embeddingStatus?"File is being processed...":"This file type may not support text extraction"})]})})})]})}var B=a.i(828288),C=a.i(592552),D=a.i(948217),E=a.i(477430);function F({status:a,chunkCount:c}){if(!a)return(0,b.jsxs)(E.Tooltip,{children:[(0,b.jsx)(E.TooltipTrigger,{children:(0,b.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-muted text-muted-foreground",children:"—"})}),(0,b.jsx)(E.TooltipContent,{children:"Not processed"})]});switch(a){case"pending":return(0,b.jsxs)(E.Tooltip,{children:[(0,b.jsx)(E.TooltipTrigger,{children:(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium bg-yellow-500/10 text-yellow-600 dark:text-yellow-400",children:[(0,b.jsx)(j.Loader2,{className:"w-2.5 h-2.5"}),"Pending"]})}),(0,b.jsx)(E.TooltipContent,{children:"Waiting to be processed"})]});case"processing":return(0,b.jsxs)(E.Tooltip,{children:[(0,b.jsx)(E.TooltipTrigger,{children:(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium bg-blue-500/10 text-blue-600 dark:text-blue-400",children:[(0,b.jsx)(j.Loader2,{className:"w-2.5 h-2.5 animate-spin"}),"Processing"]})}),(0,b.jsx)(E.TooltipContent,{children:"Extracting text and generating embeddings"})]});case"completed":return(0,b.jsxs)(E.Tooltip,{children:[(0,b.jsx)(E.TooltipTrigger,{children:(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium bg-green-500/10 text-green-600 dark:text-green-400",children:[(0,b.jsx)(g.CheckCircle2,{className:"w-2.5 h-2.5"}),"Ready"]})}),(0,b.jsx)(E.TooltipContent,{children:c?`${c} chunks indexed`:"Indexed and searchable"})]});case"failed":return(0,b.jsxs)(E.Tooltip,{children:[(0,b.jsx)(E.TooltipTrigger,{children:(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium bg-red-500/10 text-red-600 dark:text-red-400",children:[(0,b.jsx)(f.AlertCircle,{className:"w-2.5 h-2.5"}),"Failed"]})}),(0,b.jsx)(E.TooltipContent,{children:"Processing failed - file may not be searchable"})]})}}function G({params:a}){let{id:f}=(0,p.use)(a),[g,s]=(0,o.useQueryState)("file",o.parseAsString.withDefault("")),[t,u]=(0,o.useQueryState)("chunk",o.parseAsString.withDefault("")),w=(0,p.useMemo)(()=>g||null,[g]),x=(0,p.useMemo)(()=>t||null,[t]),z=(0,p.useCallback)(a=>{s(a||""),a||u("")},[s,u]),E=(0,d.useQuery)(c.api.projects.getProjectResources,{projectId:f}),G=(0,d.useQuery)(c.api.projects.getProjectAttachments,{projectId:f,paginationOpts:{numItems:50,cursor:null}}),H=(0,d.useMutation)(c.api.files.generateUploadUrl),I=(0,d.useMutation)(c.api.files.saveFile),J=(0,d.useMutation)(c.api.projects.addFileToProject);(0,d.useMutation)(c.api.files.deleteFile);let K=(0,d.useMutation)(c.api.projects.removeFileFromProject),[L,M]=(0,p.useState)(!1),[N,O]=(0,p.useState)(null),P=(0,p.useCallback)(async a=>{M(!0);try{for(let b of a){let a=await H(),c=await fetch(a,{method:"POST",headers:{"Content-Type":b.type},body:b}),{storageId:d}=await c.json(),e=await I({storageId:d,name:b.name,mimeType:b.type,size:b.size});await J({projectId:f,fileId:e})}r.toast.success("Files uploaded to project context")}catch(a){console.error(a),r.toast.error("Failed to upload files")}finally{M(!1)}},[H,I,J,f]),{getRootProps:Q,getInputProps:R,isDragActive:S}=(0,q.useDropzone)({onDrop:P}),T=a=>{if(0===a)return"0 B";let b=Math.floor(Math.log(a)/Math.log(1024));return`${parseFloat((a/1024**b).toFixed(1))} ${["B","KB","MB","GB","TB"][b]}`},U=a=>a.startsWith("image/")?(0,b.jsx)(i.ImageIcon,{className:"w-4 h-4 text-blue-500"}):a.startsWith("audio/")?(0,b.jsx)(k,{className:"w-4 h-4 text-purple-500"}):(0,b.jsx)(h.FileText,{className:"w-4 h-4 text-gray-500"}),V=E?.files||[],W=G?.page||[],X=(0,p.useMemo)(()=>!!w&&!!V.length&&V.some(a=>a._id===w),[w,V]);return(0,p.useEffect)(()=>{w&&V.length>0&&!X&&(s(null),u(null))},[w,V,X,s,u]),(0,b.jsxs)("div",{className:"h-full flex",children:[(0,b.jsxs)("div",{className:(0,y.cn)("flex-1 flex flex-col space-y-8 p-6 overflow-y-auto transition-all",w&&"max-w-[60%]"),children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-semibold tracking-tight",children:"Files"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Manage project context and view attachments from conversations."})]}),(0,b.jsxs)(C.Card,{children:[(0,b.jsxs)(C.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(C.CardTitle,{className:"text-lg",children:"Project Context"}),(0,b.jsx)(C.CardDescription,{children:"Files uploaded here are available as context for all project conversations."})]}),(0,b.jsxs)("div",{...Q(),children:[(0,b.jsx)("input",{...R()}),(0,b.jsxs)(v.Button,{disabled:L,size:"sm",children:[L?(0,b.jsx)(j.Loader2,{className:"w-4 h-4 animate-spin mr-2"}):(0,b.jsx)(l.Plus,{className:"w-4 h-4 mr-2"}),"Add File"]})]})]}),(0,b.jsxs)(C.CardContent,{children:[L&&(0,b.jsxs)("div",{className:"flex items-center justify-center p-8 border-2 border-dashed rounded-lg mb-4",children:[(0,b.jsx)(j.Loader2,{className:"w-6 h-6 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"ml-2 text-sm text-muted-foreground",children:"Uploading..."})]}),0!==V.length||L?(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(D.Table,{children:[(0,b.jsx)(D.TableHeader,{children:(0,b.jsxs)(D.TableRow,{children:[(0,b.jsx)(D.TableHead,{className:"w-[35%]",children:"Name"}),(0,b.jsx)(D.TableHead,{children:"Type"}),(0,b.jsx)(D.TableHead,{children:"Size"}),(0,b.jsx)(D.TableHead,{children:"Status"}),(0,b.jsx)(D.TableHead,{children:"Added"}),(0,b.jsx)(D.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(D.TableBody,{children:V.map(a=>(0,b.jsxs)(D.TableRow,{className:(0,y.cn)("cursor-pointer hover:bg-muted/50 transition-colors",w===a._id&&"bg-primary/10 hover:bg-primary/15"),onClick:()=>z(a._id),children:[(0,b.jsxs)(D.TableCell,{className:"font-medium flex items-center gap-2",children:[U(a.mimeType),a.name]}),(0,b.jsx)(D.TableCell,{className:"text-muted-foreground text-xs",children:a.mimeType}),(0,b.jsx)(D.TableCell,{className:"text-xs font-mono",children:T(a.size)}),(0,b.jsx)(D.TableCell,{children:(0,b.jsx)(F,{status:a.embeddingStatus,chunkCount:a.chunkCount})}),(0,b.jsx)(D.TableCell,{className:"text-muted-foreground text-xs",children:(0,e.format)(a.createdAt,"MMM d, yyyy")}),(0,b.jsx)(D.TableCell,{className:"text-right",children:(0,b.jsxs)(v.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-destructive",onClick:b=>{b.stopPropagation(),O({id:a._id,name:a.name})},children:[(0,b.jsx)("span",{className:"sr-only",children:"Remove"}),"×"]})})]},a._id))})]})}):(0,b.jsxs)("div",{...Q(),className:`flex flex-col items-center justify-center p-12 border-2 border-dashed rounded-lg cursor-pointer transition-colors ${S?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary/50"}`,children:[(0,b.jsx)("input",{...R()}),(0,b.jsx)(m.Upload,{className:"w-8 h-8 text-muted-foreground mb-4"}),(0,b.jsx)("p",{className:"text-sm font-medium",children:"Drag & drop context files here, or click to select"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"PDF, TXT, MD, Images (Max 10MB)"})]})]})]}),(0,b.jsxs)(C.Card,{children:[(0,b.jsxs)(C.CardHeader,{children:[(0,b.jsx)(C.CardTitle,{className:"text-lg",children:"Conversation Attachments"}),(0,b.jsx)(C.CardDescription,{children:"Files attached to conversations linked to this project."})]}),(0,b.jsx)(C.CardContent,{children:0===W.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground italic text-sm",children:"No attachments found in linked conversations."}):(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(D.Table,{children:[(0,b.jsx)(D.TableHeader,{children:(0,b.jsxs)(D.TableRow,{children:[(0,b.jsx)(D.TableHead,{className:"w-[40%]",children:"Name"}),(0,b.jsx)(D.TableHead,{children:"Type"}),(0,b.jsx)(D.TableHead,{children:"Size"}),(0,b.jsx)(D.TableHead,{children:"Conversation"}),(0,b.jsx)(D.TableHead,{children:"Date"})]})}),(0,b.jsx)(D.TableBody,{children:W.map(a=>(0,b.jsxs)(D.TableRow,{children:[(0,b.jsxs)(D.TableCell,{className:"font-medium flex items-center gap-2",children:[U(a.mimeType),a.name]}),(0,b.jsx)(D.TableCell,{className:"text-muted-foreground text-xs",children:a.mimeType}),(0,b.jsx)(D.TableCell,{className:"text-xs font-mono",children:T(a.size)}),(0,b.jsx)(D.TableCell,{children:a.conversationId&&(0,b.jsx)(n.default,{href:`/chat/${a.conversationId}`,className:"text-xs text-primary hover:underline",children:"View Chat"})}),(0,b.jsx)(D.TableCell,{className:"text-muted-foreground text-xs",children:(0,e.format)(a.createdAt,"MMM d, yyyy")})]},a._id))})]})})})]})]}),w&&(0,b.jsx)("div",{className:"w-[40%] min-w-[350px] h-full overflow-hidden",children:(0,b.jsx)(A,{fileId:w,highlightChunkId:x,onClose:()=>z(null)})}),(0,b.jsx)(B.AlertDialog,{open:!!N,onOpenChange:a=>!a&&O(null),children:(0,b.jsxs)(B.AlertDialogContent,{children:[(0,b.jsxs)(B.AlertDialogHeader,{children:[(0,b.jsx)(B.AlertDialogTitle,{children:"Remove file from project?"}),(0,b.jsxs)(B.AlertDialogDescription,{children:["This will remove"," ",(0,b.jsx)("span",{className:"font-medium",children:N?.name})," from the project context. The file will no longer be available for AI conversations in this project."]})]}),(0,b.jsxs)(B.AlertDialogFooter,{children:[(0,b.jsx)(B.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(B.AlertDialogAction,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:async()=>{N&&(await K({projectId:f,fileId:N.id}),r.toast.success("File removed from project"),O(null))},children:"Remove"})]})]})})]})}a.s(["default",()=>G],316852)}];

//# sourceMappingURL=apps_web_src_app_%28main%29_projects_%5Bid%5D_files_page_tsx_0e5c8c0b._.js.map