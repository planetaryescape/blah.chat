module.exports=[17113,a=>{"use strict";var b=a.i(367146),c=a.i(537500),d=a.i(353788),e=a.i(971310),f=a.i(968177),g=a.i(539524),h=a.i(592552),i=a.i(276670),j=a.i(452309);function k({recentSearches:a,isLoading:c=!1,onSelectSearch:k,onClearRecent:l}){return c?(0,b.jsxs)("div",{className:"space-y-3 mt-7",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4 pr-5",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 px-5",children:[(0,b.jsx)(j.Skeleton,{className:"w-4 h-5"}),(0,b.jsx)(j.Skeleton,{className:"w-32 h-5"})]}),(0,b.jsx)(j.Skeleton,{className:"w-18 h-6"})]}),(0,b.jsx)("div",{className:"space-y-2",children:["skeleton-1","skeleton-2","skeleton-3"].map(a=>(0,b.jsx)(j.Skeleton,{className:"w-full h-10"},a))})]}):0===a.length?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(d.Clock,{className:"w-12 h-12 mx-auto text-muted-foreground/50 mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No recent searches yet"}),(0,b.jsx)("p",{className:"text-muted-foreground/70 text-xs mt-1",children:"Your search history will appear here"})]}):(0,b.jsxs)(h.Card,{className:"border-border/40 bg-background/50 backdrop-blur-sm",children:[(0,b.jsx)(h.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(h.CardTitle,{className:"text-sm font-medium flex items-center gap-2",children:[(0,b.jsx)(d.Clock,{className:"w-4 h-4"}),"Recent Searches"]}),(0,b.jsxs)(g.Button,{variant:"ghost",size:"sm",onClick:l,className:"h-7 px-2 text-xs text-muted-foreground hover:text-destructive",children:[(0,b.jsx)(e.Trash2,{className:"w-3 h-3 mr-1"}),"Clear"]})]})}),(0,b.jsxs)(h.CardContent,{className:"relative",children:[(0,b.jsx)(i.ScrollArea,{className:"max-h-[400px]",children:(0,b.jsx)("div",{className:"space-y-1 pr-4",children:a.map(a=>(0,b.jsxs)("button",{type:"button",onClick:()=>k(a),className:"w-full flex items-center justify-between px-3 py-2 rounded-md hover:bg-muted/50 transition-colors group text-left",children:[(0,b.jsx)("span",{className:"text-sm truncate flex-1 font-mono",children:a}),(0,b.jsx)(f.Badge,{variant:"secondary",className:"text-[10px] opacity-0 group-hover:opacity-100 transition-opacity",children:"Search"})]},a))})}),(0,b.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-card to-transparent pointer-events-none"})]})]})}var l=a.i(452549),m=a.i(286028),n=a.i(23944),o=a.i(928503),p=a.i(700760);function q({value:a,onChange:d,isSearching:e=!1,placeholder:f="Search conversations...",autoFocus:h=!1}){let i=(0,c.useRef)(null);return(0,c.useEffect)(()=>{let a=a=>{let b=a.target,c="INPUT"===b.tagName||"TEXTAREA"===b.tagName;"/"!==a.key||c||(a.preventDefault(),i.current?.focus()),"Escape"===a.key&&i.current===document.activeElement&&(a.preventDefault(),d(""),i.current?.blur())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[d]),(0,b.jsx)("div",{className:"relative group max-w-xl mx-auto",children:(0,b.jsxs)("div",{className:"relative flex items-center",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none z-10",children:e?(0,b.jsx)(l.Loader2,{className:"w-4 h-4 text-primary animate-spin"}):(0,b.jsx)(m.Search,{className:"w-4 h-4 text-muted-foreground/60 group-focus-within:text-foreground transition-colors duration-200"})}),(0,b.jsx)(o.Input,{ref:i,value:a,onChange:a=>d(a.target.value),placeholder:f,autoFocus:h,className:(0,p.cn)("pl-9 pr-9 h-10 text-sm font-medium shadow-sm","bg-background/50 border-transparent","hover:bg-background/80 hover:border-border/40","focus:bg-background focus:border-primary/20","focus:ring-2 focus:ring-primary/10","rounded-lg transition-all duration-200","placeholder:text-muted-foreground/50")}),a&&(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",onClick:()=>{d(""),i.current?.focus()},className:"absolute right-1 top-1/2 -translate-y-1/2 h-8 w-8 hover:bg-transparent text-muted-foreground/40 hover:text-foreground",children:(0,b.jsx)(n.X,{className:"w-3.5 h-3.5"})})]}),(0,b.jsx)("div",{className:"absolute right-12 top-1/2 -translate-y-1/2 hidden sm:flex items-center gap-1 pointer-events-none",children:(0,b.jsx)("kbd",{className:"inline-flex h-5 select-none items-center gap-1 rounded border bg-muted/50 px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:"/"})})]})})}var r=a.i(130487);a.i(16243);var s=a.i(182234),t=a.i(648615),u=a.i(359275),v=a.i(687336),w=a.i(118747),x=a.i(158540),y=a.i(863116),z=a.i(371135),A=a.i(658547),B=a.i(165004),C=a.i(812911),D=a.i(638600);let E=[{label:"Today",value:"today"},{label:"Last 7 days",value:"7days"},{label:"Last 30 days",value:"30days"},{label:"Last 90 days",value:"90days"}];function F({filters:a,onClearFilters:d,hasActiveFilters:e,onFilterChange:h}){let[i,j]=(0,c.useState)(""),k=function(a,b){let[d,e]=(0,c.useState)(a);return(0,c.useEffect)(()=>{let b=setTimeout(()=>e(a),300);return()=>clearTimeout(b)},[a,300]),d}(i,0),l=(0,s.useQuery)(r.api.conversations.list,{searchQuery:k||void 0,limit:20}),[m,n]=(0,c.useState)("all"),[o,p]=(0,c.useState)(a.messageType||"all"),q=[a.conversationId,a.dateFrom,a.messageType].filter(Boolean).length;return(0,b.jsx)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap flex-1",children:[(0,b.jsxs)(B.Popover,{children:[(0,b.jsx)(B.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",className:"gap-2 whitespace-nowrap h-7 text-xs",children:[(0,b.jsx)(x.Plus,{className:"w-3 h-3"}),"Filters",q>0&&(0,b.jsx)(f.Badge,{variant:"secondary",className:"ml-1 h-5 min-w-5 px-1.5 text-[10px]",children:q})]})}),(0,b.jsx)(B.PopoverContent,{className:"w-80 p-4",align:"start",side:"bottom",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h4",{className:"font-medium text-sm",children:"Filter Search Results"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(A.Label,{className:"text-xs flex items-center gap-2",children:[(0,b.jsx)(v.MessageSquare,{className:"w-3.5 h-3.5"}),"Conversation"]}),(0,b.jsxs)(B.Popover,{children:[(0,b.jsx)(B.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",className:"w-full justify-start text-left font-normal",children:[(0,b.jsx)(v.MessageSquare,{className:"w-3.5 h-3.5 mr-2"}),a.conversationId?l?.find(b=>b._id===a.conversationId)?.title||"Unknown":"All conversations"]})}),(0,b.jsx)(B.PopoverContent,{className:"w-[300px] p-0",align:"start",children:(0,b.jsxs)(z.Command,{children:[(0,b.jsx)(z.CommandInput,{placeholder:"Search conversations...",value:i,onValueChange:j}),(0,b.jsxs)(z.CommandList,{children:[(0,b.jsx)(z.CommandEmpty,{children:i?`No conversations matching "${i}"`:"No conversations yet"}),(0,b.jsxs)(z.CommandGroup,{heading:i?"Search Results":"Recent Conversations",children:[(0,b.jsx)(z.CommandItem,{value:"all",onSelect:()=>{h("conversationId",null),j(""),D.analytics.track("search_filter_applied",{filterType:"conversation"})},children:"All conversations"}),!l&&(0,b.jsx)(z.CommandItem,{disabled:!0,children:"Loading conversations..."}),l?.map(a=>(0,b.jsxs)(z.CommandItem,{value:a._id,onSelect:()=>{h("conversationId",a._id),j(""),D.analytics.track("search_filter_applied",{filterType:"conversation"})},children:[a.pinned&&(0,b.jsx)(w.Pin,{className:"w-3 h-3 mr-2 text-muted-foreground"}),(0,b.jsx)("span",{className:"truncate",children:a.title||"Untitled"})]},a._id))]})]})]})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(A.Label,{className:"text-xs flex items-center gap-2",children:[(0,b.jsx)(u.Calendar,{className:"w-3.5 h-3.5"}),"Date Range"]}),(0,b.jsxs)(C.RadioGroup,{value:m,onValueChange:a=>{if(n(a),"all"===a){h("dateFrom",null),h("dateTo",null),D.analytics.track("search_filter_applied",{filterType:"date_range"});return}let b=Date.now(),c=b;switch(a){case"today":c=new Date().setHours(0,0,0,0);break;case"7days":c=b-6048e5;break;case"30days":c=b-2592e6;break;case"90days":c=b-7776e6}h("dateFrom",c.toString()),h("dateTo",b.toString()),D.analytics.track("search_filter_applied",{filterType:"date_range"})},children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(C.RadioGroupItem,{value:"all",id:"date-all"}),(0,b.jsx)(A.Label,{htmlFor:"date-all",className:"text-sm cursor-pointer",children:"All time"})]}),E.map(a=>(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(C.RadioGroupItem,{value:a.value,id:`date-${a.value}`}),(0,b.jsx)(A.Label,{htmlFor:`date-${a.value}`,className:"text-sm cursor-pointer",children:a.label})]},a.value))]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(A.Label,{className:"text-xs",children:"Message Type"}),(0,b.jsxs)(C.RadioGroup,{value:o,onValueChange:a=>{p(a),"all"===a?h("messageType",null):h("messageType",a),D.analytics.track("search_filter_applied",{filterType:"message_type"})},children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(C.RadioGroupItem,{value:"all",id:"type-all"}),(0,b.jsx)(A.Label,{htmlFor:"type-all",className:"text-sm cursor-pointer",children:"All messages"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(C.RadioGroupItem,{value:"user",id:"type-user"}),(0,b.jsxs)(A.Label,{htmlFor:"type-user",className:"text-sm cursor-pointer flex items-center gap-2",children:[(0,b.jsx)(y.User,{className:"w-3.5 h-3.5"}),"User messages"]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(C.RadioGroupItem,{value:"assistant",id:"type-assistant"}),(0,b.jsxs)(A.Label,{htmlFor:"type-assistant",className:"text-sm cursor-pointer flex items-center gap-2",children:[(0,b.jsx)(t.Bot,{className:"w-3.5 h-3.5"}),"AI responses"]})]})]})]})]})})]}),q>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"h-6 w-px bg-border"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Active:"}),a.conversationId&&(0,b.jsx)(G,{label:"Conversation",value:l?.find(b=>b._id===a.conversationId)?.title||"Unknown",onRemove:()=>d()}),a.dateFrom&&(0,b.jsx)(G,{label:"Date Range",value:"Custom",onRemove:()=>d()}),a.messageType&&(0,b.jsx)(G,{label:"Type",value:"user"===a.messageType?"User Messages":"AI Responses",onRemove:()=>d()}),(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:d,className:"h-7 text-xs",children:"Clear all"})]})]})]})})}function G({label:a,value:c,onRemove:d}){return(0,b.jsxs)(f.Badge,{variant:"secondary",className:"h-7 pl-2 pr-1 text-xs gap-1 bg-primary/10 text-primary border-primary/20",children:[(0,b.jsxs)("span",{className:"font-medium",children:[a,":"]}),(0,b.jsx)("span",{className:"truncate max-w-[100px]",children:c}),(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:d,className:"h-4 w-4 p-0 hover:bg-primary/20 ml-1",children:(0,b.jsx)(n.X,{className:"w-3 h-3"})})]})}function H({children:a}){return(0,b.jsx)("div",{className:(0,p.cn)("bg-background/80 backdrop-blur-md border-b border-border/40 shadow-sm"),children:(0,b.jsxs)("div",{className:"container mx-auto max-w-6xl px-4 py-4",children:[(0,b.jsxs)("div",{className:"mb-6 space-y-1",children:[(0,b.jsx)("h1",{className:"text-xl font-bold tracking-tight",children:"Search"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Find anything across all your conversations"})]}),a]})})}var I=a.i(509423),J=a.i(35302),K=a.i(529395),L=a.i(851943),M=a.i(468106),N=a.i(553812),O=a.i(127718),P=a.i(54797),Q=a.i(753884),R=a.i(828288);function S({open:a,onOpenChange:c,title:d,description:e,onConfirm:f,confirmLabel:g="Confirm",destructive:h=!1}){return(0,b.jsx)(R.AlertDialog,{open:a,onOpenChange:c,children:(0,b.jsxs)(R.AlertDialogContent,{children:[(0,b.jsxs)(R.AlertDialogHeader,{children:[(0,b.jsx)(R.AlertDialogTitle,{children:d}),(0,b.jsx)(R.AlertDialogDescription,{children:e})]}),(0,b.jsxs)(R.AlertDialogFooter,{children:[(0,b.jsx)(R.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(R.AlertDialogAction,{onClick:f,className:h?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"",children:g})]})]})})}function T({selectedCount:a,selectedMessages:d,onClearSelection:h,onActionComplete:i}){let j=(0,s.useMutation)(r.api.conversations.bulkDelete),k=(0,s.useMutation)(r.api.conversations.bulkArchive),l=(0,s.useMutation)(r.api.bookmarks.bulkCreate),[m,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(!1),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(!1),x=(0,c.useMemo)(()=>Array.from(new Set(d.map(a=>a.conversationId))),[d]),y=async()=>{q(!0);try{await j({conversationIds:x}),Q.toast.success(`Deleted ${x.length} conversation(s)`),i(),h()}catch(a){Q.toast.error("Failed to delete conversations"),console.error(a)}finally{q(!1),o(!1)}},z=async()=>{u(!0);try{await k({conversationIds:x}),Q.toast.success(`Archived ${x.length} conversation(s)`),i(),h()}catch(a){Q.toast.error("Failed to archive conversations"),console.error(a)}finally{u(!1)}},A=async()=>{w(!0);try{let a=await l({messageIds:d.map(a=>a._id)});Q.toast.success(`Bookmarked ${a.bookmarkedCount} message(s)`),h()}catch(a){Q.toast.error("Failed to bookmark messages"),console.error(a)}finally{w(!1)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"sticky top-0 z-10 bg-background/95 backdrop-blur border-b p-3 mb-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,b.jsxs)(f.Badge,{variant:"secondary",className:"text-sm",children:[a," selected"]}),(0,b.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,b.jsxs)(g.Button,{variant:"destructive",size:"sm",onClick:()=>{o(!0)},disabled:p,children:[(0,b.jsx)(e.Trash2,{className:"w-3.5 h-3.5 mr-1"}),"Delete (",x.length," conv)"]}),(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:z,disabled:t,children:[(0,b.jsx)(N.Archive,{className:"w-3.5 h-3.5 mr-1"}),"Archive (",x.length," conv)"]}),(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:A,disabled:v,children:[(0,b.jsx)(O.Bookmark,{className:"w-3.5 h-3.5 mr-1"}),"Bookmark"]}),(0,b.jsxs)(g.Button,{variant:"ghost",size:"sm",onClick:()=>{let b=d.map(a=>`[${a.role}] ${a.content}`).join("\n\n---\n\n");navigator.clipboard.writeText(b),Q.toast.success(`Copied ${a} message(s) to clipboard`),h()},children:[(0,b.jsx)(P.Copy,{className:"w-3.5 h-3.5 mr-1"}),"Copy text"]})]}),(0,b.jsxs)(g.Button,{variant:"ghost",size:"sm",onClick:h,className:"ml-auto",children:[(0,b.jsx)(n.X,{className:"w-3.5 h-3.5 mr-1"}),"Clear"]})]})}),(0,b.jsx)(S,{open:m,onOpenChange:o,title:"Delete conversations?",description:`This will permanently delete ${x.length} conversation(s) and all their messages. This action cannot be undone.`,onConfirm:y,confirmLabel:"Delete",destructive:!0})]})}var U=a.i(240695);let V=(0,a.i(366705).default)("search-x",[["path",{d:"m13.5 8.5-5 5",key:"1cs55j"}],["path",{d:"m8.5 8.5 5 5",key:"a8mexj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);var W=a.i(651386);function X({query:a,hasFilters:c=!1,onClearFilters:d}){return(0,b.jsx)(h.Card,{className:"border-dashed border-2 border-border/40 bg-transparent",children:(0,b.jsxs)(h.CardContent,{className:"flex flex-col items-center justify-center py-12 px-6 text-center",children:[(0,b.jsxs)("div",{className:"relative mb-4",children:[(0,b.jsx)(V,{className:"w-16 h-16 text-muted-foreground/50"}),(0,b.jsx)("div",{className:"absolute -right-2 -top-2 w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-xl",children:"ðŸ˜•"})})]}),(0,b.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No results found"}),(0,b.jsxs)("p",{className:"text-muted-foreground mb-6 max-w-md",children:["No messages match"," ",(0,b.jsxs)("span",{className:"font-mono font-semibold",children:['"',a,'"']})]}),(0,b.jsxs)("div",{className:"space-y-3 w-full max-w-sm",children:[(0,b.jsxs)("div",{className:"text-xs text-muted-foreground text-left space-y-2",children:[(0,b.jsx)("p",{className:"font-medium",children:"Suggestions:"}),(0,b.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[(0,b.jsx)("li",{children:"Check spelling and try different keywords"}),!c&&(0,b.jsxs)("li",{className:"flex items-center gap-1",children:["Try ",(0,b.jsx)(W.Sparkles,{className:"w-3 h-3 inline text-primary"})," ",(0,b.jsx)("span",{className:"font-medium",children:"Hybrid Search"})," in settings"]}),c&&(0,b.jsx)("li",{children:"Remove filters to broaden search"}),(0,b.jsx)("li",{children:"Search for common words or phrases"})]})]}),c&&d&&(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:d,className:"w-full",children:[(0,b.jsx)(U.Filter,{className:"w-3 h-3 mr-2"}),"Clear Filters"]})]})]})})}function Y(){return(0,b.jsxs)(h.Card,{className:"animate-pulse border-border/40 bg-background/50",children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"h-5 w-32 bg-muted/50 rounded-full"}),(0,b.jsx)("div",{className:"h-6 w-3/4 bg-muted rounded"}),(0,b.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,b.jsx)("div",{className:"h-3 w-24 bg-muted/70 rounded"}),(0,b.jsx)("div",{className:"h-3 w-16 bg-muted/70 rounded"})]})]})}),(0,b.jsx)(h.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"h-4 w-full bg-muted/70 rounded"}),(0,b.jsx)("div",{className:"h-4 w-5/6 bg-muted/70 rounded"})]})})]})}function Z({count:a=6}){return(0,b.jsx)("div",{className:"space-y-4",children:Array.from({length:a},(a,c)=>(0,b.jsx)("div",{style:{animationDelay:`${75*c}ms`},children:(0,b.jsx)(Y,{})},c))})}function $({results:a,isLoading:d,query:e,hasMore:f=!1,onLoadMore:h,hasFilters:i=!1,onClearFilters:j,selectedCount:k=0,isSelected:m,toggleSelection:n,selectAll:o,clearSelection:p,onRefresh:q}){let r=(0,c.useRef)(null);return((0,c.useEffect)(()=>{if(!r.current||!f||d||!h)return;let a=new IntersectionObserver(([a])=>{a.isIntersecting&&h()},{rootMargin:"200px"});return a.observe(r.current),()=>{a.disconnect()}},[f,d,h]),d&&0===a.length)?(0,b.jsx)(Z,{count:6}):!d&&0===a.length&&e?(0,b.jsx)(X,{query:e,hasFilters:i,onClearFilters:j}):(0,b.jsxs)("div",{className:"space-y-6",children:[k>0&&o&&p&&m&&n&&q&&(0,b.jsx)(T,{selectedCount:k,selectedMessages:a.filter(a=>m(a._id)),onClearSelection:p,onActionComplete:q}),a.length>0&&o&&p&&m&&(0,b.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-muted/30 rounded-lg",children:[(0,b.jsx)(M.Checkbox,{checked:k>0&&k===a.length,onCheckedChange:b=>{b?o(a.map(a=>a._id)):p()}}),(0,b.jsxs)(A.Label,{className:"text-sm text-muted-foreground cursor-pointer",children:["Select all ",a.length," result",1===a.length?"":"s"]})]}),a.length>0&&(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Found ",a.length," result",1===a.length?"":"s",f&&" (showing first batch)"]})}),(0,b.jsx)("div",{className:"border border-border/40 rounded-lg overflow-hidden bg-muted/5",children:(0,b.jsx)(K.motion.div,{className:"divide-y divide-border/40",variants:{hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.02}}},initial:"hidden",animate:"show",children:a.map((a,c)=>(0,b.jsx)(K.motion.div,{variants:{hidden:{opacity:0,y:10},show:{opacity:1,y:0,transition:{duration:.2}}},children:(0,b.jsx)(_,{message:a,query:e,index:c,isSelected:!!m&&m(a._id),onToggleSelection:n||(()=>{})})},a._id))})}),f&&(0,b.jsx)("div",{ref:r,className:"flex justify-center py-8",children:d?(0,b.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,b.jsx)(l.Loader2,{className:"w-4 h-4 animate-spin"}),(0,b.jsx)("span",{className:"text-sm",children:"Loading more results..."})]}):(0,b.jsx)(g.Button,{variant:"outline",size:"lg",onClick:h,className:"min-w-[200px]",children:"Load More Results"})})]})}function _({message:a,query:c,index:d,isSelected:e,onToggleSelection:f}){let g=(0,s.useQuery)(r.api.conversations.get,a.conversationId?{conversationId:a.conversationId}:"skip"),h=function(a,b){let c=(a??"").trim().replace(/^\s+/gm,"").replace(/\n{3,}/g,"\n\n");if(!b?.trim())return J.default.sanitize(c);let d=b?.trim().split(/\s+/)??[],e=c;return d.forEach(a=>{if(a.length<2)return;let b=RegExp(`(${a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");e=e.replace(b,'<mark class="bg-yellow-200 dark:bg-yellow-900">$1</mark>')}),J.default.sanitize(e,{ALLOWED_TAGS:["mark"],ALLOWED_ATTR:["class"]})}(a.content,c);return(0,b.jsxs)("div",{className:"relative group/item z-0",children:[e&&(0,b.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-[3px] bg-primary z-20"}),(0,b.jsx)("div",{className:(0,p.cn)("w-full text-left px-4 py-3.5 transition-colors duration-200 border-b border-border/40",e?"bg-accent/50":"hover:bg-muted/30"),children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{onClick:a=>a.preventDefault(),className:"pt-1 opacity-10 group-hover/item:opacity-100 transition-opacity",children:(0,b.jsx)(M.Checkbox,{checked:e,onCheckedChange:()=>f(a._id),className:"h-4 w-4 border-muted-foreground/40 data-[state=checked]:border-primary"})}),(0,b.jsxs)(L.default,{href:`/chat/${a.conversationId}?messageId=${a._id}#message-${a._id}`,className:"flex-1 min-w-0 block",onClick:()=>{D.analytics.track("search_result_clicked",{resultPosition:d})},children:[(0,b.jsxs)("div",{className:"flex items-baseline justify-between gap-2 mb-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,b.jsx)("h3",{className:(0,p.cn)("text-[13px] truncate font-medium",e?"text-foreground":"text-foreground/90"),children:g?.title||"Untitled Conversation"}),(0,b.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] bg-muted/50 text-muted-foreground font-medium uppercase tracking-wider",children:"user"===a.role?"You":"AI"})]}),(0,b.jsx)("span",{className:"text-[10px] text-muted-foreground/60 shrink-0 tabular-nums",children:a.createdAt?(0,I.formatDistanceToNow)(a.createdAt,{addSuffix:!0}):""})]}),(0,b.jsx)("div",{className:"pr-8",children:(0,b.jsx)("p",{className:(0,p.cn)("text-[12px] line-clamp-2 leading-relaxed text-muted-foreground/70",e?"text-muted-foreground/90":""),dangerouslySetInnerHTML:{__html:h}})})]})]})})]})}var aa=a.i(247028),ab=a.i(689024);function ac(){let{filters:a,setFilter:d,clearFilters:e,hasActiveFilters:f}=function(){let[a,b]=(0,ab.useQueryStates)({conversation:ab.parseAsString,from:ab.parseAsInteger,to:ab.parseAsInteger,type:(0,ab.parseAsStringLiteral)(["user","assistant"])});return{filters:(0,c.useMemo)(()=>({conversationId:a.conversation?a.conversation:void 0,dateFrom:a.from??void 0,dateTo:a.to??void 0,messageType:a.type??void 0}),[a]),setFilter:(a,c)=>{b({[({conversationId:"conversation",dateFrom:"from",dateTo:"to",messageType:"type"})[a]]:c})},clearFilters:()=>{b({conversation:null,from:null,to:null,type:null})},hasActiveFilters:Object.values(a).some(a=>null!==a)}}(),{queryParam:g,setQueryParam:h,debouncedQuery:j,page:l,setPage:m}=function(){let[a,b]=(0,ab.useQueryState)("q",ab.parseAsString.withDefault("")),[c]=(0,aa.useDebounceValue)(a,350),[d,e]=(0,ab.useQueryState)("page",ab.parseAsInteger.withDefault(1));return{queryParam:a,setQueryParam:b,debouncedQuery:c,page:d,setPage:e}}(),{results:n,isSearching:o,hasMore:p}=function(a,b,d){let[e,f]=(0,c.useState)([]),[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)(!1),k=(0,s.useAction)(r.api.search.hybridSearch);return(0,c.useEffect)(()=>{let c=a?.trim()??"";if(!c){f([]),h(!1),j(!1);return}(async()=>{h(!0);try{let a=20*d,e=await k({query:c,limit:a,conversationId:b.conversation,dateFrom:b.from?Number(b.from):void 0,dateTo:b.to?Number(b.to):void 0,messageType:b.type??void 0});f(e),j(e.length===a)}catch(a){console.error("Search failed:",a),f([]),j(!1)}finally{h(!1)}})()},[a,b.conversation,b.from,b.to,b.type,d,k]),{results:e,isSearching:g,hasMore:i}}(j,{conversation:a.conversationId,from:a.dateFrom,to:a.dateTo,type:a.messageType},l),{recentSearches:t,isLoading:u,addSearch:v,clearRecent:w}=function(){let[a,b]=(0,aa.useLocalStorage)("blah-chat-recent-searches",[]);return{recentSearches:a,isLoading:!1,addSearch:a=>{let c=a.trim();c&&!(c.length<2)&&b(a=>{let b=a.filter(a=>a!==c);return[c,...b].slice(0,6)})},clearRecent:()=>{b([])}}}(),{selectedCount:x,toggleSelection:y,selectAll:z,clearSelection:A,isSelected:B}=function(){let[a,b]=(0,c.useState)(new Set),d=(0,c.useCallback)(a=>{b(b=>{let c=new Set(b);return c.has(a)?c.delete(a):c.add(a),c})},[]),e=(0,c.useCallback)(a=>{b(new Set(a))},[]),f=(0,c.useCallback)(()=>b(new Set),[]),g=(0,c.useCallback)(b=>a.has(b),[a]);return{selectedIds:Array.from(a),selectedCount:a.size,toggleSelection:d,selectAll:e,clearSelection:f,isSelected:g}}();(0,c.useEffect)(()=>{A()},[A]),(0,c.useEffect)(()=>{l>1&&m(1)},[l,m]);let C=(0,c.useRef)("");(0,c.useEffect)(()=>{j&&n.length>0&&!o&&j!==C.current&&(v(j),C.current=j,D.analytics.track("global_search_performed",{queryText:j,searchType:"hybrid",resultsCount:n.length,filterApplied:f?"active":void 0}))},[j,n.length,o,v,f]);let E=()=>{e()};return(0,b.jsxs)("div",{className:"h-[calc(100vh-theme(spacing.16))] flex flex-col relative bg-background overflow-hidden",children:[(0,b.jsx)("div",{className:"flex-none z-50",children:(0,b.jsx)(H,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(q,{value:g,onChange:h,isSearching:o,autoFocus:!0}),(0,b.jsx)(F,{filters:a,onClearFilters:E,hasActiveFilters:f,onFilterChange:d})]})})}),(0,b.jsx)(i.ScrollArea,{className:"flex-1 w-full min-h-0",children:(0,b.jsxs)("div",{className:"container mx-auto max-w-6xl px-4 py-8 relative",children:[!j&&!g&&(0,b.jsx)(k,{recentSearches:t,isLoading:u,onSelectSearch:a=>{h(a)},onClearRecent:w}),(j||g)&&(0,b.jsx)($,{results:n,isLoading:o,query:j,hasMore:p,onLoadMore:()=>{m(l+1)},hasFilters:f,onClearFilters:E,selectedCount:x,isSelected:B,toggleSelection:y,selectAll:z,clearSelection:A,onRefresh:()=>{A()}})]})})]})}function ad(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(ae,{}),children:(0,b.jsx)(ac,{})})}function ae(){return(0,b.jsx)("div",{className:"h-[calc(100vh-theme(spacing.16))] flex flex-col relative bg-background overflow-hidden",children:(0,b.jsx)("div",{className:"flex-none z-50 p-6",children:(0,b.jsx)("div",{className:"h-12 bg-muted/50 rounded-lg animate-pulse"})})})}a.s(["default",()=>ad],17113)}];

//# sourceMappingURL=apps_web_src_app_%28main%29_search_page_tsx_51ba59ba._.js.map