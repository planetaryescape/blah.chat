{"version":3,"sources":["../../../../../../node_modules/.bun/zustand%405.0.9%2Bbf1b4fba7aab5d1a/node_modules/zustand/esm/react.mjs","../../../../../../node_modules/.bun/zustand%405.0.9%2Bbf1b4fba7aab5d1a/node_modules/zustand/esm/vanilla.mjs","../../../../../../apps/web/src/stores/templateStore.ts","../../../../../../apps/web/src/components/chat/MessageListSkeleton.tsx","../../../../../../apps/web/src/app/%28main%29/chat/page.tsx"],"sourcesContent":["import React from 'react';\nimport { createStore } from 'zustand/vanilla';\n\nconst identity = (arg) => arg;\nfunction useStore(api, selector = identity) {\n  const slice = React.useSyncExternalStore(\n    api.subscribe,\n    React.useCallback(() => selector(api.getState()), [api, selector]),\n    React.useCallback(() => selector(api.getInitialState()), [api, selector])\n  );\n  React.useDebugValue(slice);\n  return slice;\n}\nconst createImpl = (createState) => {\n  const api = createStore(createState);\n  const useBoundStore = (selector) => useStore(api, selector);\n  Object.assign(useBoundStore, api);\n  return useBoundStore;\n};\nconst create = ((createState) => createState ? createImpl(createState) : createImpl);\n\nexport { create, useStore };\n","const createStoreImpl = (createState) => {\n  let state;\n  const listeners = /* @__PURE__ */ new Set();\n  const setState = (partial, replace) => {\n    const nextState = typeof partial === \"function\" ? partial(state) : partial;\n    if (!Object.is(nextState, state)) {\n      const previousState = state;\n      state = (replace != null ? replace : typeof nextState !== \"object\" || nextState === null) ? nextState : Object.assign({}, state, nextState);\n      listeners.forEach((listener) => listener(state, previousState));\n    }\n  };\n  const getState = () => state;\n  const getInitialState = () => initialState;\n  const subscribe = (listener) => {\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  };\n  const api = { setState, getState, getInitialState, subscribe };\n  const initialState = state = createState(setState, getState, api);\n  return api;\n};\nconst createStore = ((createState) => createState ? createStoreImpl(createState) : createStoreImpl);\n\nexport { createStore };\n","import { create } from \"zustand\";\n\ninterface TemplateStore {\n  /**\n   * The template prompt text to be inserted into chat input.\n   * Stored here temporarily when navigating from templates page to chat.\n   */\n  pendingTemplateText: string | null;\n\n  /**\n   * Template name for analytics/display purposes\n   */\n  pendingTemplateName: string | null;\n\n  /**\n   * Set the pending template text (called when \"Use\" is clicked)\n   */\n  setTemplateText: (text: string, name?: string) => void;\n\n  /**\n   * Get and clear the pending template text (called by chat page)\n   * Returns null if no pending template\n   */\n  consumeTemplateText: () => { text: string; name: string } | null;\n\n  /**\n   * Clear without consuming (e.g., on navigation away)\n   */\n  clear: () => void;\n}\n\nexport const useTemplateStore = create<TemplateStore>((set, get) => ({\n  pendingTemplateText: null,\n  pendingTemplateName: null,\n\n  setTemplateText: (text: string, name?: string) => {\n    set({\n      pendingTemplateText: text,\n      pendingTemplateName: name || null,\n    });\n  },\n\n  consumeTemplateText: () => {\n    const { pendingTemplateText, pendingTemplateName } = get();\n    if (!pendingTemplateText) return null;\n\n    // Clear after consuming\n    set({ pendingTemplateText: null, pendingTemplateName: null });\n\n    return {\n      text: pendingTemplateText,\n      name: pendingTemplateName || \"Template\",\n    };\n  },\n\n  clear: () => {\n    set({ pendingTemplateText: null, pendingTemplateName: null });\n  },\n}));\n","\"use client\";\n\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { cn } from \"@/lib/utils\";\nimport type { ChatWidth } from \"@/lib/utils/chatWidth\";\n\ninterface MessageListSkeletonProps {\n  chatWidth?: ChatWidth;\n}\n\nexport function MessageListSkeleton({\n  chatWidth = \"standard\",\n}: MessageListSkeletonProps) {\n  // Message bubble styling (matches ChatMessage.tsx exactly)\n  const userMessageClass = cn(\n    \"relative rounded-[2rem] rounded-tr-sm\",\n    \"px-5 py-3 sm:px-6 sm:py-4 text-sm sm:text-base leading-relaxed\",\n    \"bg-primary/5\",\n    \"border border-primary/10\",\n  );\n\n  const assistantMessageClass = cn(\n    \"relative rounded-[2rem] rounded-tl-sm\",\n    \"px-5 py-3 sm:px-6 sm:py-4 text-sm sm:text-base leading-relaxed\",\n    \"bg-muted/30 border border-border/30\",\n  );\n\n  // Wrapper classes (matches ChatMessage.tsx structure exactly)\n  const userWrapperClass = \"relative group ml-auto max-w-[90%] sm:max-w-[75%]\";\n  const assistantWrapperClass =\n    \"relative group mr-auto max-w-[95%] sm:max-w-[85%]\";\n\n  // Simulated conversation with varying content lengths\n  const skeletonMessages = [\n    { isUser: true, lines: [{ width: \"w-24\" }, { width: \"w-40\" }] },\n    {\n      isUser: false,\n      lines: [{ width: \"w-48\" }, { width: \"w-72 sm:w-96\" }, { width: \"w-56\" }],\n    },\n    { isUser: true, lines: [{ width: \"w-32\" }] },\n    {\n      isUser: false,\n      lines: [{ width: \"w-64\" }, { width: \"w-80 sm:w-[400px]\" }],\n    },\n  ];\n\n  return (\n    <div className=\"flex-1 w-full min-w-0 relative flex flex-col overflow-hidden\">\n      <div\n        className=\"flex-1 w-full min-w-0 overflow-y-auto relative\"\n        style={{\n          contain: \"layout style paint\",\n          contentVisibility: \"auto\",\n        }}\n      >\n        {/* Grid structure matches VirtualizedMessageList exactly */}\n        <div\n          className={cn(\n            \"grid gap-4 p-4 transition-all duration-300 ease-out\",\n            chatWidth === \"narrow\" && \"grid-cols-[1fr_min(42rem,100%)_1fr]\",\n            chatWidth === \"standard\" && \"grid-cols-[1fr_min(56rem,100%)_1fr]\",\n            chatWidth === \"wide\" && \"grid-cols-[1fr_min(72rem,100%)_1fr]\",\n            chatWidth === \"full\" && \"grid-cols-[1fr_min(95%,100%)_1fr]\",\n            !chatWidth && \"grid-cols-[1fr_min(56rem,100%)_1fr]\",\n          )}\n        >\n          {skeletonMessages.map((msg, i) => (\n            <div\n              key={i}\n              className={cn(\n                \"col-start-2 flex w-full mb-10\",\n                msg.isUser ? \"justify-end\" : \"justify-start\",\n              )}\n            >\n              <div\n                className={\n                  msg.isUser ? userWrapperClass : assistantWrapperClass\n                }\n              >\n                <div\n                  className={\n                    msg.isUser ? userMessageClass : assistantMessageClass\n                  }\n                >\n                  <div className=\"space-y-2\">\n                    {msg.lines.map((line, j) => (\n                      <Skeleton\n                        key={j}\n                        className={cn(\n                          \"h-4\",\n                          line.width,\n                          msg.isUser && \"ml-auto\",\n                        )}\n                      />\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n","\"use client\";\n\nimport { api } from \"@blah-chat/backend/convex/_generated/api\";\nimport {\n  Authenticated,\n  Unauthenticated,\n  useConvexAuth,\n  useMutation,\n} from \"convex/react\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\nimport { Suspense, useEffect, useRef } from \"react\";\nimport { MessageListSkeleton } from \"@/components/chat/MessageListSkeleton\";\nimport { useNewChat } from \"@/hooks/useNewChat\";\nimport { useNewChatModel } from \"@/hooks/useNewChatModel\";\nimport { analytics } from \"@/lib/analytics\";\nimport { useTemplateStore } from \"@/stores/templateStore\";\n\nfunction ChatPageContent() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const { isAuthenticated, isLoading: authLoading } = useConvexAuth();\n  const { startNewChat } = useNewChat();\n  const { newChatModel } = useNewChatModel();\n  const navigationStarted = useRef(false);\n\n  // Zustand store for template text\n  const consumeTemplateText = useTemplateStore((s) => s.consumeTemplateText);\n\n  // @ts-ignore - Type depth exceeded with complex Convex mutation\n  const createConversation = useMutation(api.conversations.create);\n\n  const fromTemplate = searchParams.get(\"from\") === \"template\";\n\n  // Redirect unauthenticated users to sign-in\n  useEffect(() => {\n    if (!authLoading && !isAuthenticated) {\n      router.push(\"/sign-in\");\n    }\n  }, [authLoading, isAuthenticated, router]);\n\n  // Handle template-based new chat creation\n  useEffect(() => {\n    if (authLoading || !isAuthenticated) return;\n    if (!fromTemplate) return;\n    if (navigationStarted.current) return;\n\n    navigationStarted.current = true;\n\n    const createChatWithTemplate = async () => {\n      // Get template text from Zustand store\n      const templateData = consumeTemplateText();\n\n      if (!templateData) {\n        // No template text found, just start normal chat\n        startNewChat();\n        return;\n      }\n\n      try {\n        // Create new conversation\n        const conversationId = await createConversation({\n          model: newChatModel,\n          title: templateData.name || \"New Chat\",\n        });\n\n        // Track analytics\n        analytics.track(\"template_used\", {\n          templateId: \"from-store\",\n          templateName: templateData.name,\n          conversationId,\n        });\n\n        // Store the template text in sessionStorage for the chat page to pick up\n        // This survives the navigation to the new chat page\n        sessionStorage.setItem(\"pending-template-text\", templateData.text);\n\n        // Navigate to new chat\n        router.replace(`/chat/${conversationId}?insertTemplate=true`);\n      } catch (error) {\n        console.error(\"Failed to create chat with template:\", error);\n        startNewChat();\n      }\n    };\n\n    createChatWithTemplate();\n  }, [\n    authLoading,\n    isAuthenticated,\n    fromTemplate,\n    consumeTemplateText,\n    createConversation,\n    newChatModel,\n    router,\n    startNewChat,\n  ]);\n\n  // Handle normal new chat (no template)\n  useEffect(() => {\n    if (authLoading || !isAuthenticated) return;\n    if (fromTemplate) return; // Handled by other effect\n    if (navigationStarted.current) return;\n\n    navigationStarted.current = true;\n    startNewChat();\n  }, [isAuthenticated, authLoading, fromTemplate, startNewChat]);\n\n  return (\n    <>\n      <Authenticated>\n        <MessageListSkeleton />\n      </Authenticated>\n      <Unauthenticated>\n        <div className=\"flex items-center justify-center min-h-screen\">\n          <p className=\"text-muted-foreground\">Redirecting to sign in...</p>\n        </div>\n      </Unauthenticated>\n    </>\n  );\n}\n\nexport default function ChatPage() {\n  return (\n    <Suspense fallback={<MessageListSkeleton />}>\n      <ChatPageContent />\n    </Suspense>\n  );\n}\n"],"names":[],"mappings":"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","ignoreList":[0,1]}