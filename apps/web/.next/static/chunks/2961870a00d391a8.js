(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,807017,e=>{"use strict";var t=e.i(379492),s=e.i(283164);e.i(977101);var i=e.i(727630),n=e.i(346596),r=e.i(430387),a=e.i(384078),o=e.i(799126),l=e.i(985902),u=e.i(547608),c=e.i(610012),d=e.i(173554);function h({open:e,onOpenChange:h,initialContent:p,sourceMessageId:m,sourceConversationId:v,sourceSelectionText:f}){let g=(0,r.useRouter)(),y=(0,i.useMutation)(s.api.notes.createNote),x=(0,i.useAction)(s.api.notes.generateTitle.generateTitle),[w,b]=(0,a.useState)(""),[k,C]=(0,a.useState)(p),[M,E]=(0,a.useState)(!1),[j,S]=(0,a.useState)(!1);(0,a.useEffect)(()=>{e&&(C(p),b(""))},[e,p]);let D=async()=>{if(!k.trim())return void o.toast.error("Add some content first");S(!0);try{let e=await x({content:k});b(e.title),o.toast.success("Title generated!")}catch(e){console.error("Failed to generate title:",e),o.toast.error("Failed to generate title")}finally{S(!1)}},A=async()=>{if(!k.trim())return void o.toast.error("Note content cannot be empty");E(!0);let e=w;try{if(!e.trim()){o.toast.info("Generating title with AI...");try{e=(await x({content:k})).title}catch(t){console.error("Failed to generate title:",t),e=""}}let t=await y({content:k,title:e||void 0,sourceMessageId:m,sourceConversationId:v,sourceSelectionText:f});o.toast.success("Note saved"),h(!1),g.push(`/notes?note=${t}`)}catch(e){console.error("Failed to save note:",e),o.toast.error("Failed to save note")}finally{E(!1)}};return(0,t.jsx)(u.Dialog,{open:e,onOpenChange:h,children:(0,t.jsxs)(u.DialogContent,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,t.jsxs)(u.DialogHeader,{children:[(0,t.jsx)(u.DialogTitle,{children:"Save as Note"}),(0,t.jsx)(u.DialogDescription,{children:"Create a new note. You can edit it in the notes page."})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.Label,{htmlFor:"title",children:"Title (optional)"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(c.Input,{id:"title",value:w,onChange:e=>b(e.target.value),placeholder:"Leave empty to auto-generate from first line",className:"flex-1"}),(0,t.jsx)(l.Button,{type:"button",variant:"outline",size:"sm",onClick:D,disabled:j||!k.trim(),className:"shrink-0",children:j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Sparkles,{className:"mr-2 h-4 w-4 animate-pulse"}),"Generating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Sparkles,{className:"mr-2 h-4 w-4"}),"Generate with AI"]})})]})]}),m&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Source: Message in conversation"})]}),(0,t.jsxs)(u.DialogFooter,{children:[(0,t.jsx)(l.Button,{variant:"outline",onClick:()=>h(!1),disabled:M,children:"Cancel"}),(0,t.jsx)(l.Button,{onClick:A,disabled:M,children:M?"Saving...":"Save Note"})]})]})})}e.s(["CreateNoteDialog",()=>h])},650430,e=>{"use strict";var t=e.i(379492),s=e.i(384078);let i=(0,s.createContext)(void 0);function n({children:e}){let[n,r]=(0,s.useState)(null),[a,o]=(0,s.useState)(null),[l,u]=(0,s.useState)(!1);return(0,t.jsx)(i.Provider,{value:{documentId:n,setDocumentId:r,pendingConflict:a,setPendingConflict:o,showHistoryPanel:l,setShowHistoryPanel:u},children:e})}function r(){let e=(0,s.useContext)(i);if(!e)throw Error("useCanvasContext must be used within CanvasProvider");return e}e.s(["CanvasProvider",()=>n,"useCanvasContext",()=>r])},311743,e=>{"use strict";var t=e.i(384078);e.i(662122);var s=e.i(774395),i=e.i(379492),n=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,n)=>{let r=(0,s.createSlot)(`Primitive.${n}`),a=t.forwardRef((e,t)=>{let{asChild:s,...a}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,i.jsx)(s?r:n,{...a,ref:t})});return a.displayName=`Primitive.${n}`,{...e,[n]:a}},{});e.s(["Primitive",()=>n])},173554,e=>{"use strict";var t=e.i(379492),s=e.i(384078),i=e.i(311743),n=s.forwardRef((e,s)=>(0,t.jsx)(i.Primitive.label,{...e,ref:s,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));n.displayName="Label";var r=e.i(152088);function a({className:e,...s}){return(0,t.jsx)(n,{"data-slot":"label",className:(0,r.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...s})}e.s(["Label",()=>a],173554)},541247,e=>{"use strict";var t=e.i(379492),s=e.i(152088);function i({className:e,...i}){return(0,t.jsx)("textarea",{"data-slot":"textarea",className:(0,s.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...i})}e.s(["Textarea",()=>i])},346596,265636,e=>{"use strict";let t=(0,e.i(755430).default)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);e.s(["default",()=>t],265636),e.s(["Sparkles",()=>t],346596)},813038,e=>{"use strict";e.i(708883);var t=e.i(379492),s=e.i(384078),i=e.i(815721),n=e.i(398774),r=e.i(921608),a=e.i(833858),o=e.i(492437),l=s,u=e.i(648591);function c(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}class d extends l.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,s=(0,o.isHTMLElement)(e)&&e.offsetWidth||0,i=this.props.sizeRef.current;i.height=t.offsetHeight||0,i.width=t.offsetWidth||0,i.top=t.offsetTop,i.left=t.offsetLeft,i.right=s-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function h({children:e,isPresent:i,anchorX:n,root:r}){let a=(0,l.useId)(),o=(0,l.useRef)(null),h=(0,l.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:p}=(0,l.useContext)(u.MotionConfigContext),m=function(...e){return s.useCallback(function(...e){return t=>{let s=!1,i=e.map(e=>{let i=c(e,t);return s||"function"!=typeof i||(s=!0),i});if(s)return()=>{for(let t=0;t<i.length;t++){let s=i[t];"function"==typeof s?s():c(e[t],null)}}}}(...e),e)}(o,e?.ref);return(0,l.useInsertionEffect)(()=>{let{width:e,height:t,top:s,left:l,right:u}=h.current;if(i||!o.current||!e||!t)return;let c="left"===n?`left: ${l}`:`right: ${u}`;o.current.dataset.motionPopId=a;let d=document.createElement("style");p&&(d.nonce=p);let m=r??document.head;return m.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${a}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${t}px !important;
            ${c}px !important;
            top: ${s}px !important;
          }
        `),()=>{m.contains(d)&&m.removeChild(d)}},[i]),(0,t.jsx)(d,{isPresent:i,childRef:o,sizeRef:h,children:l.cloneElement(e,{ref:m})})}let p=({children:e,initial:i,isPresent:r,onExitComplete:o,custom:l,presenceAffectsLayout:u,mode:c,anchorX:d,root:p})=>{let v=(0,n.useConstant)(m),f=(0,s.useId)(),g=!0,y=(0,s.useMemo)(()=>(g=!1,{id:f,initial:i,isPresent:r,custom:l,onExitComplete:e=>{for(let t of(v.set(e,!0),v.values()))if(!t)return;o&&o()},register:e=>(v.set(e,!1),()=>v.delete(e))}),[r,v,o]);return u&&g&&(y={...y}),(0,s.useMemo)(()=>{v.forEach((e,t)=>v.set(t,!1))},[r]),s.useEffect(()=>{r||v.size||!o||o()},[r]),"popLayout"===c&&(e=(0,t.jsx)(h,{isPresent:r,anchorX:d,root:p,children:e})),(0,t.jsx)(a.PresenceContext.Provider,{value:y,children:e})};function m(){return new Map}var v=e.i(253099);let f=e=>e.key||"";function g(e){let t=[];return s.Children.forEach(e,e=>{(0,s.isValidElement)(e)&&t.push(e)}),t}let y=({children:e,custom:a,initial:o=!0,onExitComplete:l,presenceAffectsLayout:u=!0,mode:c="sync",propagate:d=!1,anchorX:h="left",root:m})=>{let[y,x]=(0,v.usePresence)(d),w=(0,s.useMemo)(()=>g(e),[e]),b=d&&!y?[]:w.map(f),k=(0,s.useRef)(!0),C=(0,s.useRef)(w),M=(0,n.useConstant)(()=>new Map),[E,j]=(0,s.useState)(w),[S,D]=(0,s.useState)(w);(0,r.useIsomorphicLayoutEffect)(()=>{k.current=!1,C.current=w;for(let e=0;e<S.length;e++){let t=f(S[e]);b.includes(t)?M.delete(t):!0!==M.get(t)&&M.set(t,!1)}},[S,b.length,b.join("-")]);let A=[];if(w!==E){let e=[...w];for(let t=0;t<S.length;t++){let s=S[t],i=f(s);b.includes(i)||(e.splice(t,0,s),A.push(s))}return"wait"===c&&A.length&&(e=A),D(g(e)),j(w),null}let{forceRender:I}=(0,s.useContext)(i.LayoutGroupContext);return(0,t.jsx)(t.Fragment,{children:S.map(e=>{let s=f(e),i=(!d||!!y)&&(w===S||b.includes(s));return(0,t.jsx)(p,{isPresent:i,initial:(!k.current||!!o)&&void 0,custom:a,presenceAffectsLayout:u,mode:c,root:m,onExitComplete:i?void 0:()=>{if(!M.has(s))return;M.set(s,!0);let e=!0;M.forEach(t=>{t||(e=!1)}),e&&(I?.(),D(C.current),d&&x?.(),l&&l())},anchorX:h,children:e},s)})})};e.s(["AnimatePresence",()=>y],813038)},755589,e=>{"use strict";let t=(0,e.i(755430).default)("presentation",[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]]);e.s(["Presentation",()=>t],755589)},851278,e=>{"use strict";let t=(0,e.i(755430).default)("bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);e.s(["Bookmark",()=>t],851278)},788410,e=>{"use strict";let t=(0,e.i(755430).default)("git-branch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);e.s(["GitBranch",()=>t],788410)},310165,e=>{"use strict";let t=(0,e.i(755430).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],310165)},278894,e=>{"use strict";let t=(0,e.i(755430).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);e.s(["Download",()=>t],278894)},62551,e=>{"use strict";let t=(0,e.i(755430).default)("brain",[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]]);e.s(["Brain",()=>t],62551)},927998,e=>{"use strict";let t=(0,e.i(755430).default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);e.s(["Edit",()=>t],927998)},966685,381379,e=>{"use strict";var t=e.i(755430);let s=(0,t.default)("ghost",[["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z",key:"uwwb07"}]]);e.s(["Ghost",()=>s],966685);let i=(0,t.default)("keyboard",[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]]);e.s(["Keyboard",()=>i],381379)},893631,529780,715455,555398,45211,352047,299805,e=>{"use strict";var t=e.i(283164);e.i(977101);var s=e.i(727630),i=e.i(430387),n=e.i(384078),r=e.i(799126),a=e.i(696057),o=e.i(214349),l=e.i(848053),u=e.i(782398),c=e.i(577405),d=class extends u.Subscribable{#e;#t=void 0;#s;#i;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,c.shallowEqualObjects)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,c.hashKey)(t.mutationKey)!==(0,c.hashKey)(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(e){this.#n(),this.#r(e)}getCurrentResult(){return this.#t}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#n(),this.#r()}mutate(e,t){return this.#i=t,this.#s?.removeObserver(this),this.#s=this.#e.getMutationCache().build(this.#e,this.options),this.#s.addObserver(this),this.#s.execute(e)}#n(){let e=this.#s?.state??(0,o.getDefaultState)();this.#t={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#r(e){l.notifyManager.batch(()=>{if(this.#i&&this.hasListeners()){let t=this.#t.variables,s=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#i.onSuccess?.(e.data,t,s,i),this.#i.onSettled?.(e.data,null,t,s,i)):e?.type==="error"&&(this.#i.onError?.(e.error,t,s,i),this.#i.onSettled?.(void 0,e.error,t,s,i))}this.listeners.forEach(e=>{e(this.#t)})})}},h=e.i(521360);function p(e,t){let s=(0,h.useQueryClient)(t),[i]=n.useState(()=>new d(s,e));n.useEffect(()=>{i.setOptions(e)},[i,e]);let r=n.useSyncExternalStore(n.useCallback(e=>i.subscribe(l.notifyManager.batchCalls(e)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),a=n.useCallback((e,t)=>{i.mutate(e,t).catch(c.noop)},[i]);if(r.error&&(0,c.shouldThrowError)(i.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:a,mutateAsync:r.mutate}}var m=e.i(324354);class v extends Error{status;code;constructor(e,t,s){super(s||`API Error: ${e}`),this.status=e,this.code=t,this.name="ApiClientError"}}async function f(e,t,s){let i=await s();if(!i)throw new v(401,"UNAUTHORIZED","Auth required");let n=await fetch(e,{...t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`,...t.headers}}),r=await n.json();if(!n.ok||"error"===r.status){let e="string"==typeof r.error?r.error:r.error?.message,t="object"==typeof r.error?r.error?.code:void 0;throw new v(n.status,t,e)}return r.data}function g(){let{getToken:e}=(0,m.useAuth)();return{get:t=>f(t,{method:"GET"},e),post:(t,s)=>f(t,{method:"POST",body:JSON.stringify(s)},e),patch:(t,s)=>f(t,{method:"PATCH",body:JSON.stringify(s)},e),delete:t=>f(t,{method:"DELETE"},e)}}e.s(["useApiClient",()=>g],529780);let y={conversations:{all:["conversations"],lists:()=>[...y.conversations.all,"list"],detail:e=>[...y.conversations.all,e]},messages:{all:["messages"],list:e=>[...y.messages.all,e]},preferences:{all:["preferences"]}},x=new class{STORAGE_KEY="blah-chat-offline-queue";MAX_RETRIES=3;enqueue(e){let t=this.getQueue(),s={...e,id:crypto.randomUUID(),timestamp:Date.now(),retries:0};t.push(s),this.persist(t),this.dispatchQueueUpdate()}async processQueue(e){for(let t of this.getQueue())try{await e(t),this.remove(t.id)}catch(e){if(t.retries>=this.MAX_RETRIES)this.remove(t.id),console.error(`[MessageQueue] Permanently failed after ${this.MAX_RETRIES} retries:`,t.content.slice(0,50));else{this.incrementRetry(t.id);let e=2e3*2**t.retries;await new Promise(t=>setTimeout(t,e))}}}getQueue(){try{let e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("[MessageQueue] Failed to read queue:",e),[]}}getCount(){return this.getQueue().length}clear(){localStorage.removeItem(this.STORAGE_KEY),this.dispatchQueueUpdate()}persist(e){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(e){console.error("[MessageQueue] Failed to persist queue:",e)}}remove(e){let t=this.getQueue().filter(t=>t.id!==e);this.persist(t),this.dispatchQueueUpdate()}incrementRetry(e){let t=this.getQueue(),s=t.find(t=>t.id===e);s&&(s.retries++,this.persist(t))}dispatchQueueUpdate(){window.dispatchEvent(new CustomEvent("queue-updated",{detail:{count:this.getCount()}}))}};function w(e){let i=g(),o=(0,h.useQueryClient)(),l=(0,s.useQuery)(t.api.users.getCurrentUser);return(0,n.useEffect)(()=>{let e=async()=>{let e=x.getCount();0!==e&&(r.toast.info(`Processing ${e} queued message${e>1?"s":""}...`),await x.processQueue(async e=>{await i.post(`/api/v1/conversations/${e.conversationId}/messages`,{conversationId:e.conversationId,content:e.content,modelId:e.modelId,models:e.models,attachments:e.attachments})}),r.toast.success("All queued messages sent"))};return window.addEventListener("online",e),()=>window.removeEventListener("online",e)},[i]),p({mutationFn:async e=>i.post(`/api/v1/conversations/${e.conversationId}/messages`,e),onMutate:t=>{let s={_id:`temp-user-${Date.now()}`,conversationId:t.conversationId,userId:l?._id,role:"user",content:t.content,status:"optimistic",attachments:t.attachments?.map(e=>({id:e.storageId,storageId:e.storageId,_optimistic:!0})),createdAt:Date.now(),updatedAt:Date.now(),_creationTime:Date.now(),_optimistic:!0},i=t.models||[t.modelId],n=i.filter(e=>!!e).map((e,s)=>({_id:`temp-assistant-${Date.now()}-${s}`,conversationId:t.conversationId,userId:l?._id,role:"assistant",content:"",status:"pending",model:e,comparisonGroupId:i.length>1?`temp-comparison-${Date.now()}`:void 0,createdAt:Date.now()+s+1,updatedAt:Date.now()+s+1,_creationTime:Date.now()+s+1,_optimistic:!0}));return e?.([s,...n]),{optimisticIds:[s._id,...n.map(e=>e._id)]}},onSuccess:(e,t)=>{o.invalidateQueries({queryKey:y.messages.list(t.conversationId)}),a.analytics.track("message_sent",{model:t.models?t.models.join(","):t.modelId??"unknown",hasAttachments:!!t.attachments?.length})},onError:(e,t,s)=>{let i=e instanceof Error?e.message:"Failed to send message";navigator.onLine?r.toast.error(i):(x.enqueue({conversationId:t.conversationId,content:t.content,modelId:t.modelId,models:t.models,attachments:t.attachments}),r.toast.info("You're offline. Message queued and will send when reconnected."))}})}function b(e,o){let l,u,c,d,m,v,f,x,w=(0,i.useRouter)(),[b,k]=(0,n.useState)(!1),{mutate:C,isPending:M}=(l=g(),u=(0,h.useQueryClient)(),p({mutationFn:async({conversationId:e})=>l.delete(`/api/v1/conversations/${e}`),onSuccess:(e,t)=>{u.invalidateQueries({queryKey:y.conversations.lists()}),u.removeQueries({queryKey:y.conversations.detail(t.conversationId)}),r.toast.success("Conversation deleted")},onError:e=>{let t=e instanceof Error?e.message:"Failed to delete conversation";r.toast.error(t)}})),{mutate:E,isPending:j}=(c=g(),d=(0,h.useQueryClient)(),p({mutationFn:async({conversationId:e})=>c.patch(`/api/v1/conversations/${e}/archive`),onSuccess:(e,t)=>{d.invalidateQueries({queryKey:y.conversations.lists()}),r.toast.success("Conversation archived")},onError:e=>{let t=e instanceof Error?e.message:"Failed to archive conversation";r.toast.error(t)}})),{mutate:S,isPending:D}=(m=g(),v=(0,h.useQueryClient)(),p({mutationFn:async({conversationId:e})=>m.patch(`/api/v1/conversations/${e}/pin`),onMutate:async({conversationId:e})=>{await v.cancelQueries({queryKey:y.conversations.lists()});let t=v.getQueryData(y.conversations.lists());return v.setQueriesData({queryKey:y.conversations.lists()},t=>t?t.map(t=>t._id===e?{...t,pinned:!t.pinned}:t):t),{previous:t}},onError:(e,t,s)=>{s?.previous&&v.setQueryData(y.conversations.lists(),s.previous),r.toast.error("Failed to toggle pin")},onSettled:()=>{v.invalidateQueries({queryKey:y.conversations.lists()})}})),{mutate:A,isPending:I}=(f=g(),x=(0,h.useQueryClient)(),p({mutationFn:async({conversationId:e})=>f.patch(`/api/v1/conversations/${e}/star`),onMutate:async({conversationId:e})=>{await x.cancelQueries({queryKey:y.conversations.lists()});let t=x.getQueryData(y.conversations.lists());return x.setQueriesData({queryKey:y.conversations.lists()},t=>t?t.map(t=>t._id===e?{...t,starred:!t.starred}:t):t),{previous:t}},onError:(e,t,s)=>{s?.previous&&x.setQueryData(y.conversations.lists(),s.previous),r.toast.error("Failed to toggle star")},onSettled:()=>{x.invalidateQueries({queryKey:y.conversations.lists()})}})),R=(0,s.useAction)(t.api.conversations.actions.bulkAutoRename);return{handleDelete:()=>{e&&C({conversationId:e},{onSuccess:()=>{a.analytics.track("conversation_action",{action:"delete",source:o,conversationId:e}),w.push("/")}})},handleArchive:()=>{e&&E({conversationId:e},{onSuccess:()=>{a.analytics.track("conversation_action",{action:"archive",source:o,conversationId:e}),w.push("/")}})},handleTogglePin:t=>{e&&S({conversationId:e},{onSuccess:()=>{r.toast.success(t?"Conversation unpinned":"Conversation pinned"),a.analytics.track("conversation_action",{action:t?"unpin":"pin",source:o,conversationId:e})}})},handleToggleStar:t=>{e&&A({conversationId:e},{onSuccess:()=>{r.toast.success(t?"Conversation unstarred":"Conversation starred"),a.analytics.track("conversation_action",{action:t?"unstar":"star",source:o,conversationId:e})}})},handleAutoRename:async()=>{if(e)try{k(!0),r.toast.loading("Generating title...",{id:"auto-rename"});let t=await R({conversationIds:[e]});if(t[0]?.success)r.toast.success("Conversation renamed",{id:"auto-rename"}),a.analytics.track("conversation_action",{action:"auto_rename",source:o,conversationId:e});else throw Error(t[0]?.error||"Failed to generate title")}catch(t){let e=t instanceof Error?t.message:"Failed to auto-rename";r.toast.error(e,{id:"auto-rename"})}finally{k(!1)}},isLoading:M||j||D||I||b}}e.s(["messageQueue",0,x],715455),e.s(["useSendMessage",()=>w],555398),e.s([],45211),e.s(["useConversationActions",()=>b],893631);var k=e.i(379492),C=e.i(49275);function M({open:e,onOpenChange:t,onConfirm:s,conversationTitle:i}){return(0,k.jsx)(C.AlertDialog,{open:e,onOpenChange:t,children:(0,k.jsxs)(C.AlertDialogContent,{children:[(0,k.jsxs)(C.AlertDialogHeader,{children:[(0,k.jsx)(C.AlertDialogTitle,{children:"Delete conversation?"}),(0,k.jsxs)(C.AlertDialogDescription,{children:["This will permanently delete"," ",(0,k.jsxs)("span",{className:"font-medium text-foreground",children:['"',i||"this conversation",'"']})," ","and all its messages. This action cannot be undone."]})]}),(0,k.jsxs)(C.AlertDialogFooter,{children:[(0,k.jsx)(C.AlertDialogCancel,{children:"Cancel"}),(0,k.jsx)(C.AlertDialogAction,{onClick:s,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})}e.s(["DeleteConversationDialog",()=>M],352047);var E=e.i(985902),j=e.i(547608),S=e.i(610012);function D({conversation:e,open:i,onOpenChange:r}){let[a,o]=(0,n.useState)(e.title||""),l=(0,s.useMutation)(t.api.conversations.rename),u=async()=>{await l({conversationId:e._id,title:a}),r(!1)};return(0,k.jsx)(j.Dialog,{open:i,onOpenChange:r,children:(0,k.jsxs)(j.DialogContent,{children:[(0,k.jsx)(j.DialogHeader,{children:(0,k.jsx)(j.DialogTitle,{children:"Rename conversation"})}),(0,k.jsx)(S.Input,{value:a,onChange:e=>o(e.target.value),placeholder:"Enter title...",onKeyDown:e=>{"Enter"===e.key&&u()}}),(0,k.jsxs)(j.DialogFooter,{children:[(0,k.jsx)(E.Button,{variant:"outline",onClick:()=>r(!1),children:"Cancel"}),(0,k.jsx)(E.Button,{onClick:u,children:"Save"})]})]})})}e.s(["RenameDialog",()=>D],299805)},736436,e=>{"use strict";let t=(0,e.i(755430).default)("quote",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]);e.s(["Quote",()=>t],736436)},497847,e=>{"use strict";var t=e.i(379492),s=e.i(290312);function i({keys:e}){let i=e.map(e=>"mod"===e?(0,s.getModifierKey)():e);return(0,t.jsx)("kbd",{className:"inline-flex h-5 select-none items-center gap-1 rounded border bg-background/50 px-1.5 font-mono text-[10px] font-medium text-muted-foreground",children:i.map((e,s)=>(0,t.jsxs)("span",{children:[s>0&&(0,t.jsx)("span",{className:"mx-0.5",children:"+"}),e]},s))})}e.s(["ShortcutBadge",()=>i])}]);