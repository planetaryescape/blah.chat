(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,987677,e=>{"use strict";let t,n;var r=e.i(379492),s=e.i(283164);e.i(834687);var a=e.i(641269),i=e.i(813038),o=e.i(403950),l=e.i(430387),c=e.i(505196),d=e.i(384078);e.i(977101);var u=e.i(727630),m=e.i(328299),h=e.i(985902),p=e.i(650430),f=e.i(350148),x=e.i(480494),g=e.i(773492),v=e.i(33928),y=d;class b extends y.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Canvas error:",e,t)}handleRetry=()=>{this.setState({hasError:!1,error:void 0})};render(){return this.state.hasError?this.props.fallback??(0,r.jsxs)("div",{className:"h-full flex flex-col items-center justify-center gap-4 p-8 text-center",children:[(0,r.jsx)(g.AlertTriangle,{className:"w-12 h-12 text-destructive"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-1",children:"Something went wrong"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"The Canvas editor encountered an error."}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground font-mono mb-4 max-w-md break-all",children:this.state.error?.message})]}),(0,r.jsxs)(h.Button,{onClick:this.handleRetry,variant:"outline",children:[(0,r.jsx)(v.RefreshCw,{className:"w-4 h-4 mr-2"}),"Try Again"]})]}):this.props.children}}var j=e.i(828982),w=e.i(983300),C=e.i(278894),N=e.i(755430);let k=(0,N.default)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);var S=e.i(760087);let M=(0,N.default)("redo-2",[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]]);var T=e.i(126312),R=e.i(199049),E=e.i(628876),I=e.i(465986);function D(e){let t=(0,u.useQuery)(s.api.canvas.documents.get,e?{documentId:e}:"skip"),n=(0,u.useQuery)(s.api.canvas.history.getHistory,e?{documentId:e,limit:50}:"skip"),r=(0,u.useMutation)(s.api.canvas.documents.updateContent),a=t?.version??0,i=(0,d.useMemo)(()=>n?.length?Math.max(...n.map(e=>e.version)):a,[n,a]),o=a>1,l=a<i,c=a<i,m=(0,d.useCallback)(async()=>{if(!e||a<=1||!n)return;let t=n.find(e=>e.version===a-1);t&&await r({documentId:e,content:t.content,source:"user_edit",diff:"Undo"})},[e,a,n,r]),h=(0,d.useCallback)(async()=>{if(!e||!n?.length||a>=Math.max(...n.map(e=>e.version)))return;let t=n.find(e=>e.version===a+1);t&&await r({documentId:e,content:t.content,source:"user_edit",diff:"Redo"})},[e,a,n,r]),p=(0,d.useCallback)(async t=>{if(!e||!n)return;let s=n.find(e=>e.version===t);s&&await r({documentId:e,content:s.content,source:"user_edit",diff:`Restore v${t}`})},[e,n,r]);return{history:n,currentVersion:a,latestVersion:i,isViewingOldVersion:c,canUndo:o,canRedo:l,undo:m,redo:h,jumpToVersion:p}}var z=e.i(152088);function L({documentId:e,isSaving:t=!1,className:n,onDelete:a}){let{setShowHistoryPanel:i}=(0,p.useCanvasContext)(),[o,l]=(0,d.useState)(!1),c=(0,u.useQuery)(s.api.canvas.documents.get,e?{documentId:e}:"skip"),{canUndo:m,canRedo:f,undo:x,redo:g,currentVersion:y,latestVersion:b,isViewingOldVersion:N,jumpToVersion:L}=D(e??void 0),P=async()=>{c?.content&&(await navigator.clipboard.writeText(c.content),l(!0),setTimeout(()=>l(!1),2e3))};return(0,r.jsxs)("div",{className:(0,z.cn)("flex items-center gap-1 px-2 py-1 border-b border-border bg-muted/30",n),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,r.jsx)("span",{children:c?.documentType==="code"?c.language??"plaintext":"Document"}),(0,r.jsx)("span",{className:"text-muted-foreground/50",children:"|"}),(0,r.jsxs)("span",{className:N?"text-amber-500":"",children:["v",y,N&&` of ${b}`]})]}),N&&(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsxs)(h.Button,{variant:"outline",size:"sm",className:"h-6 px-2 text-xs ml-2 gap-1",onClick:()=>L(b),children:[(0,r.jsx)(v.RefreshCw,{className:"h-3 w-3"}),"Latest"]})}),(0,r.jsxs)(I.TooltipContent,{children:["Jump to latest version (v",b,")"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-0.5 ml-2",children:[(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",disabled:!m,onClick:x,children:(0,r.jsx)(R.Undo2,{className:"h-3.5 w-3.5"})})}),(0,r.jsx)(I.TooltipContent,{children:"Undo version"})]}),(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",disabled:!f,onClick:g,children:(0,r.jsx)(M,{className:"h-3.5 w-3.5"})})}),(0,r.jsx)(I.TooltipContent,{children:"Redo version"})]})]}),(0,r.jsx)("div",{className:"flex-1"}),(0,r.jsx)("span",{className:(0,z.cn)("text-xs mr-2",t?"text-muted-foreground animate-pulse":"text-green-500"),children:t?"Saving...":"Saved"}),(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:P,children:o?(0,r.jsx)(j.Check,{className:"h-3.5 w-3.5 text-green-500"}):(0,r.jsx)(w.Copy,{className:"h-3.5 w-3.5"})})}),(0,r.jsx)(I.TooltipContent,{children:o?"Copied!":"Copy to clipboard"})]}),(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{if(!c)return;let e={typescript:".ts",javascript:".js",python:".py",rust:".rs",go:".go",java:".java",csharp:".cs",cpp:".cpp",c:".c",html:".html",css:".css",json:".json",yaml:".yaml",markdown:".md",sql:".sql",shell:".sh",bash:".sh"}[c.language??""]??".txt",t=new Blob([c.content],{type:"text/plain"}),n=URL.createObjectURL(t),r=window.document.createElement("a");r.href=n,r.download=`${c.title}${e}`,r.click(),URL.revokeObjectURL(n)},children:(0,r.jsx)(C.Download,{className:"h-3.5 w-3.5"})})}),(0,r.jsx)(I.TooltipContent,{children:"Download file"})]}),(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>i(!0),children:(0,r.jsx)(k,{className:"h-3.5 w-3.5"})})}),(0,r.jsx)(I.TooltipContent,{children:"View history"})]}),(0,r.jsxs)(E.DropdownMenu,{children:[(0,r.jsx)(E.DropdownMenuTrigger,{asChild:!0,children:(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",children:(0,r.jsx)(S.MoreHorizontal,{className:"h-3.5 w-3.5"})})}),(0,r.jsxs)(E.DropdownMenuContent,{align:"end",children:[(0,r.jsxs)(E.DropdownMenuItem,{onClick:()=>i(!0),children:[(0,r.jsx)(k,{className:"h-4 w-4 mr-2"}),"View history"]}),(0,r.jsx)(E.DropdownMenuSeparator,{}),(0,r.jsxs)(E.DropdownMenuItem,{className:"text-destructive",onClick:a,children:[(0,r.jsx)(T.Trash2,{className:"h-4 w-4 mr-2"}),"Delete document"]})]})]})]})}let P=(0,f.default)(()=>e.A(655522).then(e=>e.default),{loadableGenerated:{modules:[202966]},ssr:!1,loading:()=>(0,r.jsx)("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Loading editor..."]})})});function _({document:e,onEditorReady:t,onDelete:n}){let a=(0,d.useRef)(null),i=(0,u.useMutation)(s.api.canvas.documents.updateContent),[o,l]=(0,d.useState)(e.content),[c]=(0,x.useDebounceValue)(o,500),m=(0,d.useRef)(e.content);(0,d.useEffect)(()=>{e.content!==m.current&&(a.current&&a.current.setValue(e.content),l(e.content),m.current=e.content)},[e.content]),(0,d.useEffect)(()=>{c!==e.content&&i({documentId:e._id,content:c,source:"user_edit"}).catch(console.error)},[c,e._id,e.content,i]);let h=(0,d.useCallback)(e=>{a.current=e,t?.(e)},[t]),p=o!==e.content;return(0,r.jsx)(b,{children:(0,r.jsxs)("div",{className:"h-full flex flex-col",children:[(0,r.jsx)(L,{documentId:e._id,isSaving:p,onDelete:n}),(0,r.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,r.jsx)(P,{height:"100%",language:e.language??("prose"===e.documentType?"markdown":"typescript"),value:o,onChange:e=>l(e??""),onMount:h,theme:"vs-dark",options:{fontSize:14,lineNumbers:"on",minimap:{enabled:"code"===e.documentType},wordWrap:"prose"===e.documentType?"on":"off",scrollBeyondLastLine:!1,automaticLayout:!0,codeLens:!1,inlayHints:{enabled:"off"}},loading:(0,r.jsx)("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:"Loading editor..."})})})]})})}var A=e.i(685809),F=e.i(462957),O=e.i(628680),B=e.i(547608);function $({open:e,onClose:t,conflict:n,onResolve:s}){let[a,i]=(0,d.useState)(!1),o=e=>{s(e),t()};return(0,r.jsx)(B.Dialog,{open:e,onOpenChange:e=>!e&&t(),children:(0,r.jsxs)(B.DialogContent,{className:"max-w-2xl",children:[(0,r.jsxs)(B.DialogHeader,{children:[(0,r.jsxs)(B.DialogTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(g.AlertTriangle,{className:"w-5 h-5 text-yellow-500"}),"Edit Conflict Detected"]}),(0,r.jsxs)(B.DialogDescription,{children:[n.description,n.lineRange&&(0,r.jsxs)("span",{className:"block mt-1 text-xs",children:["Lines ",n.lineRange.start,"-",n.lineRange.end]})]})]}),a&&(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 my-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2 text-sm font-medium",children:[(0,r.jsx)(F.FileText,{className:"w-4 h-4"}),"Your Version"]}),(0,r.jsx)("pre",{className:"p-3 rounded bg-muted text-xs overflow-auto max-h-48 whitespace-pre-wrap",children:n.userContent||"(empty)"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2 text-sm font-medium",children:[(0,r.jsx)(A.Bot,{className:"w-4 h-4"}),"AI Version"]}),(0,r.jsx)("pre",{className:"p-3 rounded bg-muted text-xs overflow-auto max-h-48 whitespace-pre-wrap",children:n.aiContent||"(empty)"})]})]}),(0,r.jsxs)(B.DialogFooter,{className:"flex-col sm:flex-row gap-2",children:[(0,r.jsxs)(h.Button,{variant:"outline",size:"sm",onClick:()=>i(!a),children:[a?"Hide":"Show"," Comparison"]}),(0,r.jsxs)("div",{className:"flex gap-2 ml-auto",children:[(0,r.jsxs)(h.Button,{variant:"outline",size:"sm",onClick:()=>o("user"),children:[(0,r.jsx)(F.FileText,{className:"w-4 h-4 mr-2"}),"Keep Mine"]}),(0,r.jsxs)(h.Button,{variant:"outline",size:"sm",onClick:()=>o("ai"),children:[(0,r.jsx)(A.Bot,{className:"w-4 h-4 mr-2"}),"Use AI's"]}),(0,r.jsxs)(h.Button,{size:"sm",onClick:()=>o("merge"),children:[(0,r.jsx)(O.GitMerge,{className:"w-4 h-4 mr-2"}),"Merge Both"]})]})]})]})})}var Q=e.i(975620),G=e.i(497439),U=e.i(162432),H=e.i(783055);function q({documentId:e}){let{setShowHistoryPanel:t}=(0,p.useCanvasContext)(),{history:n,currentVersion:s,jumpToVersion:a}=D(e);return n?(0,r.jsxs)("div",{className:"h-full flex flex-col border-l border-border bg-muted/20",children:[(0,r.jsxs)("div",{className:"p-3 border-b border-border flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"font-medium text-sm",children:"Version History"}),(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>t(!1),children:(0,r.jsx)(m.X,{className:"h-4 w-4"})})]}),(0,r.jsx)(H.ScrollArea,{className:"flex-1",children:(0,r.jsxs)("div",{className:"p-2 space-y-1",children:[n.map(e=>(0,r.jsx)("div",{className:(0,z.cn)("p-3 rounded-lg border transition-colors",e.version===s?"border-primary bg-primary/5":"border-transparent hover:bg-muted/50"),children:(0,r.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:["llm_diff"===e.source?(0,r.jsx)(A.Bot,{className:"w-4 h-4 text-primary shrink-0"}):(0,r.jsx)(U.User,{className:"w-4 h-4 shrink-0"}),(0,r.jsxs)("span",{className:"font-medium",children:["v",e.version]}),e.version===s&&(0,r.jsx)("span",{className:"text-xs text-primary",children:"(current)"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-xs text-muted-foreground",children:[(0,r.jsx)(G.Clock,{className:"w-3 h-3"}),(0,Q.formatDistanceToNow)(e.createdAt,{addSuffix:!0})]}),e.diff&&(0,r.jsx)("p",{className:"mt-1 text-xs text-muted-foreground truncate",children:function(e){try{let t=JSON.parse(e);if("string"==typeof t)return t;if(t.changeDescription)return t.changeDescription;if(t.operations?.length)return`${t.operations.length} change(s)`;return"Changes applied"}catch{return"string"==typeof e?e:"Changes applied"}}(e.diff)})]}),e.version!==s&&(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 shrink-0",onClick:()=>a(e.version),title:`Restore v${e.version}`,children:(0,r.jsx)(R.Undo2,{className:"w-4 h-4"})})]})},e._id)),0===n.length&&(0,r.jsx)("div",{className:"text-center text-sm text-muted-foreground py-8",children:"No history available"})]})})]}):(0,r.jsx)("div",{className:"h-full flex items-center justify-center p-4 text-muted-foreground text-sm",children:"Loading history..."})}function W({documentId:e,onClose:t}){let n=(0,d.useRef)(null),{pendingConflict:a,setPendingConflict:i,showHistoryPanel:o}=(0,p.useCanvasContext)(),l=(0,u.useQuery)(s.api.canvas.documents.get,{documentId:e}),c=(0,u.useMutation)(s.api.canvas.documents.updateContent),f=(0,d.useCallback)(async e=>{let t;if(a&&l){switch(e){case"user":t=a.userContent;break;case"ai":t=a.aiContent;break;case"merge":var n,r;n=a.userContent,r=a.aiContent,t=`${n}

---

${r}`}await c({documentId:a.documentId,content:t,source:"user_edit",diff:`Conflict resolved: ${e}`}),i(null)}},[a,l,c,i]);return l?(0,r.jsxs)("div",{className:"h-full border-l bg-card flex",children:[(0,r.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,r.jsx)("h3",{className:"font-semibold text-sm truncate",children:l.title}),l.language&&(0,r.jsx)("span",{className:"text-xs px-2 py-0.5 rounded bg-muted text-muted-foreground shrink-0",children:l.language})]}),(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",onClick:t,className:"h-8 w-8 shrink-0",children:(0,r.jsx)(m.X,{className:"h-4 w-4"})})]}),(0,r.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,r.jsx)(_,{document:l,onEditorReady:e=>{n.current=e}})}),(0,r.jsxs)("div",{className:"p-4 border-t text-xs text-muted-foreground",children:["Version ",l.version," • ",l.documentType]})]}),o&&(0,r.jsx)("div",{className:"w-64 shrink-0",children:(0,r.jsx)(q,{documentId:e})}),a&&(0,r.jsx)($,{open:!!a,onClose:()=>i(null),conflict:{description:a.description,userContent:a.userContent,aiContent:a.aiContent,lineRange:a.lineRange},onResolve:f})]}):(0,r.jsx)("div",{className:"h-full border-l bg-card flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-pulse text-muted-foreground",children:"Loading..."})})}var V=e.i(543621),K=e.i(359548),X=e.i(788410),Y=e.i(907347),J=e.i(337837);function Z({conversationId:e}){let t=(0,l.useRouter)(),n=(0,u.useQuery)(s.api.conversations.getChildBranches,{conversationId:e});return n&&0!==n.length?(0,r.jsxs)(J.Popover,{children:[(0,r.jsx)(J.PopoverTrigger,{asChild:!0,children:(0,r.jsxs)(h.Button,{variant:"outline",size:"sm",className:"h-7 gap-1.5 text-xs font-medium",children:[(0,r.jsx)(X.GitBranch,{className:"h-3 w-3"}),(0,r.jsx)(Y.Badge,{variant:"secondary",className:"h-4 min-w-4 px-1 text-[10px] rounded-full",children:n.length})]})}),(0,r.jsx)(J.PopoverContent,{align:"end",className:"w-72 p-2",children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("p",{className:"text-xs font-medium text-muted-foreground px-2 py-1",children:["Branched conversations (",n.length,")"]}),(0,r.jsx)("div",{className:"space-y-0.5",children:n.map(e=>(0,r.jsx)(h.Button,{variant:"ghost",size:"sm",className:"w-full justify-start h-auto py-2 px-2 text-left font-normal",onClick:()=>{t.push(`/chat/${e._id}`)},children:(0,r.jsxs)("div",{className:"flex items-start gap-2 w-full min-w-0",children:[(0,r.jsx)(X.GitBranch,{className:"h-3.5 w-3.5 mt-0.5 flex-shrink-0 text-muted-foreground"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"text-sm truncate",children:e.title}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})},e._id))})]})})]}):null}var ee=e.i(241362);function et({conversationId:e,modelId:t}){let n=(0,u.useQuery)(s.api.conversations.getTokenUsage,{conversationId:e}),a=(0,ee.getModelConfig)(t),i=a?.contextWindow??128e3;if(!n)return null;let{systemTokens:o,messagesTokens:l,memoriesTokens:c,totalTokens:d}=n,m=Math.min(100,Math.round(d/i*100)),h=m>=95?"critical":m>=85?"warning":m>=70?"caution":"safe",p=2*Math.PI*8.75,f=p-m/100*p;return(0,r.jsx)(I.TooltipProvider,{children:(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsxs)("div",{className:"flex items-center gap-1.5 cursor-pointer",children:[(0,r.jsxs)("svg",{width:20,height:20,viewBox:"0 0 20 20",className:"-rotate-90",children:[(0,r.jsx)("circle",{cx:10,cy:10,r:8.75,fill:"none",strokeWidth:2.5,className:"stroke-muted-foreground/30"}),(0,r.jsx)("circle",{cx:10,cy:10,r:8.75,fill:"none",strokeWidth:2.5,strokeLinecap:"round",strokeDasharray:p,strokeDashoffset:f,className:(()=>{switch(h){case"critical":return"stroke-destructive";case"warning":return"stroke-yellow-500";case"caution":return"stroke-yellow-400";default:return"stroke-primary"}})()})]}),(0,r.jsxs)("span",{className:"text-xs text-muted-foreground tabular-nums",children:[m,"%"]})]})}),(0,r.jsx)(I.TooltipContent,{side:"bottom",className:"max-w-sm",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"font-semibold",children:"Context Window Usage"}),(0,r.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between gap-4",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"System prompts:"}),(0,r.jsx)("span",{className:"tabular-nums",children:o.toLocaleString()})]}),(0,r.jsxs)("div",{className:"flex justify-between gap-4",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Memories:"}),(0,r.jsx)("span",{className:"tabular-nums",children:c.toLocaleString()})]}),(0,r.jsxs)("div",{className:"flex justify-between gap-4",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Messages:"}),(0,r.jsx)("span",{className:"tabular-nums",children:l.toLocaleString()})]}),(0,r.jsxs)("div",{className:"flex justify-between gap-4 pt-1 border-t",children:[(0,r.jsx)("span",{className:"font-medium",children:"Total Usage:"}),(0,r.jsxs)("span",{className:"tabular-nums font-medium",children:[d.toLocaleString()," (",m,"%)"]})]}),(0,r.jsxs)("div",{className:"flex justify-between gap-4",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Context Limit:"}),(0,r.jsx)("span",{className:"tabular-nums",children:i.toLocaleString()})]})]}),"critical"===h&&(0,r.jsxs)("div",{className:"pt-2 text-sm text-destructive",children:[(0,r.jsx)("strong",{children:"Critical:"})," Context nearly full. Consider starting a new conversation."]}),"warning"===h&&(0,r.jsxs)("div",{className:"pt-2 text-sm text-yellow-600",children:[(0,r.jsx)("strong",{children:"Warning:"})," Context filling up. New conversation recommended soon."]})]})})]})})}var en=e.i(186996),er=e.i(744739),es=e.i(62551),ea=e.i(927998),ei=e.i(2138),eo=e.i(817735),el=e.i(794805),ec=e.i(755589),ed=e.i(346596),eu=e.i(357245),em=e.i(799126),eh=e.i(893631),ep=e.i(152823),ef=e.i(432593),ex=e.i(696057),eg=e.i(352047),ev=e.i(299805);function ey({conversation:e}){let t=(0,l.useRouter)(),[n,a]=(0,d.useState)(!1),[i,o]=(0,d.useState)(!1),[c,m]=(0,d.useState)(!1),[p,f]=(0,d.useState)(!1),x=(0,eh.useConversationActions)(e._id,"header_menu"),{showSlides:g}=(0,ep.useFeatureToggles)(),v=(0,u.useMutation)(s.api.memories.triggerExtraction),y=(0,u.useQuery)(s.api.messages.list,{conversationId:e._id}),b=(0,u.useQuery)(s.api.sources.operations.getByConversation,{conversationId:e._id}),C=async()=>{m(!0);try{await v({conversationId:e._id}),em.toast.success("Memory extraction started! This may take a few moments."),ex.analytics.track("memory_extraction_triggered",{source:"manual",conversationId:e._id})}catch(e){em.toast.error("Failed to start extraction")}finally{setTimeout(()=>m(!1),3e3)}},N=async()=>{if(!y)return;let t=new Map;if(b)for(let e of b){let n=t.get(e.messageId)||[];n.push(e),t.set(e.messageId,n)}let n=function(e,t,n){let r=`# ${e.title}

`;for(let s of(r+=`*Created: ${new Date(e.createdAt).toLocaleString()}*

---

`,t)){let e="user"===s.role?"You":"assistant"===s.role?"Assistant":"System";r+=`**${e}:**

${s.content}

`;let t=n?.get(s._id);if(t?.length){for(let e of(r+=`**Sources:**
`,t))r+=`- [${e.position}] [${e.title||e.url}](${e.url})
`;r+=`
`}}return r}(e,y,t);await navigator.clipboard.writeText(n),f(!0),em.toast.success("Conversation copied to clipboard"),setTimeout(()=>f(!1),2e3),ex.analytics.track("conversation_copied",{conversationId:e._id,messageCount:y.length})};(0,u.useQuery)(s.api.users.getCurrentUser);let k=(0,u.useMutation)(s.api.users.updatePreferences),M=(0,ef.useUserPreference)("chatWidth"),R=(0,ef.useUserPreference)("showMessageStatistics"),D=(0,ef.useUserPreference)("showComparisonStatistics"),z=async e=>{try{await k({preferences:{chatWidth:e}}),em.toast.success("Chat width updated")}catch(e){console.error("[ConversationHeaderMenu] Failed to update width:",e),em.toast.error(e instanceof Error?e.message:"Failed to update width")}},L=async e=>{try{await k({preferences:{showMessageStatistics:e}}),em.toast.success(e?"Statistics enabled":"Statistics hidden"),ex.analytics.track("ui_preference_changed",{setting:"show_message_statistics",value:e,source:"header_menu"})}catch(e){console.error("[ConversationHeaderMenu] Failed to update message statistics:",e),em.toast.error(e instanceof Error?e.message:"Failed to update statistics")}},P=async e=>{try{await k({preferences:{showComparisonStatistics:e}}),em.toast.success(e?"Comparison stats enabled":"Comparison stats hidden"),ex.analytics.track("ui_preference_changed",{setting:"show_comparison_statistics",value:e,source:"header_menu"})}catch(e){console.error("[ConversationHeaderMenu] Failed to update comparison statistics:",e),em.toast.error(e instanceof Error?e.message:"Failed to update comparison statistics")}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(E.DropdownMenu,{children:[(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsx)(E.DropdownMenuTrigger,{asChild:!0,children:(0,r.jsxs)(h.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[(0,r.jsx)(S.MoreHorizontal,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Conversation options"})]})})}),(0,r.jsx)(I.TooltipContent,{children:"Conversation options"})]}),(0,r.jsxs)(E.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,r.jsxs)(E.DropdownMenuItem,{onClick:e=>{e.stopPropagation(),a(!0)},children:[(0,r.jsx)(ea.Edit,{className:"mr-2 h-4 w-4"}),"Rename"]}),(0,r.jsx)(E.DropdownMenuSeparator,{}),(0,r.jsxs)(E.DropdownMenuItem,{disabled:!e.pinned&&0===e.messageCount,onClick:t=>{t.stopPropagation(),x.handleTogglePin(e.pinned)},children:[(0,r.jsx)(el.Pin,{className:"mr-2 h-4 w-4"}),e.pinned?"Unpin":0===e.messageCount?"Cannot pin empty":"Pin"]}),(0,r.jsxs)(E.DropdownMenuItem,{onClick:t=>{t.stopPropagation(),x.handleToggleStar(e.starred)},children:[(0,r.jsx)(eu.Star,{className:"mr-2 h-4 w-4"}),e.starred?"Unstar":"Star"]}),(0,r.jsxs)(E.DropdownMenuItem,{onClick:e=>{e.stopPropagation(),x.handleArchive()},children:[(0,r.jsx)(en.Archive,{className:"mr-2 h-4 w-4"}),"Archive"]}),(0,r.jsxs)(E.DropdownMenuItem,{onClick:e=>{e.stopPropagation(),N()},disabled:!y?.length,children:[p?(0,r.jsx)(j.Check,{className:"mr-2 h-4 w-4"}):(0,r.jsx)(w.Copy,{className:"mr-2 h-4 w-4"}),p?"Copied!":"Copy conversation"]}),g&&(0,r.jsxs)(E.DropdownMenuItem,{onClick:n=>{n.stopPropagation(),t.push(`/slides/new?conversationId=${e._id}`)},children:[(0,r.jsx)(ec.Presentation,{className:"mr-2 h-4 w-4"}),"Create Presentation"]}),(0,r.jsxs)(E.DropdownMenuItem,{onClick:e=>{e.stopPropagation(),x.handleAutoRename()},children:[(0,r.jsx)(ed.Sparkles,{className:"mr-2 h-4 w-4"}),"Auto-rename"]}),!e.isIncognito&&(e.messageCount??0)>=3&&(0,r.jsxs)(E.DropdownMenuItem,{onClick:e=>{e.stopPropagation(),C()},disabled:c,children:[c?(0,r.jsx)(ei.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(es.Brain,{className:"mr-2 h-4 w-4"}),c?"Extracting...":"Extract Memories"]}),(0,r.jsx)(E.DropdownMenuSeparator,{}),(0,r.jsxs)(E.DropdownMenuSub,{children:[(0,r.jsxs)(E.DropdownMenuSubTrigger,{children:[(0,r.jsx)(eo.Maximize2,{className:"mr-2 h-4 w-4"}),"Chat Width"]}),(0,r.jsxs)(E.DropdownMenuSubContent,{children:[(0,r.jsx)(E.DropdownMenuLabel,{children:"Layout Width"}),(0,r.jsxs)(E.DropdownMenuRadioGroup,{value:M||"standard",onValueChange:e=>z(e),children:[(0,r.jsx)(E.DropdownMenuRadioItem,{value:"narrow",children:"Narrow (672px)"}),(0,r.jsx)(E.DropdownMenuRadioItem,{value:"standard",children:"Standard (896px)"}),(0,r.jsx)(E.DropdownMenuRadioItem,{value:"wide",children:"Wide (1152px)"}),(0,r.jsx)(E.DropdownMenuRadioItem,{value:"full",children:"Full Width (95%)"})]})]})]}),(0,r.jsxs)(E.DropdownMenuSub,{children:[(0,r.jsxs)(E.DropdownMenuSubTrigger,{children:[(0,r.jsx)(er.BarChart3,{className:"mr-2 h-4 w-4"}),"Statistics"]}),(0,r.jsxs)(E.DropdownMenuSubContent,{children:[(0,r.jsx)(E.DropdownMenuLabel,{children:"Display Options"}),(0,r.jsx)(E.DropdownMenuCheckboxItem,{checked:R??!1,onCheckedChange:L,children:"Message Statistics"}),(0,r.jsx)(E.DropdownMenuCheckboxItem,{checked:D??!1,onCheckedChange:P,children:"Comparison Statistics"})]})]}),(0,r.jsx)(E.DropdownMenuSeparator,{}),(0,r.jsxs)(E.DropdownMenuItem,{onClick:e=>{e.stopPropagation(),o(!0)},className:"text-destructive focus:text-destructive",children:[(0,r.jsx)(T.Trash2,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]}),(0,r.jsx)(ev.RenameDialog,{conversation:e,open:n,onOpenChange:a}),(0,r.jsx)(eg.DeleteConversationDialog,{open:i,onOpenChange:o,onConfirm:x.handleDelete,conversationTitle:e.title})]})}var eb=e.i(831710),ej=e.i(49275);function ew({conversationId:e,className:t}){let[n,a]=(0,d.useState)(!1),i=(0,u.useMutation)(s.api.conversations.deleteConversation),o=(0,l.useRouter)(),c=async()=>{a(!0);try{await i({conversationId:e}),em.toast.success("Conversation wiped"),o.push("/")}catch(e){console.error("Failed to wipe conversation:",e),em.toast.error("Failed to wipe conversation")}finally{a(!1)}};return(0,r.jsxs)(ej.AlertDialog,{children:[(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsx)(ej.AlertDialogTrigger,{asChild:!0,children:(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",disabled:n,className:(0,z.cn)("h-7 w-7 shrink-0","text-orange-400/60 hover:text-orange-400","hover:bg-orange-500/10","transition-colors duration-200",t),children:(0,r.jsx)(eb.Flame,{className:"size-4"})})})}),(0,r.jsx)(I.TooltipContent,{side:"bottom",children:"Wipe conversation now"})]}),(0,r.jsxs)(ej.AlertDialogContent,{children:[(0,r.jsxs)(ej.AlertDialogHeader,{children:[(0,r.jsxs)(ej.AlertDialogTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(eb.Flame,{className:"size-5 text-orange-400"}),"Wipe Incognito Chat"]}),(0,r.jsx)(ej.AlertDialogDescription,{children:"This will permanently delete this conversation and all its messages. This action cannot be undone."})]}),(0,r.jsxs)(ej.AlertDialogFooter,{children:[(0,r.jsx)(ej.AlertDialogCancel,{children:"Cancel"}),(0,r.jsxs)(ej.AlertDialogAction,{onClick:c,className:"bg-orange-500 hover:bg-orange-600 text-white",children:[(0,r.jsx)(eb.Flame,{className:"size-4 mr-2"}),"Wipe Now"]})]})]})]})}var eC=e.i(966685);function eN({className:e}){return(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsxs)(Y.Badge,{variant:"outline",className:(0,z.cn)("h-7 text-xs px-3 rounded-full cursor-default select-none","border-violet-500/30 bg-violet-500/5","text-violet-400","transition-colors duration-200",e),children:[(0,r.jsx)(eC.Ghost,{className:"size-3 mr-1.5 opacity-80"}),"Incognito"]})}),(0,r.jsx)(I.TooltipContent,{side:"bottom",children:(0,r.jsx)("p",{className:"text-xs",children:"Ephemeral chat - no memories saved"})})]})}var ek=e.i(135456),eS=e.i(385158);function eM({modelId:e,isComparison:t=!1,comparisonCount:n=0,onClick:s,className:a}){if(t)return(0,r.jsxs)(h.Button,{variant:"outline",size:"sm",onClick:s,title:"Manage comparison models",className:(0,z.cn)("gap-2 h-7 text-xs border-primary/20 bg-primary/2 hover:bg-primary/10 px-3 rounded-full transition-colors min-w-0 w-auto font-medium text-primary/80 hover:text-primary/80 cursor-pointer",a),children:[(0,r.jsx)(ek.Grid,{className:"w-3 h-3"}),(0,r.jsxs)("span",{className:"hidden sm:inline",children:["Comparing ",n," models"]}),(0,r.jsx)("span",{className:"sm:hidden",children:n})]});if(!e)return null;let i=(0,ee.getModelConfig)(e);if(!i)return null;let o=(0,eS.getModelIcon)(e);return(0,r.jsxs)(h.Button,{variant:"outline",size:"sm",onClick:s,title:"Change AI model (⌘J)",className:(0,z.cn)("gap-2 h-7 text-xs border-primary/20 bg-primary/2 hover:bg-primary/10 px-3 rounded-full transition-colors min-w-0 w-auto font-medium text-primary/80 hover:text-primary/80 cursor-pointer",a),children:[(0,r.jsx)(o,{className:"w-3 h-3"}),(0,r.jsx)("span",{className:"hidden sm:inline truncate max-w-[200px]",children:i.name})]})}var eT=e.i(518784),eR=e.i(610012),eE=e.i(173554),eI=e.i(680707),eD=e.i(632555);function ez({conversationId:e}){let[t,n]=(0,d.useState)(!1),[a,i]=(0,d.useState)(""),[o,l]=(0,d.useState)(7),[c,m]=(0,d.useState)(!1),[p,f]=(0,d.useState)(null),[x,g]=(0,d.useState)(!1),v=(0,u.useQuery)(s.api.shares.getByConversation,{conversationId:e}),y=(0,u.useAction)(s.api.shares.create),b=(0,u.useMutation)(s.api.shares.toggle);(0,d.useEffect)(()=>{v?.shareId&&f(`${window.location.origin}/share/${v.shareId}`)},[v]);let C=async()=>{try{let t=await y({conversationId:e,password:a||void 0,expiresIn:o,anonymizeUsernames:c}),n=`${window.location.origin}/share/${t}`;f(n),ex.analytics.track("conversation_shared",{hasPassword:!!a,hasExpiry:!!o,expiresIn:o,anonymizeEnabled:c})}catch(e){console.error("Failed to create share:",e)}},N=async()=>{p&&(await navigator.clipboard.writeText(p),g(!0),setTimeout(()=>g(!1),2e3))},k=async t=>{try{await b({conversationId:e,isActive:t})}catch(e){console.error("Failed to toggle share:",e)}};return(0,r.jsxs)(B.Dialog,{open:t,onOpenChange:n,children:[(0,r.jsx)(B.DialogTrigger,{asChild:!0,children:(0,r.jsx)(h.Button,{variant:"ghost",size:"sm",children:(0,r.jsx)(eT.Share2,{className:"h-4 w-4"})})}),(0,r.jsxs)(B.DialogContent,{children:[(0,r.jsxs)(B.DialogHeader,{children:[(0,r.jsx)(B.DialogTitle,{children:"Share Conversation"}),(0,r.jsx)(B.DialogDescription,{children:"Create a shareable link to this conversation"})]}),p?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(eE.Label,{htmlFor:"share-toggle",children:"Sharing enabled"}),(0,r.jsx)(eD.Switch,{id:"share-toggle",checked:v?.isActive??!0,onCheckedChange:k})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(eR.Input,{value:p,readOnly:!0}),(0,r.jsx)(h.Button,{onClick:N,size:"icon",children:x?(0,r.jsx)(j.Check,{className:"h-4 w-4"}):(0,r.jsx)(w.Copy,{className:"h-4 w-4"})})]}),v?.isActive===!1?(0,r.jsx)("p",{className:"text-sm text-destructive",children:'⚠️ Sharing is disabled. Anyone with the link will see a "revoked" message.'}):(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Anyone with this link can view the conversation",v?.password&&" (password required)",v?.expiresAt&&` (expires ${new Date(v.expiresAt).toLocaleDateString()})`,"."]})]}):(0,r.jsxs)("div",{className:"space-y-4 py-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(eE.Label,{htmlFor:"password",children:"Password (optional)"}),(0,r.jsx)(eR.Input,{id:"password",type:"password",placeholder:"Leave empty for no password",value:a,onChange:e=>i(e.target.value)})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(eE.Label,{htmlFor:"expires",children:"Expires in"}),(0,r.jsxs)(eI.Select,{value:o?.toString()||"never",onValueChange:e=>l("never"===e?void 0:Number(e)),children:[(0,r.jsx)(eI.SelectTrigger,{id:"expires",children:(0,r.jsx)(eI.SelectValue,{})}),(0,r.jsxs)(eI.SelectContent,{children:[(0,r.jsx)(eI.SelectItem,{value:"1",children:"1 day"}),(0,r.jsx)(eI.SelectItem,{value:"7",children:"7 days"}),(0,r.jsx)(eI.SelectItem,{value:"30",children:"30 days"}),(0,r.jsx)(eI.SelectItem,{value:"never",children:"Never"})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(eE.Label,{htmlFor:"anonymize",children:"Anonymize usernames"}),(0,r.jsx)(eD.Switch,{id:"anonymize",checked:c,onCheckedChange:m})]})]}),(0,r.jsx)(B.DialogFooter,{children:p?(0,r.jsx)(h.Button,{onClick:()=>{n(!1),v||(f(null),i(""),l(7),m(!1)),g(!1)},children:"Done"}):(0,r.jsx)(h.Button,{onClick:C,children:"Create Share Link"})})]})]})}var eL=e.i(583993);function eP({conversationId:e,currentProjectId:t}){let n=(0,u.useQuery)(s.api.projects.list),a=(0,u.useMutation)(s.api.projects.assignConversations),i=(0,d.useRef)(t||"none"),o=async t=>{t!==i.current&&(i.current=t,await a({projectId:"none"===t?null:t,conversationIds:[e]}))};return n&&0!==n.length?(0,r.jsxs)(eI.Select,{value:t||"none",onValueChange:o,children:[(0,r.jsx)(eI.SelectTrigger,{className:"w-auto sm:w-[200px] px-2 sm:px-3 max-w-[180px] min-w-0","aria-label":"Select Project",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[(0,r.jsx)(eL.FolderOpen,{className:"w-4 h-4 shrink-0"}),(0,r.jsx)("span",{className:"hidden sm:block truncate min-w-0 flex-1",children:(0,r.jsx)(eI.SelectValue,{placeholder:"No project"})})]})}),(0,r.jsxs)(eI.SelectContent,{children:[(0,r.jsx)(eI.SelectItem,{value:"none",children:"No project"}),n?.map(e=>(0,r.jsx)(eI.SelectItem,{value:e._id,children:(0,r.jsx)("span",{className:"truncate",title:e.name,children:e.name})},e._id))]})]}):null}function e_({conversation:e,conversationId:t,selectedModel:n,modelLoading:s,hasMessages:a,isFirst:i,isLast:o,isComparisonActive:l,comparisonModelCount:c,showProjects:d,onNavigatePrevious:u,onNavigateNext:m,onModelBadgeClick:p,onComparisonBadgeClick:f}){return(0,r.jsxs)("header",{className:"flex items-center gap-4 border-b px-4 py-3 shrink-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",onClick:u,disabled:i,className:"h-7 w-7 shrink-0 cursor-pointer",title:"Previous conversation (⌘[)",children:(0,r.jsx)(V.ChevronLeft,{className:"w-4 h-4"})}),(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",onClick:m,disabled:o,className:"h-7 w-7 shrink-0 cursor-pointer",title:"Next conversation (⌘])",children:(0,r.jsx)(K.ChevronRight,{className:"w-4 h-4"})})]}),(0,r.jsx)("div",{className:"flex items-center gap-1 flex-1 min-w-0",children:(0,r.jsx)("h1",{className:"text-lg font-semibold truncate",children:e?.title||"New Chat"})}),(0,r.jsxs)("div",{className:"hidden sm:flex items-center gap-2",children:[!s&&n&&(0,r.jsx)(eM,{modelId:l?void 0:n,isComparison:l,comparisonCount:c,onClick:l?f:p}),e?.isIncognito&&(0,r.jsx)(eN,{})]}),d&&!e?.isIncognito&&(0,r.jsx)(eP,{conversationId:t,currentProjectId:e?.projectId??void 0}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[a&&t&&(0,r.jsx)(et,{conversationId:t,modelId:n}),t&&(0,r.jsx)(Z,{conversationId:t}),a&&t&&!e?.isIncognito&&(0,r.jsx)(ez,{conversationId:t}),e?.isIncognito&&(0,r.jsx)(ew,{conversationId:t}),e&&(0,r.jsx)(ey,{conversation:e})]})]})}let eA=(0,N.default)("expand",[["path",{d:"m15 15 6 6",key:"1s409w"}],["path",{d:"m15 9 6-6",key:"ko1vev"}],["path",{d:"M21 16v5h-5",key:"1ck2sf"}],["path",{d:"M21 8V3h-5",key:"1qoq8a"}],["path",{d:"M3 16v5h5",key:"1t08am"}],["path",{d:"m3 21 6-6",key:"wwnumi"}],["path",{d:"M3 8V3h5",key:"1ln10m"}],["path",{d:"M9 9 3 3",key:"v551iv"}]]),eF=(0,N.default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var eO=e.i(654270),eB=e.i(593830),e$=e.i(541247),eQ=e.i(943111);e.i(45211);var eG=e.i(555398);let eU={narrow:"max-w-2xl",standard:"max-w-4xl",wide:"max-w-6xl",full:"max-w-[95%]"};var eH=e.i(165002);let eq=(0,N.default)("file-spreadsheet",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);var eW=e.i(672171),eV=e.i(239149);let eK={pdf:"from-red-500/20 to-red-600/10 border-red-500/20",doc:"from-blue-500/20 to-blue-600/10 border-blue-500/20",docx:"from-blue-500/20 to-blue-600/10 border-blue-500/20",xls:"from-green-500/20 to-green-600/10 border-green-500/20",xlsx:"from-green-500/20 to-green-600/10 border-green-500/20",csv:"from-green-500/20 to-green-600/10 border-green-500/20",txt:"from-zinc-500/20 to-zinc-600/10 border-zinc-500/20",default:"from-muted/50 to-muted/30 border-border/50"};function eX(e){return e.split(".").pop()?.toLowerCase()||""}function eY(e){return e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`}function eJ({attachments:e,onRemove:t}){return(0,r.jsx)("div",{className:"flex gap-2 flex-wrap",children:(0,r.jsx)(i.AnimatePresence,{mode:"popLayout",children:e.map((e,n)=>(0,r.jsx)(o.motion.div,{initial:{opacity:0,y:8,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-8,scale:.95},transition:{duration:.2,delay:.05*n,ease:[.4,0,.2,1]},children:"image"===e.type?(0,r.jsx)(eZ,{attachment:e,onRemove:()=>t(n)}):"audio"===e.type?(0,r.jsx)(e0,{attachment:e,onRemove:()=>t(n)}):(0,r.jsx)(e1,{attachment:e,onRemove:()=>t(n)})},`${e.storageId}-${n}`))})})}function eZ({attachment:e,onRemove:t}){let n=(0,u.useQuery)(s.api.files.getFileUrl,{storageId:e.storageId});return(0,r.jsxs)("div",{className:"relative group overflow-hidden rounded-xl w-16 h-16 bg-muted/30 border border-border/30",children:[n?(0,r.jsx)("img",{src:n,alt:e.name,className:"object-cover w-full h-full transition-transform duration-200 group-hover:scale-110"}):(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,r.jsx)(eW.Image,{className:"w-6 h-6 text-muted-foreground/50"})}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),(0,r.jsx)(h.Button,{type:"button",variant:"ghost",size:"icon",onClick:t,className:"absolute top-1 right-1 h-5 w-5 p-0 rounded-full bg-black/50 text-white opacity-0 group-hover:opacity-100 transition-opacity hover:bg-black/70","aria-label":`Remove ${e.name}`,children:(0,r.jsx)(m.X,{className:"w-3 h-3"})}),(0,r.jsx)("span",{className:"absolute bottom-1 left-1 text-[10px] text-white/80 bg-black/40 px-1 rounded opacity-0 group-hover:opacity-100 transition-opacity",children:eY(e.size)})]})}function e0({attachment:e,onRemove:t}){return(0,r.jsxs)("div",{className:"relative group flex items-center gap-2 px-3 py-2 rounded-full bg-gradient-to-r from-violet-500/20 to-violet-600/10 border border-violet-500/20",children:[(0,r.jsx)("div",{className:"w-6 h-6 rounded-full bg-violet-500/20 flex items-center justify-center",children:(0,r.jsx)(eV.Mic,{className:"w-3.5 h-3.5 text-violet-400"})}),(0,r.jsxs)("div",{className:"max-w-[100px] min-w-0",children:[(0,r.jsx)("p",{className:"text-xs font-medium truncate text-foreground/90",children:e.name}),(0,r.jsx)("p",{className:"text-[10px] text-muted-foreground",children:eY(e.size)})]}),(0,r.jsx)(h.Button,{type:"button",variant:"ghost",size:"icon",onClick:t,className:"h-5 w-5 p-0 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-violet-500/20","aria-label":`Remove ${e.name}`,children:(0,r.jsx)(m.X,{className:"w-3 h-3"})})]})}function e1({attachment:e,onRemove:t}){var n;let s,a=eK[eX(e.name)]||eK.default,i=(n=e.mimeType,s=eX(e.name),n.includes("spreadsheet")||["xls","xlsx","csv"].includes(s)?eq:n.includes("pdf")||n.includes("document")||["doc","docx","txt","pdf"].includes(s)?F.FileText:eH.FileIcon);return(0,r.jsxs)("div",{className:(0,z.cn)("relative group flex items-center gap-2 px-3 py-2 rounded-full bg-gradient-to-r border",a),children:[(0,r.jsx)(i,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),(0,r.jsxs)("div",{className:"max-w-[100px] min-w-0",children:[(0,r.jsx)("p",{className:"text-xs font-medium truncate text-foreground/90",children:e.name}),(0,r.jsx)("p",{className:"text-[10px] text-muted-foreground",children:eY(e.size)})]}),(0,r.jsx)(h.Button,{type:"button",variant:"ghost",size:"icon",onClick:t,className:"h-5 w-5 p-0 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-muted/50","aria-label":`Remove ${e.name}`,children:(0,r.jsx)(m.X,{className:"w-3 h-3"})})]})}function e5({stream:e,height:t=120,className:n}){let s=(0,d.useRef)(null),a=(0,d.useRef)(null),i=(0,d.useRef)(null),o=(0,d.useRef)(null),l=(0,d.useRef)("");return(0,d.useEffect)(()=>{let e=document.createElement("div");e.style.color="var(--primary)",e.style.display="none",document.body.appendChild(e),l.current=getComputedStyle(e).color,document.body.removeChild(e)},[]),(0,d.useEffect)(()=>{if(!e)return;let t=new AudioContext,n=t.createAnalyser(),r=t.createMediaStreamSource(e);n.fftSize=512,n.smoothingTimeConstant=.85,r.connect(n),o.current=t,a.current=n;let c=new Uint8Array(n.frequencyBinCount),d=s.current;if(!d)return;let u=d.getContext("2d");if(!u)return;let m=window.devicePixelRatio||1,h=d.getBoundingClientRect();d.width=h.width*m,d.height=h.height*m,u.scale(m,m);let p=(h.width-320)/2,f=()=>{n.getByteFrequencyData(c),u.clearRect(0,0,h.width,h.height);let e=Math.floor(c.length/64);for(let t=0;t<64;t++){let n=c[t*e]/255,r=Math.max(4,n*(.8*h.height)),s=p+5*t,a=(h.height-r)/2,i=.6+.4*n;if(l.current.startsWith("rgb")){let e=l.current.match(/\d+/g);e&&e.length>=3?u.fillStyle=`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${i})`:u.fillStyle=l.current}else u.fillStyle=l.current,u.globalAlpha=i;u.beginPath(),u.roundRect(s,a,3,r,1.5),u.fill(),u.globalAlpha=1}i.current=requestAnimationFrame(f)};return f(),()=>{i.current&&cancelAnimationFrame(i.current),r.disconnect(),n.disconnect(),t.close()}},[e]),(0,r.jsx)("canvas",{ref:s,className:(0,z.cn)("w-full h-full",n),style:{height:"100%",width:"100%"}})}function e2({open:e,onOpenChange:t,value:n,onChange:s,onSubmit:a,placeholder:i}){let o=(0,d.useRef)(null);return(0,d.useEffect)(()=>{e&&o.current&&(o.current.focus(),o.current.setSelectionRange(n.length,n.length))},[e,n.length]),(0,r.jsx)(B.Dialog,{open:e,onOpenChange:t,children:(0,r.jsxs)(B.DialogContent,{className:"max-w-3xl h-[80vh] flex flex-col gap-0 p-0",children:[(0,r.jsx)(B.DialogHeader,{className:"px-4 py-3 border-b shrink-0",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(B.DialogTitle,{className:"text-sm font-medium text-muted-foreground",children:"Edit message"}),(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>t(!1),children:(0,r.jsx)(m.X,{className:"h-4 w-4"})})]})}),(0,r.jsx)("div",{className:"flex-1 p-4 overflow-hidden",children:(0,r.jsx)(e$.Textarea,{ref:o,value:n,onChange:e=>s(e.target.value),onKeyDown:e=>{(e.metaKey||e.ctrlKey)&&"Enter"===e.key&&(e.preventDefault(),a()),"Escape"===e.key&&(e.preventDefault(),t(!1))},placeholder:i,className:"h-full w-full resize-none border-0 bg-transparent focus-visible:ring-0 text-base"})}),(0,r.jsxs)("div",{className:"px-4 py-3 border-t shrink-0 flex items-center justify-between",children:[(0,r.jsxs)("span",{className:"text-xs text-muted-foreground",children:[n.length," characters"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:"⌘ + Enter to send"}),(0,r.jsx)(h.Button,{onClick:a,disabled:!n.trim(),size:"sm",children:"Send"})]})]})]})})}var e4=e.i(985612),e3=e.i(690558);function e6({conversationId:e,attachments:t,onAttachmentsChange:n,onUploadComplete:a,maxSizeMB:i=10,uploading:o,setUploading:l}){let c=(0,u.useMutation)(s.api.files.generateUploadUrl),m=(0,u.useMutation)(s.api.files.saveFile),p=(0,d.useCallback)(async r=>{l(!0);try{let s=[];for(let t of r){if(t.size>1024*i*1024){em.toast.error(`${t.name} exceeds ${i}MB limit`);continue}let n=await c(),r=await fetch(n,{method:"POST",headers:{"Content-Type":t.type},body:t}),{storageId:a}=await r.json();await m({storageId:a,name:t.name,mimeType:t.type,size:t.size,conversationId:e});let o="file";t.type.startsWith("image/")?o="image":t.type.startsWith("audio/")&&(o="audio"),s.push({type:o,name:t.name,storageId:a,mimeType:t.type,size:t.size}),ex.analytics.track("attachment_uploaded",{type:o,size:t.size,mimeType:t.type,countPerMessage:1})}n([...t,...s]),em.toast.success(`Uploaded ${s.length} file${1===s.length?"":"s"}`),a?.()}catch(e){console.error("Upload failed:",e),em.toast.error("Failed to upload files")}finally{l(!1)}},[t,e,c,i,n,a,m,l]),{getRootProps:f,getInputProps:x}=(0,e3.useDropzone)({onDrop:p,disabled:o,maxSize:1024*i*1024,noClick:!1,noKeyboard:!1});return(0,r.jsxs)(h.Button,{type:"button",variant:"ghost",size:"icon",...f(),disabled:o,title:"Attach files",className:"h-8 w-8 rounded-full text-muted-foreground hover:text-foreground hover:bg-muted/50 transition-colors",children:[(0,r.jsx)("input",{...x()}),o?(0,r.jsx)(ei.Loader2,{className:"w-5 h-5 animate-spin"}):(0,r.jsx)(e4.Plus,{className:"w-5 h-5"}),(0,r.jsx)("span",{className:"sr-only",children:"Attach files"})]})}var e8=e.i(846532),e7=e.i(760911);let e9=(0,N.default)("arrow-left-right",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);var te=e.i(774247);function tt({onStartComparison:e,isActive:t,selectedModels:n=[],open:s,onOpenChange:a}){let[i,o]=(0,d.useState)(!1),l=a||o;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsxs)(h.Button,{variant:"ghost",disabled:t,title:"Compare models",onClick:()=>l(!0),className:"h-7 text-xs border border-primary/20 bg-primary/2 hover:bg-primary/10 text-primary/80 hover:text-primary/80 cursor-pointer px-3 rounded-full transition-colors min-w-0 w-auto font-medium gap-1.5","data-tour":"comparison",children:[(0,r.jsx)(e9,{className:"w-3.5 h-3.5"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Compare"})]})}),(0,r.jsx)(I.TooltipContent,{children:(0,r.jsx)("p",{children:"Compare models"})})]}),(0,r.jsx)(te.QuickModelSwitcher,{currentModel:"",onSelectModel:()=>{},open:void 0!==s?s:i,onOpenChange:l,mode:"multiple",selectedModels:n,onSelectedModelsChange:t=>{e(t),l(!1)}})]})}var tn=e.i(381379),tr=e.i(290312);function ts({keys:e}){let t=function(){let[e,t]=(0,d.useState)("Ctrl");return(0,d.useEffect)(()=>{t((0,tr.getServerSafeModifierKey)())},[]),e}(),n=e.map(e=>"mod"===e?t:e);return(0,r.jsx)("kbd",{className:"inline-flex h-5 select-none items-center gap-1 rounded border bg-background/50 px-1.5 font-mono text-[10px] font-medium text-muted-foreground",children:n.map((e,t)=>(0,r.jsxs)("span",{children:[t>0&&(0,r.jsx)("span",{className:"mx-0.5",children:"+"}),e]},e))})}var ta=e.i(497847);function ti({isEmpty:e,hasContent:t}){let{isMobile:n}=(0,eQ.useMobileDetect)();return n?null:(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground/60 hover:text-muted-foreground hover:bg-transparent","aria-label":"Keyboard shortcuts",children:(0,r.jsx)(tn.Keyboard,{className:"h-4 w-4"})})}),(0,r.jsxs)(I.TooltipContent,{side:"top",align:"end",className:"p-3 space-y-2",children:[(0,r.jsx)("p",{className:"text-xs font-medium text-foreground mb-2",children:"Shortcuts"}),t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(to,{keys:["Enter"],label:"Send message"}),(0,r.jsx)(to,{keys:["Shift","Enter"],label:"New line"})]}):e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tl,{keys:["mod","K"],label:"Commands"}),(0,r.jsx)(to,{keys:["Alt","N"],label:"New chat"})]}):(0,r.jsx)(to,{keys:["Shift","Enter"],label:"New line"})]})]})}function to({keys:e,label:t}){return(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4 text-xs",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:t}),(0,r.jsx)(ta.ShortcutBadge,{keys:e})]})}function tl({keys:e,label:t}){return(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4 text-xs",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:t}),(0,r.jsx)(ts,{keys:e})]})}var tc=e.i(108665);let td=[{value:"none",label:"No Reasoning"},{value:"low",label:"Low Reasoning"},{value:"medium",label:"Medium Reasoning"},{value:"high",label:"High Reasoning"}];function tu({value:e,onChange:t,className:n}){return(0,r.jsxs)(eI.Select,{value:e,onValueChange:n=>{t(n),ex.analytics.track("thinking_effort_selected",{effort:n,previousEffort:e})},children:[(0,r.jsx)(eI.SelectTrigger,{className:(0,z.cn)("h-7 text-xs border border-primary/20 bg-primary/5 hover:bg-primary/10 text-primary px-3 rounded-full transition-colors min-w-0 w-auto font-medium gap-1",n),children:(0,r.jsx)(eI.SelectValue,{placeholder:"Reasoning effort",children:(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)(tc.Zap,{className:"w-3.5 h-3.5"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:td.find(t=>t.value===e)?.label})]})})}),(0,r.jsx)(eI.SelectContent,{children:td.map(e=>(0,r.jsx)(eI.SelectItem,{value:e.value,className:"text-xs",children:e.label},e.value))})]})}function tm({isComparisonMode:e,selectedModels:t,onExitComparison:n,onStartComparison:s,comparisonDialogOpen:a,onComparisonDialogOpenChange:i,selectedModel:o,onModelChange:l,modelSelectorOpen:c,onModelSelectorOpenChange:d,supportsThinking:u,thinkingEffort:p,onThinkingEffortChange:f,isEmpty:x,hasContent:g}){return(0,r.jsxs)("div",{className:"px-3 pb-2 flex justify-between items-center gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[e&&n?(0,r.jsxs)(Y.Badge,{variant:"secondary",className:"flex items-center gap-1.5 pr-1 text-xs font-medium",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Comparing"}),(0,r.jsx)("span",{className:"text-foreground",children:t.length}),(0,r.jsx)(h.Button,{size:"icon",variant:"ghost",className:"h-4 w-4 p-0 hover:bg-muted/50 rounded-full",onClick:n,"aria-label":"Exit comparison mode",children:(0,r.jsx)(m.X,{className:"w-3 h-3"})})]}):(0,r.jsx)(te.QuickModelSwitcher,{currentModel:o,onSelectModel:l,open:c??!1,onOpenChange:d??(()=>{}),mode:"single",showTrigger:!0}),u&&p&&f&&!e&&(0,r.jsx)(tu,{value:p,onChange:f})]}),(0,r.jsxs)("div",{className:"flex items-center gap-0.5",children:[s&&(0,r.jsx)(tt,{onStartComparison:s,isActive:e,selectedModels:t,open:a,onOpenChange:i}),(0,r.jsx)(ti,{isEmpty:x,hasContent:g}),(0,r.jsx)(th,{})]})]})}function th(){return(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground/40 hover:text-muted-foreground/60 hover:bg-transparent","aria-label":"AI information",children:(0,r.jsx)(e8.Info,{className:"h-3.5 w-3.5"})})}),(0,r.jsx)(I.TooltipContent,{side:"top",align:"end",className:"max-w-xs",children:(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["AI can make mistakes."," ",(0,r.jsx)(e7.default,{href:"/ai-info",className:"underline hover:text-foreground transition-colors",children:"Verify important info"}),"."]})})]})}var tp=e.i(736436);function tf({quote:e,onDismiss:t}){return(0,r.jsxs)("div",{className:"mx-2 mt-2 p-3 rounded-xl bg-muted/50 dark:bg-white/5 border border-border/50 dark:border-white/10 flex items-start gap-3 group relative",children:[(0,r.jsx)("div",{className:"shrink-0 mt-0.5",children:(0,r.jsx)(tp.Quote,{className:"w-4 h-4 text-primary/70"})}),(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsx)("p",{className:"text-sm text-foreground/90 line-clamp-3 leading-relaxed font-medium",children:e})}),(0,r.jsx)(h.Button,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6 -mr-1 -mt-1 opacity-60 group-hover:opacity-100 transition-opacity",onClick:t,children:(0,r.jsx)(m.X,{className:"w-3 h-3"})})]})}var tx=e.i(310165);function tg({open:e,onOpenChange:t,limit:n}){let[s,a]=(0,d.useState)("");return(0,d.useEffect)(()=>{let t=()=>{let e=new Date,t=new Date(e);t.setDate(t.getDate()+1),t.setHours(0,0,0,0);let n=t.getTime()-e.getTime(),r=Math.floor(n/36e5),s=Math.floor(n%36e5/6e4);a(`${r}h ${s}m`)};if(e){t();let e=setInterval(t,6e4);return()=>clearInterval(e)}},[e]),(0,r.jsx)(B.Dialog,{open:e,onOpenChange:t,children:(0,r.jsxs)(B.DialogContent,{className:"sm:max-w-md",children:[(0,r.jsxs)(B.DialogHeader,{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("div",{className:"p-2 rounded-full bg-destructive/10",children:(0,r.jsx)(tx.AlertCircle,{className:"w-5 h-5 text-destructive"})}),(0,r.jsx)(B.DialogTitle,{children:"Daily Limit Reached"})]}),(0,r.jsxs)(B.DialogDescription,{className:"text-left space-y-3 pt-2",children:[(0,r.jsxs)("p",{children:["You've reached your daily limit of"," ",(0,r.jsxs)("strong",{children:[n," messages"]}),"."]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-muted/50 border",children:[(0,r.jsx)(G.Clock,{className:"w-4 h-4 text-muted-foreground"}),(0,r.jsxs)("span",{className:"text-sm",children:["Resets in"," ",(0,r.jsx)("strong",{className:"text-foreground",children:s})]})]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Your message count resets at midnight (local time). Come back tomorrow to continue chatting!"})]})]}),(0,r.jsx)("div",{className:"flex justify-end mt-2",children:(0,r.jsx)(h.Button,{onClick:()=>t(!1),children:"Got it"})})]})})}let tv=(0,d.forwardRef)(({onTranscript:e,onRecordingStateChange:t,isDisabled:n},a)=>{let[i,o]=(0,d.useState)(!1),[l,c]=(0,d.useState)(!1),m=(0,d.useRef)(null),p=(0,d.useRef)([]),f=(0,d.useRef)(null),x=(0,d.useRef)(null),g=(0,u.useQuery)(s.api.users.getCurrentUser),v=(0,u.useAction)(s.api.transcription.transcribeAudio),y=(0,u.useMutation)(s.api.files.generateUploadUrl),b=(0,ef.useUserPreference)("sttEnabled"),j=(0,ef.useUserPreference)("sttProvider"),w=(0,d.useCallback)(async()=>{if(!b)return void em.toast.error("Voice input disabled in settings");try{let n=await navigator.mediaDevices.getUserMedia({audio:!0});f.current=n;let r=new MediaRecorder(n,{mimeType:"audio/webm;codecs=opus"});p.current=[],r.ondataavailable=e=>{e.data.size>0&&p.current.push(e.data)},r.onstop=async()=>{c(!0),t?.(!1);let n=new Blob(p.current,{type:"audio/webm"});ex.analytics.track("voice_recording_stopped",{durationMs:n.size/16});try{let t=await y(),r=await fetch(t,{method:"POST",headers:{"Content-Type":n.type},body:n});if(!r.ok)throw Error("Failed to upload audio file");let{storageId:s}=await r.json(),a=new Promise((e,t)=>setTimeout(()=>t(Error("TIMEOUT")),95e3)),i=v({storageId:s,mimeType:"audio/webm"}),o=await Promise.race([i,a]),l="send"===x.current;e(o,l),ex.analytics.track("transcription_completed",{autoSendUsed:l})}catch(n){console.error("Transcription failed:",n);let t=n instanceof Error?n.message:String(n);"TIMEOUT"===t?em.toast.error("Transcription timed out. Try recording a shorter message."):em.toast.error(t||"STT not working right now"),e("",!1)}finally{c(!1),x.current=null}},r.start(),m.current=r,o(!0),t?.(!0,n),ex.analytics.track("voice_recording_started")}catch(e){console.error("MediaRecorder failed:",e),em.toast.error("Microphone access denied")}},[b,v,e,t,y]),C=(0,d.useCallback)(e=>{i&&m.current&&(x.current=e,m.current.stop(),f.current&&(f.current.getTracks().forEach(e=>e.stop()),f.current=null),o(!1))},[i]),N=(0,d.useCallback)(()=>{i?C("preview"):w()},[i,w,C]);return((0,d.useImperativeHandle)(a,()=>({stopRecording:C}),[C]),b)?(0,r.jsx)(h.Button,{type:"button",variant:"ghost",size:"icon",onClick:N,disabled:n||l||!g,"aria-label":i?"Stop recording":`Start voice input (${j})`,className:(0,z.cn)("h-8 w-8 rounded-full transition-all duration-300",i?"bg-primary text-primary-foreground hover:bg-primary/90":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:(0,r.jsxs)("div",{className:"relative w-4 h-4 flex items-center justify-center","aria-hidden":"true",children:[(0,r.jsx)("div",{className:(0,z.cn)("absolute inset-0 flex items-center justify-center transition-all duration-300 transform",i?"opacity-100 scale-100 rotate-0":"opacity-0 scale-50 rotate-90"),children:(0,r.jsx)("div",{className:"h-3 w-3 bg-current rounded-[2px]"})}),(0,r.jsx)("div",{className:(0,z.cn)("absolute inset-0 flex items-center justify-center transition-all duration-300 transform",i?"opacity-0 scale-50 -rotate-90":"opacity-100 scale-100 rotate-0"),children:(0,r.jsx)(eV.Mic,{className:"w-4 h-4"})})]})}):null});tv.displayName="VoiceInput";let ty=(0,d.memo)(function({conversationId:e,isGenerating:t,selectedModel:n,onModelChange:a,thinkingEffort:l,onThinkingEffortChange:c,attachments:m,chatWidth:p,onAttachmentsChange:f,isComparisonMode:x=!1,selectedModels:g=[],onStartComparison:v,onExitComparison:y,isEmpty:b=!1,modelSelectorOpen:j,onModelSelectorOpenChange:w,comparisonDialogOpen:C,onComparisonDialogOpenChange:N,onOptimisticUpdate:k}){let[S,M]=(0,d.useState)(""),[T,R]=(0,d.useState)(!1),[E,D]=(0,d.useState)(!1),[L,P]=(0,d.useState)(!1),[_,A]=(0,d.useState)(null),[F,O]=(0,d.useState)(!1),[B,$]=(0,d.useState)(!1),[Q,G]=(0,d.useState)(!1),[U,H]=(0,d.useState)(!1),[q,W]=(0,d.useState)(!1),[V,K]=(0,d.useState)(null),[X,Y]=(0,d.useState)(null),J=(0,d.useRef)(null),Z=(0,d.useRef)(null),et=(0,d.useRef)(null),en=(0,d.useRef)(0),{isMobile:er,isTouchDevice:es}=(0,eQ.useMobileDetect)(),ea=function(e){let[t,n]=(0,d.useState)(!1);return(0,d.useEffect)(()=>{n(e in window)},[e]),t}("webkitSpeechRecognition"),{mutate:eo}=(0,eG.useSendMessage)(k),el=(0,u.useMutation)(s.api.chat.stopGeneration),ec=(0,u.useQuery)(s.api.messages.getLastAssistantMessage,{conversationId:e}),ed=(0,ee.getModelConfig)(n);ed?.capabilities?.includes("vision");let eu=!!ed?.reasoning,em=async r=>{if(r.preventDefault(),t||!S.trim()&&!X||T||E)return;R(!0);let s=S.trim(),a=[...m];eo({conversationId:e,content:X?`> ${X}

${s}`:s,...x?{models:g}:{modelId:n},thinkingEffort:l,attachments:m.length>0?m:void 0},{onError:e=>{J.current?.value?.trim()||(M(s),Y(X),f(a)),e instanceof Error&&e.message.includes("Daily message limit")&&H(!0)}}),M(""),Y(null),f([]),R(!1),er||setTimeout(()=>J.current?.focus(),0)},{handleKeyDown:eh}=function({input:e,setInput:t,textareaRef:n,onSubmit:r}){return{handleKeyDown:s=>{if("Enter"!==s.key||s.shiftKey||(s.preventDefault(),r(s)),(s.metaKey||s.ctrlKey)&&"$"===s.key){s.preventDefault();let r=n.current;if(!r)return;let a=r.selectionStart,i=r.selectionEnd;t(e.substring(0,a)+"$$\n\n$$"+e.substring(i)),setTimeout(()=>{r.focus(),r.selectionStart=r.selectionEnd=a+3},0)}}}}({input:S,setInput:M,textareaRef:J,onSubmit:em});!function({textareaRef:e,setInput:t,setQuote:n,isEmpty:r,isMobile:s,isTouchDevice:a,lastAssistantMessageId:i,lastAssistantMessageStatus:o,lastCompletedMessageId:l,setLastCompletedMessageId:c}){(0,d.useEffect)(()=>{let n=n=>{t(n.detail),e.current?.focus()};return window.addEventListener("insert-prompt",n),()=>{window.removeEventListener("insert-prompt",n)}},[t,e]),(0,d.useEffect)(()=>{let t=t=>{n(t.detail),e.current?.focus()};return window.addEventListener("quote-selection",t),()=>{window.removeEventListener("quote-selection",t)}},[n,e]),(0,d.useEffect)(()=>{let t=()=>{e.current?.focus()};return window.addEventListener("focus-chat-input",t),()=>{window.removeEventListener("focus-chat-input",t)}},[e]);let u=(0,d.useRef)(!1);(0,d.useEffect)(()=>{if(r&&!s&&!a&&e.current&&!u.current){u.current=!0;let t=setTimeout(()=>{e.current?.focus()},300);return()=>clearTimeout(t)}},[r,s,a,e]);let m=(0,d.useRef)(null);(0,d.useEffect)(()=>(m.current&&(clearTimeout(m.current),m.current=null),s||"complete"!==o||i===l||document.activeElement?.tagName==="INPUT"||document.activeElement?.tagName==="TEXTAREA"||(c(i),m.current=setTimeout(()=>{document.activeElement?.tagName!=="INPUT"&&document.activeElement?.tagName!=="TEXTAREA"&&e.current?.focus(),m.current=null},100)),()=>{m.current&&(clearTimeout(m.current),m.current=null)}),[o,i,l,c,s,e])}({textareaRef:J,setInput:M,setQuote:Y,isEmpty:b,isMobile:er,isTouchDevice:es,lastAssistantMessageId:ec?._id,lastAssistantMessageStatus:ec?.status,lastCompletedMessageId:V,setLastCompletedMessageId:K});let ep=async t=>{t.preventDefault(),t.stopPropagation();try{await el({conversationId:e}),ex.analytics.track("generation_stopped",{model:n,source:"stop_button"})}catch(e){console.error("Failed to stop generation:",e)}};(0,d.useEffect)(()=>{let e=J.current;e&&(e.style.height="auto",e.style.height=`${Math.min(e.scrollHeight,200)}px`)},[S]);let ef=()=>{let e=(0,ee.getModelConfig)(n);return e?.capabilities?.includes("vision")?"Describe an image or upload a file...":e?.capabilities?.includes("thinking")||e?.capabilities?.includes("extended-thinking")?"Ask me to reason through a problem...":"Message blah.chat..."},eg=S.trim().length>0||X,ev=(eg||L||t)&&!T&&!E,ey=!eg&&!t&&ea&&!L,eb=S.length>100;return(0,r.jsxs)("div",{className:(0,z.cn)("w-full mx-auto px-2 sm:px-4 pb-4 sm:pb-6 !pb-[calc(1rem+env(safe-area-inset-bottom))] transition-[max-width] duration-300 ease-out",function(e,t=!1){return t?eU.full:eU[e||"standard"]}(p,!1)),children:[(0,r.jsxs)("form",{ref:Z,onSubmit:em,onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),en.current++,e.dataTransfer.types.includes("Files")&&G(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),en.current--,0===en.current&&G(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation(),en.current=0,G(!1)},role:"search","aria-label":"Send message to AI",className:(0,z.cn)("relative flex flex-col gap-2 p-2 transition-all duration-300 ease-out","bg-background/60 backdrop-blur-xl","border border-white/[0.06] dark:border-white/[0.08]","rounded-3xl","shadow-[0_1px_2px_rgba(0,0,0,0.04),0_4px_8px_rgba(0,0,0,0.06),0_8px_16px_rgba(0,0,0,0.04)]",B&&["ring-1 ring-primary/20","shadow-[0_0_0_1px_rgba(var(--primary-rgb),0.1),0_2px_8px_rgba(var(--primary-rgb),0.08),0_8px_24px_rgba(var(--primary-rgb),0.06)]","border-primary/20"],!B&&"hover:border-white/[0.1] hover:shadow-[0_1px_2px_rgba(0,0,0,0.04),0_4px_12px_rgba(0,0,0,0.08),0_12px_24px_rgba(0,0,0,0.06)]"),children:[(0,r.jsx)(i.AnimatePresence,{children:Q&&(0,r.jsxs)(o.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"absolute inset-0 z-10 rounded-3xl overflow-hidden pointer-events-none",children:[(0,r.jsx)("div",{className:"absolute inset-0 border-2 border-dashed border-primary/50 rounded-3xl animate-pulse"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-primary/5 backdrop-blur-sm flex items-center justify-center",children:(0,r.jsxs)(o.motion.div,{initial:{y:4,opacity:0},animate:{y:0,opacity:1},transition:{delay:.05},className:"flex flex-col items-center gap-2",children:[(0,r.jsx)("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:(0,r.jsx)(eB.Upload,{className:"w-6 h-6 text-primary"})}),(0,r.jsx)("span",{className:"text-sm font-medium text-primary",children:"Drop files here"})]})})]})}),X&&(0,r.jsx)(tf,{quote:X,onDismiss:()=>Y(null)}),m.length>0&&(0,r.jsx)("div",{className:"px-3 pt-2",children:(0,r.jsx)(eJ,{attachments:m,onRemove:e=>f(m.filter((t,n)=>n!==e))})}),(0,r.jsxs)("div",{className:"flex gap-2 items-end px-2",children:[(0,r.jsx)("div",{className:"pb-1.5 flex-shrink-0",children:(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsx)("div",{children:(0,r.jsx)(e6,{conversationId:e,attachments:m,onAttachmentsChange:f,onUploadComplete:()=>J.current?.focus(),uploading:E,setUploading:D})})}),(0,r.jsx)(I.TooltipContent,{side:"top",children:(0,r.jsx)("p",{children:"Attach files"})})]})}),(0,r.jsx)("div",{className:"flex-1 min-w-0 relative",children:L?(0,r.jsxs)("div",{className:"relative min-h-[50px] flex items-center justify-center rounded-xl overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/5 via-primary/10 to-primary/5 animate-pulse"}),(0,r.jsx)("div",{className:"absolute inset-0 border border-primary/20 rounded-xl"}),(0,r.jsx)(e5,{stream:_,height:50,className:"absolute inset-0 w-full h-full"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e$.Textarea,{ref:J,"data-testid":"chat-input",value:S,onChange:e=>M(e.target.value),onKeyDown:eh,onFocus:()=>$(!0),onBlur:()=>$(!1),placeholder:ef(),"aria-label":"Message input","aria-describedby":"input-hint","aria-multiline":"true",className:"resize-none min-h-[50px] max-h-[200px] py-3 px-2 pr-8 bg-transparent border-0 shadow-none focus-visible:ring-0 text-base placeholder:text-muted-foreground/50",rows:1,disabled:T||E,"data-tour":"input"}),eb&&(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsx)(h.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>W(!0),className:"absolute top-2 right-1 h-6 w-6 text-muted-foreground/50 hover:text-muted-foreground hover:bg-transparent","aria-label":"Expand input",children:(0,r.jsx)(eA,{className:"w-3.5 h-3.5"})})}),(0,r.jsx)(I.TooltipContent,{side:"top",children:(0,r.jsx)("p",{children:"Expand editor"})})]})]})}),(0,r.jsx)("div",{id:"input-hint",className:"sr-only",children:"Type your message. Press Enter to send, Shift+Enter for new line."}),(0,r.jsx)("div",{className:"pb-1.5 flex-shrink-0 flex items-center gap-1",children:ey?(0,r.jsxs)(I.Tooltip,{children:[(0,r.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,r.jsx)("div",{children:(0,r.jsx)(tv,{ref:et,onTranscript:async(t,r)=>{if(O(!1),r&&t.trim()){R(!0);try{await eo({conversationId:e,content:t.trim(),...x?{models:g}:{modelId:n},thinkingEffort:l,attachments:m.length>0?m:void 0}),f([])}catch(e){e instanceof Error&&e.message.includes("Daily message limit")?H(!0):console.error("Failed to send message:",e)}finally{R(!1)}}else M(e=>e.trim()?`${e} ${t}`:t)},onRecordingStateChange:(e,t)=>{P(e),A(t||null),!e&&t&&O(!0)},isDisabled:T||E})})}),(0,r.jsx)(I.TooltipContent,{children:(0,r.jsx)("p",{children:"Voice input"})})]}):(0,r.jsx)(o.motion.div,{whileHover:ev?{scale:1.05}:void 0,whileTap:ev?{scale:.95,rotate:-2}:void 0,transition:{type:"spring",stiffness:400,damping:17},children:(0,r.jsx)(h.Button,{type:t||L?"button":"submit",size:"icon",onClick:t?ep:L?()=>et.current?.stopRecording("send"):void 0,"data-testid":"send-button","aria-label":t?"Stop generating response":L?"Stop recording and send":"Send message",className:(0,z.cn)("h-10 w-10 rounded-full transition-all duration-200",ev?["bg-primary text-primary-foreground","shadow-[0_2px_8px_rgba(var(--primary-rgb),0.25)]","hover:shadow-[0_4px_16px_rgba(var(--primary-rgb),0.35)]"]:"bg-muted/50 text-muted-foreground/50"),disabled:!ev,children:T?(0,r.jsx)(ei.Loader2,{className:"w-5 h-5 animate-spin","aria-hidden":"true"}):t?(0,r.jsx)(eO.Square,{className:"w-4 h-4 fill-current","aria-hidden":"true"}):(0,r.jsx)(eF,{className:"w-5 h-5 ml-0.5","aria-hidden":"true"})})})})]}),(0,r.jsx)(tm,{isComparisonMode:x,selectedModels:g,onExitComparison:y,onStartComparison:v,comparisonDialogOpen:C,onComparisonDialogOpenChange:N,selectedModel:n,onModelChange:a,modelSelectorOpen:j,onModelSelectorOpenChange:w,supportsThinking:eu,thinkingEffort:l,onThinkingEffortChange:c,isEmpty:b,hasContent:S.length>0})]}),(0,r.jsx)(tg,{open:U,onOpenChange:H,limit:50}),(0,r.jsx)(e2,{open:q,onOpenChange:W,value:S,onChange:M,onSubmit:()=>{W(!1),Z.current?.requestSubmit()},placeholder:ef()})]})});var tb=e.i(897885);let tj=(0,N.default)("arrow-right-left",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);var tw=e.i(320287),tC=e.i(833250);function tN({open:e,onOpenChange:t,currentModelId:n,suggestedModelId:a,currentResponse:i,onSwitch:o,conversationId:l,userMessage:c}){let[m,p]=(0,d.useState)(""),[f,x]=(0,d.useState)(!0),[g,v]=(0,d.useState)(0),y=tw.MODEL_CONFIG[n],b=tw.MODEL_CONFIG[a],j=(0,u.useMutation)(s.api.conversations.dismissModelRecommendation),w=(0,u.useMutation)(s.api.users.updatePreferences),C=(0,d.useRef)(null),N=(0,d.useRef)(null),k=(0,d.useRef)(null),S=(0,u.useAction)(s.api.ai.modelTriage.generatePreview),M=(0,d.useCallback)(async()=>{x(!0);try{let e=await S({conversationId:l,suggestedModelId:a,userMessage:c});p(e.content),ex.analytics.track("recommendation_preview_completed",{conversationId:l,currentModel:n,suggestedModel:a,generationTimeMs:Date.now()-g,responseLength:e.content.length,timestamp:Date.now()}),ex.analytics.track("recommendation_preview_compared",{conversationId:l,currentModel:n,suggestedModel:a,userSpentTimeComparingMs:Date.now()-g,timestamp:Date.now()})}catch(e){console.error("Failed to generate preview:",e),p("Failed to generate preview. Please try again.")}finally{x(!1)}},[S,l,a,c,n,g]);(0,d.useEffect)(()=>{e&&(v(Date.now()),M())},[e,M]),(0,d.useEffect)(()=>{let e=C.current,t=N.current;if(!e||!t)return;let n=()=>{if("right"===k.current)return;k.current="left";let n=e.scrollTop/(e.scrollHeight-e.clientHeight);t.scrollHeight>t.clientHeight&&(t.scrollTop=n*(t.scrollHeight-t.clientHeight)),window.requestAnimationFrame(()=>{"left"===k.current&&(k.current=null)})},r=()=>{if("left"===k.current)return;k.current="right";let n=t.scrollTop/(t.scrollHeight-t.clientHeight);e.scrollHeight>e.clientHeight&&(e.scrollTop=n*(e.scrollHeight-e.clientHeight)),window.requestAnimationFrame(()=>{"right"===k.current&&(k.current=null)})};return e.addEventListener("scroll",n),t.addEventListener("scroll",r),()=>{e.removeEventListener("scroll",n),t.removeEventListener("scroll",r)}},[]);let T=async()=>{if(!b||!y)return;let e=Math.round((1-(b.pricing.input+b.pricing.output)/(y.pricing.input+y.pricing.output))*100);ex.analytics.track("recommendation_accepted",{conversationId:l,from:n,to:a,savings:e,viaPreview:!0,userSpentTimeComparingMs:Date.now()-g,timestamp:Date.now()}),o(a);try{await j({conversationId:l})}catch(e){console.error("Failed to dismiss recommendation:",e)}try{console.log("[ModelPreviewModal] Updating preferences:",{newChatModelSelection:"fixed",defaultModel:a}),await w({preferences:{newChatModelSelection:"fixed",defaultModel:a}}),console.log("[ModelPreviewModal] Preferences updated successfully"),ex.analytics.track("model_preference_updated",{event:"recommendation_switch",modelId:a})}catch(e){console.error("[ModelPreviewModal] Failed to update global preference:",e)}window.dispatchEvent(new CustomEvent("focus-chat-input")),t(!1)},R=Math.round((1-(b.pricing.input+b.pricing.output)/(y.pricing.input+y.pricing.output))*100);return y&&b?(0,r.jsx)(B.Dialog,{open:e,onOpenChange:t,children:(0,r.jsxs)(B.DialogContent,{className:"w-full max-w-[96vw] xl:max-w-[1600px] h-[92vh] flex flex-col p-0 gap-0 overflow-hidden border-surface-glass-border bg-background/95 backdrop-blur-xl",children:[(0,r.jsx)(B.DialogHeader,{className:"px-8 py-5 border-b shrink-0 flex flex-row items-center justify-between bg-muted/30",children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"p-2.5 rounded-full bg-primary/10 text-primary",children:(0,r.jsx)(tj,{className:"w-5 h-5"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)(B.DialogTitle,{className:"text-xl font-semibold tracking-tight",children:"Model Comparison"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mt-1.5 font-normal",children:"Review how the suggested model responds to your request"})]})]})}),(0,r.jsxs)("div",{className:"flex-1 min-h-0 grid grid-cols-1 xl:grid-cols-2 divide-y xl:divide-y-0 xl:divide-x divide-border overflow-hidden bg-muted/5 relative",children:[(0,r.jsxs)("div",{className:"flex flex-col min-h-0 bg-background/50 h-full",children:[(0,r.jsxs)("div",{className:"p-4 px-6 border-b flex items-center justify-between bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-10 shadow-sm",children:[(0,r.jsx)("div",{className:"flex items-center gap-4",children:(0,r.jsxs)("div",{className:"font-semibold text-foreground flex items-center gap-3 text-lg",children:[y.name,(0,r.jsx)(Y.Badge,{variant:"secondary",className:"text-[10px] font-mono tracking-wider px-2 py-0.5 uppercase opacity-80",children:"Current"})]})}),(0,r.jsxs)("div",{className:"flex flex-col items-end text-xs gap-0.5",children:[(0,r.jsxs)("span",{className:"text-foreground font-mono font-medium text-sm",children:["$",((y.pricing.input+y.pricing.output)/2).toFixed(2)," ","/ 1M"]}),(0,r.jsx)("span",{className:"text-muted-foreground/60",children:"Estimated Cost"})]})]}),(0,r.jsx)("div",{ref:C,className:"flex-1 overflow-y-auto",children:(0,r.jsx)("div",{className:"max-w-none p-8 md:p-10",children:(0,r.jsx)(tC.MarkdownContent,{content:i})})})]}),(0,r.jsxs)("div",{className:"flex flex-col min-h-0 bg-background h-full relative group",children:[(0,r.jsxs)("div",{className:"p-4 px-6 border-b flex items-center justify-between bg-blue-50/10 backdrop-blur supports-[backdrop-filter]:bg-blue-50/5 sticky top-0 z-10 shadow-sm",children:[(0,r.jsx)("div",{className:"flex items-center gap-4",children:(0,r.jsxs)("div",{className:"font-semibold text-foreground flex items-center gap-3 text-lg",children:[b.name,(0,r.jsxs)(Y.Badge,{className:"bg-green-500/15 text-green-700 dark:text-green-400 hover:bg-green-500/25 border-green-500/20 text-[10px] font-mono tracking-wider px-2 py-0.5 uppercase",children:[R,"% Cheaper"]})]})}),(0,r.jsxs)("div",{className:"flex flex-col items-end text-xs gap-0.5",children:[(0,r.jsxs)("span",{className:"text-green-600 dark:text-green-400 font-mono font-medium text-sm",children:["$",((b.pricing.input+b.pricing.output)/2).toFixed(2)," ","/ 1M"]}),(0,r.jsx)("span",{className:"text-muted-foreground/60",children:"Estimated Cost"})]})]}),(0,r.jsx)("div",{ref:N,className:"flex-1 overflow-y-auto bg-gradient-to-b from-blue-50/5 to-transparent",children:f?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full gap-5 text-muted-foreground p-10",children:[(0,r.jsx)(ei.Loader2,{className:"h-10 w-10 animate-spin text-primary/50"}),(0,r.jsx)("p",{className:"text-sm font-medium animate-pulse tracking-wide",children:"Generating comparison response..."})]}):(0,r.jsx)("div",{className:"max-w-none p-8 md:p-10",children:(0,r.jsx)(tC.MarkdownContent,{content:m})})})]})]}),(0,r.jsx)(B.DialogFooter,{className:"border-t p-6 bg-background/95 backdrop-blur shrink-0 flex flex-col xl:flex-row !justify-end gap-4 items-center z-20 shadow-[0_-5px_20px_-10px_rgba(0,0,0,0.1)]",children:(0,r.jsxs)("div",{className:"flex items-center gap-4 w-full xl:w-auto justify-end",children:[(0,r.jsx)(h.Button,{variant:"ghost",onClick:()=>t(!1),className:"text-muted-foreground hover:text-foreground px-6",children:"Cancel"}),(0,r.jsxs)(h.Button,{onClick:T,disabled:f,size:"lg",className:"bg-primary hover:bg-primary/90 text-primary-foreground shadow-lg shadow-primary/20 flex-1 xl:flex-none min-w-[200px] font-medium",children:["Switch to ",b.name]})]})})]})}):null}var tk=e.i(285659),tS=e.i(924398);function tM({modelId:e,modelName:t,onSetDefault:n,onDismiss:s,conversationId:a}){return(0,d.useEffect)(()=>{ex.analytics.track("set_default_prompt_shown",{conversationId:a,modelId:e,afterAcceptingRecommendation:!0,timestamp:Date.now()})},[a,e]),(0,r.jsx)(i.AnimatePresence,{children:(0,r.jsx)(o.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3,ease:"easeOut"},className:"mx-auto mb-4 max-w-3xl rounded-xl border border-green-500/30 bg-gradient-to-r from-green-500/10 to-emerald-500/10 p-4 shadow-lg",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"mt-0.5 rounded-lg bg-green-500/20 p-2",children:(0,r.jsx)(tS.CheckCircle,{className:"h-4 w-4 text-green-400"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("p",{className:"text-sm font-medium text-green-200",children:[t," worked great! 💚"]}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Make it your default model for future chats?"})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)(h.Button,{size:"sm",onClick:()=>{ex.analytics.track("set_default_accepted",{conversationId:a,modelId:e,timestamp:Date.now()}),n()},className:"bg-green-500 hover:bg-green-600 text-white",children:"Set as default"}),(0,r.jsx)(h.Button,{size:"sm",variant:"ghost",onClick:()=>{ex.analytics.track("set_default_dismissed",{conversationId:a,modelId:e,timestamp:Date.now()}),s()},className:"text-muted-foreground hover:text-foreground",children:(0,r.jsx)(m.X,{className:"h-4 w-4"})})]})]})})})}var tT=e.i(479591),tR=e.i(502772),tE=e.i(952244),tI=e.i(168280),tD=e.i(722434);function tz(e){if(!Number.isFinite(e)||e<0)return"0:00";let t=Math.floor(e/60),n=Math.floor(e%60).toString().padStart(2,"0");return`${t}:${n}`}let tL=[.5,.75,1,1.25,1.5,1.75,2];function tP({className:e}){let{state:t,pause:n,resume:s,stop:a,seekBy:i,seekTo:o,setSpeed:l,close:c}=(0,tD.useTTSPlayer)(),{isVisible:u,isLoading:p,isPlaying:f,duration:x,currentTime:g,speed:v}=t,y=(0,d.useMemo)(()=>x&&x>0?x:Math.max(g,1),[x,g]),b=(0,d.useCallback)(()=>{p||(f?n():s())},[p,f,n,s]),j=(0,d.useCallback)(e=>{let t,n=tL.indexOf(v);t="up"===e?(n+1)%tL.length:(n-1+tL.length)%tL.length,l(tL[t])},[v,l]);return((0,d.useEffect)(()=>{if(!u)return;let e=e=>{if(document.activeElement?.tagName!=="INPUT"&&document.activeElement?.tagName!=="TEXTAREA"&&document.activeElement?.getAttribute("contenteditable")!=="true")switch(e.key.toLowerCase()){case" ":e.preventDefault(),b();break;case"escape":e.preventDefault(),c();break;case"l":e.preventDefault(),i(15);break;case"h":e.preventDefault(),i(-15);break;case"k":e.preventDefault(),j("up");break;case"j":e.preventDefault(),j("down")}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[u,b,c,i,j]),u||p)?(0,r.jsx)("div",{className:(0,z.cn)("pointer-events-none fixed left-0 right-0 top-[76px] z-40 px-4","flex justify-center",e),children:(0,r.jsxs)("div",{className:(0,z.cn)("pointer-events-auto flex w-full max-w-lg flex-col gap-0 overflow-hidden","rounded-2xl border border-white/20 bg-background/80 shadow-2xl backdrop-blur-xl","dark:border-white/10 dark:bg-black/60","transform transition-all duration-300 ease-out animate-in fade-in slide-in-from-top-4"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between border-b border-white/5 bg-white/5 px-4 py-2.5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 overflow-hidden text-xs text-muted-foreground",children:[(0,r.jsxs)("span",{children:[(0,r.jsx)("kbd",{className:"rounded bg-secondary px-1.5 py-0.5 font-mono text-[10px]",children:"Space"})," ","Play/Pause"]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("kbd",{className:"rounded bg-secondary px-1.5 py-0.5 font-mono text-[10px]",children:"K"}),"/",(0,r.jsx)("kbd",{className:"rounded bg-secondary px-1.5 py-0.5 font-mono text-[10px]",children:"J"})," ","Speed"]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("kbd",{className:"rounded bg-secondary px-1.5 py-0.5 font-mono text-[10px]",children:"H"}),"/",(0,r.jsx)("kbd",{className:"rounded bg-secondary px-1.5 py-0.5 font-mono text-[10px]",children:"L"})," ","±15s"]})]}),(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 shrink-0 rounded-full text-muted-foreground hover:bg-white/10 hover:text-foreground",onClick:c,title:"Close (Esc)",children:(0,r.jsx)(m.X,{className:"h-3.5 w-3.5"})})]}),(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsxs)("div",{className:"mb-4 flex items-center gap-3",children:[(0,r.jsx)("span",{className:"w-9 text-right text-xs tabular-nums text-muted-foreground",children:tz(g)}),(0,r.jsx)(tI.Slider,{value:[Math.min(g,y)],min:0,max:y,step:.1,onValueChange:([e])=>o(e),className:"mt-0.5 flex-1 cursor-pointer","aria-label":"Seek"}),(0,r.jsx)("span",{className:"w-9 text-xs tabular-nums text-muted-foreground",children:tz(x)})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(h.Button,{variant:"ghost",size:"sm",className:(0,z.cn)("h-8 min-w-[3rem] px-0 text-xs font-medium text-muted-foreground hover:text-foreground","rounded-full bg-secondary/50 hover:bg-secondary"),onClick:()=>j("up"),title:"Change Speed (J/K)",children:[v,"x"]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full text-foreground/80 hover:bg-primary/10 hover:text-primary",onClick:()=>i(-15),disabled:p,title:"Rewind 15s (H)",children:(0,r.jsx)(tE.RotateCcw,{className:"h-4 w-4"})}),(0,r.jsx)(h.Button,{size:"icon",className:"h-12 w-12 rounded-full shadow-lg shadow-primary/20 transition-transform active:scale-95",onClick:b,disabled:p,title:f?"Pause (Space)":"Play (Space)",children:p?(0,r.jsx)(ei.Loader2,{className:"h-5 w-5 animate-spin"}):f?(0,r.jsx)(tT.Pause,{className:"h-5 w-5 fill-current"}):(0,r.jsx)(tR.Play,{className:"h-5 w-5 fill-current ml-0.5"})}),(0,r.jsx)(h.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full text-foreground/80 hover:bg-primary/10 hover:text-primary",onClick:()=>i(15),disabled:p,title:"Forward 15s (L)",children:(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)(tE.RotateCcw,{className:"h-4 w-4 scale-x-[-1]"})})})]}),(0,r.jsx)("div",{className:"w-[3rem]"})]})]})]})}):null}var t_=e.i(70779),tA=e.i(761625),tF=e.i(474447),tO=e.i(848053),tB=e.i(105551),t$=e.i(782398),tQ=e.i(609141),tG=e.i(577405),tU=e.i(99006),tH=class extends t$.Subscribable{constructor(e,t){super(),this.options=t,this.#e=e,this.#t=null,this.#n=(0,tQ.pendingThenable)(),this.bindMethods(),this.setOptions(t)}#e;#r=void 0;#s=void 0;#a=void 0;#i;#o;#n;#t;#l;#c;#d;#u;#m;#h;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#r.addObserver(this),tq(this.#r,this.options)?this.#f():this.updateResult(),this.#x())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return tW(this.#r,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return tW(this.#r,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#g(),this.#v(),this.#r.removeObserver(this)}setOptions(e){let t=this.options,n=this.#r;if(this.options=this.#e.defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof(0,tG.resolveEnabled)(this.options.enabled,this.#r))throw Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#y(),this.#r.setOptions(this.options),t._defaulted&&!(0,tG.shallowEqualObjects)(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#r,observer:this});let r=this.hasListeners();r&&tV(this.#r,n,this.options,t)&&this.#f(),this.updateResult(),r&&(this.#r!==n||(0,tG.resolveEnabled)(this.options.enabled,this.#r)!==(0,tG.resolveEnabled)(t.enabled,this.#r)||(0,tG.resolveStaleTime)(this.options.staleTime,this.#r)!==(0,tG.resolveStaleTime)(t.staleTime,this.#r))&&this.#b();let s=this.#j();r&&(this.#r!==n||(0,tG.resolveEnabled)(this.options.enabled,this.#r)!==(0,tG.resolveEnabled)(t.enabled,this.#r)||s!==this.#h)&&this.#w(s)}getOptimisticResult(e){var t,n;let r=this.#e.getQueryCache().build(this.#e,e),s=this.createResult(r,e);return t=this,n=s,(0,tG.shallowEqualObjects)(t.getCurrentResult(),n)||(this.#a=s,this.#o=this.options,this.#i=this.#r.state),s}getCurrentResult(){return this.#a}trackResult(e,t){return new Proxy(e,{get:(e,n)=>(this.trackProp(n),t?.(n),"promise"===n&&(this.trackProp("data"),this.options.experimental_prefetchInRender||"pending"!==this.#n.status||this.#n.reject(Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(e,n))})}trackProp(e){this.#p.add(e)}getCurrentQuery(){return this.#r}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){let t=this.#e.defaultQueryOptions(e),n=this.#e.getQueryCache().build(this.#e,t);return n.fetch().then(()=>this.createResult(n,t))}fetch(e){return this.#f({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#a))}#f(e){this.#y();let t=this.#r.fetch(this.options,e);return e?.throwOnError||(t=t.catch(tG.noop)),t}#b(){this.#g();let e=(0,tG.resolveStaleTime)(this.options.staleTime,this.#r);if(tG.isServer||this.#a.isStale||!(0,tG.isValidTimeout)(e))return;let t=(0,tG.timeUntilStale)(this.#a.dataUpdatedAt,e);this.#u=tU.timeoutManager.setTimeout(()=>{this.#a.isStale||this.updateResult()},t+1)}#j(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#r):this.options.refetchInterval)??!1}#w(e){this.#v(),this.#h=e,!tG.isServer&&!1!==(0,tG.resolveEnabled)(this.options.enabled,this.#r)&&(0,tG.isValidTimeout)(this.#h)&&0!==this.#h&&(this.#m=tU.timeoutManager.setInterval(()=>{(this.options.refetchIntervalInBackground||tF.focusManager.isFocused())&&this.#f()},this.#h))}#x(){this.#b(),this.#w(this.#j())}#g(){this.#u&&(tU.timeoutManager.clearTimeout(this.#u),this.#u=void 0)}#v(){this.#m&&(tU.timeoutManager.clearInterval(this.#m),this.#m=void 0)}createResult(e,t){let n,r=this.#r,s=this.options,a=this.#a,i=this.#i,o=this.#o,l=e!==r?e.state:this.#s,{state:c}=e,d={...c},u=!1;if(t._optimisticResults){let n=this.hasListeners(),a=!n&&tq(e,t),i=n&&tV(e,r,t,s);(a||i)&&(d={...d,...(0,tB.fetchState)(c.data,e.options)}),"isRestoring"===t._optimisticResults&&(d.fetchStatus="idle")}let{error:m,errorUpdatedAt:h,status:p}=d;n=d.data;let f=!1;if(void 0!==t.placeholderData&&void 0===n&&"pending"===p){let e;a?.isPlaceholderData&&t.placeholderData===o?.placeholderData?(e=a.data,f=!0):e="function"==typeof t.placeholderData?t.placeholderData(this.#d?.state.data,this.#d):t.placeholderData,void 0!==e&&(p="success",n=(0,tG.replaceData)(a?.data,e,t),u=!0)}if(t.select&&void 0!==n&&!f)if(a&&n===i?.data&&t.select===this.#l)n=this.#c;else try{this.#l=t.select,n=t.select(n),n=(0,tG.replaceData)(a?.data,n,t),this.#c=n,this.#t=null}catch(e){this.#t=e}this.#t&&(m=this.#t,n=this.#c,h=Date.now(),p="error");let x="fetching"===d.fetchStatus,g="pending"===p,v="error"===p,y=g&&x,b=void 0!==n,j={status:p,fetchStatus:d.fetchStatus,isPending:g,isSuccess:"success"===p,isError:v,isInitialLoading:y,isLoading:y,data:n,dataUpdatedAt:d.dataUpdatedAt,error:m,errorUpdatedAt:h,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>l.dataUpdateCount||d.errorUpdateCount>l.errorUpdateCount,isFetching:x,isRefetching:x&&!g,isLoadingError:v&&!b,isPaused:"paused"===d.fetchStatus,isPlaceholderData:u,isRefetchError:v&&b,isStale:tK(e,t),refetch:this.refetch,promise:this.#n,isEnabled:!1!==(0,tG.resolveEnabled)(t.enabled,e)};if(this.options.experimental_prefetchInRender){let t=e=>{"error"===j.status?e.reject(j.error):void 0!==j.data&&e.resolve(j.data)},n=()=>{t(this.#n=j.promise=(0,tQ.pendingThenable)())},s=this.#n;switch(s.status){case"pending":e.queryHash===r.queryHash&&t(s);break;case"fulfilled":("error"===j.status||j.data!==s.value)&&n();break;case"rejected":("error"!==j.status||j.error!==s.reason)&&n()}}return j}updateResult(){let e=this.#a,t=this.createResult(this.#r,this.options);if(this.#i=this.#r.state,this.#o=this.options,void 0!==this.#i.data&&(this.#d=this.#r),(0,tG.shallowEqualObjects)(t,e))return;this.#a=t;let n=()=>{if(!e)return!0;let{notifyOnChangeProps:t}=this.options,n="function"==typeof t?t():t;if("all"===n||!n&&!this.#p.size)return!0;let r=new Set(n??this.#p);return this.options.throwOnError&&r.add("error"),Object.keys(this.#a).some(t=>this.#a[t]!==e[t]&&r.has(t))};this.#C({listeners:n()})}#y(){let e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#r)return;let t=this.#r;this.#r=e,this.#s=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#x()}#C(e){tO.notifyManager.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(this.#a)}),this.#e.getQueryCache().notify({query:this.#r,type:"observerResultsUpdated"})})}};function tq(e,t){return!1!==(0,tG.resolveEnabled)(t.enabled,e)&&void 0===e.state.data&&("error"!==e.state.status||!1!==t.retryOnMount)||void 0!==e.state.data&&tW(e,t,t.refetchOnMount)}function tW(e,t,n){if(!1!==(0,tG.resolveEnabled)(t.enabled,e)&&"static"!==(0,tG.resolveStaleTime)(t.staleTime,e)){let r="function"==typeof n?n(e):n;return"always"===r||!1!==r&&tK(e,t)}return!1}function tV(e,t,n,r){return(e!==t||!1===(0,tG.resolveEnabled)(r.enabled,e))&&(!n.suspense||"error"!==e.state.status)&&tK(e,n)}function tK(e,t){return!1!==(0,tG.resolveEnabled)(t.enabled,e)&&e.isStaleByTime((0,tG.resolveStaleTime)(t.staleTime,e))}e.i(708883);var tX=e.i(521360),tY=d.createContext((n=!1,{clearReset:()=>{n=!1},reset:()=>{n=!0},isReset:()=>n})),tJ=d.createContext(!1);tJ.Provider;var tZ=(e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()}),t0=e.i(529780),t1=e.i(94584),t5=e.i(831709),t2=e.i(930244),t4=e.i(772507),t3=e.i(644163);let t6={"gpt-5":["Analyze this architecture diagram and suggest improvements","Debug React useEffect infinite loop with async dependencies","Extract structured data from handwritten notes","Compare these two UI mockups and list differences","Review this PR for security vulnerabilities and best practices","Refactor this component to follow React composition patterns","Explain TCP/IP handshake like I'm interviewing for senior engineer","Write comprehensive test cases for this authentication flow","Prove: sum of first n cubes equals (n(n+1)/2)²","Find the logic error in this distributed consensus algorithm","Debug race condition in concurrent Rust code","Analyze failure scenario in blockchain consensus","Derive Black-Scholes equation from first principles","Find edge case causing intermittent deadlock","Prove correctness of this sorting algorithm variant","Optimize this dynamic programming solution","Design distributed caching system for 1M requests/sec","Analyze architectural tradeoffs for microservices migration","Review API design for RESTful best practices","Refactor monolith to event-driven architecture"]},t8=["Prove: $$\\sum_{i=1}^{n} i = \\frac{n(n+1)}{2}$$ using mathematical induction","Derive quadratic formula from $$ax^2 + bx + c = 0$$","Find the subtle bug in this encryption logic: `AES-GCM` with fixed IV","Debug infinite recursion in `dfs` traversal: provide fixed code"],t7=["Extract structured JSON data from this invoice image","Identify accessibility violations in this UI design screenshot","Analyze the trend in this sales chart and predict next month","Transcribe this handwritten medical note into text"],t9=["Summarize this article in 3 bullet points","Write a regex to validate US phone numbers: `(555) 123-4567`","Fix this TypeScript error: `Property 'id' does not exist on type 'User'`","Generate 5 creative names for a coffee shop app"],ne=["Explain photosynthesis: $$\\ce{6CO2 + 6H2O ->[light] C6H12O6 + 6O2}$$","Compare PostgreSQL vs MongoDB for high-write logging system","Refactor this nested callback code to `async/await`","Solve for mass in $$E = mc^2$$ given Energy = 50J"],nt={morning:["Good morning","Morning","Ready to start the day"],afternoon:["Good afternoon","How's the day going","Afternoon"],evening:["Good evening","Evening work session","How can I help tonight"]};function nn({onClick:e,selectedModel:t,conversationCount:n,nickname:s}){let a=function(e){if(!e)return{category:"general",prompts:ne,source:"default"};if(e in t6)return{category:"suggested",prompts:t6[e],source:"exact-model"};let t=(0,ee.getModelConfig)(e);if(!t)return{category:"general",prompts:ne,source:"default"};if(t.capabilities.includes("thinking")||t.capabilities.includes("extended-thinking")||t.reasoning)return{category:"thinking",prompts:t8,source:"capability"};if(t.capabilities.includes("vision"))return{category:"vision",prompts:t7,source:"capability"};let n=t.name.toLowerCase();return n.includes("mini")||n.includes("flash")||n.includes("nano")?{category:"fast",prompts:t9,source:"capability"}:{category:"general",prompts:ne,source:"capability"}}(t),[i,o]=(0,d.useState)(a.category),l=(0,d.useMemo)(()=>{let e,t=nt[(e=new Date().getHours())<12?"morning":e<17?"afternoon":"evening"];return t[Math.floor(Math.random()*t.length)]},[]);if((0,d.useEffect)(()=>{o(a.category)},[a.category]),(n??0)>=2){let e=s?`${l}, ${s}`:l;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[50vh] px-8 text-center animate-message-enter w-full",children:[(0,r.jsx)("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold mb-8 bg-linear-to-br from-foreground to-muted-foreground bg-clip-text text-transparent",children:e}),(0,r.jsxs)("div",{className:"hidden sm:flex gap-4 md:gap-6 text-xs text-muted-foreground/60 animate-in fade-in duration-700 delay-300 flex-wrap justify-center",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsxs)("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[(0,r.jsx)("span",{className:"text-xs",children:"⌘"}),"J"]}),(0,r.jsx)("span",{children:"models"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsxs)("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[(0,r.jsx)("span",{className:"text-xs",children:"⌘"}),"K"]}),(0,r.jsx)("span",{children:"commands"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsxs)("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[(0,r.jsx)("span",{className:"text-xs",children:"⌘"}),";"]}),(0,r.jsx)("span",{children:"templates"})]})]})]})}let c=[..."exact-model"===a.source?[{key:"suggested",label:"Suggested",icon:ed.Sparkles,prompts:a.prompts}]:[],{key:"thinking",label:"Thinking",icon:es.Brain,prompts:t8},{key:"vision",label:"Vision",icon:t3.Eye,prompts:t7},{key:"fast",label:"Fast",icon:tc.Zap,prompts:t9},{key:"general",label:"General",icon:t4.Code2,prompts:ne}],u=c.find(e=>e.key===i)?.prompts||a.prompts;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[50vh] px-4 text-center animate-message-enter",children:[(0,r.jsx)("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold mb-6 sm:mb-8 bg-linear-to-br from-foreground to-muted-foreground bg-clip-text text-transparent",children:"How can I help you?"}),(0,r.jsx)("div",{className:"hidden sm:flex flex-wrap gap-2 justify-center mb-12 max-w-2xl",children:c.map(e=>{let t=e.icon;return(0,r.jsxs)(h.Button,{variant:"outline",className:(0,z.cn)("rounded-full gap-2 px-4 h-9 transition-all duration-300 border-white/10 hover:scale-105 cursor-pointer",i===e.key?"bg-primary/20 text-primary border-primary/20 hover:bg-primary/30":"bg-background/40 hover:bg-background/80 hover:border-white/20"),onClick:()=>o(e.key),children:[(0,r.jsx)(t,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:e.label})]},e.key)})}),(0,r.jsx)("div",{className:"grid gap-1.5 sm:gap-2 w-full max-w-full sm:max-w-md text-left mb-6 sm:mb-8 px-2 sm:px-0",children:u.slice(0,4).map((t,n)=>(0,r.jsxs)("div",{role:"button",tabIndex:0,onClick:()=>e(t),onKeyDown:n=>{("Enter"===n.key||" "===n.key)&&(n.preventDefault(),e(t))},className:"group flex h-16 items-center justify-between p-2 sm:p-3 rounded-lg sm:rounded-xl hover:bg-white/5 transition-all duration-200 border border-transparent hover:border-white/5 text-xs sm:text-sm text-muted-foreground hover:text-foreground cursor-pointer",style:{animationDelay:`${100*n}ms`},children:[(0,r.jsx)("div",{className:"line-clamp-2 text-left",children:(0,r.jsx)(tC.MarkdownContent,{content:t})}),(0,r.jsx)(t2.ArrowRight,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 opacity-0 -translate-x-2 group-hover:translate-x-0 group-hover:opacity-50 transition-all duration-300 shrink-0 ml-1.5 sm:ml-3"})]},t))}),(0,r.jsxs)("div",{className:"hidden sm:flex gap-6 text-xs text-muted-foreground/60 animate-in fade-in duration-700 delay-500",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsxs)("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[(0,r.jsx)("span",{className:"text-xs",children:"⌘"}),"J"]}),(0,r.jsx)("span",{children:"models"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsxs)("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[(0,r.jsx)("span",{className:"text-xs",children:"⌘"}),"K"]}),(0,r.jsx)("span",{children:"commands"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsxs)("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[(0,r.jsx)("span",{className:"text-xs",children:"⌘"}),";"]}),(0,r.jsx)("span",{children:"templates"})]})]})]})}function nr({messages:e,selectedModel:t,onVote:n,onConsolidate:a,onToggleModelNames:i,showModelNames:o,chatWidth:l,highlightMessageId:c,isCollaborative:m,isGenerating:p}){let{containerRef:f,scrollToBottom:x,showScrollButton:g}=function(e={}){let{threshold:t=100,animationDuration:n=400,disableAutoScroll:r=!1}=e,s=(0,d.useRef)(null),a=(0,d.useRef)(!1),i=(0,d.useRef)(void 0),[o,l]=(0,d.useState)(!1),[c,u]=(0,d.useState)(!0),[m,h]=(0,d.useState)(!1),[p,f]=(0,d.useState)(!1),x=(0,d.useRef)(o),g=(0,d.useRef)(c),v=(0,d.useRef)(r);(0,d.useLayoutEffect)(()=>{x.current=o},[o]),(0,d.useLayoutEffect)(()=>{g.current=c},[c]),(0,d.useLayoutEffect)(()=>{v.current=r},[r]),(0,d.useEffect)(()=>{let e=window.matchMedia("(prefers-reduced-motion: reduce)");f(e.matches);let t=e=>f(e.matches);return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]);let y=(0,d.useCallback)(e=>e.scrollHeight-e.scrollTop-e.clientHeight<t,[t]),b=(0,d.useCallback)((e="smooth")=>{let t=s.current;if(!t)return!1;a.current=!0;let r=p?"auto":e,i=t.scrollHeight-t.clientHeight;return t.scrollTo({top:i,behavior:r}),setTimeout(()=>{if(a.current=!1,!t)return;let e=y(t);u(e),e||o||requestAnimationFrame(()=>{t&&t.scrollTo({top:t.scrollHeight-t.clientHeight,behavior:"auto"})})},"smooth"===r?n:0),!0},[n,y,o,p]);(0,d.useEffect)(()=>{let e=s.current;if(!e)return;let t=()=>{let t=y(e);u(t),t||a.current?t&&(l(!1),h(!1)):(l(!0),h(!0))};return e.addEventListener("scroll",t,{passive:!0}),()=>e.removeEventListener("scroll",t)},[y]);let j=(0,d.useRef)(b);return(0,d.useEffect)(()=>{j.current=b},[b]),(0,d.useEffect)(()=>{let e=s.current;if(!e)return;let t=new MutationObserver(()=>{v.current||x.current||!g.current||(i.current&&cancelAnimationFrame(i.current),i.current=requestAnimationFrame(()=>{j.current("auto")}))});return t.observe(e,{childList:!0,subtree:!0,characterData:!0}),()=>{t.disconnect(),i.current&&cancelAnimationFrame(i.current)}},[]),{containerRef:s,scrollToBottom:b,showScrollButton:m,isAtBottom:c}}({threshold:100,animationDuration:400,disableAutoScroll:!0}),{data:v}=function(e={}){let{page:t=1,pageSize:n=20,archived:r=!1}=e,a=(0,tr.shouldUseConvex)(),i=(0,t0.useApiClient)(),o=(0,u.useQuery)(s.api.conversations.list,a&&!r?{}:"skip"),l=function(e,t,n){let r=d.useContext(tJ),s=d.useContext(tY),a=(0,tX.useQueryClient)(n),i=a.defaultQueryOptions(e);if(a.getDefaultOptions().queries?._experimental_beforeQuery?.(i),i._optimisticResults=r?"isRestoring":"optimistic",i.suspense){let e=e=>"static"===e?e:Math.max(e??1e3,1e3),t=i.staleTime;i.staleTime="function"==typeof t?(...n)=>e(t(...n)):e(t),"number"==typeof i.gcTime&&(i.gcTime=Math.max(i.gcTime,1e3))}(i.suspense||i.throwOnError||i.experimental_prefetchInRender)&&!s.isReset()&&(i.retryOnMount=!1),d.useEffect(()=>{s.clearReset()},[s]);let o=!a.getQueryCache().get(i.queryHash),[l]=d.useState(()=>new t(a,i)),c=l.getOptimisticResult(i),u=!r&&!1!==e.subscribed;if(d.useSyncExternalStore(d.useCallback(e=>{let t=u?l.subscribe(tO.notifyManager.batchCalls(e)):tG.noop;return l.updateResult(),t},[l,u]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),d.useEffect(()=>{l.setOptions(i)},[i,l]),i?.suspense&&c.isPending)throw tZ(i,l,s);if((({result:e,errorResetBoundary:t,throwOnError:n,query:r,suspense:s})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(s&&void 0===e.data||(0,tG.shouldThrowError)(n,[e.error,r])))({result:c,errorResetBoundary:s,throwOnError:i.throwOnError,query:a.getQueryCache().get(i.queryHash),suspense:i.suspense}))throw c.error;if(a.getDefaultOptions().queries?._experimental_afterQuery?.(i,c),i.experimental_prefetchInRender&&!tG.isServer&&c.isLoading&&c.isFetching&&!r){let e=o?tZ(i,l,s):a.getQueryCache().get(i.queryHash)?.promise;e?.catch(tG.noop).finally(()=>{l.updateResult()})}return i.notifyOnChangeProps?c:l.trackResult(c)}({queryKey:["conversations",{page:t,pageSize:n,archived:r}],queryFn:async()=>{let e=new URLSearchParams({page:String(t),pageSize:String(n),archived:String(r)});return i.get(`/conversations?${e}`)},enabled:!a,staleTime:3e4},tH,void 0);return a?{data:o?{items:o,pagination:{page:1,pageSize:o.length,total:o.length,hasNext:!1}}:void 0,isLoading:void 0===o,error:null,refetch:()=>Promise.resolve()}:{data:l.data,isLoading:l.isLoading,error:l.error,refetch:l.refetch}}(),y=v?.items?.length??0,b=(0,ef.useUserPreference)("customInstructions"),j=b?.nickname||"",w=e[0]?.conversationId,C=(0,d.useMemo)(()=>{let t=e.filter(e=>!("assistant"===e.role&&e.consolidatedMessageId)),n={};for(let e of t)e.comparisonGroupId&&(n[e.comparisonGroupId]||=[],n[e.comparisonGroupId].push(e));let r=[],s=new Set;for(let e of t)if(e.comparisonGroupId){if(!s.has(e.comparisonGroupId)){let t=n[e.comparisonGroupId],a=t.find(e=>"user"===e.role),i=t.filter(e=>"assistant"===e.role);a&&i.length>0?r.push({type:"comparison",id:e.comparisonGroupId,userMessage:a,assistantMessages:i,timestamp:Math.min(...t.map(e=>e.createdAt))}):a&&r.push({type:"message",data:a}),s.add(e.comparisonGroupId)}}else r.push({type:"message",data:e});return r},[e]),N=(0,t_.useVirtualizer)({count:C.length,getScrollElement:()=>f.current,estimateSize:()=>150,overscan:5}),k=N.getVirtualItems();return(!function({highlightMessageId:e,grouped:t,containerRef:n,virtualizer:r}){let s=(0,d.useRef)(!1);(0,d.useEffect)(()=>{if(!e||s.current)return;let a=t.findIndex(t=>"message"===t.type?t.data._id===e:"comparison"===t.type&&(t.userMessage._id===e||t.assistantMessages.some(t=>t._id===e)));-1!==a&&(requestAnimationFrame(()=>{r.scrollToIndex(a,{align:"start",behavior:"smooth"})}),setTimeout(()=>{let t=document.getElementById(`message-${e}`),r=n.current;if(t&&r){let e=r.getBoundingClientRect(),n=t.getBoundingClientRect().top-e.top+r.scrollTop;r.scrollTo({top:Math.max(0,n-80),behavior:"smooth"}),t.classList.add("message-highlight"),setTimeout(()=>t.classList.remove("message-highlight"),1200)}},300),s.current=!0)},[e,t,r,n]),(0,d.useEffect)(()=>{s.current=!1},[e])}({highlightMessageId:c,grouped:C,containerRef:f,virtualizer:N}),!function({containerRef:e,conversationId:t,messageCount:n,highlightMessageId:r,messages:s}){let a=(0,d.useRef)(null),i=(0,d.useRef)(n);(0,d.useEffect)(()=>{let s;if(r||!t||0===n||a.current===t)return;let i=0,o=()=>{let n=e.current;if(n&&n.scrollHeight>n.clientHeight){n.scrollTop=n.scrollHeight,a.current=t;return}++i<20&&(s=setTimeout(o,50))},l=requestAnimationFrame(o);return()=>{cancelAnimationFrame(l),clearTimeout(s)}},[t,r,n,e]),(0,d.useEffect)(()=>{let t=i.current;if(n>t){let n=s.slice(t).find(e=>"user"===e.role);n&&requestAnimationFrame(()=>{let t=document.getElementById(`message-${n._id}`),r=e.current;if(t&&r){let e=r.getBoundingClientRect(),n=t.getBoundingClientRect().top-e.top+r.scrollTop;r.scrollTo({top:Math.max(0,n-50),behavior:"smooth"})}})}i.current=n},[s,n,e])}({containerRef:f,conversationId:w,messageCount:e.length,highlightMessageId:c,messages:e}),0===e.length)?(0,r.jsx)("div",{className:"flex items-center justify-center h-full w-full",children:(0,r.jsx)(nn,{selectedModel:t,conversationCount:y,nickname:j,onClick:e=>{let t=new CustomEvent("insert-prompt",{detail:e});window.dispatchEvent(t)}})}):(0,r.jsxs)("div",{className:"flex-1 max-h-full min-h-0 min-w-0 relative flex flex-col overflow-hidden",children:[(0,r.jsx)("div",{ref:f,role:"log","aria-live":"polite","aria-label":"Chat message history","aria-atomic":"false",className:"flex-1 w-full min-w-0 min-h-0 overflow-y-auto relative",style:{contain:"layout style paint",contentVisibility:"auto"},children:(0,r.jsx)("div",{className:(0,z.cn)(p&&"pb-[80vh]"),style:{height:`${N.getTotalSize()}px`,width:"100%",position:"relative"},children:k.map(e=>{let t=C[e.index],s="message"===t.type;return(0,r.jsx)("div",{"data-index":e.index,ref:N.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${e.start}px)`},children:(0,r.jsx)("div",{className:(0,z.cn)("grid gap-4 px-4 py-2 transition-all duration-300 ease-out","narrow"===l&&"grid-cols-[1fr_min(42rem,100%)_1fr]","standard"===l&&"grid-cols-[1fr_min(56rem,100%)_1fr]","wide"===l&&"grid-cols-[1fr_min(72rem,100%)_1fr]","full"===l&&"grid-cols-[1fr_min(92%,100%)_1fr]",!l&&"grid-cols-[1fr_min(56rem,100%)_1fr]"),children:s?(0,r.jsx)("div",{className:"col-start-2",children:(0,r.jsx)(t1.ChatMessage,{message:t.data,nextMessage:(()=>{if(e.index+1>=C.length)return;let t=C[e.index+1];return"message"===t.type?t.data:void 0})(),isCollaborative:m,senderUser:t.data.senderUser})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"col-start-2",children:(0,r.jsx)(t1.ChatMessage,{message:t.userMessage,isCollaborative:m,senderUser:t.userMessage.senderUser})}),(0,r.jsx)("div",{className:"col-span-full mt-4",children:(0,r.jsx)(t5.ComparisonView,{assistantMessages:t.assistantMessages,comparisonGroupId:t.id,showModelNames:o,onVote:n||(()=>{}),onConsolidate:a||(()=>{}),onToggleModelNames:i||(()=>{})})})]})})},e.key)})})}),g&&(0,r.jsxs)(h.Button,{variant:"outline",size:"sm",className:"absolute bottom-4 left-1/2 -translate-x-1/2 shadow-lg transition-all duration-200 z-10 gap-1",onClick:()=>x("smooth"),"aria-label":"Scroll to bottom",children:["Scroll to bottom",(0,r.jsx)(tA.ArrowDown,{className:"w-3 h-3","aria-hidden":"true"})]})]})}var ns=e.i(897846),na=e.i(79721),ni=e.i(934953),no=e.i(319226),nl=e.i(879992);let nc=[{id:"all",label:"All Templates"},{id:"coding",label:"Coding"},{id:"writing",label:"Writing"},{id:"analysis",label:"Analysis"},{id:"creative",label:"Creative"}];function nd({open:e,onOpenChange:t,onSelectTemplate:n,mode:a="navigate"}){let i=(0,l.useRouter)(),[o,c]=(0,d.useState)("all"),m=(0,nl.useTemplateStore)(e=>e.setTemplateText),h=(0,u.useQuery)(s.api.templates.list,{}),p=(0,u.useMutation)(s.api.templates.incrementUsage),f=(0,d.useRef)(e);(0,d.useEffect)(()=>{let t=e&&!f.current;f.current=e,t&&ex.analytics.track("template_switcher_opened",{mode:a})},[e,a]);let x=(0,d.useMemo)(()=>{if(!h)return{builtIn:[],user:[]};let e="all"===o?h:h.filter(e=>e.category===o);return{builtIn:e.filter(e=>e.isBuiltIn),user:e.filter(e=>!e.isBuiltIn)}},[h,o]),g=async e=>{try{await p({id:e._id})}catch(e){console.error("Failed to increment usage:",e)}ex.analytics.track("template_selected",{templateId:e._id,templateName:e.name,mode:a}),"insert"===a&&n?(n(e.prompt),t(!1),setTimeout(()=>{window.dispatchEvent(new CustomEvent("focus-chat-input"))},50)):(t(!1),m(e.prompt,e.name),i.push("/chat?from=template"))},v=e=>{let t=(0,r.jsxs)(ni.CommandItem,{value:e._id,keywords:[e.name,e.category,e.description||""],onSelect:()=>g(e),className:(0,z.cn)("group flex items-center justify-between px-3 py-3 rounded-lg cursor-pointer aria-selected:bg-muted/50 transition-colors"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[(0,r.jsx)("div",{className:(0,z.cn)("flex items-center justify-center w-8 h-8 rounded-lg border shrink-0",e.isBuiltIn?"bg-amber-500/10 text-amber-600 dark:text-amber-500 border-amber-500/30":"bg-primary/10 text-primary border-primary/30"),children:e.isBuiltIn?(0,r.jsx)(ed.Sparkles,{className:"w-4 h-4"}):(0,r.jsx)(F.FileText,{className:"w-4 h-4"})}),(0,r.jsxs)("div",{className:"flex flex-col min-w-0 gap-0.5",children:[(0,r.jsx)("span",{className:"font-medium text-sm truncate text-foreground",children:e.name}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground truncate",children:e.description||`${e.prompt.slice(0,60)}...`})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 pl-2 text-xs text-muted-foreground/50",children:[(0,r.jsx)("span",{className:"capitalize",children:e.category}),e.usageCount>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-muted-foreground/30",children:"•"}),(0,r.jsxs)("span",{children:[e.usageCount," uses"]})]})]})]},e._id);return(0,r.jsxs)(no.HoverCard,{openDelay:300,children:[(0,r.jsx)(no.HoverCardTrigger,{asChild:!0,children:t}),(0,r.jsx)(no.HoverCardContent,{side:"right",align:"start",className:"w-80 p-4",sideOffset:10,children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h4",{className:"font-medium",children:e.name}),e.description&&(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),(0,r.jsx)("div",{className:"bg-muted/50 rounded-lg p-3 max-h-40 overflow-y-auto",children:(0,r.jsx)("p",{className:"text-xs text-muted-foreground whitespace-pre-wrap",children:e.prompt})})]})})]},e._id)};return(0,r.jsxs)(ni.CommandDialog,{open:e,onOpenChange:t,commandProps:{filter:(e,t,n)=>{let r=`${e} ${n?.join(" ")||""}`;return(0,ns.default)(r,t)}},className:"max-w-[95vw] md:max-w-3xl h-[80vh] md:h-[500px] p-0 gap-0 overflow-hidden bg-background/95 backdrop-blur-xl border-border/50 shadow-2xl",children:[(0,r.jsxs)("div",{className:"flex items-center border-b px-4 py-3 shrink-0",children:[(0,r.jsx)(na.Search,{className:"w-4 h-4 mr-2 text-muted-foreground"}),(0,r.jsx)(ni.CommandInput,{placeholder:`Search ${"all"===o?"":`${o} `}templates...`,className:"flex-1 h-9 bg-transparent border-0 ring-0 focus:ring-0 text-sm"})]}),(0,r.jsxs)("div",{className:"flex h-[400px] overflow-hidden",children:[(0,r.jsxs)("div",{className:"w-[160px] border-r bg-muted/30 p-2 flex flex-col gap-1 shrink-0 overflow-y-auto",children:[(0,r.jsx)("div",{className:"px-2 py-1.5 text-xs font-medium text-muted-foreground uppercase tracking-wider mb-1",children:"Categories"}),nc.map(e=>{let t=o===e.id;return(0,r.jsx)("button",{type:"button",onClick:()=>c(e.id),className:(0,z.cn)("w-full flex items-center px-2.5 py-2 rounded-md text-sm transition-colors text-left",t?"bg-primary/10 text-primary font-medium":"text-muted-foreground hover:bg-muted/50 hover:text-foreground"),children:e.label},e.id)})]}),(0,r.jsx)("div",{className:"flex-1 flex flex-col min-w-0 bg-background/50",children:(0,r.jsxs)(ni.CommandList,{className:"max-h-[400px] overflow-y-auto p-2",children:[(0,r.jsx)(ni.CommandEmpty,{children:"No templates found."}),x.user.length>0&&(0,r.jsx)(ni.CommandGroup,{heading:"Your Templates",children:x.user.map(e=>v(e))}),x.user.length>0&&x.builtIn.length>0&&(0,r.jsx)(ni.CommandSeparator,{}),x.builtIn.length>0&&(0,r.jsx)(ni.CommandGroup,{heading:"Built-in Templates",children:x.builtIn.map(e=>v(e))})]})})]}),(0,r.jsxs)("div",{className:"border-t px-4 py-2 flex items-center justify-between text-xs text-muted-foreground",children:[(0,r.jsxs)("span",{children:["Press ",(0,r.jsx)("kbd",{className:"px-1 py-0.5 rounded bg-muted",children:"↵"})," to select"]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("kbd",{className:"px-1 py-0.5 rounded bg-muted",children:"⌘;"})," to open"]})]})]})}var nu=e.i(522776),nu=nu;function nm(e,t="Assertion error"){if(!e)throw Error(t)}function nh({group:e}){let{orientation:t,panels:n}=e;return n.reduce((e,n)=>e+="horizontal"===t?n.element.offsetWidth:n.element.offsetHeight,0)}function np(e,t){return t.sort("horizontal"===e?nf:nx)}function nf(e,t){let n=e.element.offsetLeft-t.element.offsetLeft;return 0!==n?n:e.element.offsetWidth-t.element.offsetWidth}function nx(e,t){let n=e.element.offsetTop-t.element.offsetTop;return 0!==n?n:e.element.offsetHeight-t.element.offsetHeight}function ng(e){return null!==e&&"object"==typeof e&&"nodeType"in e&&e.nodeType===Node.ELEMENT_NODE}function nv(e,t){return{x:e.x>=t.left&&e.x<=t.right?0:Math.min(Math.abs(e.x-t.left),Math.abs(e.x-t.right)),y:e.y>=t.top&&e.y<=t.bottom?0:Math.min(Math.abs(e.y-t.top),Math.abs(e.y-t.bottom))}}function ny(e){let{element:t,orientation:n,panels:r,separators:s}=e,a=np(n,Array.from(t.children).filter(ng).map(e=>({element:e}))).map(({element:e})=>e),i=[],o=!1,l,c=[];for(let t of a)if(t.hasAttribute("data-panel")){let s=r.find(e=>e.element===t);if(s){if(l){let r,a=l.element.getBoundingClientRect(),d=t.getBoundingClientRect();if(o){let e="horizontal"===n?new DOMRect(a.right,a.top,0,a.height):new DOMRect(a.left,a.bottom,a.width,0),t="horizontal"===n?new DOMRect(d.left,d.top,0,d.height):new DOMRect(d.left,d.top,d.width,0);switch(c.length){case 0:r=[e,t];break;case 1:{let s=c[0],i=function({orientation:e,rects:t,targetRect:n}){let r={x:n.x+n.width/2,y:n.y+n.height/2},s,a=Number.MAX_VALUE;for(let n of t){let{x:t,y:i}=nv(r,n),o="horizontal"===e?t:i;o<a&&(a=o,s=n)}return nm(s,"No rect found"),s}({orientation:n,rects:[a,d],targetRect:s.element.getBoundingClientRect()});r=[s,i===a?t:e];break}default:r=c}}else r=c.length?c:["horizontal"===n?new DOMRect(a.right,d.top,d.left-a.right,d.height):new DOMRect(d.left,a.bottom,d.width,d.top-a.bottom)];for(let t of r)i.push({group:e,groupSize:nh({group:e}),panels:[l,s],separator:"width"in t?void 0:t,rect:"width"in t?t:t.element.getBoundingClientRect()})}o=!1,l=s,c=[]}}else if(t.hasAttribute("data-separator")){let e=s.find(e=>e.element===t);e?c.push(e):(l=void 0,c=[])}else o=!0;return i}function nb({groupSize:e,panelElement:t,styleProp:n}){let r,[s,a]=function(e){switch(typeof e){case"number":return[e,"px"];case"string":{let t=parseFloat(e);return e.endsWith("%")?[t,"%"]:e.endsWith("px")?[t,"px"]:e.endsWith("rem")?[t,"rem"]:e.endsWith("em")?[t,"em"]:e.endsWith("vh")?[t,"vh"]:e.endsWith("vw")?[t,"vw"]:[t,"%"]}}}(n);switch(a){case"%":r=s/100*e;break;case"px":r=s;break;case"rem":r=s*parseFloat(getComputedStyle(t.ownerDocument.body).fontSize);break;case"em":r=s*parseFloat(getComputedStyle(t).fontSize);break;case"vh":r=s/100*window.innerHeight;break;case"vw":r=s/100*window.innerWidth}return r}function nj(e){return parseFloat(e.toFixed(3))}function nw(e){let{panels:t}=e,n=nh({group:e});return 0===n?t.map(e=>({collapsedSize:0,collapsible:!0===e.panelConstraints.collapsible,defaultSize:void 0,minSize:0,maxSize:100,panelId:e.id})):t.map(e=>{let t,{element:r,panelConstraints:s}=e,a=0;s.collapsedSize&&(a=nj(nb({groupSize:n,panelElement:r,styleProp:s.collapsedSize})/n*100)),s.defaultSize&&(t=nj(nb({groupSize:n,panelElement:r,styleProp:s.defaultSize})/n*100));let i=0;s.minSize&&(i=nj(nb({groupSize:n,panelElement:r,styleProp:s.minSize})/n*100));let o=100;return s.maxSize&&(o=nj(nb({groupSize:n,panelElement:r,styleProp:s.maxSize})/n*100)),{collapsedSize:a,collapsible:!0===s.collapsible,defaultSize:t,minSize:i,maxSize:o,panelId:e.id}})}function nC(e,t,n=0){return Math.abs(nj(e)-nj(t))<=n}let nN={cursorFlags:0,interactionState:{state:"inactive"},mountedGroups:new Map},nk=new class{#N={};addListener(e,t){let n=this.#N[e];return void 0===n?this.#N[e]=[t]:n.includes(t)||n.push(t),()=>{this.removeListener(e,t)}}emit(e,t){let n=this.#N[e];if(void 0!==n)if(1===n.length)n[0].call(null,t);else{let e=!1,r=null,s=Array.from(n);for(let n=0;n<s.length;n++){let a=s[n];try{a.call(null,t)}catch(t){null===r&&(e=!0,r=t)}}if(e)throw r}}removeAllListeners(){this.#N={}}removeListener(e,t){let n=this.#N[e];if(void 0!==n){let e=n.indexOf(t);e>=0&&n.splice(e,1)}}};function nS(e){let t="function"==typeof e?e(nN):e;if(nN===t)return nN;let n=nN;return nN={...nN,...t},void 0!==t.cursorFlags&&nk.emit("cursorFlagsChange",nN.cursorFlags),void 0!==t.interactionState&&nk.emit("interactionStateChange",nN.interactionState),void 0!==t.mountedGroups&&(nN.mountedGroups.forEach((e,t)=>{e.derivedPanelConstraints.forEach(r=>{if(r.collapsible){let{layout:s}=n.mountedGroups.get(t)??{};if(s){let n=nC(r.collapsedSize,e.layout[r.panelId]),a=nC(r.collapsedSize,s[r.panelId]);n&&!a&&(t.inMemoryLastExpandedPanelSizes[r.panelId]=s[r.panelId])}}})}),nk.emit("mountedGroupsChange",nN.mountedGroups)),nN}function nM(e,t){return nC(e,t)?0:e>t?1:-1}function nT({panelConstraints:e,size:t}){let{collapsedSize:n=0,collapsible:r,maxSize:s=100,minSize:a=0}=e;return 0>nM(t,a)&&(t=r&&0>nM(t,(n+a)/2)?n:a),nj(t=Math.min(s,t))}function nR({delta:e,initialLayout:t,panelConstraints:n,pivotIndices:r,prevLayout:s,trigger:a}){if(nC(e,0))return t;let i=Object.values(t),o=Object.values(s),l=[...i],[c,d]=r;nm(null!=c,"Invalid first pivot index"),nm(null!=d,"Invalid second pivot index");let u=0;if("keyboard"===a){{let t=e<0?d:c,r=n[t];nm(r,`Panel constraints not found for index ${t}`);let{collapsedSize:s=0,collapsible:a,minSize:o=0}=r;if(a){let n=i[t];if(nm(null!=n,`Previous layout not found for panel index ${t}`),nC(n,s)){let t=o-n;nM(t,Math.abs(e))>0&&(e=e<0?0-t:t)}}}{let t=e<0?c:d,r=n[t];nm(r,`No panel constraints found for index ${t}`);let{collapsedSize:s=0,collapsible:a,minSize:o=0}=r;if(a){let n=i[t];if(nm(null!=n,`Previous layout not found for panel index ${t}`),nC(n,o)){let t=n-s;nM(t,Math.abs(e))>0&&(e=e<0?0-t:t)}}}}{let t=e<0?1:-1,r=e<0?d:c,s=0;for(;;){let e=i[r];if(nm(null!=e,`Previous layout not found for panel index ${r}`),s+=nT({panelConstraints:n[r],size:100})-e,(r+=t)<0||r>=n.length)break}let a=Math.min(Math.abs(e),Math.abs(s));e=e<0?0-a:a}{let t=e<0?c:d;for(;t>=0&&t<n.length;){let r=Math.abs(e)-Math.abs(u),s=i[t];nm(null!=s,`Previous layout not found for panel index ${t}`);let a=s-r,o=nT({panelConstraints:n[t],size:a});if(!nC(s,o)&&(u+=s-o,l[t]=o,u.toFixed(3).localeCompare(Math.abs(e).toFixed(3),void 0,{numeric:!0})>=0))break;e<0?t--:t++}}if(function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}(o,l))return s;{let t=e<0?d:c,r=i[t];nm(null!=r,`Previous layout not found for panel index ${t}`);let s=r+u,a=nT({panelConstraints:n[t],size:s});if(l[t]=a,!nC(a,s)){let t=s-a,r=e<0?d:c;for(;r>=0&&r<n.length;){let s=l[r];nm(null!=s,`Previous layout not found for panel index ${r}`);let a=s+t,i=nT({panelConstraints:n[r],size:a});if(nC(s,i)||(t-=i-s,l[r]=i),nC(t,0))break;e>0?r--:r++}}}if(!nC(Object.values(l).reduce((e,t)=>t+e,0),100,.1))return s;let m=Object.keys(s);return l.reduce((e,t,n)=>(e[m[n]]=t,e),{})}function nE(e){let t=e.parentElement;nm(t,"Parent group element not found");let{mountedGroups:n}=nN;for(let[e]of n)if(e.element===t)return e;throw Error("Could not find parent Group for separator element")}function nI(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(void 0===t[n]||0!==nM(e[n],t[n]))return!1;return!0}function nD({layout:e,panelConstraints:t}){let n=[...Object.values(e)],r=n.reduce((e,t)=>e+t,0);if(n.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${n.map(e=>`${e}%`).join(", ")}`);if(!nC(r,100)&&n.length>0)for(let e=0;e<t.length;e++){let t=n[e];nm(null!=t,`No layout data found for index ${e}`);let s=100/r*t;n[e]=s}let s=0;for(let e=0;e<t.length;e++){let r=n[e];nm(null!=r,`No layout data found for index ${e}`);let a=nT({panelConstraints:t[e],size:r});r!=a&&(s+=r-a,n[e]=a)}if(!nC(s,0))for(let e=0;e<t.length;e++){let r=n[e];nm(null!=r,`No layout data found for index ${e}`);let a=r+s,i=nT({panelConstraints:t[e],size:a});if(r!==i&&(s-=i-r,n[e]=i,nC(s,0)))break}let a=Object.keys(e);return n.reduce((e,t,n)=>(e[a[n]]=t,e),{})}function nz({groupId:e}){let t=()=>{let{mountedGroups:t}=nN;for(let[n,r]of t)if(n.id===e)return{group:n,...r};throw Error(`Could not find Group with id "${e}"`)};return{getLayout(){let{defaultLayoutDeferred:e,layout:n}=t();return e?{}:n},setLayout(e){let{defaultLayoutDeferred:n,derivedPanelConstraints:r,group:s,layout:a,separatorToPanels:i}=t(),o=nD({layout:e,panelConstraints:r});return n?a:(nI(a,o)||nS(e=>({mountedGroups:new Map(e.mountedGroups).set(s,{defaultLayoutDeferred:n,derivedPanelConstraints:r,layout:o,separatorToPanels:i})})),o)}}}function nL(e){let{mountedGroups:t}=nN,n=t.get(e);return nm(n,`Mounted Group ${e.id} not found`),n}function nP(e,t){let n=nE(e),r=nL(n),s=n.separators.find(t=>t.element===e);nm(s,"Matching separator not found");let a=r.separatorToPanels.get(s);nm(a,"Matching panels not found");let i=a.map(e=>n.panels.indexOf(e)),o=nz({groupId:n.id}).getLayout(),l=nD({layout:nR({delta:t,initialLayout:o,panelConstraints:r.derivedPanelConstraints,pivotIndices:i,prevLayout:o,trigger:"keyboard"}),panelConstraints:r.derivedPanelConstraints});nI(o,l)||nS(e=>({mountedGroups:new Map(e.mountedGroups).set(n,{defaultLayoutDeferred:r.defaultLayoutDeferred,derivedPanelConstraints:r.derivedPanelConstraints,layout:l,separatorToPanels:r.separatorToPanels})}))}function n_(e){if(e.defaultPrevented)return;let t=e.currentTarget,n=nE(t);if(!n.disabled)switch(e.key){case"ArrowDown":e.preventDefault(),"vertical"===n.orientation&&nP(t,5);break;case"ArrowLeft":e.preventDefault(),"horizontal"===n.orientation&&nP(t,-5);break;case"ArrowRight":e.preventDefault(),"horizontal"===n.orientation&&nP(t,5);break;case"ArrowUp":e.preventDefault(),"vertical"===n.orientation&&nP(t,-5);break;case"End":e.preventDefault(),nP(t,100);break;case"Enter":{e.preventDefault();let n=nE(t),{derivedPanelConstraints:r,layout:s,separatorToPanels:a}=nL(n),i=n.separators.find(e=>e.element===t);nm(i,"Matching separator not found");let o=a.get(i);nm(o,"Matching panels not found");let l=o[0],c=r.find(e=>e.panelId===l.id);if(nm(c,"Panel metadata not found"),c.collapsible){let e=s[l.id];nP(t,(c.collapsedSize===e?n.inMemoryLastExpandedPanelSizes[l.id]??c.minSize:c.collapsedSize)-e)}break}case"F6":{e.preventDefault();let n=nE(t).separators.map(e=>e.element),r=Array.from(n).findIndex(t=>t===e.currentTarget);nm(null!==r,"Index not found");let s=e.shiftKey?r>0?r-1:n.length-1:r+1<n.length?r+1:0;n[s].focus();break}case"Home":e.preventDefault(),nP(t,-100)}}let nA=e=>e,nF=()=>{},nO=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function nB(e){let t=e.length;for(;t--;){let n=e[t];if(nm(n,"Missing node"),function(e){let t,n=getComputedStyle(e);return!!("fixed"===n.position||"auto"!==n.zIndex&&("static"!==n.position||"flex"===(t=getComputedStyle(nG(e)??e).display)||"inline-flex"===t)||1>+n.opacity||"transform"in n&&"none"!==n.transform||"webkitTransform"in n&&"none"!==n.webkitTransform||"mixBlendMode"in n&&"normal"!==n.mixBlendMode||"filter"in n&&"none"!==n.filter||"webkitFilter"in n&&"none"!==n.webkitFilter||"isolation"in n&&"isolate"===n.isolation||nO.test(n.willChange)||"touch"===n.webkitOverflowScrolling)}(n))return n}return null}function n$(e){return e&&Number(getComputedStyle(e).zIndex)||0}function nQ(e){let t=[];for(;e;)t.push(e),e=nG(e);return t}function nG(e){let{parentNode:t}=e;return null!==t&&"object"==typeof t&&"nodeType"in t&&t.nodeType===Node.DOCUMENT_FRAGMENT_NODE?t.host:t}function nU(e,n){let r=[];return n.forEach((n,s)=>{if(s.disabled)return;let a=(void 0===t&&(t="function"==typeof matchMedia&&!!matchMedia("(pointer:coarse)").matches),t)?10:5,i=ny(s),o=function(e,t,n){let r,s={x:1/0,y:1/0};for(let a of t){let t=nv(n,a.rect);switch(e){case"horizontal":t.x<=s.x&&(r=a,s=t);break;case"vertical":t.y<=s.y&&(r=a,s=t)}}return r?{distance:s,hitRegion:r}:void 0}(s.orientation,i,{x:e.clientX,y:e.clientY});o&&o.distance.x<=a&&o.distance.y<=a&&function({groupElement:e,hitRegion:t,pointerEventTarget:n}){if(!ng(n)||n.contains(e)||e.contains(n))return!0;if(function(e,t){let n;if(e===t)throw Error("Cannot compare node with itself");let r={a:nQ(e),b:nQ(t)};for(;r.a.at(-1)===r.b.at(-1);)e=r.a.pop(),t=r.b.pop(),n=e;nm(n,"Stacking order can only be calculated for elements with a common ancestor");let s={a:n$(nB(r.a)),b:n$(nB(r.b))};if(s.a===s.b){let e=n.childNodes,t={a:r.a.at(-1),b:r.b.at(-1)},s=e.length;for(;s--;){let n=e[s];if(n===t.a)return 1;if(n===t.b)return -1}}return Math.sign(s.a-s.b)}(n,e)>0){let s=n;for(;s;){var r;if(s.contains(e))break;if(r=s.getBoundingClientRect(),r.x<t.x+t.width&&r.x+r.width>t.x&&r.y<t.y+t.height&&r.y+r.height>t.y)return!1;s=s.parentElement}}return!0}({groupElement:s.element,hitRegion:o.hitRegion.rect,pointerEventTarget:e.target})&&r.push(o.hitRegion)}),r}function nH(e){if(e.defaultPrevented)return;let{mountedGroups:t}=nN,n=nU(e,t),r=new Set,s=new Set,a=new Set,i=new Map,o=!1;n.forEach(e=>{r.add(e.group),e.panels.forEach(e=>{s.add(e)}),e.separator&&(a.add(e.separator),o||(o=!0,e.separator.element.focus()));let n=t.get(e.group);n&&i.set(e.group,n.layout)}),nS({interactionState:{hitRegions:n,initialLayoutMap:i,pointerDownAtPoint:{x:e.clientX,y:e.clientY},state:"active"}}),n.length&&e.preventDefault()}let nq=new WeakMap;function nW(e){if(null===e.defaultView)return;let{prevStyle:t,styleSheet:n}=nq.get(e)??{};void 0===n&&(n=new e.defaultView.CSSStyleSheet,e.adoptedStyleSheets=[n]);let{cursorFlags:r,interactionState:s}=nN;switch(s.state){case"active":case"hover":{let e=function({cursorFlags:e,groups:t,state:n}){let r=0,s=0;switch(n){case"active":case"hover":t.forEach(e=>{if(!e.disableCursor)switch(e.orientation){case"horizontal":r++;break;case"vertical":s++}})}if(0===r&&0===s)return null;if("active"===n){let t=(4&e)!=0,n=(8&e)!=0;if(e){if((1&e)!=0)return t?"se-resize":n?"ne-resize":"e-resize";if((2&e)!=0)return t?"sw-resize":n?"nw-resize":"w-resize";if(t)return"s-resize";if(n)return"n-resize"}}return r>0&&s>0?"move":r>0?"ew-resize":"ns-resize"}({cursorFlags:r,groups:s.hitRegions.map(e=>e.group),state:s.state}),a=`*{cursor: ${e} !important; ${"active"===s.state?"touch-action: none;":""} }`;if(t===a)return;t=a,e?0===n.cssRules.length?n.insertRule(a):n.replaceSync(a):1===n.cssRules.length&&n.deleteRule(0);break}case"inactive":t=void 0,1===n.cssRules.length&&n.deleteRule(0)}nq.set(e,{prevStyle:t,styleSheet:n})}function nV({document:e,event:t,hitRegions:n,initialLayoutMap:r,mountedGroups:s,pointerDownAtPoint:a}){let i=0,o=new Map(s);n.forEach(e=>{let{group:n,groupSize:l}=e,{disableCursor:c,orientation:d,panels:u}=n,m=0;m=a?"horizontal"===d?(t.clientX-a.x)/l*100:(t.clientY-a.y)/l*100:"horizontal"===d?t.clientX<0?-100:100:t.clientY<0?-100:100;let h=r.get(n),{defaultLayoutDeferred:p,derivedPanelConstraints:f,layout:x,separatorToPanels:g}=s.get(n)??{defaultLayoutDeferred:!1};if(f&&h&&x&&g){let t=nR({delta:m,initialLayout:h,panelConstraints:f,pivotIndices:e.panels.map(e=>u.indexOf(e)),prevLayout:x,trigger:"mouse-or-touch"});if(nI(t,x)){if(0!==m&&!c)switch(d){case"horizontal":i|=m<0?1:2;break;case"vertical":i|=m<0?4:8}}else{o.set(e.group,{defaultLayoutDeferred:p,derivedPanelConstraints:f,layout:t,separatorToPanels:g});let n=e.group.panels.map(({id:e})=>e).join(",");e.group.inMemoryLayouts[n]=t}}}),nS({cursorFlags:i,mountedGroups:o}),nW(e)}function nK(e){let{interactionState:t,mountedGroups:n}=nN;"active"===t.state&&nV({document:e.currentTarget,event:e,hitRegions:t.hitRegions,initialLayoutMap:t.initialLayoutMap,mountedGroups:n})}function nX(e){if(e.defaultPrevented)return;let{interactionState:t,mountedGroups:n}=nN;if("active"===t.state){if(0===e.buttons)return void nS(e=>"inactive"===e.interactionState.state?e:{cursorFlags:0,interactionState:{state:"inactive"}});nV({document:e.currentTarget,event:e,hitRegions:t.hitRegions,initialLayoutMap:t.initialLayoutMap,mountedGroups:n,pointerDownAtPoint:t.pointerDownAtPoint})}else{let r=nU(e,n);0===r.length?"inactive"!==t.state&&nS({interactionState:{state:"inactive"}}):nS({interactionState:{hitRegions:r,state:"hover"}}),nW(e.currentTarget)}}function nY(e){if(e.defaultPrevented)return;e.preventDefault();let{interactionState:t}=nN;"active"===t.state&&(nS({cursorFlags:0,interactionState:{state:"inactive"}}),nW(e.currentTarget))}function nJ(e){let t=0,n=0,r={};for(let s of e)if(void 0!==s.defaultSize){t++;let e=nj(s.defaultSize);n+=e,r[s.panelId]=e}else r[s.panelId]=void 0;let s=e.length-t;if(0!==s){let t=nj((100-n)/s);for(let n of e)void 0===n.defaultSize&&(r[n.panelId]=t)}return r}let nZ=new Map;function n0(e){let t=(0,d.useId)();return`${e??t}`}let n1="u">typeof window?d.useLayoutEffect:d.useEffect;function n5(e){let t=(0,d.useRef)(e);return n1(()=>{t.current=e},[e]),(0,d.useCallback)(e=>t.current?.(e),[t])}function n2(...e){return n5(t=>{e.forEach(e=>{if(e)switch(typeof e){case"function":e(t);break;case"object":e.current=t}})})}let n4="--react-resizable-panels--panel--pointer-events";function n3(e,t){let n=e.replace(/[^a-zA-Z0-9\-_]/g,""),r=t.replace(/[^a-zA-Z0-9\-_]/g,"");return`--react-resizable-panels--${n}--${r}`}let n6=(0,d.createContext)(null);function n8({children:e,className:t,defaultLayout:n,disableCursor:s,disabled:a,elementRef:i,groupRef:o,id:l,onLayoutChange:c,orientation:u="horizontal",style:m,...h}){var p;let f,x,g=(0,d.useRef)({}),v=n5(e=>{nI(g.current,e)||(g.current=e,c?.(e))}),y=n0(l),[b,j]=(0,d.useState)(!1),[w,C]=(0,d.useState)(null),[N,k]=(0,d.useState)(n??{}),[S,M]=(0,d.useState)([]),[T,R]=(0,d.useState)([]),E=(0,d.useRef)({lastExpandedPanelSizes:{},layouts:{}}),I=n2(C,i);f=(0,d.useRef)({getLayout:()=>({}),setLayout:nA}),(0,d.useImperativeHandle)(o,()=>f.current,[]),n1(()=>{Object.assign(f.current,nz({groupId:y}))});let D=(0,d.useMemo)(()=>({id:y,orientation:u,registerPanel:e=>(M(t=>np(u,[...t,e])),()=>{M(t=>t.filter(t=>t!==e))}),registerSeparator:e=>(R(t=>np(u,[...t,e])),()=>{R(t=>t.filter(t=>t!==e))})}),[y,u]),z=(p={defaultLayout:n,disableCursor:s},x=(0,d.useRef)({...p}),n1(()=>{for(let e in p)x.current[e]=p[e]},[p]),x.current),L=(0,d.useRef)(null);n1(()=>{let e,t,n,r,s,i,o,l,c,d,m,h;if(null===w)return;let p={defaultLayout:z.defaultLayout,disableCursor:!!z.disableCursor,disabled:!!a,element:w,id:y,inMemoryLastExpandedPanelSizes:E.current.lastExpandedPanelSizes,inMemoryLayouts:E.current.layouts,orientation:u,panels:S,separators:T};L.current=p;let f=(e=!0,nm(p.element.ownerDocument.defaultView,"Cannot register an unmounted Group"),t=p.element.ownerDocument.defaultView.ResizeObserver,n=new Set,r=new Set,(s=new t(t=>{for(let n of t){let{borderBoxSize:t,target:r}=n;if(r===p.element){if(e){if(0===nh({group:p}))return;nS(e=>{let t=e.mountedGroups.get(p);if(t){let n=nw(p),r=t.defaultLayoutDeferred?nJ(n):t.layout,s=nD({layout:r,panelConstraints:n});return!t.defaultLayoutDeferred&&nI(r,s)&&function(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(e[n]!==t[n])return!1;return!0}(t.derivedPanelConstraints,n)?e:{mountedGroups:new Map(e.mountedGroups).set(p,{defaultLayoutDeferred:!1,derivedPanelConstraints:n,layout:s,separatorToPanels:t.separatorToPanels})}}return e})}}else!function(e,t,n){let r=n[0];if(!r)return;let s=e.panels.find(e=>e.element===t);if(!s||!s.onResize)return;let a=nh({group:e});s.onResize({asPercentage:nj(r.inlineSize/a*100),inPixels:r.inlineSize},s.id)}(p,r,t)}})).observe(p.element),p.panels.forEach(e=>{nm(!n.has(e.id),`Panel ids must be unique; id "${e.id}" was used more than once`),n.add(e.id),e.onResize&&s.observe(e.element)}),i=nh({group:p}),o=nw(p),l=p.panels.map(({id:e})=>e).join(","),(c=p.defaultLayout)&&(function(e,t){let n=e.map(e=>e.id),r=Object.keys(t);if(n.length!==r.length)return!1;for(let e of n)if(!r.includes(e))return!1;return!0}(p.panels,c)||(c=void 0)),d=nD({layout:p.inMemoryLayouts[l]??c??nJ(o),panelConstraints:o}),m=ny(p),h=p.element.ownerDocument,nS(e=>{let t=new Map;return nZ.set(h,(nZ.get(h)??0)+1),m.forEach(e=>{e.separator&&t.set(e.separator,e.panels)}),{mountedGroups:new Map(e.mountedGroups).set(p,{defaultLayoutDeferred:0===i,derivedPanelConstraints:o,layout:d,separatorToPanels:t})}}),p.separators.forEach(e=>{nm(!r.has(e.id),`Separator ids must be unique; id "${e.id}" was used more than once`),r.add(e.id),e.element.addEventListener("keydown",n_)}),1===nZ.get(h)&&(h.addEventListener("pointerdown",nH),h.addEventListener("pointerleave",nK),h.addEventListener("pointermove",nX),h.addEventListener("pointerup",nY)),function(){e=!1,nZ.set(h,Math.max(0,(nZ.get(h)??0)-1)),nS(e=>{let t=new Map(e.mountedGroups);return t.delete(p),{mountedGroups:t}}),p.separators.forEach(e=>{e.element.removeEventListener("keydown",n_)}),nZ.get(h)||(h.removeEventListener("pointerdown",nH),h.removeEventListener("pointerleave",nK),h.removeEventListener("pointermove",nX),h.removeEventListener("pointerup",nY)),s.disconnect()}),x=nN.mountedGroups.get(p);if(x){let{defaultLayoutDeferred:e,derivedPanelConstraints:t,layout:n}=x;!e&&t.length>0&&(k(n),v?.(n))}let g=nk.addListener("interactionStateChange",e=>{"active"===e.state?j(e.hitRegions.some(e=>e.group===p)):j(!1)}),b=nk.addListener("mountedGroupsChange",e=>{let t=e.get(p);if(t){let{defaultLayoutDeferred:e,derivedPanelConstraints:n,layout:r}=t;if(e||0===n.length)return;k(r),v?.(r)}});return()=>{L.current=null,f(),g(),b()}},[a,w,y,v,u,S,T,z]),(0,d.useEffect)(()=>{let e=L.current;e&&(e.defaultLayout=n,e.disableCursor=!!s)});let P={[n4]:b?"none":void 0};for(let e in N){let t=n3(y,e),n=N[e];P[t]=n}return(0,r.jsx)(n6.Provider,{value:D,children:(0,r.jsx)("div",{...h,"aria-orientation":u,className:t,"data-group":!0,"data-testid":y,id:y,ref:I,style:{...m,...P,display:"flex",flexDirection:"horizontal"===u?"row":"column",flexWrap:"nowrap"},children:e})})}function n7(){let e=(0,d.useContext)(n6);return nm(e,"Group Context not found; did you render a Panel or Separator outside of a Group?"),e}function n9({children:e,className:t,collapsedSize:n="0%",collapsible:s=!1,defaultSize:a,elementRef:i,id:o,maxSize:l="100%",minSize:c="0%",onResize:u,panelRef:m,style:h,...p}){let f=!!o,x=n0(o),[g,v]=(0,d.useState)(null),y=n2(v,i),{id:b,registerPanel:j}=n7(),w=null!==u,C=n5(e=>{u?.(e,o)});n1(()=>{if(null!==g)return j({element:g,id:x,idIsStable:f,onResize:w?C:void 0,panelConstraints:{collapsedSize:n,collapsible:s,defaultSize:a,maxSize:l,minSize:c}})},[n,s,a,g,w,x,f,l,c,C,j]),function(e,t){let{id:n}=n7(),r=(0,d.useRef)({collapse:nF,expand:nF,getSize:()=>({asPercentage:0,inPixels:0}),isCollapsed:()=>!1,resize:nF});(0,d.useImperativeHandle)(t,()=>r.current,[]),n1(()=>{Object.assign(r.current,function({groupId:e,panelId:t}){let n=()=>{let{mountedGroups:t}=nN;for(let[n,{defaultLayoutDeferred:r,derivedPanelConstraints:s,layout:a,separatorToPanels:i}]of t)if(n.id===e)return{defaultLayoutDeferred:r,derivedPanelConstraints:s,group:n,layout:a,separatorToPanels:i};throw Error(`Group ${e} not found`)},r=()=>{let e=n().derivedPanelConstraints.find(e=>e.panelId===t);if(void 0!==e)return e;throw Error(`Panel constraints not found for Panel ${t}`)},s=()=>{let e=n().layout[t];if(void 0!==e)return e;throw Error(`Layout not found for Panel ${t}`)},a=e=>{let r=s();if(e===r)return;let{defaultLayoutDeferred:a,derivedPanelConstraints:i,group:o,layout:l,separatorToPanels:c}=n(),d=o.panels.findIndex(e=>e.id===t),u=d===o.panels.length-1,m=nD({layout:nR({delta:u?r-e:e-r,initialLayout:l,panelConstraints:i,pivotIndices:u?[d-1,d]:[d,d+1],prevLayout:l,trigger:"imperative-api"}),panelConstraints:i});nI(l,m)||nS(e=>({mountedGroups:new Map(e.mountedGroups).set(o,{defaultLayoutDeferred:a,derivedPanelConstraints:i,layout:m,separatorToPanels:c})}))};return{collapse:()=>{let{collapsible:e,collapsedSize:t}=r(),n=s();e&&n!==t&&a(t)},expand:()=>{let{collapsible:e,collapsedSize:t,minSize:n}=r(),i=s();e&&i===t&&a(n)},getSize:()=>{let{group:e}=n(),r=s(),{element:a}=(()=>{let e=n().group.panels.find(e=>e.id===t);if(void 0!==e)return e;throw Error(`Layout not found for Panel ${t}`)})();return{asPercentage:r,inPixels:"horizontal"===e.orientation?a.offsetWidth:a.offsetHeight}},isCollapsed:()=>{let{collapsible:e,collapsedSize:t}=r(),n=s();return e&&nC(t,n)},resize:e=>{if(s()!==e){let t;switch(typeof e){case"number":{let{group:r}=n();t=nj(e/nh({group:r})*100);break}case"string":t=parseFloat(e)}a(t)}}}}({groupId:n,panelId:e}))})}(x,m);let N=n3(b,x);return(0,r.jsx)("div",{...p,"data-panel":!0,"data-testid":x,id:x,ref:y,style:{...re,flexBasis:0,flexGrow:`var(${N}, 1)`,flexShrink:1,overflow:"hidden",pointerEvents:`var(${n4})`},children:(0,r.jsx)("div",{className:t,style:{width:"100%",height:"100%",...h},children:e})})}let re={minHeight:"unset",maxHeight:"unset",height:"unset",minWidth:"unset",maxWidth:"unset",width:"unset",flex:"unset",flexBasis:"unset",flexShrink:"unset",flexGrow:"unset",border:"unset",borderWidth:"unset",padding:"unset",margin:"unset"};function rt({children:e,className:t,elementRef:n,id:s,style:a,...i}){let o=n0(s),[l,c]=(0,d.useState)({}),[u,m]=(0,d.useState)("inactive"),[h,p]=(0,d.useState)(null),f=n2(p,n),{id:x,orientation:g,registerSeparator:v}=n7();return n1(()=>{if(null!==h){let e={element:h,id:o},t=v(e),n=nk.addListener("interactionStateChange",t=>{m("inactive"!==t.state&&t.hitRegions.some(t=>t.separator===e)?t.state:"inactive")}),r=nk.addListener("mountedGroupsChange",t=>{t.forEach(({derivedPanelConstraints:t,layout:n,separatorToPanels:r},s)=>{if(s.id===x){let a=r.get(e);if(a){let e=a[0],r=s.panels.indexOf(e);c(function({layout:e,panelConstraints:t,panelId:n,panelIndex:r}){let s,a,i=e[n],o=t.find(e=>e.panelId===n);if(o){let l=o.maxSize,c=a=o.collapsible?o.collapsedSize:o.minSize,d=[r,r+1];a=nD({layout:nR({delta:c-i,initialLayout:e,panelConstraints:t,pivotIndices:d,prevLayout:e,trigger:"keyboard"}),panelConstraints:t})[n],s=nD({layout:nR({delta:l-i,initialLayout:e,panelConstraints:t,pivotIndices:d,prevLayout:e,trigger:"keyboard"}),panelConstraints:t})[n]}return{valueControls:n,valueMax:s,valueMin:a,valueNow:i}}({layout:n,panelConstraints:t,panelId:e.id,panelIndex:r}))}}})});return()=>{n(),r(),t()}}},[h,x,o,v]),(0,r.jsx)("div",{...i,"aria-controls":l.valueControls,"aria-orientation":"horizontal"===g?"vertical":"horizontal","aria-valuemax":l.valueMax,"aria-valuemin":l.valueMin,"aria-valuenow":l.valueNow,children:e,className:t,"data-separator":u,"data-testid":o,id:o,ref:f,role:"separator",style:{flexBasis:"auto",...a,flexGrow:0,flexShrink:0},tabIndex:0})}function rn({className:e,...t}){return(0,r.jsx)(n8,{"data-slot":"resizable-panel-group",className:(0,z.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",e),...t})}function rr({...e}){return(0,r.jsx)(n9,{"data-slot":"resizable-panel",...e})}function rs({withHandle:e,className:t,...n}){return(0,r.jsx)(rt,{"data-slot":"resizable-handle",className:(0,z.cn)("bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:translate-x-0 data-[panel-group-direction=vertical]:after:-translate-y-1/2 [&[data-panel-group-direction=vertical]>div]:rotate-90",t),...n,children:e&&(0,r.jsx)("div",{className:"bg-border z-10 flex h-4 w-3 items-center justify-center rounded-xs border",children:(0,r.jsx)(nu.default,{className:"size-2.5"})})})}var ra=e.i(776012),ri=e.i(873964);function ro({params:e}){let t,n,m=(0,d.use)(e).conversationId,f=(0,l.useRouter)(),x=(0,l.useSearchParams)().get("messageId")??void 0,{filteredConversations:g}=(0,ra.useConversationContext)(),{documentId:v,setDocumentId:y}=(0,p.useCanvasContext)(),b=(0,a.useQuery)(s.api.canvas.documents.getByConversation,m?{conversationId:m}:"skip"),j=(0,a.useQuery)(s.api.conversations.get,m?{conversationId:m}:"skip"),{results:w,status:C,loadMore:N}=(0,a.usePaginatedQuery)(s.api.messages.listPaginated,m?{conversationId:m}:"skip",{initialNumItems:50}),k=(0,a.useQuery)(s.api.users.getCurrentUser),{handleClose:S}=function({conversationId:e,isDocumentMode:t,documentId:n,activeCanvasDocumentId:r,setDocumentId:s}){let a=(0,d.useRef)(e),i=(0,d.useRef)(!1),o=(0,d.useCallback)(()=>{i.current=!0,s(null)},[s]);return(0,d.useEffect)(()=>{!t&&n&&s(null)},[t,n,s]),(0,d.useEffect)(()=>{a.current!==e&&(a.current=e,i.current=!1,n&&s(null))},[e,n,s]),(0,d.useEffect)(()=>{r&&!n&&t&&!i.current&&s(r)},[r,n,s,t]),{handleClose:o}}({conversationId:m,isDocumentMode:j?.mode==="document",documentId:v,activeCanvasDocumentId:b?._id,setDocumentId:y}),{messages:M,addOptimisticMessages:T}=function({serverMessages:e}){let[t,n]=(0,d.useState)([]),r=(0,d.useCallback)(e=>{n(t=>[...t,...e])},[]);return{messages:(0,d.useMemo)(()=>{let n=e||[];if(0===t.length)return n;let r=t.filter(e=>!n.some(t=>!(t.role!==e.role||Math.abs(t.createdAt-e.createdAt)>=5e3)&&("assistant"!==e.role||!e.model||t.model===e.model)));return[...n,...r].sort((e,t)=>e.createdAt-t.createdAt)},[e,t]),addOptimisticMessages:r}}({serverMessages:w}),R=(0,a.useQuery)(s.api.users.getUserPreference,{key:"chatWidth"}),E=void 0===R,I=R||"standard",D=(0,ef.useUserPreference)("defaultModel"),z=(0,ef.useUserPreference)("showModelNamesDuringComparison"),L=(0,ef.useUserPreference)("ttsSpeed"),P=(0,ep.useFeatureToggles)(),{selectedModel:_,displayModel:A,modelLoading:F,handleModelChange:O}=function({conversationId:e,conversation:t,user:n,defaultModel:r}){let a=(0,u.useMutation)(s.api.conversations.updateModel),[i,o]=(0,d.useState)(null),{selectedModel:l,modelLoading:c}=(0,d.useMemo)(()=>{let e=void 0!==n;if(void 0===t||!e)return{selectedModel:"",modelLoading:!0};ri.DEFAULT_MODEL_ID;return{selectedModel:t?.model&&(0,ee.isValidModel)(t.model)?t.model:r&&(0,ee.isValidModel)(r)?r:ri.DEFAULT_MODEL_ID,modelLoading:!1}},[t,n,r]);return{selectedModel:l,displayModel:i||l,modelLoading:c,optimisticModel:i,handleModelChange:(0,d.useCallback)(async t=>{if(o(t),e)try{await a({conversationId:e,model:t}),o(null)}catch(e){console.error("Failed to persist model:",e),o(null)}},[e,a])}}({conversationId:m,conversation:j,user:k,defaultModel:D}),[B,$]=(0,d.useState)("none"),[Q,G]=(0,d.useState)([]),[U,H]=(0,c.useQueryState)("showModelNames",c.parseAsBoolean.withDefault(z)),[q,V]=(0,d.useState)(!1),[K,X]=(0,d.useState)(!1),[Y,J]=(0,d.useState)(!1),[Z,et]=(0,d.useState)(!1),en=(0,d.useRef)(null),{isActive:er,selectedModels:es,startComparison:ea,exitComparison:ei}=function(){let[e,t]=(0,d.useState)(!1),[n,r]=(0,d.useState)([]),[s,a]=(0,d.useState)(null);return{isActive:e,selectedModels:n,activeComparisonId:s,startComparison:(0,d.useCallback)(e=>e.length<2?(console.warn("Cannot start comparison: Select at least 2 models"),!1):e.length>4?(console.warn("Cannot start comparison: Maximum 4 models allowed"),!1):(r(e),t(!0),ex.analytics.track("comparison_started",{modelCount:e.length,models:e.join(",")}),!0),[]),exitComparison:(0,d.useCallback)(()=>{t(!1),r([]),a(null),ex.analytics.track("comparison_exited",{})},[]),setActiveComparisonId:a}}(),{isMobile:eo,isTouchDevice:el}=(0,eQ.useMobileDetect)(),{handleVote:ec,handleConsolidate:ed}=function({conversationId:e,messages:t}){let n=(0,l.useRouter)(),r=(0,u.useMutation)(s.api.votes.recordVote),a=(0,u.useMutation)(s.api.conversations.createConsolidationConversation),i=(0,u.useMutation)(s.api.conversations.consolidateInSameChat),o=(0,u.useMutation)(s.api.conversations.updateModel);return{handleVote:(0,d.useCallback)(async(e,n)=>{let s=t?.find(t=>!("_optimistic"in t)&&t._id===e);s?.comparisonGroupId&&await r({comparisonGroupId:s.comparisonGroupId,winnerId:s._id,rating:n})},[t,r]),handleConsolidate:(0,d.useCallback)(async(r,s)=>{let l=t?.find(e=>e.comparisonGroupId);if(l?.comparisonGroupId)if("same-chat"===s)await i({conversationId:e,comparisonGroupId:l.comparisonGroupId,consolidationModel:r}),await o({conversationId:e,model:r});else{let{conversationId:e}=await a({comparisonGroupId:l.comparisonGroupId,consolidationModel:r});n.push(`/chat/${e}`)}},[e,t,i,a,o,n])}}({conversationId:m,messages:M}),eu=function({conversation:e,messages:t,onModelChange:n}){let[r,a]=(0,d.useState)(!1),[i,o]=(0,d.useState)(null),[l,c]=(0,d.useState)(!1),[m,h]=(0,d.useState)(null),[p,f]=(0,d.useState)(null),x=(0,u.useMutation)(s.api.users.updatePreferences),g=(0,d.useCallback)(async e=>{await n(e),h(e),f(Date.now())},[n]),v=(0,d.useCallback)(e=>{o(e),a(!0)},[]),y=(0,d.useCallback)(async()=>{m&&(await x({preferences:{defaultModel:m}}),c(!1))},[m,x]);return(0,d.useEffect)(()=>{if(m&&p&&t&&t.length>0){let n=t[t.length-1];if("assistant"===n.role&&"complete"===n.status&&e?.model===m&&n._creationTime>p){let e=setTimeout(()=>{c(!0)},2e3);return()=>clearTimeout(e)}}},[t,m,p,e?.model]),(0,d.useEffect)(()=>{let e=e=>{o(e.detail.modelId),a(!0)};return window.addEventListener("open-model-preview",e),()=>window.removeEventListener("open-model-preview",e)},[]),{previewModalOpen:r,setPreviewModalOpen:a,previewModelId:i,showSetDefaultPrompt:l,switchedModelId:m,handleSwitchModel:g,handlePreviewModel:v,handleSetAsDefault:y,dismissSetDefaultPrompt:()=>c(!1)}}({conversation:j,messages:M,onModelChange:O});!function({onOpenQuickSwitcher:e,onOpenTemplateSelector:t}){(0,d.useEffect)(()=>(window.addEventListener("open-quick-model-switcher",e),()=>window.removeEventListener("open-quick-model-switcher",e)),[e]),(0,d.useEffect)(()=>(window.addEventListener("open-quick-template-switcher",t),()=>window.removeEventListener("open-quick-template-switcher",t)),[t])}({onOpenQuickSwitcher:(0,d.useCallback)(()=>J(!0),[]),onOpenTemplateSelector:(0,d.useCallback)(()=>et(!0),[])}),t=(0,l.useRouter)(),n=(0,l.useSearchParams)(),(0,d.useEffect)(()=>{if("true"!==n.get("insertTemplate"))return;let e=sessionStorage.getItem("pending-template-text");e&&(sessionStorage.removeItem("pending-template-text"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("insert-prompt",{detail:e})),window.dispatchEvent(new CustomEvent("focus-chat-input"))},100));let r=new URL(window.location.href);r.searchParams.delete("insertTemplate"),t.replace(r.pathname+r.search,{scroll:!1})},[n,t]),(0,d.useEffect)(()=>{if(!en.current||"CanLoadMore"!==C)return;let e=new IntersectionObserver(e=>{e[0].isIntersecting&&"CanLoadMore"===C&&N(50)},{threshold:1});return e.observe(en.current),()=>e.disconnect()},[C,N]);let em=(0,d.useRef)(!1);(0,d.useEffect)(()=>{if(void 0===j){em.current=!1;return}em.current=!0,null===j&&f.push("/app")},[j,f]),(0,d.useEffect)(()=>{if(!m||eo||el)return;let e=setTimeout(()=>{window.dispatchEvent(new CustomEvent("focus-chat-input"))},50);return()=>clearTimeout(e)},[m,eo,el]);let eh=M?.some(e=>"assistant"===e.role&&["pending","generating"].includes(e.status||""))??!1,eg=(0,ee.getModelConfig)(A),ev=!!eg?.reasoning||eg?.capabilities?.includes("thinking"),ey=(M?.length??0)>0,{isFirst:eb,isLast:ej,navigateToPrevious:ew,navigateToNext:eC}=function({conversationId:e,filteredConversations:t}){let n=(0,l.useRouter)(),{currentIndex:r,isFirst:s,isLast:a,sortedConversations:i}=(0,d.useMemo)(()=>{if(!t?.length||!e)return{currentIndex:-1,isFirst:!0,isLast:!0,sortedConversations:[]};let n=[...t].sort((e,t)=>t._creationTime-e._creationTime),r=n.findIndex(t=>t._id===e);return{currentIndex:r,isFirst:r<=0,isLast:r>=n.length-1,sortedConversations:n}},[t,e]),o=(0,d.useCallback)(()=>{if(s||0===i.length)return;let e=Math.max(r-1,0);n.push(`/chat/${i[e]._id}`)},[s,i,r,n]),c=(0,d.useCallback)(()=>{if(a||0===i.length)return;let e=Math.min(r+1,i.length-1);n.push(`/chat/${i[e]._id}`)},[a,i,r,n]);return{currentIndex:r,isFirst:s,isLast:a,navigateToPrevious:o,navigateToNext:c}}({conversationId:m,filteredConversations:g}),eN=void 0===w||"LoadingFirstPage"===C||E;return(0,r.jsx)(tD.TTSProvider,{defaultSpeed:L,children:(0,r.jsxs)(rn,{orientation:"horizontal",className:"flex-1 min-h-0",id:"chat-canvas-layout",children:[(0,r.jsx)(rr,{defaultSize:v?45:100,minSize:30,children:(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)(e_,{conversation:j,conversationId:m,selectedModel:A,modelLoading:F,hasMessages:ey,isFirst:eb,isLast:ej,isComparisonActive:er,comparisonModelCount:es.length,showProjects:P.showProjects,onNavigatePrevious:ew,onNavigateNext:eC,onModelBadgeClick:()=>V(!0),onComparisonBadgeClick:()=>X(!0)}),(0,r.jsx)(tP,{}),(0,r.jsx)(i.AnimatePresence,{mode:"popLayout",children:eN?(0,r.jsx)(o.motion.div,{initial:{opacity:1},exit:{opacity:0},transition:{duration:.15},children:(0,r.jsx)(tb.MessageListSkeleton,{chatWidth:I})},"skeleton"):(0,r.jsxs)(o.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"flex-1 flex flex-col min-h-0",children:["CanLoadMore"===C&&(0,r.jsx)("div",{className:"flex justify-center p-4",children:(0,r.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:()=>N(50),className:"text-sm",children:"Load older messages"})}),"LoadingMore"===C&&(0,r.jsx)("div",{className:"flex justify-center p-4",children:(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading more messages..."})}),(0,r.jsx)("div",{ref:en,className:"h-px"}),(0,r.jsx)(nr,{messages:M,selectedModel:A,chatWidth:I,isGenerating:eh,onVote:ec,onConsolidate:ed,onToggleModelNames:()=>H(!U),showModelNames:U??!1,highlightMessageId:x,isCollaborative:j?.isCollaborative}),j?.modelRecommendation&&!j.modelRecommendation.dismissed&&(0,r.jsx)(tk.ModelRecommendationBanner,{recommendation:j.modelRecommendation,conversationId:m,onSwitch:eu.handleSwitchModel,onPreview:eu.handlePreviewModel}),eu.showSetDefaultPrompt&&eu.switchedModelId&&(0,r.jsx)(tM,{modelId:eu.switchedModelId,modelName:tw.MODEL_CONFIG[eu.switchedModelId]?.name??eu.switchedModelId,conversationId:m,onSetDefault:eu.handleSetAsDefault,onDismiss:eu.dismissSetDefaultPrompt}),eu.previewModalOpen&&eu.previewModelId&&j?.modelRecommendation&&(0,r.jsx)(tN,{open:eu.previewModalOpen,onOpenChange:eu.setPreviewModalOpen,currentModelId:j.modelRecommendation.currentModelId,suggestedModelId:eu.previewModelId,currentResponse:M?.find(e=>"assistant"===e.role)?.content??"",onSwitch:eu.handleSwitchModel,conversationId:m,userMessage:M?.find(e=>"user"===e.role)?.content??""}),(0,r.jsx)(te.QuickModelSwitcher,{open:Y,onOpenChange:J,currentModel:_,onSelectModel:O}),(0,r.jsx)(nd,{open:Z,onOpenChange:et,mode:"insert",onSelectTemplate:e=>{window.dispatchEvent(new CustomEvent("insert-prompt",{detail:e}))}})]},`messages-${m}`)}),(0,r.jsx)("div",{className:"flex shrink-0",children:(0,r.jsx)(ty,{conversationId:m,chatWidth:I,isGenerating:eh,selectedModel:A,onModelChange:O,thinkingEffort:ev?B:void 0,onThinkingEffortChange:$,attachments:Q,onAttachmentsChange:G,isComparisonMode:er,selectedModels:es,onStartComparison:ea,onExitComparison:ei,isEmpty:M?.length===0,modelSelectorOpen:q,onModelSelectorOpenChange:V,comparisonDialogOpen:K,onComparisonDialogOpenChange:X,onOptimisticUpdate:T})})]})}),v&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(rs,{withHandle:!0}),(0,r.jsx)(rr,{defaultSize:55,minSize:25,children:(0,r.jsx)(W,{documentId:v,onClose:S})})]})]})})}function rl({params:e}){return(0,r.jsx)(ro,{params:e})}e.s(["default",()=>rl],987677)}]);