(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,817735,e=>{"use strict";let t=(0,e.i(755430).default)("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]);e.s(["Maximize2",()=>t],817735)},201029,e=>{"use strict";let t=(0,e.i(755430).default)("cpu",[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]]);e.s(["Cpu",()=>t],201029)},336158,e=>{"use strict";let t=(0,e.i(755430).default)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);e.s(["Globe",()=>t],336158)},385158,e=>{"use strict";var t=e.i(685809),r=e.i(62551),s=e.i(201029),a=e.i(644163),n=e.i(336158),o=e.i(346596),i=e.i(265636),i=i;let l=(0,e.i(755430).default)("wind",[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]]);var c=e.i(108665),d=e.i(241362);function u(e){let t=(0,d.getModelConfig)(e);return t?t.capabilities.includes("vision")?a.Eye:t.capabilities.includes("thinking")||t.capabilities.includes("extended-thinking")?o.Sparkles:c.Zap:o.Sparkles}function m(e){return({openai:o.Sparkles,anthropic:c.Zap,google:i.default,xai:r.Brain,perplexity:n.Globe,groq:s.Cpu,cerebras:s.Cpu,minimax:t.Bot,deepseek:r.Brain,kimi:t.Bot,zai:r.Brain,meta:t.Bot,mistral:l,alibaba:t.Bot,zhipu:t.Bot})[e]||o.Sparkles}e.s(["getModelIcon",()=>u,"getProviderIcon",()=>m],385158)},654270,e=>{"use strict";let t=(0,e.i(755430).default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);e.s(["Square",()=>t],654270)},897846,(e,t,r)=>{var s=/[\\\/\-_+.# \t"@\[\(\{&]/,a=/[\\\/\-_+.# \t"@\[\(\{&]/g;t.exports=function(e,t){return function e(t,r,n,o,i,l){if(l===r.length)return i===t.length?1:.99;for(var c,d,u,m=o.charAt(l),p=n.indexOf(m,i),x=0;p>=0;)(c=e(t,r,n,o,p+1,l+1))>x&&(p===i?c*=1:s.test(t.charAt(p-1))?(c*=.9,(u=t.slice(i,p-1).match(a))&&i>0&&(c*=Math.pow(.999,u.length))):(s.test(t.slice(i,p-1))?c*=0:c*=.3,i>0&&(c*=Math.pow(.999,p-i))),t.charAt(p)!==r.charAt(l)&&(c*=.9999)),c<.1&&n.charAt(p-1)===o.charAt(l+1)&&n.charAt(p-1)!==o.charAt(l)&&.1*(d=e(t,r,n,o,p+1,l+2))>c&&(c=.1*d),c>x&&(x=c),p=n.indexOf(m,p+1);return x}(e,t,e.toLowerCase(),t.toLowerCase(),0,0)}},372825,46944,219307,360549,319226,423223,e=>{"use strict";var t,r=e.i(283164);e.i(977101);var s=e.i(727630),a=e.i(384078),n=e.i(799126),o=e.i(432593);function i(){let e=(0,o.useUserPreference)("favoriteModels"),t=(0,s.useMutation)(r.api.users.updatePreferences),[i,l]=(0,a.useState)([]);(0,a.useEffect)(()=>{l(e)},[e]);let c=async e=>{let r=i.includes(e)?i.filter(t=>t!==e):[...i,e];l(r);try{await t({preferences:{favoriteModels:r}})}catch(e){l(i),n.toast.error("Failed to update favorites")}};return{favorites:i,toggleFavorite:c,isFavorite:e=>i.includes(e)}}e.s(["useFavoriteModels",()=>i],372825);var l=e.i(62551),c=e.i(455236),d=e.i(418966),u=e.i(644163),m=e.i(755430);let p=(0,m.default)("gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);var x=e.i(336158),h=e.i(346596),g=e.i(108665),f=e.i(341879);let v=[{id:"all",label:"All Models",filter:()=>!0,description:"All available models"},{id:"free",label:"Free",icon:p,filter:e=>0===e.pricing.input&&0===e.pricing.output,description:"Completely free to use"},{id:"speed",label:"Speed",icon:g.Zap,filter:e=>{let t=(0,f.computeModelMetrics)(e);return"ultra-fast"===t.speedTier||"fast"===t.speedTier},description:"Fast models for quick answers and simple tasks"},{id:"budget",label:"Budget",icon:d.DollarSign,filter:e=>"budget"===(0,f.computeModelMetrics)(e).costTier,description:"Cost-effective for high-volume use"},{id:"coding",label:"Coding",icon:c.Code,filter:e=>((0,f.getBenchmarkScores)(e).coding??0)>=70,description:"Best for software development tasks"},{id:"reasoning",label:"Reasoning",icon:h.Sparkles,filter:e=>e.capabilities.includes("extended-thinking")||e.capabilities.includes("thinking"),description:"Deep thinking for complex problems (slower/pricier)"},{id:"intelligence",label:"Intelligence",icon:l.Brain,filter:e=>((0,f.getBenchmarkScores)(e).intelligence??0)>=85,description:"Highest capability for sophisticated tasks (expensive)"},{id:"vision",label:"Vision",icon:u.Eye,filter:e=>e.capabilities.includes("vision"),description:"Image analysis and multimodal understanding"},{id:"web-search",label:"Web Search",icon:x.Globe,filter:e=>"perplexity"===e.provider||(e.knowledgeCutoff?.includes("Real-time")??!1),description:"Real-time internet access"}];function b(e){return v.filter(t=>"all"!==t.id&&t.filter(e)).map(e=>e.id)}function j(e,t){let r=v.find(t=>t.id===e);return r?t.filter(r.filter).length:0}function y(e,t,r,s=[]){let a=e.find(e=>e.id===t),n=e.filter(e=>r.includes(e.id)&&e.id!==t).sort((e,t)=>e.name.localeCompare(t.name));return{defaultModel:a,favorites:n,recents:e.filter(e=>s.includes(e.id)&&e.id!==t&&!r.includes(e.id)).sort((e,t)=>s.indexOf(e.id)-s.indexOf(t.id)),rest:e.filter(e=>e.id!==t&&!r.includes(e.id)&&!s.includes(e.id))}}e.s(["MODEL_CATEGORIES",0,v,"countModelsInCategory",()=>j,"getModelCategories",()=>b],46944),e.s(["sortModels",()=>y],219307);var w=e.i(379492),N=e.i(152088);function k({activeCategory:e,onCategoryChange:t,allModels:r}){return(0,w.jsxs)("div",{className:"w-[180px] border-r bg-muted/30 p-2 flex flex-col gap-1 shrink-0 overflow-y-auto",children:[(0,w.jsx)("div",{className:"px-2 py-1.5 text-xs font-medium text-muted-foreground uppercase tracking-wider mb-1",children:"Categories"}),v.map(s=>{let a=j(s.id,r),n=s.icon,o=e===s.id;return(0,w.jsxs)("button",{onClick:()=>t(s.id),className:(0,N.cn)("w-full flex items-center justify-between px-2.5 py-2 rounded-md text-sm transition-colors",o?"bg-primary/10 text-primary font-medium":"text-muted-foreground hover:bg-muted/50 hover:text-foreground"),children:[(0,w.jsxs)("div",{className:"flex items-center gap-2.5",children:[n&&(0,w.jsx)(n,{className:"w-4 h-4"}),(0,w.jsx)("span",{children:s.label})]}),a>0&&(0,w.jsx)("span",{className:(0,N.cn)("text-[10px] tabular-nums px-1.5 py-0.5 rounded-full",o?"bg-primary/20 text-primary":"bg-muted text-muted-foreground"),children:a})]},s.id)})]})}e.s(["CategorySidebar",()=>k],360549);var _=e.i(119836),C=e.i(864567),S=e.i(541852),M=e.i(194222),T=e.i(644868),$=e.i(546195),A=e.i(72351),D=e.i(990743),E=e.i(806693),I="HoverCard",[q,B]=(0,C.createContextScope)(I,[T.createPopperScope]),R=(0,T.createPopperScope)(),[L,F]=q(I),P=e=>{let{__scopeHoverCard:t,children:r,open:s,defaultOpen:n,onOpenChange:o,openDelay:i=700,closeDelay:l=300}=e,c=R(t),d=a.useRef(0),u=a.useRef(0),m=a.useRef(!1),p=a.useRef(!1),[x,h]=(0,S.useControllableState)({prop:s,defaultProp:n??!1,onChange:o,caller:I}),g=a.useCallback(()=>{clearTimeout(u.current),d.current=window.setTimeout(()=>h(!0),i)},[i,h]),f=a.useCallback(()=>{clearTimeout(d.current),m.current||p.current||(u.current=window.setTimeout(()=>h(!1),l))},[l,h]),v=a.useCallback(()=>h(!1),[h]);return a.useEffect(()=>()=>{clearTimeout(d.current),clearTimeout(u.current)},[]),(0,w.jsx)(L,{scope:t,open:x,onOpenChange:h,onOpen:g,onClose:f,onDismiss:v,hasSelectionRef:m,isPointerDownOnContentRef:p,children:(0,w.jsx)(T.Root,{...c,children:r})})};P.displayName=I;var z="HoverCardTrigger",O=a.forwardRef((e,t)=>{let{__scopeHoverCard:r,...s}=e,a=F(z,r),n=R(r);return(0,w.jsx)(T.Anchor,{asChild:!0,...n,children:(0,w.jsx)(D.Primitive.a,{"data-state":a.open?"open":"closed",...s,ref:t,onPointerEnter:(0,_.composeEventHandlers)(e.onPointerEnter,K(a.onOpen)),onPointerLeave:(0,_.composeEventHandlers)(e.onPointerLeave,K(a.onClose)),onFocus:(0,_.composeEventHandlers)(e.onFocus,a.onOpen),onBlur:(0,_.composeEventHandlers)(e.onBlur,a.onClose),onTouchStart:(0,_.composeEventHandlers)(e.onTouchStart,e=>e.preventDefault())})})});O.displayName=z;var U="HoverCardPortal",[G,H]=q(U,{forceMount:void 0}),V=e=>{let{__scopeHoverCard:t,forceMount:r,children:s,container:a}=e,n=F(U,t);return(0,w.jsx)(G,{scope:t,forceMount:r,children:(0,w.jsx)(A.Presence,{present:r||n.open,children:(0,w.jsx)($.Portal,{asChild:!0,container:a,children:s})})})};V.displayName=U;var Z="HoverCardContent",W=a.forwardRef((e,t)=>{let r=H(Z,e.__scopeHoverCard),{forceMount:s=r.forceMount,...a}=e,n=F(Z,e.__scopeHoverCard);return(0,w.jsx)(A.Presence,{present:s||n.open,children:(0,w.jsx)(X,{"data-state":n.open?"open":"closed",...a,onPointerEnter:(0,_.composeEventHandlers)(e.onPointerEnter,K(n.onOpen)),onPointerLeave:(0,_.composeEventHandlers)(e.onPointerLeave,K(n.onClose)),ref:t})})});W.displayName=Z;var X=a.forwardRef((e,r)=>{let{__scopeHoverCard:s,onEscapeKeyDown:n,onPointerDownOutside:o,onFocusOutside:i,onInteractOutside:l,...c}=e,d=F(Z,s),u=R(s),m=a.useRef(null),p=(0,M.useComposedRefs)(r,m),[x,h]=a.useState(!1);return a.useEffect(()=>{if(x){let e=document.body;return t=e.style.userSelect||e.style.webkitUserSelect,e.style.userSelect="none",e.style.webkitUserSelect="none",()=>{e.style.userSelect=t,e.style.webkitUserSelect=t}}},[x]),a.useEffect(()=>{if(m.current){let e=()=>{h(!1),d.isPointerDownOnContentRef.current=!1,setTimeout(()=>{document.getSelection()?.toString()!==""&&(d.hasSelectionRef.current=!0)})};return document.addEventListener("pointerup",e),()=>{document.removeEventListener("pointerup",e),d.hasSelectionRef.current=!1,d.isPointerDownOnContentRef.current=!1}}},[d.isPointerDownOnContentRef,d.hasSelectionRef]),a.useEffect(()=>{m.current&&(function(e){let t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;r.nextNode();)t.push(r.currentNode);return t})(m.current).forEach(e=>e.setAttribute("tabindex","-1"))}),(0,w.jsx)(E.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:!1,onInteractOutside:l,onEscapeKeyDown:n,onPointerDownOutside:o,onFocusOutside:(0,_.composeEventHandlers)(i,e=>{e.preventDefault()}),onDismiss:d.onDismiss,children:(0,w.jsx)(T.Content,{...u,...c,onPointerDown:(0,_.composeEventHandlers)(c.onPointerDown,e=>{e.currentTarget.contains(e.target)&&h(!0),d.hasSelectionRef.current=!1,d.isPointerDownOnContentRef.current=!0}),ref:p,style:{...c.style,userSelect:x?"text":void 0,WebkitUserSelect:x?"text":void 0,"--radix-hover-card-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-hover-card-content-available-width":"var(--radix-popper-available-width)","--radix-hover-card-content-available-height":"var(--radix-popper-available-height)","--radix-hover-card-trigger-width":"var(--radix-popper-anchor-width)","--radix-hover-card-trigger-height":"var(--radix-popper-anchor-height)"}})})});function K(e){return t=>"touch"===t.pointerType?void 0:e()}function Q({...e}){return(0,w.jsx)(P,{"data-slot":"hover-card",...e})}function J({...e}){return(0,w.jsx)(O,{"data-slot":"hover-card-trigger",...e})}function Y({className:e,align:t="center",sideOffset:r=4,...s}){return(0,w.jsx)(V,{"data-slot":"hover-card-portal",children:(0,w.jsx)(W,{"data-slot":"hover-card-content",align:t,sideOffset:r,className:(0,N.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-64 origin-(--radix-hover-card-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",e),...s})})}a.forwardRef((e,t)=>{let{__scopeHoverCard:r,...s}=e,a=R(r);return(0,w.jsx)(T.Arrow,{...a,...s,ref:t})}).displayName="HoverCardArrow",e.s(["HoverCard",()=>Q,"HoverCardContent",()=>Y,"HoverCardTrigger",()=>J],319226);let ee=(0,m.default)("square-function",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 17c2 0 2.8-1 2.8-2.8V10c0-2 1-3.3 3.2-3",key:"m1af9g"}],["path",{d:"M9 11.2h5.7",key:"3zgcl2"}]]);e.s(["FunctionSquare",()=>ee],423223)},774247,e=>{"use strict";var t=e.i(379492),r=e.i(283164),s=e.i(897846);e.i(977101);var a=e.i(727630),n=e.i(359548),o=e.i(79721),i=e.i(384078),l=e.i(799126),c=e.i(985902),d=e.i(934953),u=e.i(372825),m=e.i(421643),p=e.i(432593),x=e.i(46944),h=e.i(219307),g=e.i(241362),f=e.i(696057),v=e.i(360549),b=e.i(828982),j=e.i(329742),y=e.i(357245),w=e.i(108665),N=e.i(319226),k=e.i(152088),_=e.i(644163),C=e.i(423223),S=e.i(672171),M=e.i(346596),T=e.i(385158),$=e.i(320287),A=e.i(846532),D=e.i(277814),E=e.i(341879);function I({label:e,value:r,comparative:s,inverted:a=!1}){return(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,t.jsx)("span",{className:"font-medium text-muted-foreground",children:e}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:s})]}),(0,t.jsx)(D.Progress,{value:a?100-r:r,className:"h-1.5 bg-muted/40",indicatorClassName:"bg-foreground/80"})]})}function q({model:e,metrics:r,compact:s=!1}){let a=(0,E.getBenchmarkScores)(e);return(0,t.jsxs)("div",{className:(0,k.cn)("grid gap-4 pt-1",s&&"gap-3"),children:[(0,t.jsx)(I,{label:"Speed",value:(e=>{switch(e){case"ultra-fast":return 100;case"fast":return 75;case"medium":default:return 50;case"slow":return 25}})(r.speedTier),comparative:(0,E.getSpeedText)(r)}),(0,t.jsx)(I,{label:"Cost Efficiency",value:(e=>{switch(e){case"budget":return 25;case"balanced":default:return 50;case"premium":return 75}})(r.costTier),comparative:(0,E.getCostText)(r),inverted:!0}),(0,t.jsx)(I,{label:"Intelligence",value:r.intelligencePercentile??a.intelligence??50,comparative:(0,E.getIntelligenceText)(r.intelligencePercentile)}),!r.hasPublicBenchmarks&&(0,t.jsxs)("div",{className:"text-[10px] text-muted-foreground/50 pt-1 flex items-center gap-1.5",children:[(0,t.jsx)(A.Info,{className:"w-2.5 h-2.5"}),(0,t.jsx)("span",{children:"Estimated metrics based on provider data"})]})]})}function B({modelId:e,variant:r="popover"}){var s;let a=(0,g.getModelConfig)(e),n=(0,p.useUserPreference)("showModelProvider");if(!a)return null;let o=(0,T.getProviderIcon)(a.provider),l=(s=a.contextWindow)>=1e6?`${(s/1e6).toFixed(1)}M tokens`:s>=1e3?`${(s/1e3).toFixed(0)}K tokens`:`${s} tokens`,c=(0,i.useMemo)(()=>(0,$.getModelMetrics)(a.id),[a.id]);return(0,t.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"bg-muted p-1.5 rounded-md mt-0.5",children:(0,t.jsx)(o,{className:"w-5 h-5 text-foreground/80"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-base leading-none mb-1",children:a.name}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground capitalize",children:[a.provider," • ",a.isLocal?"Local":"Cloud"]}),n&&!a.isLocal&&(0,t.jsxs)("span",{className:"text-[10px] text-muted-foreground/60 block",children:["via"," ","openrouter"===a.gateway?"OpenRouter":"Vercel AI Gateway"]})]})]}),a.userFriendlyDescription&&(0,t.jsx)("div",{className:"text-muted-foreground leading-relaxed",children:a.userFriendlyDescription}),a.capabilities.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground/80",children:a.capabilities.map(e=>(0,t.jsxs)("span",{className:"flex items-center gap-1.5 bg-muted/50 px-2.5 py-1 rounded-md border border-border/50",children:[function(e){switch(e){case"vision":return(0,t.jsx)(_.Eye,{className:"w-3.5 h-3.5"});case"function-calling":return(0,t.jsx)(C.FunctionSquare,{className:"w-3.5 h-3.5"});case"thinking":return(0,t.jsx)(M.Sparkles,{className:"w-3.5 h-3.5 text-purple-500"});case"extended-thinking":return(0,t.jsx)(w.Zap,{className:"w-3.5 h-3.5 text-purple-600"});case"image-generation":return(0,t.jsx)(S.Image,{className:"w-3.5 h-3.5"});default:return null}}(e),(0,t.jsx)("span",{className:"capitalize",children:e.replace("-"," ")})]},e))}),(0,t.jsxs)("div",{className:"pt-3 border-t grid grid-cols-2 gap-y-3 gap-x-2 text-xs",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block mb-0.5 font-medium",children:"Context Window"}),(0,t.jsx)("span",{className:"font-medium text-foreground",children:l})]}),a.knowledgeCutoff&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block mb-0.5 font-medium",children:"Knowledge Access"}),(0,t.jsx)("span",{children:a.knowledgeCutoff})]}),!a.isLocal&&(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("span",{className:"text-muted-foreground block mb-0.5 font-medium",children:"Pricing (Input / Output)"}),(0,t.jsxs)("div",{className:"font-mono text-muted-foreground",children:[(0,t.jsxs)("span",{className:"text-foreground",children:["$",a.pricing.input]})," /",(0,t.jsxs)("span",{className:"text-foreground",children:[" $",a.pricing.output]}),(0,t.jsx)("span",{className:"opacity-50 ml-1",children:"per million tokens"})]})]})]}),c&&(0,t.jsx)("div",{className:"pt-3 border-t",children:(0,t.jsx)(q,{model:a,metrics:c,compact:!0})}),a.bestFor&&(0,t.jsxs)("div",{className:"pt-3 border-t bg-muted/20 -mx-4 px-4 pb-1",children:[(0,t.jsx)("span",{className:"text-[10px] uppercase tracking-wider text-muted-foreground font-semibold mb-1 block",children:"Best Used For"}),(0,t.jsx)("p",{className:"text-xs text-foreground/80 italic",children:a.bestFor})]})]})}function R({model:e,isSelected:r,isFavorite:s,mode:a,showDefaultBadge:o=!1,activeCategory:i,onSelect:l,onToggleFavorite:u,isPro:m=!1,proAccessRemaining:p=null,isDisabled:h=!1}){var g;"all"===i&&(0,x.getModelCategories)(e);let f=(0,t.jsxs)(d.CommandItem,{value:e.id,keywords:[e.name,e.provider,e.description||""],onSelect:()=>l(e.id),className:(0,k.cn)("group flex items-center justify-between px-3 py-3 rounded-lg cursor-pointer aria-selected:bg-muted/50 data-[selected=true]:bg-muted/50 transition-colors",r?"bg-primary/5":"",h&&"opacity-50 cursor-not-allowed"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[(0,t.jsx)("div",{className:(0,k.cn)("flex items-center justify-center w-4 h-4 rounded-full border transition-all",r?"bg-primary border-primary text-primary-foreground":"border-muted-foreground/30 group-hover:border-primary/50"),children:r&&(0,t.jsx)(b.Check,{className:"w-2.5 h-2.5"})}),(0,t.jsxs)("div",{className:"flex flex-col min-w-0 gap-0.5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:(0,k.cn)("font-medium text-sm truncate",r?"text-primary":"text-foreground"),children:e.name}),o&&(0,t.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded-full bg-primary/10 text-primary font-medium",children:"Default"}),e.reasoning&&(0,t.jsxs)("span",{className:"text-[10px] px-1.5 py-0.5 rounded-full bg-purple-500/10 text-purple-600 dark:text-purple-400 font-medium flex items-center gap-0.5",children:[(0,t.jsx)(w.Zap,{className:"w-2.5 h-2.5"}),"Reasoning"]}),m&&(0,t.jsxs)("span",{className:"text-[10px] px-1.5 py-0.5 rounded-full bg-amber-500/10 text-amber-600 dark:text-amber-400 font-medium flex items-center gap-0.5",children:[(0,t.jsx)(j.Crown,{className:"w-2.5 h-2.5"}),"Pro"]}),m&&h&&(0,t.jsx)("span",{className:"text-[10px] text-amber-600 dark:text-amber-400",children:"Upgrade"}),m&&!h&&null!=p&&p!==1/0&&(0,t.jsx)("span",{className:"text-[10px] text-muted-foreground",children:0===p?"Limit reached":`${p} left`})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)("span",{className:"capitalize",children:e.provider}),(0,t.jsx)("span",{className:"text-muted-foreground/30",children:"•"}),(0,t.jsx)("span",{children:(g=e.contextWindow)>=1e6?`${(g/1e6).toFixed(1)}M`:g>=1e3?`${(g/1e3).toFixed(0)}K`:`${g}`}),e.capabilities?.includes("vision")&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-muted-foreground/30",children:"•"}),(0,t.jsx)("span",{children:"Vision"})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 pl-2",children:[!e.isLocal&&(0,t.jsxs)("div",{className:"hidden sm:flex flex-col items-end text-[10px] text-muted-foreground/50 tabular-nums leading-tight",children:[(0,t.jsxs)("span",{children:["In: $",e.pricing.input]}),(0,t.jsxs)("span",{children:["Out: $",e.pricing.output]})]}),(0,t.jsx)(c.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-transparent -mr-2 opacity-0 group-hover:opacity-100 transition-opacity focus:opacity-100",onClick:t=>{t.preventDefault(),t.stopPropagation(),u(e.id)},children:(0,t.jsx)(y.Star,{className:(0,k.cn)("h-4 w-4 transition-colors",s?"fill-amber-400 text-amber-400 opacity-100":"text-muted-foreground hover:text-amber-400")})}),"single"===a&&(0,t.jsx)(n.ChevronRight,{className:"w-4 h-4 text-muted-foreground/30"})]})]},e.id);return"single"===a?(0,t.jsxs)(N.HoverCard,{openDelay:200,children:[(0,t.jsx)(N.HoverCardTrigger,{asChild:!0,children:f}),(0,t.jsx)(N.HoverCardContent,{side:"right",align:"start",className:"w-80 p-4",sideOffset:10,children:(0,t.jsx)(B,{modelId:e.id,variant:"sidebar"})})]},e.id):f}var L=e.i(328299),F=e.i(907347);function P({selectedIds:e,allModels:r,onRemove:s}){return 0===e.length?null:(0,t.jsx)("div",{className:"flex gap-2 px-3 py-2 border-b flex-wrap bg-background/50 backdrop-blur-sm",children:e.map(e=>{let a=r.find(t=>t.id===e);return(0,t.jsxs)(F.Badge,{variant:"secondary",className:"gap-1 pl-2 pr-1 py-1 h-7",children:[a?.name,(0,t.jsx)(c.Button,{variant:"ghost",size:"icon",className:"h-4 w-4 ml-1 hover:bg-destructive/10 hover:text-destructive rounded-full",onClick:()=>s(e),children:(0,t.jsx)(L.X,{className:"h-3 w-3"})})]},e)})})}var z=e.i(2138),O=e.i(547608);function U({open:e,onOpenChange:s,currentTier:n}){let[o,d]=(0,i.useState)(!1),u=(0,a.useMutation)(r.api.feedback.createFeedback),m=async()=>{d(!0);try{await u({feedbackType:"feature",description:`Upgrade request: User on ${n} tier requesting pro model access`,page:"/chat"}),l.toast.success("Request sent! Admins will review your upgrade request."),s(!1)}catch(e){l.toast.error("Failed to send request")}finally{d(!1)}};return(0,t.jsx)(O.Dialog,{open:e,onOpenChange:s,children:(0,t.jsxs)(O.DialogContent,{className:"sm:max-w-md",children:[(0,t.jsxs)(O.DialogHeader,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)("div",{className:"p-2 rounded-full bg-amber-500/10",children:(0,t.jsx)(j.Crown,{className:"w-5 h-5 text-amber-500"})}),(0,t.jsx)(O.DialogTitle,{children:"Pro Models"})]}),(0,t.jsxs)(O.DialogDescription,{className:"text-left space-y-3 pt-2",children:[(0,t.jsx)("p",{children:"Pro models require an upgraded account. We haven't set up payments yet, but you can request access."}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Your request will be reviewed by an admin who can upgrade your account manually."})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2 mt-2",children:[(0,t.jsx)(c.Button,{variant:"ghost",onClick:()=>s(!1),children:"Cancel"}),(0,t.jsxs)(c.Button,{onClick:m,disabled:o,children:[o&&(0,t.jsx)(z.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Request Access"]})]})]})})}function G({open:e,onOpenChange:b,currentModel:j,onSelectModel:y,mode:w="single",selectedModels:N=[],onSelectedModelsChange:k,showTrigger:_=!1}){let C=(0,g.getModelsByProvider)(),{favorites:S,toggleFavorite:M,isFavorite:T}=(0,u.useFavoriteModels)(),{recents:$,addRecent:A}=(0,m.useRecentModels)();(0,a.useQuery)(r.api.users.getCurrentUser);let D=(0,a.useQuery)(r.api.adminSettings.getProModelAccess),E=(0,p.useUserPreference)("defaultModel"),I=e=>!0===e.isPro||(e.pricing?.input??0)>=5||(e.pricing?.output??0)>=15,[q,B]=(0,i.useState)([]),[L,F]=(0,i.useState)("all"),[z,O]=(0,i.useState)(!1),G=(0,i.useRef)(e);(0,i.useEffect)(()=>{let t=e&&!G.current;G.current=e,t&&"multiple"===w&&B(N||[]),t&&f.analytics.track("quick_switcher_opened",{mode:w,currentModel:j})},[e,w,N,j]);let H=Object.values(C).flat(),{defaultModel:V,favorites:Z,recents:W,rest:X}=(0,h.sortModels)(H,E,S,$),K=(0,i.useMemo)(()=>{let e=x.MODEL_CATEGORIES.find(e=>e.id===L);return e&&"all"!==e.id?{defaultModel:V&&e.filter(V)?V:void 0,favorites:Z.filter(e.filter),recents:W.filter(e.filter),rest:X.filter(e.filter)}:{defaultModel:V,favorites:Z,recents:W,rest:X}},[L,V,Z,W,X]),Q=K.rest.reduce((e,t)=>{let r=t.provider;return e[r]||(e[r]=[]),e[r].push(t),e},{}),J=e=>{"multiple"===w?B(t=>t.includes(e)?t.filter(t=>t!==e):t.length>=4?(l.toast.error("Maximum 4 models for comparison"),t):[...t,e]):(A(e),y(e),b(!1),f.analytics.track("model_selected",{model:e,previousModel:j,source:"quick_switcher"}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("focus-chat-input"))},0))},Y=(e,r=!1)=>{let s=I(e)&&D&&!D.canUse;return(0,t.jsx)(R,{model:e,isSelected:"single"===w?j===e.id:q.includes(e.id),isFavorite:T(e.id),mode:w,showDefaultBadge:r,activeCategory:L,onSelect:s?()=>O(!0):J,onToggleFavorite:M,isPro:I(e),proAccessRemaining:I(e)&&D?D.remainingDaily??D.remainingMonthly??null:null,isDisabled:s},e.id)};return(0,t.jsxs)(t.Fragment,{children:[_&&(0,t.jsxs)(c.Button,{variant:"ghost",onClick:()=>b(!0),className:"h-8 px-2.5 text-sm font-medium bg-transparent hover:bg-muted/50 border-0 transition-all group gap-1.5 min-w-0",children:[(0,t.jsx)("span",{className:"truncate max-w-[120px] text-muted-foreground group-hover:text-foreground transition-colors",children:"single"===w?H.find(e=>e.id===j)?.name||"Select model":`${q.length} models`}),(0,t.jsx)(n.ChevronRight,{className:"w-3 h-3 text-muted-foreground/40 group-hover:text-muted-foreground rotate-90 transition-all"})]}),(0,t.jsxs)(d.CommandDialog,{open:e,onOpenChange:b,commandProps:{filter:(e,t,r)=>{let a=`${e} ${r?.join(" ")||""}`;return(0,s.default)(a,t)}},className:"max-w-[95vw] md:max-w-4xl h-[85vh] md:h-[600px] p-0 gap-0 overflow-hidden bg-background/95 backdrop-blur-xl border-border/50 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center border-b px-4 py-3 shrink-0",children:[(0,t.jsx)(o.Search,{className:"w-4 h-4 mr-2 text-muted-foreground"}),(0,t.jsx)(d.CommandInput,{placeholder:`Search ${"all"===L?"":`${L} `}models...`,className:"flex-1 h-9 bg-transparent border-0 ring-0 focus:ring-0 text-sm"})]}),(0,t.jsxs)("div",{className:"flex h-[500px] overflow-hidden",children:[(0,t.jsx)(v.CategorySidebar,{activeCategory:L,onCategoryChange:e=>{F(e),f.analytics.track("category_filter_changed",{category:e,mode:w})},allModels:H}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col min-w-0 bg-background/50",children:["multiple"===w&&(0,t.jsx)(P,{selectedIds:q,allModels:H,onRemove:e=>B(t=>t.filter(t=>t!==e))}),(0,t.jsxs)(d.CommandList,{className:"max-h-[600px] overflow-y-auto p-2",children:[(0,t.jsx)(d.CommandEmpty,{children:"No models found."}),K.defaultModel&&(0,t.jsx)(d.CommandGroup,{heading:"Default",children:Y(K.defaultModel,!0)}),K.favorites.length>0&&(0,t.jsx)(d.CommandGroup,{heading:"Favorites",children:K.favorites.map(e=>Y(e))}),K.recents.length>0&&(0,t.jsx)(d.CommandGroup,{heading:"Recent",children:K.recents.map(e=>Y(e))}),(K.defaultModel||K.favorites.length>0||K.recents.length>0)&&(0,t.jsx)(d.CommandSeparator,{}),Object.entries(Q).map(([e,r])=>(0,t.jsx)(d.CommandGroup,{heading:e.charAt(0).toUpperCase()+e.slice(1),className:"px-2",children:r.map(e=>Y(e))},e))]}),D&&!D.canUse&&(0,t.jsx)("div",{className:"p-3 border-t text-center",children:(0,t.jsx)("button",{type:"button",onClick:()=>O(!0),className:"text-sm text-primary hover:underline",children:"Request pro model access →"})})]})]}),"multiple"===w&&(0,t.jsxs)("div",{className:"border-t p-3 flex justify-between items-center",children:[(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:[q.length,"/4 selected"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(c.Button,{variant:"ghost",onClick:()=>b(!1),size:"sm",children:"Cancel"}),(0,t.jsx)(c.Button,{onClick:()=>{q.length<2?l.toast.error("Select at least 2 models to compare"):(k?.(q),b(!1),f.analytics.track("comparison_models_selected",{modelCount:q.length,models:q.join(",")}))},disabled:q.length<2,size:"sm",children:"Compare Models"})]})]})]}),(0,t.jsx)(U,{open:z,onOpenChange:O,currentTier:D?.tier||"free"})]})}e.s(["QuickModelSwitcher",()=>G],774247)},312879,128260,636160,544705,620808,520891,645147,688540,456209,301463,e=>{"use strict";var t=e.i(384078);function r(e={}){let{threshold:s=.01,rootMargin:a="50px 0px",mobileOnly:n=!0}=e,o=(0,t.useRef)(null),[i,l]=(0,t.useState)(!1),[c,d]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{let e=()=>{d(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,t.useEffect)(()=>{if(n&&!c)return void l(!0);if(!o.current)return;if(!("IntersectionObserver"in window))return void l(!0);let e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(l(!0),e.disconnect())})},{threshold:s,rootMargin:a});return e.observe(o.current),()=>{e.disconnect()}},[s,a,c,n]),{observeRef:o,isRendered:i,isMobile:c}}e.s(["useLazyMathRenderer",()=>r],312879);var s=e.i(696057);let a=[{regex:/\\int_\{(.+?)\}\^\{(.+?)\}(.+?)d([a-z])/,describe:e=>`Integral from ${e[1]} to ${e[2]} of ${e[3]} with respect to ${e[4]}`},{regex:/\\int\s*(.+?)d([a-z])/,describe:e=>`Integral of ${e[1]} with respect to ${e[2]}`},{regex:/\\oint/,describe:()=>"Contour integral"},{regex:/\\frac\{d\}\{d([a-z])\}/,describe:e=>`Derivative with respect to ${e[1]}`},{regex:/\\frac\{d(.+?)\}\{d([a-z])\}/,describe:e=>`Derivative of ${e[1]} with respect to ${e[2]}`},{regex:/\\frac\{\\partial\}\{\\partial\s*([a-z])\}/,describe:e=>`Partial derivative with respect to ${e[1]}`},{regex:/\\frac\{\\partial(.+?)\}\{\\partial\s*([a-z])\}/,describe:e=>`Partial derivative of ${e[1]} with respect to ${e[2]}`},{regex:/\\nabla/,describe:()=>"Gradient or del operator"},{regex:/\\lim_\{(.+?)\\to\s*(.+?)\}/,describe:e=>`Limit as ${e[1]} approaches ${e[2]}`},{regex:/\\sum_\{(.+?)\}\^\{(.+?)\}/,describe:e=>`Sum from ${e[1]} to ${e[2]}`},{regex:/\\sum_\{(.+?)\}\^\{\\infty\}/,describe:e=>`Infinite sum starting from ${e[1]}`},{regex:/\\prod_\{(.+?)\}\^\{(.+?)\}/,describe:e=>`Product from ${e[1]} to ${e[2]}`},{regex:/\\begin\{(b|p|v|B|V|small)?matrix\}/,describe:e=>{let t=e[1]||"",r="b"===t?"square-bracketed":"p"===t?"parenthesized":"v"===t?"bar-bracketed":"";return`${r?`${r} `:""}Matrix`.trim()}},{regex:/\\det\s*\((.+?)\)|\\begin\{vmatrix\}/,describe:()=>"Determinant"},{regex:/\\vec\{(.+?)\}/,describe:e=>`Vector ${e[1]}`},{regex:/\\cdot/,describe:()=>"Dot product"},{regex:/\\times/,describe:()=>"Cross product or Cartesian product"},{regex:/\\lVert(.+?)\\rVert|\\norm\{(.+?)\}/,describe:e=>`Norm of ${e[1]||e[2]}`},{regex:/\\mathbb\{E\}\[(.+?)\]/,describe:e=>`Expected value of ${e[1]}`},{regex:/\\text\{Var\}\[(.+?)\]/,describe:e=>`Variance of ${e[1]}`},{regex:/P\((.+?)\)/,describe:e=>`Probability of ${e[1]}`},{regex:/P\((.+?)\|(.+?)\)/,describe:e=>`Probability of ${e[1]} given ${e[2]}`},{regex:/\\mathcal\{N\}\((.+?),\s*(.+?)\)/,describe:e=>`Normal distribution with mean ${e[1]} and variance ${e[2]}`},{regex:/\\frac\{(.+?)\}\{(.+?)\}/,describe:e=>`Fraction: ${e[1]} over ${e[2]}`},{regex:/\\sqrt\{(.+?)\}/,describe:e=>`Square root of ${e[1]}`},{regex:/\\sqrt\[(.+?)\]\{(.+?)\}/,describe:e=>`${e[1]}-th root of ${e[2]}`},{regex:/\\cup/,describe:()=>"Set union"},{regex:/\\cap/,describe:()=>"Set intersection"},{regex:/\\subset/,describe:()=>"Subset relation"},{regex:/\\in/,describe:()=>"Element of"},{regex:/\\emptyset/,describe:()=>"Empty set"},{regex:/\\forall/,describe:()=>"For all"},{regex:/\\exists/,describe:()=>"There exists"},{regex:/\\Rightarrow|\\implies/,describe:()=>"Implies"},{regex:/\\Leftrightarrow|\\iff/,describe:()=>"If and only if"},{regex:/\\neg/,describe:()=>"Not"},{regex:/\\(mu|sigma|alpha|beta|gamma|delta)/,describe:e=>{let t=e[1];return"mu"===t?"Statistical parameter mu":"sigma"===t?"Standard deviation sigma":"alpha"===t||"beta"===t?"Statistical parameter":"Greek letter expression"}},{regex:/\\(theta|phi|psi)/,describe:()=>"Angle expression"},{regex:/\\ce\{(.+?)\}/,describe:e=>`Chemical formula: ${e[1]}`},{regex:/\\pu\{(.+?)\}/,describe:e=>`Physical unit: ${e[1]}`},{regex:/\\infty/,describe:()=>"Expression involving infinity"},{regex:/\\approx/,describe:()=>"Approximately equal to"},{regex:/\\propto/,describe:()=>"Proportional to"}],n=[{test:e=>e.includes("\\int"),label:"Integral expression"},{test:e=>e.includes("\\sum"),label:"Summation"},{test:e=>e.includes("\\prod"),label:"Product"},{test:e=>e.includes("\\frac"),label:"Fraction"},{test:e=>e.includes("\\sqrt"),label:"Root expression"},{test:e=>e.includes("matrix"),label:"Matrix or array expression"},{test:e=>e.includes("\\lim"),label:"Limit expression"},{test:e=>e.includes("\\partial"),label:"Partial derivative"},{test:e=>e.includes("\\mathbb{E}")||e.includes("\\text{Var}")||e.includes("\\sigma"),label:"Statistical expression"},{test:e=>e.includes("\\Rightarrow")||e.includes("\\Leftarrow")||e.includes("\\iff"),label:"Logical implication"},{test:e=>e.includes("\\cup")||e.includes("\\cap"),label:"Set operation"}];function o(e,r=!1){let i=(0,t.useRef)(new Set);(0,t.useEffect)(()=>{e.current&&e.current.querySelectorAll(".katex-display, .katex:not(.katex-display)").forEach(e=>{let t;if(i.current.has(e))return;let o=e.querySelector('annotation[encoding="application/x-tex"]'),l=o?.textContent||"",c=e.classList.contains("katex-display"),d=(t=performance.now(),()=>{let e=performance.now()-t;s.analytics.track("math_rendered",{displayMode:c,equationLength:l.length,renderTimeMs:Math.round(e),isStreaming:r}),e>50&&console.warn(`[Math] Slow render: ${Math.round(e)}ms for ${l.length} chars`,{latex:l.slice(0,50)})}),u=function(e){if(!e)return"Mathematical expression";for(let t of a){let r=e.match(t.regex);if(r)return t.describe(r)}for(let t of n)if(t.test(e))return t.label;return"Mathematical expression"}(l);e.setAttribute("role","math"),e.setAttribute("aria-label",u),r&&(e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"));let m=e.querySelector("math");if(m||console.warn("[Accessibility] MathML not found - ensure KaTeX output: 'htmlAndMathml' is set"),"MathMLElement"in window&&!m&&l)try{let t=document.createElement("span");t.setAttribute("aria-hidden","true"),t.style.position="absolute",t.style.clip="rect(1px, 1px, 1px, 1px)";let r=document.createElementNS("http://www.w3.org/1998/Math/MathML","math"),s=document.createElementNS("http://www.w3.org/1998/Math/MathML","annotation");s.setAttribute("encoding","application/x-tex"),s.textContent=l,r.appendChild(s),t.appendChild(r),e.appendChild(t)}catch(e){console.debug("[Accessibility] MathML enhancement failed",e)}i.current.add(e),d()})},[e,r])}function i(e){let r=(0,t.useRef)(new Set);(0,t.useEffect)(()=>{let e=e=>{if((e.metaKey||e.ctrlKey)&&"c"===e.key){let t=e.target;if(t.classList.contains("katex")||t.classList.contains("katex-display")){let r=t.querySelector('annotation[encoding="application/x-tex"]'),s=r?.textContent;s&&(e.preventDefault(),l(s,t))}}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]),(0,t.useEffect)(()=>{if(!e.current)return;let t=e.current.querySelectorAll(".katex-display"),s=e.current.querySelectorAll(".katex:not(.katex-display)");t.forEach(e=>{let t,s;if(r.current.has(e))return;let a=e.querySelector('annotation[encoding="application/x-tex"]'),n=a?.textContent||"";if(!n)return;let o=document.createElement("div");o.className="group relative",e.parentNode?.insertBefore(o,e),o.appendChild(e);let i=document.createElement("button");i.className="absolute right-2 top-2 h-8 w-8 flex items-center justify-center rounded-md border border-border bg-background opacity-0 transition-opacity group-hover:opacity-100 focus-visible:opacity-100 hover:bg-accent hover:text-accent-foreground",i.setAttribute("aria-label","Copy LaTeX source"),i.setAttribute("type","button");let l=d(),u=((t=document.createElementNS("http://www.w3.org/2000/svg","svg")).setAttribute("width","16"),t.setAttribute("height","16"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),t.classList.add("check-icon","hidden","text-green-500"),(s=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d","M20 6 9 17l-5-5"),t.appendChild(s),t);i.appendChild(l),i.appendChild(u),i.addEventListener("click",async t=>{t.preventDefault(),t.stopPropagation(),await c(n,e,l,u,!0)}),o.appendChild(i),r.current.add(e)}),s.forEach(e=>{if(r.current.has(e))return;let t=e.querySelector('annotation[encoding="application/x-tex"]'),s=t?.textContent||"";if(!s)return;e.setAttribute("tabindex","0"),e.setAttribute("role","button"),e.setAttribute("aria-label",`Math: ${s}`);let a=document.createElement("button");a.className="inline-math-copy",a.setAttribute("aria-label","Copy LaTeX"),a.setAttribute("type","button");let n=d();a.appendChild(n),a.addEventListener("click",async t=>{t.preventDefault(),t.stopPropagation(),await l(s,e)}),e.appendChild(a),r.current.add(e)})},[e])}async function l(e,t){let r=t.classList.contains("katex-display");try{let a=r?`$$${e}$$`:`\\(${e}\\)`,n=t.querySelector(".katex-html"),o=n?r?`<div class="math-display">${n.innerHTML}</div>`:`<span class="math-inline">${n.innerHTML}</span>`:"";if(navigator.clipboard&&ClipboardItem){let t={"text/plain":new Blob([a],{type:"text/plain"})};if(o&&(t["text/html"]=new Blob([o],{type:"text/html"})),"MathMLElement"in window&&e)try{let r=`<math><annotation encoding="application/x-tex">${e}</annotation></math>`;t["application/mathml+xml"]=new Blob([r],{type:"application/mathml+xml"})}catch{}await navigator.clipboard.write([new ClipboardItem(t)])}else await navigator.clipboard.writeText(a);s.analytics.track("math_copied",{format:o?"both":"latex",equationLength:e.length})}catch(t){console.error("Failed to copy math:",t);try{await navigator.clipboard.writeText(r?`$$${e}$$`:`\\(${e}\\)`)}catch(e){console.error("Fallback copy failed:",e)}}}async function c(e,t,r,s,a){await l(e,t),r.classList.add("hidden"),s.classList.remove("hidden"),setTimeout(()=>{r.classList.remove("hidden"),s.classList.add("hidden")},2e3)}function d(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("copy-icon");let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","14"),t.setAttribute("height","14"),t.setAttribute("x","8"),t.setAttribute("y","8"),t.setAttribute("rx","2"),t.setAttribute("ry","2");let r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d","M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"),e.appendChild(t),e.appendChild(r),e}function u(e){if(!e)return"";let t=e,r=e.match(/```/g);if((r?.length??0)%2!=0){let r=e.lastIndexOf("```");t=e.slice(0,r)}let s=t,a=s.match(RegExp("(?<!`)`(?!`)","g"));if((a?.length??0)%2!=0){let e=s.lastIndexOf("`");t=s.slice(0,e)}let n=t.slice(-20),o=n.match(/(\*\*(?!\*\*)(?:[^*]|(?!\*\*)\*)*$)/)||n.match(RegExp("((?<!\\*)\\*(?!\\*)(?:[^*])*$)"))||n.match(/(__(?!__)(?:[^_]|(?!__)_)*$)/)||n.match(RegExp("((?<!_)_(?!_)(?:[^_])*$)"));if(o){let e=o[0].length;t=t.slice(0,-e)}let i=t.match(/(!?\[[^\]]*?)$/);if(i){let e=i[0].length;t=t.slice(0,-e)}let l=t.match(/\[[^\]]+\]\((?:[^)]*?)$/);if(l){let e=l[0].length;t=t.slice(0,-e)}return t}function m(e,r,s){let[a,n]=(0,t.useState)(""),o=s?.charsPerSecond??200,i=s?.minTokenSize??3,l=s?.adaptiveThreshold??5e3,c=(0,t.useRef)(""),d=(0,t.useRef)(""),m=(0,t.useRef)(void 0),p=(0,t.useRef)(Date.now()),x=c.current.length>0;return(0,t.useEffect)(()=>{if(e!==d.current){if(e.length>d.current.length&&e.startsWith(d.current)){let t=e.slice(d.current.length);c.current+=t}else n(e),c.current="",p.current=Date.now();d.current=e}if(!r){c.current.length>0?(n(e),c.current=""):a!==e&&n(e),m.current&&(cancelAnimationFrame(m.current),m.current=void 0);return}let t=()=>{let e=Date.now(),r=Math.floor((e-p.current)/1e3*(c.current.length>l?2*o:o));if(r>0&&c.current.length>0){let t=function(e,t,r=3){if(e.length<=t)return u(e);for(let s=t;s>=r;s--){let t=e[s];if(/[\s.,;:!?)\]}>]/.test(t))return u(e.slice(0,s+1))}return u(e.slice(0,Math.max(t,r)))}(c.current,r,i);t.length>0&&(n(e=>e+t),c.current=c.current.slice(t.length),p.current=e)}m.current=requestAnimationFrame(t)};return m.current||(p.current=Date.now(),m.current=requestAnimationFrame(t)),()=>{m.current&&(cancelAnimationFrame(m.current),m.current=void 0)}},[e,r,o,i,l,a]),{displayContent:a,hasBufferedContent:x}}e.s(["useMathAccessibility",()=>o],128260),e.s(["useMathCopyButtons",()=>i],636160),e.s(["useStreamBuffer",()=>m],544705);var p=e.i(101177);p.default.__defineMacro("\\ce",function(e){return x(e.consumeArgs(1)[0],"ce")}),p.default.__defineMacro("\\pu",function(e){return x(e.consumeArgs(1)[0],"pu")}),p.default.__defineMacro("\\tripledash","{\\vphantom{-}\\raisebox{2.56mu}{$\\mkern2mu\\tiny\\text{-}\\mkern1mu\\text{-}\\mkern1mu\\text{-}\\mkern2mu$}}");var x=function(e,t){for(var r="",s=e.length&&e[e.length-1].loc.start,a=e.length-1;a>=0;a--)e[a].loc.start>s&&(r+=" ",s=e[a].loc.start),r+=e[a].text,s+=e[a].text.length;return g.go(h.go(r,t))},h={go:function(e,t){if(!e)return[];void 0===t&&(t="ce");var r="0",s={};s.parenthesisLevel=0,e=(e=(e=e.replace(/\n/g," ")).replace(/[\u2212\u2013\u2014\u2010]/g,"-")).replace(/[\u2026]/g,"...");for(var a=10,n=[];;){d!==e?(a=10,d=e):a--;for(var o=h.stateMachines[t],i=o.transitions[r]||o.transitions["*"],l=0;l<i.length;l++){var c=h.patterns.match_(i[l].pattern,e);if(c){for(var d,u,m=i[l].task,p=0;p<m.action_.length;p++){if(o.actions[m.action_[p].type_])u=o.actions[m.action_[p].type_](s,c.match_,m.action_[p].option);else if(h.actions[m.action_[p].type_])u=h.actions[m.action_[p].type_](s,c.match_,m.action_[p].option);else throw["MhchemBugA","mhchem bug A. Please report. ("+m.action_[p].type_+")"];h.concatArray(n,u)}if(r=m.nextState||r,!(e.length>0))return n;if(m.revisit||(e=c.remainder),!m.toContinue)break}}if(a<=0)throw["MhchemBugU","mhchem bug U. Please report."]}},concatArray:function(e,t){if(t)if(Array.isArray(t))for(var r=0;r<t.length;r++)e.push(t[r]);else e.push(t)},patterns:{patterns:{empty:/^$/,else:/^./,else2:/^./,space:/^\s/,"space A":/^\s(?=[A-Z\\$])/,space$:/^\s$/,"a-z":/^[a-z]/,x:/^x/,x$:/^x$/,i$:/^i$/,letters:/^(?:[a-zA-Z\u03B1-\u03C9\u0391-\u03A9?@]|(?:\\(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega|Gamma|Delta|Theta|Lambda|Xi|Pi|Sigma|Upsilon|Phi|Psi|Omega)(?:\s+|\{\}|(?![a-zA-Z]))))+/,"\\greek":/^\\(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega|Gamma|Delta|Theta|Lambda|Xi|Pi|Sigma|Upsilon|Phi|Psi|Omega)(?:\s+|\{\}|(?![a-zA-Z]))/,"one lowercase latin letter $":/^(?:([a-z])(?:$|[^a-zA-Z]))$/,"$one lowercase latin letter$ $":/^\$(?:([a-z])(?:$|[^a-zA-Z]))\$$/,"one lowercase greek letter $":/^(?:\$?[\u03B1-\u03C9]\$?|\$?\\(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega)\s*\$?)(?:\s+|\{\}|(?![a-zA-Z]))$/,digits:/^[0-9]+/,"-9.,9":/^[+\-]?(?:[0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+))/,"-9.,9 no missing 0":/^[+\-]?[0-9]+(?:[.,][0-9]+)?/,"(-)(9.,9)(e)(99)":function(e){var t=e.match(/^(\+\-|\+\/\-|\+|\-|\\pm\s?)?([0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+))?(\((?:[0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+))\))?(?:([eE]|\s*(\*|x|\\times|\u00D7)\s*10\^)([+\-]?[0-9]+|\{[+\-]?[0-9]+\}))?/);return t&&t[0]?{match_:t.splice(1),remainder:e.substr(t[0].length)}:null},"(-)(9)^(-9)":function(e){var t=e.match(/^(\+\-|\+\/\-|\+|\-|\\pm\s?)?([0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+)?)\^([+\-]?[0-9]+|\{[+\-]?[0-9]+\})/);return t&&t[0]?{match_:t.splice(1),remainder:e.substr(t[0].length)}:null},"state of aggregation $":function(e){var t=h.patterns.findObserveGroups(e,"",/^\([a-z]{1,3}(?=[\),])/,")","");if(t&&t.remainder.match(/^($|[\s,;\)\]\}])/))return t;var r=e.match(/^(?:\((?:\\ca\s?)?\$[amothc]\$\))/);return r?{match_:r[0],remainder:e.substr(r[0].length)}:null},"_{(state of aggregation)}$":/^_\{(\([a-z]{1,3}\))\}/,"{[(":/^(?:\\\{|\[|\()/,")]}":/^(?:\)|\]|\\\})/,", ":/^[,;]\s*/,",":/^[,;]/,".":/^[.]/,". ":/^([.\u22C5\u00B7\u2022])\s*/,"...":/^\.\.\.(?=$|[^.])/,"* ":/^([*])\s*/,"^{(...)}":function(e){return h.patterns.findObserveGroups(e,"^{","","","}")},"^($...$)":function(e){return h.patterns.findObserveGroups(e,"^","$","$","")},"^a":/^\^([0-9]+|[^\\_])/,"^\\x{}{}":function(e){return h.patterns.findObserveGroups(e,"^",/^\\[a-zA-Z]+\{/,"}","","","{","}","",!0)},"^\\x{}":function(e){return h.patterns.findObserveGroups(e,"^",/^\\[a-zA-Z]+\{/,"}","")},"^\\x":/^\^(\\[a-zA-Z]+)\s*/,"^(-1)":/^\^(-?\d+)/,"'":/^'/,"_{(...)}":function(e){return h.patterns.findObserveGroups(e,"_{","","","}")},"_($...$)":function(e){return h.patterns.findObserveGroups(e,"_","$","$","")},_9:/^_([+\-]?[0-9]+|[^\\])/,"_\\x{}{}":function(e){return h.patterns.findObserveGroups(e,"_",/^\\[a-zA-Z]+\{/,"}","","","{","}","",!0)},"_\\x{}":function(e){return h.patterns.findObserveGroups(e,"_",/^\\[a-zA-Z]+\{/,"}","")},"_\\x":/^_(\\[a-zA-Z]+)\s*/,"^_":/^(?:\^(?=_)|\_(?=\^)|[\^_]$)/,"{}":/^\{\}/,"{...}":function(e){return h.patterns.findObserveGroups(e,"","{","}","")},"{(...)}":function(e){return h.patterns.findObserveGroups(e,"{","","","}")},"$...$":function(e){return h.patterns.findObserveGroups(e,"","$","$","")},"${(...)}$":function(e){return h.patterns.findObserveGroups(e,"${","","","}$")},"$(...)$":function(e){return h.patterns.findObserveGroups(e,"$","","","$")},"=<>":/^[=<>]/,"#":/^[#\u2261]/,"+":/^\+/,"-$":/^-(?=[\s_},;\]/]|$|\([a-z]+\))/,"-9":/^-(?=[0-9])/,"- orbital overlap":/^-(?=(?:[spd]|sp)(?:$|[\s,;\)\]\}]))/,"-":/^-/,"pm-operator":/^(?:\\pm|\$\\pm\$|\+-|\+\/-)/,operator:/^(?:\+|(?:[\-=<>]|<<|>>|\\approx|\$\\approx\$)(?=\s|$|-?[0-9]))/,arrowUpDown:/^(?:v|\(v\)|\^|\(\^\))(?=$|[\s,;\)\]\}])/,"\\bond{(...)}":function(e){return h.patterns.findObserveGroups(e,"\\bond{","","","}")},"->":/^(?:<->|<-->|->|<-|<=>>|<<=>|<=>|[\u2192\u27F6\u21CC])/,CMT:/^[CMT](?=\[)/,"[(...)]":function(e){return h.patterns.findObserveGroups(e,"[","","","]")},"1st-level escape":/^(&|\\\\|\\hline)\s*/,"\\,":/^(?:\\[,\ ;:])/,"\\x{}{}":function(e){return h.patterns.findObserveGroups(e,"",/^\\[a-zA-Z]+\{/,"}","","","{","}","",!0)},"\\x{}":function(e){return h.patterns.findObserveGroups(e,"",/^\\[a-zA-Z]+\{/,"}","")},"\\ca":/^\\ca(?:\s+|(?![a-zA-Z]))/,"\\x":/^(?:\\[a-zA-Z]+\s*|\\[_&{}%])/,orbital:/^(?:[0-9]{1,2}[spdfgh]|[0-9]{0,2}sp)(?=$|[^a-zA-Z])/,others:/^[\/~|]/,"\\frac{(...)}":function(e){return h.patterns.findObserveGroups(e,"\\frac{","","","}","{","","","}")},"\\overset{(...)}":function(e){return h.patterns.findObserveGroups(e,"\\overset{","","","}","{","","","}")},"\\underset{(...)}":function(e){return h.patterns.findObserveGroups(e,"\\underset{","","","}","{","","","}")},"\\underbrace{(...)}":function(e){return h.patterns.findObserveGroups(e,"\\underbrace{","","","}_","{","","","}")},"\\color{(...)}0":function(e){return h.patterns.findObserveGroups(e,"\\color{","","","}")},"\\color{(...)}{(...)}1":function(e){return h.patterns.findObserveGroups(e,"\\color{","","","}","{","","","}")},"\\color(...){(...)}2":function(e){return h.patterns.findObserveGroups(e,"\\color","\\","",/^(?=\{)/,"{","","","}")},"\\ce{(...)}":function(e){return h.patterns.findObserveGroups(e,"\\ce{","","","}")},oxidation$:/^(?:[+-][IVX]+|\\pm\s*0|\$\\pm\$\s*0)$/,"d-oxidation$":/^(?:[+-]?\s?[IVX]+|\\pm\s*0|\$\\pm\$\s*0)$/,"roman numeral":/^[IVX]+/,"1/2$":/^[+\-]?(?:[0-9]+|\$[a-z]\$|[a-z])\/[0-9]+(?:\$[a-z]\$|[a-z])?$/,amount:function(e){if(t=e.match(/^(?:(?:(?:\([+\-]?[0-9]+\/[0-9]+\)|[+\-]?(?:[0-9]+|\$[a-z]\$|[a-z])\/[0-9]+|[+\-]?[0-9]+[.,][0-9]+|[+\-]?\.[0-9]+|[+\-]?[0-9]+)(?:[a-z](?=\s*[A-Z]))?)|[+\-]?[a-z](?=\s*[A-Z])|\+(?!\s))/))return{match_:t[0],remainder:e.substr(t[0].length)};var t,r=h.patterns.findObserveGroups(e,"","$","$","");return r&&(t=r.match_.match(/^\$(?:\(?[+\-]?(?:[0-9]*[a-z]?[+\-])?[0-9]*[a-z](?:[+\-][0-9]*[a-z]?)?\)?|\+|-)\$$/))?{match_:t[0],remainder:e.substr(t[0].length)}:null},amount2:function(e){return this.amount(e)},"(KV letters),":/^(?:[A-Z][a-z]{0,2}|i)(?=,)/,formula$:function(e){if(e.match(/^\([a-z]+\)$/))return null;var t=e.match(/^(?:[a-z]|(?:[0-9\ \+\-\,\.\(\)]+[a-z])+[0-9\ \+\-\,\.\(\)]*|(?:[a-z][0-9\ \+\-\,\.\(\)]+)+[a-z]?)$/);return t?{match_:t[0],remainder:e.substr(t[0].length)}:null},uprightEntities:/^(?:pH|pOH|pC|pK|iPr|iBu)(?=$|[^a-zA-Z])/,"/":/^\s*(\/)\s*/,"//":/^\s*(\/\/)\s*/,"*":/^\s*[*.]\s*/},findObserveGroups:function(e,t,r,s,a,n,o,i,l,c){var d=function(e,t){if("string"==typeof t)return 0!==e.indexOf(t)?null:t;var r=e.match(t);return r?r[0]:null},u=d(e,t);if(null===u||null===(u=d(e=e.substr(u.length),r)))return null;var m=function(e,t,r){for(var s=0;t<e.length;){var a=e.charAt(t),n=d(e.substr(t),r);if(null!==n&&0===s)return{endMatchBegin:t,endMatchEnd:t+n.length};if("{"===a)s++;else if("}"===a)if(0===s)throw["ExtraCloseMissingOpen","Extra close brace or missing open brace"];else s--;t++}return null}(e,u.length,s||a);if(null===m)return null;var p=e.substring(0,s?m.endMatchEnd:m.endMatchBegin);if(!(n||o))return{match_:p,remainder:e.substr(m.endMatchEnd)};var x=this.findObserveGroups(e.substr(m.endMatchEnd),n,o,i,l);if(null===x)return null;var h=[p,x.match_];return{match_:c?h.join(""):h,remainder:x.remainder}},match_:function(e,t){var r=h.patterns.patterns[e];if(void 0===r)throw["MhchemBugP","mhchem bug P. Please report. ("+e+")"];if("function"==typeof r)return h.patterns.patterns[e](t);var s=t.match(r);return s?{match_:s[2]?[s[1],s[2]]:s[1]?s[1]:s[0],remainder:t.substr(s[0].length)}:null}},actions:{"a=":function(e,t){e.a=(e.a||"")+t},"b=":function(e,t){e.b=(e.b||"")+t},"p=":function(e,t){e.p=(e.p||"")+t},"o=":function(e,t){e.o=(e.o||"")+t},"q=":function(e,t){e.q=(e.q||"")+t},"d=":function(e,t){e.d=(e.d||"")+t},"rm=":function(e,t){e.rm=(e.rm||"")+t},"text=":function(e,t){e.text_=(e.text_||"")+t},insert:function(e,t,r){return{type_:r}},"insert+p1":function(e,t,r){return{type_:r,p1:t}},"insert+p1+p2":function(e,t,r){return{type_:r,p1:t[0],p2:t[1]}},copy:function(e,t){return t},rm:function(e,t){return{type_:"rm",p1:t||""}},text:function(e,t){return h.go(t,"text")},"{text}":function(e,t){var r=["{"];return h.concatArray(r,h.go(t,"text")),r.push("}"),r},"tex-math":function(e,t){return h.go(t,"tex-math")},"tex-math tight":function(e,t){return h.go(t,"tex-math tight")},bond:function(e,t,r){return{type_:"bond",kind_:r||t}},"color0-output":function(e,t){return{type_:"color0",color:t[0]}},ce:function(e,t){return h.go(t)},"1/2":function(e,t){var r=[];t.match(/^[+\-]/)&&(r.push(t.substr(0,1)),t=t.substr(1));var s=t.match(/^([0-9]+|\$[a-z]\$|[a-z])\/([0-9]+)(\$[a-z]\$|[a-z])?$/);return s[1]=s[1].replace(/\$/g,""),r.push({type_:"frac",p1:s[1],p2:s[2]}),s[3]&&(s[3]=s[3].replace(/\$/g,""),r.push({type_:"tex-math",p1:s[3]})),r},"9,9":function(e,t){return h.go(t,"9,9")}},createTransitions:function(e){var t,r,s,a,n={};for(t in e)for(r in e[t])for(a=0,s=r.split("|"),e[t][r].stateArray=s;a<s.length;a++)n[s[a]]=[];for(t in e)for(r in e[t])for(a=0,s=e[t][r].stateArray||[];a<s.length;a++){var o=e[t][r];if(o.action_){o.action_=[].concat(o.action_);for(var i=0;i<o.action_.length;i++)"string"==typeof o.action_[i]&&(o.action_[i]={type_:o.action_[i]})}else o.action_=[];for(var l=t.split("|"),c=0;c<l.length;c++)if("*"===s[a])for(var d in n)n[d].push({pattern:l[c],task:o});else n[s[a]].push({pattern:l[c],task:o})}return n},stateMachines:{}};h.stateMachines={ce:{transitions:h.createTransitions({empty:{"*":{action_:"output"}},else:{"0|1|2":{action_:"beginsWithBond=false",revisit:!0,toContinue:!0}},oxidation$:{0:{action_:"oxidation-output"}},CMT:{r:{action_:"rdt=",nextState:"rt"},rd:{action_:"rqt=",nextState:"rdt"}},arrowUpDown:{"0|1|2|as":{action_:["sb=false","output","operator"],nextState:"1"}},uprightEntities:{"0|1|2":{action_:["o=","output"],nextState:"1"}},orbital:{"0|1|2|3":{action_:"o=",nextState:"o"}},"->":{"0|1|2|3":{action_:"r=",nextState:"r"},"a|as":{action_:["output","r="],nextState:"r"},"*":{action_:["output","r="],nextState:"r"}},"+":{o:{action_:"d= kv",nextState:"d"},"d|D":{action_:"d=",nextState:"d"},q:{action_:"d=",nextState:"qd"},"qd|qD":{action_:"d=",nextState:"qd"},dq:{action_:["output","d="],nextState:"d"},3:{action_:["sb=false","output","operator"],nextState:"0"}},amount:{"0|2":{action_:"a=",nextState:"a"}},"pm-operator":{"0|1|2|a|as":{action_:["sb=false","output",{type_:"operator",option:"\\pm"}],nextState:"0"}},operator:{"0|1|2|a|as":{action_:["sb=false","output","operator"],nextState:"0"}},"-$":{"o|q":{action_:["charge or bond","output"],nextState:"qd"},d:{action_:"d=",nextState:"d"},D:{action_:["output",{type_:"bond",option:"-"}],nextState:"3"},q:{action_:"d=",nextState:"qd"},qd:{action_:"d=",nextState:"qd"},"qD|dq":{action_:["output",{type_:"bond",option:"-"}],nextState:"3"}},"-9":{"3|o":{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"3"}},"- orbital overlap":{o:{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"2"},d:{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"2"}},"-":{"0|1|2":{action_:[{type_:"output",option:1},"beginsWithBond=true",{type_:"bond",option:"-"}],nextState:"3"},3:{action_:{type_:"bond",option:"-"}},a:{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"2"},as:{action_:[{type_:"output",option:2},{type_:"bond",option:"-"}],nextState:"3"},b:{action_:"b="},o:{action_:{type_:"- after o/d",option:!1},nextState:"2"},q:{action_:{type_:"- after o/d",option:!1},nextState:"2"},"d|qd|dq":{action_:{type_:"- after o/d",option:!0},nextState:"2"},"D|qD|p":{action_:["output",{type_:"bond",option:"-"}],nextState:"3"}},amount2:{"1|3":{action_:"a=",nextState:"a"}},letters:{"0|1|2|3|a|as|b|p|bp|o":{action_:"o=",nextState:"o"},"q|dq":{action_:["output","o="],nextState:"o"},"d|D|qd|qD":{action_:"o after d",nextState:"o"}},digits:{o:{action_:"q=",nextState:"q"},"d|D":{action_:"q=",nextState:"dq"},q:{action_:["output","o="],nextState:"o"},a:{action_:"o=",nextState:"o"}},"space A":{"b|p|bp":{}},space:{a:{nextState:"as"},0:{action_:"sb=false"},"1|2":{action_:"sb=true"},"r|rt|rd|rdt|rdq":{action_:"output",nextState:"0"},"*":{action_:["output","sb=true"],nextState:"1"}},"1st-level escape":{"1|2":{action_:["output",{type_:"insert+p1",option:"1st-level escape"}]},"*":{action_:["output",{type_:"insert+p1",option:"1st-level escape"}],nextState:"0"}},"[(...)]":{"r|rt":{action_:"rd=",nextState:"rd"},"rd|rdt":{action_:"rq=",nextState:"rdq"}},"...":{"o|d|D|dq|qd|qD":{action_:["output",{type_:"bond",option:"..."}],nextState:"3"},"*":{action_:[{type_:"output",option:1},{type_:"insert",option:"ellipsis"}],nextState:"1"}},". |* ":{"*":{action_:["output",{type_:"insert",option:"addition compound"}],nextState:"1"}},"state of aggregation $":{"*":{action_:["output","state of aggregation"],nextState:"1"}},"{[(":{"a|as|o":{action_:["o=","output","parenthesisLevel++"],nextState:"2"},"0|1|2|3":{action_:["o=","output","parenthesisLevel++"],nextState:"2"},"*":{action_:["output","o=","output","parenthesisLevel++"],nextState:"2"}},")]}":{"0|1|2|3|b|p|bp|o":{action_:["o=","parenthesisLevel--"],nextState:"o"},"a|as|d|D|q|qd|qD|dq":{action_:["output","o=","parenthesisLevel--"],nextState:"o"}},", ":{"*":{action_:["output","comma"],nextState:"0"}},"^_":{"*":{}},"^{(...)}|^($...$)":{"0|1|2|as":{action_:"b=",nextState:"b"},p:{action_:"b=",nextState:"bp"},"3|o":{action_:"d= kv",nextState:"D"},q:{action_:"d=",nextState:"qD"},"d|D|qd|qD|dq":{action_:["output","d="],nextState:"D"}},"^a|^\\x{}{}|^\\x{}|^\\x|'":{"0|1|2|as":{action_:"b=",nextState:"b"},p:{action_:"b=",nextState:"bp"},"3|o":{action_:"d= kv",nextState:"d"},q:{action_:"d=",nextState:"qd"},"d|qd|D|qD":{action_:"d="},dq:{action_:["output","d="],nextState:"d"}},"_{(state of aggregation)}$":{"d|D|q|qd|qD|dq":{action_:["output","q="],nextState:"q"}},"_{(...)}|_($...$)|_9|_\\x{}{}|_\\x{}|_\\x":{"0|1|2|as":{action_:"p=",nextState:"p"},b:{action_:"p=",nextState:"bp"},"3|o":{action_:"q=",nextState:"q"},"d|D":{action_:"q=",nextState:"dq"},"q|qd|qD|dq":{action_:["output","q="],nextState:"q"}},"=<>":{"0|1|2|3|a|as|o|q|d|D|qd|qD|dq":{action_:[{type_:"output",option:2},"bond"],nextState:"3"}},"#":{"0|1|2|3|a|as|o":{action_:[{type_:"output",option:2},{type_:"bond",option:"#"}],nextState:"3"}},"{}":{"*":{action_:{type_:"output",option:1},nextState:"1"}},"{...}":{"0|1|2|3|a|as|b|p|bp":{action_:"o=",nextState:"o"},"o|d|D|q|qd|qD|dq":{action_:["output","o="],nextState:"o"}},"$...$":{a:{action_:"a="},"0|1|2|3|as|b|p|bp|o":{action_:"o=",nextState:"o"},"as|o":{action_:"o="},"q|d|D|qd|qD|dq":{action_:["output","o="],nextState:"o"}},"\\bond{(...)}":{"*":{action_:[{type_:"output",option:2},"bond"],nextState:"3"}},"\\frac{(...)}":{"*":{action_:[{type_:"output",option:1},"frac-output"],nextState:"3"}},"\\overset{(...)}":{"*":{action_:[{type_:"output",option:2},"overset-output"],nextState:"3"}},"\\underset{(...)}":{"*":{action_:[{type_:"output",option:2},"underset-output"],nextState:"3"}},"\\underbrace{(...)}":{"*":{action_:[{type_:"output",option:2},"underbrace-output"],nextState:"3"}},"\\color{(...)}{(...)}1|\\color(...){(...)}2":{"*":{action_:[{type_:"output",option:2},"color-output"],nextState:"3"}},"\\color{(...)}0":{"*":{action_:[{type_:"output",option:2},"color0-output"]}},"\\ce{(...)}":{"*":{action_:[{type_:"output",option:2},"ce"],nextState:"3"}},"\\,":{"*":{action_:[{type_:"output",option:1},"copy"],nextState:"1"}},"\\x{}{}|\\x{}|\\x":{"0|1|2|3|a|as|b|p|bp|o|c0":{action_:["o=","output"],nextState:"3"},"*":{action_:["output","o=","output"],nextState:"3"}},others:{"*":{action_:[{type_:"output",option:1},"copy"],nextState:"3"}},else2:{a:{action_:"a to o",nextState:"o",revisit:!0},as:{action_:["output","sb=true"],nextState:"1",revisit:!0},"r|rt|rd|rdt|rdq":{action_:["output"],nextState:"0",revisit:!0},"*":{action_:["output","copy"],nextState:"3"}}}),actions:{"o after d":function(e,t){var r;if((e.d||"").match(/^[0-9]+$/)){var s=e.d;e.d=void 0,r=this.output(e),e.b=s}else r=this.output(e);return h.actions["o="](e,t),r},"d= kv":function(e,t){e.d=t,e.dType="kv"},"charge or bond":function(e,t){if(e.beginsWithBond){var r=[];return h.concatArray(r,this.output(e)),h.concatArray(r,h.actions.bond(e,t,"-")),r}e.d=t},"- after o/d":function(e,t,r){var s=h.patterns.match_("orbital",e.o||""),a=h.patterns.match_("one lowercase greek letter $",e.o||""),n=h.patterns.match_("one lowercase latin letter $",e.o||""),o=h.patterns.match_("$one lowercase latin letter$ $",e.o||""),i="-"===t&&(s&&""===s.remainder||a||n||o);!i||e.a||e.b||e.p||e.d||e.q||s||!n||(e.o="$"+e.o+"$");var l=[];return i?(h.concatArray(l,this.output(e)),l.push({type_:"hyphen"})):(s=h.patterns.match_("digits",e.d||""),r&&s&&""===s.remainder?(h.concatArray(l,h.actions["d="](e,t)),h.concatArray(l,this.output(e))):(h.concatArray(l,this.output(e)),h.concatArray(l,h.actions.bond(e,t,"-")))),l},"a to o":function(e){e.o=e.a,e.a=void 0},"sb=true":function(e){e.sb=!0},"sb=false":function(e){e.sb=!1},"beginsWithBond=true":function(e){e.beginsWithBond=!0},"beginsWithBond=false":function(e){e.beginsWithBond=!1},"parenthesisLevel++":function(e){e.parenthesisLevel++},"parenthesisLevel--":function(e){e.parenthesisLevel--},"state of aggregation":function(e,t){return{type_:"state of aggregation",p1:h.go(t,"o")}},comma:function(e,t){var r=t.replace(/\s*$/,"");return r!==t&&0===e.parenthesisLevel?{type_:"comma enumeration L",p1:r}:{type_:"comma enumeration M",p1:r}},output:function(e,t,r){var s,a,n;for(var o in e.r?(a="M"===e.rdt?h.go(e.rd,"tex-math"):"T"===e.rdt?[{type_:"text",p1:e.rd||""}]:h.go(e.rd),n="M"===e.rqt?h.go(e.rq,"tex-math"):"T"===e.rqt?[{type_:"text",p1:e.rq||""}]:h.go(e.rq),s={type_:"arrow",r:e.r,rd:a,rq:n}):(s=[],(e.a||e.b||e.p||e.o||e.q||e.d||r)&&(e.sb&&s.push({type_:"entitySkip"}),e.o||e.q||e.d||e.b||e.p||2===r?e.o||e.q||e.d||!e.b&&!e.p?e.o&&"kv"===e.dType&&h.patterns.match_("d-oxidation$",e.d||"")?e.dType="oxidation":e.o&&"kv"===e.dType&&!e.q&&(e.dType=void 0):(e.o=e.a,e.d=e.b,e.q=e.p,e.a=e.b=e.p=void 0):(e.o=e.a,e.a=void 0),s.push({type_:"chemfive",a:h.go(e.a,"a"),b:h.go(e.b,"bd"),p:h.go(e.p,"pq"),o:h.go(e.o,"o"),q:h.go(e.q,"pq"),d:h.go(e.d,"oxidation"===e.dType?"oxidation":"bd"),dType:e.dType}))),e)"parenthesisLevel"!==o&&"beginsWithBond"!==o&&delete e[o];return s},"oxidation-output":function(e,t){var r=["{"];return h.concatArray(r,h.go(t,"oxidation")),r.push("}"),r},"frac-output":function(e,t){return{type_:"frac-ce",p1:h.go(t[0]),p2:h.go(t[1])}},"overset-output":function(e,t){return{type_:"overset",p1:h.go(t[0]),p2:h.go(t[1])}},"underset-output":function(e,t){return{type_:"underset",p1:h.go(t[0]),p2:h.go(t[1])}},"underbrace-output":function(e,t){return{type_:"underbrace",p1:h.go(t[0]),p2:h.go(t[1])}},"color-output":function(e,t){return{type_:"color",color1:t[0],color2:h.go(t[1])}},"r=":function(e,t){e.r=t},"rdt=":function(e,t){e.rdt=t},"rd=":function(e,t){e.rd=t},"rqt=":function(e,t){e.rqt=t},"rq=":function(e,t){e.rq=t},operator:function(e,t,r){return{type_:"operator",kind_:r||t}}}},a:{transitions:h.createTransitions({empty:{"*":{}},"1/2$":{0:{action_:"1/2"}},else:{0:{nextState:"1",revisit:!0}},"$(...)$":{"*":{action_:"tex-math tight",nextState:"1"}},",":{"*":{action_:{type_:"insert",option:"commaDecimal"}}},else2:{"*":{action_:"copy"}}}),actions:{}},o:{transitions:h.createTransitions({empty:{"*":{}},"1/2$":{0:{action_:"1/2"}},else:{0:{nextState:"1",revisit:!0}},letters:{"*":{action_:"rm"}},"\\ca":{"*":{action_:{type_:"insert",option:"circa"}}},"\\x{}{}|\\x{}|\\x":{"*":{action_:"copy"}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"{(...)}":{"*":{action_:"{text}"}},else2:{"*":{action_:"copy"}}}),actions:{}},text:{transitions:h.createTransitions({empty:{"*":{action_:"output"}},"{...}":{"*":{action_:"text="}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"\\greek":{"*":{action_:["output","rm"]}},"\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:["output","copy"]}},else:{"*":{action_:"text="}}}),actions:{output:function(e){if(e.text_){var t={type_:"text",p1:e.text_};for(var r in e)delete e[r];return t}}}},pq:{transitions:h.createTransitions({empty:{"*":{}},"state of aggregation $":{"*":{action_:"state of aggregation"}},i$:{0:{nextState:"!f",revisit:!0}},"(KV letters),":{0:{action_:"rm",nextState:"0"}},formula$:{0:{nextState:"f",revisit:!0}},"1/2$":{0:{action_:"1/2"}},else:{0:{nextState:"!f",revisit:!0}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"{(...)}":{"*":{action_:"text"}},"a-z":{f:{action_:"tex-math"}},letters:{"*":{action_:"rm"}},"-9.,9":{"*":{action_:"9,9"}},",":{"*":{action_:{type_:"insert+p1",option:"comma enumeration S"}}},"\\color{(...)}{(...)}1|\\color(...){(...)}2":{"*":{action_:"color-output"}},"\\color{(...)}0":{"*":{action_:"color0-output"}},"\\ce{(...)}":{"*":{action_:"ce"}},"\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"copy"}},else2:{"*":{action_:"copy"}}}),actions:{"state of aggregation":function(e,t){return{type_:"state of aggregation subscript",p1:h.go(t,"o")}},"color-output":function(e,t){return{type_:"color",color1:t[0],color2:h.go(t[1],"pq")}}}},bd:{transitions:h.createTransitions({empty:{"*":{}},x$:{0:{nextState:"!f",revisit:!0}},formula$:{0:{nextState:"f",revisit:!0}},else:{0:{nextState:"!f",revisit:!0}},"-9.,9 no missing 0":{"*":{action_:"9,9"}},".":{"*":{action_:{type_:"insert",option:"electron dot"}}},"a-z":{f:{action_:"tex-math"}},x:{"*":{action_:{type_:"insert",option:"KV x"}}},letters:{"*":{action_:"rm"}},"'":{"*":{action_:{type_:"insert",option:"prime"}}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"{(...)}":{"*":{action_:"text"}},"\\color{(...)}{(...)}1|\\color(...){(...)}2":{"*":{action_:"color-output"}},"\\color{(...)}0":{"*":{action_:"color0-output"}},"\\ce{(...)}":{"*":{action_:"ce"}},"\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"copy"}},else2:{"*":{action_:"copy"}}}),actions:{"color-output":function(e,t){return{type_:"color",color1:t[0],color2:h.go(t[1],"bd")}}}},oxidation:{transitions:h.createTransitions({empty:{"*":{}},"roman numeral":{"*":{action_:"roman-numeral"}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},else:{"*":{action_:"copy"}}}),actions:{"roman-numeral":function(e,t){return{type_:"roman numeral",p1:t||""}}}},"tex-math":{transitions:h.createTransitions({empty:{"*":{action_:"output"}},"\\ce{(...)}":{"*":{action_:["output","ce"]}},"{...}|\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"o="}},else:{"*":{action_:"o="}}}),actions:{output:function(e){if(e.o){var t={type_:"tex-math",p1:e.o};for(var r in e)delete e[r];return t}}}},"tex-math tight":{transitions:h.createTransitions({empty:{"*":{action_:"output"}},"\\ce{(...)}":{"*":{action_:["output","ce"]}},"{...}|\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"o="}},"-|+":{"*":{action_:"tight operator"}},else:{"*":{action_:"o="}}}),actions:{"tight operator":function(e,t){e.o=(e.o||"")+"{"+t+"}"},output:function(e){if(e.o){var t={type_:"tex-math",p1:e.o};for(var r in e)delete e[r];return t}}}},"9,9":{transitions:h.createTransitions({empty:{"*":{}},",":{"*":{action_:"comma"}},else:{"*":{action_:"copy"}}}),actions:{comma:function(){return{type_:"commaDecimal"}}}},pu:{transitions:h.createTransitions({empty:{"*":{action_:"output"}},space$:{"*":{action_:["output","space"]}},"{[(|)]}":{"0|a":{action_:"copy"}},"(-)(9)^(-9)":{0:{action_:"number^",nextState:"a"}},"(-)(9.,9)(e)(99)":{0:{action_:"enumber",nextState:"a"}},space:{"0|a":{}},"pm-operator":{"0|a":{action_:{type_:"operator",option:"\\pm"},nextState:"0"}},operator:{"0|a":{action_:"copy",nextState:"0"}},"//":{d:{action_:"o=",nextState:"/"}},"/":{d:{action_:"o=",nextState:"/"}},"{...}|else":{"0|d":{action_:"d=",nextState:"d"},a:{action_:["space","d="],nextState:"d"},"/|q":{action_:"q=",nextState:"q"}}}),actions:{enumber:function(e,t){var r=[];return"+-"===t[0]||"+/-"===t[0]?r.push("\\pm "):t[0]&&r.push(t[0]),t[1]&&(h.concatArray(r,h.go(t[1],"pu-9,9")),t[2]&&(t[2].match(/[,.]/)?h.concatArray(r,h.go(t[2],"pu-9,9")):r.push(t[2])),t[3]=t[4]||t[3],t[3]&&(t[3]=t[3].trim(),"e"===t[3]||"*"===t[3].substr(0,1)?r.push({type_:"cdot"}):r.push({type_:"times"}))),t[3]&&r.push("10^{"+t[5]+"}"),r},"number^":function(e,t){var r=[];return"+-"===t[0]||"+/-"===t[0]?r.push("\\pm "):t[0]&&r.push(t[0]),h.concatArray(r,h.go(t[1],"pu-9,9")),r.push("^{"+t[2]+"}"),r},operator:function(e,t,r){return{type_:"operator",kind_:r||t}},space:function(){return{type_:"pu-space-1"}},output:function(e){var t,r=h.patterns.match_("{(...)}",e.d||"");r&&""===r.remainder&&(e.d=r.match_);var s=h.patterns.match_("{(...)}",e.q||"");if(s&&""===s.remainder&&(e.q=s.match_),e.d&&(e.d=e.d.replace(/\u00B0C|\^oC|\^{o}C/g,"{}^{\\circ}C"),e.d=e.d.replace(/\u00B0F|\^oF|\^{o}F/g,"{}^{\\circ}F")),e.q){e.q=e.q.replace(/\u00B0C|\^oC|\^{o}C/g,"{}^{\\circ}C"),e.q=e.q.replace(/\u00B0F|\^oF|\^{o}F/g,"{}^{\\circ}F");var a={d:h.go(e.d,"pu"),q:h.go(e.q,"pu")};"//"===e.o?t={type_:"pu-frac",p1:a.d,p2:a.q}:(t=a.d,a.d.length>1||a.q.length>1?t.push({type_:" / "}):t.push({type_:"/"}),h.concatArray(t,a.q))}else t=h.go(e.d,"pu-2");for(var n in e)delete e[n];return t}}},"pu-2":{transitions:h.createTransitions({empty:{"*":{action_:"output"}},"*":{"*":{action_:["output","cdot"],nextState:"0"}},"\\x":{"*":{action_:"rm="}},space:{"*":{action_:["output","space"],nextState:"0"}},"^{(...)}|^(-1)":{1:{action_:"^(-1)"}},"-9.,9":{0:{action_:"rm=",nextState:"0"},1:{action_:"^(-1)",nextState:"0"}},"{...}|else":{"*":{action_:"rm=",nextState:"1"}}}),actions:{cdot:function(){return{type_:"tight cdot"}},"^(-1)":function(e,t){e.rm+="^{"+t+"}"},space:function(){return{type_:"pu-space-2"}},output:function(e){var t=[];if(e.rm){var r=h.patterns.match_("{(...)}",e.rm||"");t=r&&""===r.remainder?h.go(r.match_,"pu"):{type_:"rm",p1:e.rm}}for(var s in e)delete e[s];return t}}},"pu-9,9":{transitions:h.createTransitions({empty:{0:{action_:"output-0"},o:{action_:"output-o"}},",":{0:{action_:["output-0","comma"],nextState:"o"}},".":{0:{action_:["output-0","copy"],nextState:"o"}},else:{"*":{action_:"text="}}}),actions:{comma:function(){return{type_:"commaDecimal"}},"output-0":function(e){var t=[];if(e.text_=e.text_||"",e.text_.length>4){var r=e.text_.length%3;0===r&&(r=3);for(var s=e.text_.length-3;s>0;s-=3)t.push(e.text_.substr(s,3)),t.push({type_:"1000 separator"});t.push(e.text_.substr(0,r)),t.reverse()}else t.push(e.text_);for(var a in e)delete e[a];return t},"output-o":function(e){var t=[];if(e.text_=e.text_||"",e.text_.length>4){for(var r=e.text_.length-3,s=0;s<r;s+=3)t.push(e.text_.substr(s,3)),t.push({type_:"1000 separator"});t.push(e.text_.substr(s))}else t.push(e.text_);for(var a in e)delete e[a];return t}}}};var g={go:function(e,t){if(!e)return"";for(var r="",s=!1,a=0;a<e.length;a++){var n=e[a];"string"==typeof n?r+=n:(r+=g._go2(n),"1st-level escape"===n.type_&&(s=!0))}return t||s||!r||(r="{"+r+"}"),r},_goInner:function(e){return e?g.go(e,!0):e},_go2:function(e){var t;switch(e.type_){case"chemfive":t="";var r={a:g._goInner(e.a),b:g._goInner(e.b),p:g._goInner(e.p),o:g._goInner(e.o),q:g._goInner(e.q),d:g._goInner(e.d)};r.a&&(r.a.match(/^[+\-]/)&&(r.a="{"+r.a+"}"),t+=r.a+"\\,"),(r.b||r.p)&&(t+="{\\vphantom{X}}",t+="^{\\hphantom{"+(r.b||"")+"}}_{\\hphantom{"+(r.p||"")+"}}",t+="{\\vphantom{X}}",t+="^{\\smash[t]{\\vphantom{2}}\\mathllap{"+(r.b||"")+"}}",t+="_{\\vphantom{2}\\mathllap{\\smash[t]{"+(r.p||"")+"}}}"),r.o&&(r.o.match(/^[+\-]/)&&(r.o="{"+r.o+"}"),t+=r.o),"kv"===e.dType?((r.d||r.q)&&(t+="{\\vphantom{X}}"),r.d&&(t+="^{"+r.d+"}"),r.q&&(t+="_{\\smash[t]{"+r.q+"}}")):"oxidation"===e.dType?(r.d&&(t+="{\\vphantom{X}}",t+="^{"+r.d+"}"),r.q&&(t+="{\\vphantom{X}}",t+="_{\\smash[t]{"+r.q+"}}")):(r.q&&(t+="{\\vphantom{X}}",t+="_{\\smash[t]{"+r.q+"}}"),r.d&&(t+="{\\vphantom{X}}",t+="^{"+r.d+"}"));break;case"rm":case"roman numeral":t="\\mathrm{"+e.p1+"}";break;case"text":e.p1.match(/[\^_]/)?(e.p1=e.p1.replace(" ","~").replace("-","\\text{-}"),t="\\mathrm{"+e.p1+"}"):t="\\text{"+e.p1+"}";break;case"state of aggregation":t="\\mskip2mu "+g._goInner(e.p1);break;case"state of aggregation subscript":t="\\mskip1mu "+g._goInner(e.p1);break;case"bond":if(!(t=g._getBond(e.kind_)))throw["MhchemErrorBond","mhchem Error. Unknown bond type ("+e.kind_+")"];break;case"frac":var s="\\frac{"+e.p1+"}{"+e.p2+"}";t="\\mathchoice{\\textstyle"+s+"}{"+s+"}{"+s+"}{"+s+"}";break;case"pu-frac":var a="\\frac{"+g._goInner(e.p1)+"}{"+g._goInner(e.p2)+"}";t="\\mathchoice{\\textstyle"+a+"}{"+a+"}{"+a+"}{"+a+"}";break;case"tex-math":case"1st-level escape":t=e.p1+" ";break;case"frac-ce":t="\\frac{"+g._goInner(e.p1)+"}{"+g._goInner(e.p2)+"}";break;case"overset":t="\\overset{"+g._goInner(e.p1)+"}{"+g._goInner(e.p2)+"}";break;case"underset":t="\\underset{"+g._goInner(e.p1)+"}{"+g._goInner(e.p2)+"}";break;case"underbrace":t="\\underbrace{"+g._goInner(e.p1)+"}_{"+g._goInner(e.p2)+"}";break;case"color":t="{\\color{"+e.color1+"}{"+g._goInner(e.color2)+"}}";break;case"color0":t="\\color{"+e.color+"}";break;case"arrow":var n={rd:g._goInner(e.rd),rq:g._goInner(e.rq)},o="\\x"+g._getArrow(e.r);n.rq&&(o+="[{"+n.rq+"}]"),n.rd?o+="{"+n.rd+"}":o+="{}",t=o;break;case"operator":t=g._getOperator(e.kind_);break;case"space":t=" ";break;case"entitySkip":case"pu-space-1":t="~";break;case"pu-space-2":t="\\mkern3mu ";break;case"1000 separator":t="\\mkern2mu ";break;case"commaDecimal":t="{,}";break;case"comma enumeration L":t="{"+e.p1+"}\\mkern6mu ";break;case"comma enumeration M":t="{"+e.p1+"}\\mkern3mu ";break;case"comma enumeration S":t="{"+e.p1+"}\\mkern1mu ";break;case"hyphen":t="\\text{-}";break;case"addition compound":t="\\,{\\cdot}\\,";break;case"electron dot":t="\\mkern1mu \\bullet\\mkern1mu ";break;case"KV x":t="{\\times}";break;case"prime":t="\\prime ";break;case"cdot":t="\\cdot ";break;case"tight cdot":t="\\mkern1mu{\\cdot}\\mkern1mu ";break;case"times":t="\\times ";break;case"circa":t="{\\sim}";break;case"^":t="uparrow";break;case"v":t="downarrow";break;case"ellipsis":t="\\ldots ";break;case"/":t="/";break;case" / ":t="\\,/\\,";break;default:throw["MhchemBugT","mhchem bug T. Please report."]}return t},_getArrow:function(e){switch(e){case"->":case"→":case"⟶":return"rightarrow";case"<-":return"leftarrow";case"<->":return"leftrightarrow";case"<-->":return"rightleftarrows";case"<=>":case"⇌":return"rightleftharpoons";case"<=>>":return"rightequilibrium";case"<<=>":return"leftequilibrium";default:throw["MhchemBugT","mhchem bug T. Please report."]}},_getBond:function(e){switch(e){case"-":case"1":return"{-}";case"=":case"2":return"{=}";case"#":case"3":return"{\\equiv}";case"~":return"{\\tripledash}";case"~-":return"{\\mathrlap{\\raisebox{-.1em}{$-$}}\\raisebox{.1em}{$\\tripledash$}}";case"~=":case"~--":return"{\\mathrlap{\\raisebox{-.2em}{$-$}}\\mathrlap{\\raisebox{.2em}{$\\tripledash$}}-}";case"-~-":return"{\\mathrlap{\\raisebox{-.2em}{$-$}}\\mathrlap{\\raisebox{.2em}{$-$}}\\tripledash}";case"...":return"{{\\cdot}{\\cdot}{\\cdot}}";case"....":return"{{\\cdot}{\\cdot}{\\cdot}{\\cdot}}";case"->":return"{\\rightarrow}";case"<-":return"{\\leftarrow}";case"<":return"{<}";case">":return"{>}";default:throw["MhchemBugT","mhchem bug T. Please report."]}},_getOperator:function(e){switch(e){case"+":return" {}+{} ";case"-":return" {}-{} ";case"=":return" {}={} ";case"<":return" {}<{} ";case">":return" {}>{} ";case"<<":return" {}\\ll{} ";case">>":return" {}\\gg{} ";case"\\pm":return" {}\\pm{} ";case"\\approx":case"$\\approx$":return" {}\\approx{} ";case"v":case"(v)":return" \\downarrow{} ";case"^":case"(^)":return" \\uparrow{} ";default:throw["MhchemBugT","mhchem bug T. Please report."]}}};e.s([],620808);var f=e.i(254153);e.s([],520891),e.s(["Streamdown",()=>f.i],645147);var v=e.i(379492),b=e.i(454160),j=e.i(706139),y=e.i(215900),w=e.i(92959),N=e.i(647415),k=e.i(684698),_=e.i(465016),C=e.i(200118),S=e.i(694859),M=e.i(975384),T=e.i(128288),$=e.i(123893),A=e.i(424127),D=e.i(999293),E=e.i(372559),I=e.i(707366),q=e.i(344834);let B=null,R=new Set(["typescript","javascript","tsx","jsx","python","rust","go","java","html","css","json","markdown","yaml","bash","shell","ts","js","py","md","yml","sh"]),L={ts:"typescript",js:"javascript",py:"python",md:"markdown",yml:"yaml",sh:"bash",zsh:"bash",fish:"bash"};function F(e){let t=e.toLowerCase().trim();return L[t]||t}function P(e){return`<pre class="shiki" style="background-color:#24292e;color:#e1e4e8"><code>${e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}</code></pre>`}var z=e.i(152088),O=e.i(828982),U=e.i(983300),G=e.i(755430);let H=(0,G.default)("unfold-horizontal",[["path",{d:"M16 12h6",key:"15xry1"}],["path",{d:"M8 12H2",key:"1jqql6"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 8v2",key:"1woqiv"}],["path",{d:"M12 14v2",key:"8jcxud"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m19 15 3-3-3-3",key:"wjy7rq"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}]]),V=(0,G.default)("text-wrap",[["path",{d:"m16 16-3 3 3 3",key:"117b85"}],["path",{d:"M3 12h14.5a1 1 0 0 1 0 7H13",key:"18xa6z"}],["path",{d:"M3 19h6",key:"1ygdsz"}],["path",{d:"M3 5h18",key:"1u36vt"}]]);var Z=e.i(985902);function W({code:e}){let[r,s]=(0,t.useState)(!1),[a,n]=(0,t.useState)(!1),o=async()=>{await navigator.clipboard.writeText(e),s(!0),setTimeout(()=>s(!1),2e3)};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Z.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-all duration-200",onClick:()=>n(!a),"aria-label":a?"Disable line wrapping":"Enable line wrapping",children:a?(0,v.jsx)(V,{className:"w-3 h-3"}):(0,v.jsx)(H,{className:"w-3 h-3"})}),(0,v.jsx)(Z.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-all duration-200",onClick:o,"aria-label":"Copy code",children:r?(0,v.jsx)(O.Check,{className:"w-3 h-3 text-primary"}):(0,v.jsx)(U.Copy,{className:"w-3 h-3"})})]})}function X({code:e,language:r,inline:s}){var a;let[n,o]=(0,t.useState)(null),i=(0,t.useRef)(e),l=(0,t.useRef)(r);if(s)return(0,v.jsx)("code",{className:(0,z.cn)("px-1.5 py-0.5 rounded text-sm font-mono","bg-muted/80 text-foreground","border border-border/20","dark:bg-gradient-to-br dark:from-[oklch(28%_0.03_260)] dark:to-[oklch(25%_0.02_260)]","dark:text-[oklch(88%_0.02_260)]","dark:border-[oklch(35%_0.04_260)]","dark:shadow-[inset_0_1px_0_oklch(40%_0.02_260_/_0.15),_0_1px_2px_oklch(0%_0_0_/_0.2)]","hover:bg-muted dark:hover:from-[oklch(30%_0.03_260)] dark:hover:to-[oklch(27%_0.02_260)]","transition-colors"),children:e});(0,t.useEffect)(()=>{if(i.current===e&&l.current===r&&n)return;i.current=e,l.current=r;let t=()=>{let t=function(e,t){let r=F(t);if(!R.has(F(r)))return{html:P(e),error:`Language "${t}" is not supported, showing as plain text`};try{return{html:(!B&&(B=(0,b.createHighlighterCoreSync)({themes:[q.default],langs:[E.default,C.default,D.default,M.default,$.default,A.default,N.default,_.default,k.default,w.default,S.default,T.default,I.default,y.default,y.default],engine:(0,j.createJavaScriptRegexEngine)()})),B).codeToHtml(e,{lang:r,theme:"github-dark"})}}catch(r){return console.warn(`[Shiki] Failed to highlight code with language "${t}":`,r),{html:P(e),error:r instanceof Error?r.message:"Unknown error during syntax highlighting"}}}(e,r||"text");o(t)};if("requestIdleCallback"in window){let e=requestIdleCallback(t);return()=>cancelIdleCallback(e)}{let e=setTimeout(t,1);return()=>clearTimeout(e)}},[e,r,n]);let c=n?.html||(a=e,`<pre class="shiki" style="background-color:#24292e;color:#e1e4e8"><code>${a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}</code></pre>`);return(0,v.jsxs)("div",{className:"relative group my-4",children:[(0,v.jsxs)("div",{className:"flex items-center justify-between bg-muted/50 px-4 py-2 rounded-t border-b border-border",children:[(0,v.jsx)("span",{className:"text-xs text-muted-foreground font-mono",children:r||"code"}),(0,v.jsx)("div",{className:"flex gap-2",children:(0,v.jsx)(W,{code:e})})]}),(0,v.jsx)("div",{className:"relative",children:(0,v.jsx)("div",{className:(0,z.cn)("rounded-b overflow-x-auto max-h-[600px] overflow-y-auto w-full","[&>pre]:m-0 [&>pre]:p-4 [&>pre]:w-full [&>pre]:overflow-x-auto"),dangerouslySetInnerHTML:{__html:c}})})]})}e.s(["CodeBlock",()=>X],688540);var K=t;class Q extends K.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){console.warn("[MathBlock] Render error caught by boundary:",e,t),s.analytics.track("math_error",{error:e.message,latexSnippet:this.props.latex?.slice(0,100)||"",isStreaming:!1}),s.analytics.captureException(e,{severity:"warning",context:"math_rendering",componentStack:t.componentStack??void 0,latexSnippet:this.props.latex?.slice(0,100)||""})}render(){return this.state.hasError?(0,v.jsxs)("div",{className:"math-error-fallback rounded-lg border border-destructive/50 bg-destructive/10 p-4 my-2",children:[(0,v.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,v.jsx)("span",{className:"text-sm font-medium text-destructive",children:"Math Rendering Error"})}),this.props.latex&&(0,v.jsx)("pre",{className:"text-xs font-mono bg-background/50 p-2 rounded overflow-x-auto",children:this.props.latex})]}):this.props.children}}e.s(["MathErrorBoundary",()=>Q],456209);let J=(0,t.forwardRef)(({isDisplay:e=!1,className:t},r)=>e?(0,v.jsx)("div",{ref:r,className:(0,z.cn)("animate-pulse rounded-lg bg-gradient-to-r from-muted/50 to-muted/30","h-20 w-full",t),role:"status","aria-label":"Loading mathematical equation",children:(0,v.jsx)("span",{className:"sr-only",children:"Loading equation..."})}):(0,v.jsx)("span",{ref:r,className:(0,z.cn)("inline-block animate-pulse rounded bg-gradient-to-r from-muted/50 to-muted/30","h-[1.5em] w-16",t),role:"status","aria-label":"Loading mathematical expression",children:(0,v.jsx)("span",{className:"sr-only",children:"Loading expression..."})}));J.displayName="MathSkeleton",e.s(["MathSkeleton",0,J],301463)},833250,e=>{"use strict";var t=e.i(379492),r=e.i(312879),s=e.i(128260),a=e.i(636160),n=e.i(544705),o=e.i(152088);e.i(620808);var i=e.i(384078);e.i(520891);var l=e.i(645147),c=e.i(688540),d=e.i(456209),u=e.i(301463),m=e.i(983300),p=e.i(278894),x=e.i(817735);let h=(0,e.i(755430).default)("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]);var g=e.i(968291);let f=null,v=!1;async function b(){return f||(f=await e.A(406063)),f.default}function j({code:e,config:r}){let s=(0,i.useRef)(null),[a,n]=(0,i.useState)(""),[l,c]=(0,i.useState)(null),[d,u]=(0,i.useState)(!0),[f,j]=(0,i.useState)(!1),[y,w]=(0,i.useState)(!1),{theme:N,resolvedTheme:k}=(0,g.useTheme)(),_="dark"===k||"system"===N&&"dark"===k;(0,i.useEffect)(()=>{(async()=>{let e=await b();v||(e.initialize({startOnLoad:!1,theme:r?.theme||"base",themeVariables:r?.themeVariables||{},flowchart:r?.flowchart||{nodeSpacing:50,rankSpacing:50,curve:"basis"},sequence:r?.sequence||{actorMargin:50,boxMargin:10,boxTextMargin:5,diagramMarginX:50,diagramMarginY:10,messageMargin:35},state:r?.state||{titleTopMargin:25}}),v=!0)})()},[r]),(0,i.useEffect)(()=>{let t=async()=>{try{c(null),u(!0);let t=await b();t.initialize({startOnLoad:!1,theme:"base",themeVariables:{..._?{primaryColor:"#d4a574",primaryTextColor:"#e8dfd4",primaryBorderColor:"#e89f5f",lineColor:"#b8b8b8",secondaryColor:"#3d3d3d",tertiaryColor:"#e89f5f",background:"#1a1a1a",mainBkg:"#2d2d2d",secondBkg:"#3d3d3d",textColor:"#e8dfd4",nodeBorder:"#d4a574",clusterBkg:"#2d2d2d",clusterBorder:"#b88a5f",edgeLabelBackground:"#2d2d2d"}:{primaryColor:"#d4a574",primaryTextColor:"#2d2d2d",primaryBorderColor:"#b88a5f",lineColor:"#8b8b8b",secondaryColor:"#e8dfd4",tertiaryColor:"#e89f5f",background:"#f0ebe5",mainBkg:"#fdfcfb",secondBkg:"#e8dfd4",textColor:"#2d2d2d"},...r?.themeVariables},flowchart:r?.flowchart||{nodeSpacing:50,rankSpacing:50,curve:"basis"},sequence:r?.sequence||{actorMargin:50,boxMargin:10,boxTextMargin:5,diagramMarginX:50,diagramMarginY:10,messageMargin:35},state:r?.state||{titleTopMargin:25}});let s=`mermaid-${Date.now()}-${Math.random().toString(36).substring(2,11)}`,{svg:a}=await t.render(s,e);n(a)}catch(e){console.error("[MermaidRenderer] Render error:",e),c(e instanceof Error?e.message:"Failed to render diagram")}finally{u(!1)}};e&&t()},[e,_,r]);let C=async()=>{try{await navigator.clipboard.writeText(e),w(!0),setTimeout(()=>w(!1),2e3)}catch(e){console.error("[MermaidRenderer] Copy failed:",e)}};return((0,i.useEffect)(()=>{let e=()=>{j(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),l)?(0,t.jsxs)("div",{className:"my-4 rounded border border-destructive/50 bg-destructive/10 p-4",children:[(0,t.jsx)("div",{className:"flex items-center gap-2 text-sm font-medium text-destructive mb-2",children:(0,t.jsx)("span",{children:"Mermaid Diagram Error"})}),(0,t.jsx)("pre",{className:"text-xs text-muted-foreground overflow-x-auto",children:l}),(0,t.jsxs)("details",{className:"mt-2",children:[(0,t.jsx)("summary",{className:"text-xs text-muted-foreground cursor-pointer hover:text-foreground",children:"Show diagram code"}),(0,t.jsx)("pre",{className:"mt-2 text-xs text-muted-foreground overflow-x-auto bg-muted/50 p-2 rounded",children:e})]})]}):(0,t.jsxs)("div",{ref:s,className:(0,o.cn)("relative group my-4 rounded border border-border bg-card",f&&"bg-background p-8"),children:[(0,t.jsxs)("div",{className:(0,o.cn)("absolute top-2 right-2 z-10 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",f&&"opacity-100"),children:[(0,t.jsx)("button",{type:"button",onClick:C,className:"p-1.5 rounded bg-background/90 hover:bg-background border border-border text-muted-foreground hover:text-foreground transition-colors",title:y?"Copied!":"Copy code",children:(0,t.jsx)(m.Copy,{className:"w-4 h-4"})}),(0,t.jsx)("button",{type:"button",onClick:()=>{if(!a)return;let e=new Blob([a],{type:"image/svg+xml"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download=`diagram-${Date.now()}.svg`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)},className:"p-1.5 rounded bg-background/90 hover:bg-background border border-border text-muted-foreground hover:text-foreground transition-colors",title:"Download as SVG",children:(0,t.jsx)(p.Download,{className:"w-4 h-4"})}),(0,t.jsx)("button",{type:"button",onClick:()=>{f?(document.exitFullscreen?.(),j(!1)):(s.current?.requestFullscreen?.(),j(!0))},className:"p-1.5 rounded bg-background/90 hover:bg-background border border-border text-muted-foreground hover:text-foreground transition-colors",title:f?"Exit fullscreen":"Fullscreen",children:f?(0,t.jsx)(h,{className:"w-4 h-4"}):(0,t.jsx)(x.Maximize2,{className:"w-4 h-4"})})]}),(0,t.jsx)("div",{className:(0,o.cn)("flex items-center justify-center p-6 overflow-auto min-h-[100px]",f&&"h-full"),children:d?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Loading diagram..."]}):(0,t.jsx)("div",{dangerouslySetInnerHTML:{__html:a}})})]})}class y extends i.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){console.warn("[CodeBlock] Render error caught by boundary:",e,t)}render(){return this.state.hasError?(0,t.jsxs)("div",{className:"relative group my-4",children:[(0,t.jsx)("div",{className:"flex items-center justify-between bg-muted/50 px-4 py-2 rounded-t border-b border-border",children:(0,t.jsx)("span",{className:"text-xs text-muted-foreground font-mono",children:this.props.language||"code"})}),(0,t.jsx)("pre",{className:"rounded-b overflow-x-auto max-h-[600px] overflow-y-auto w-full p-4 bg-[#24292e] text-[#e1e4e8]",children:(0,t.jsx)("code",{children:this.props.code})})]}):this.props.children}}function w({content:e,isStreaming:m=!1}){var p;let x=(0,i.useRef)(null),h=(p=!e.includes("\\(")&&!e.includes("\\[")?e:e.split(/(`{3}[\s\S]*?`{3}|`[^`\n]+`)/).map(e=>{if(e.startsWith("`"))return e;let t=e.replace(/\\\(([^)]*?)\\\)/g,"$$$$$1$$$$");return t.replace(/\\\[([^\]]*?)\\\]/g,"\n$$$$$1$$\n")}).join("")).includes("[")?p.split(/(`{3}[\s\S]*?`{3}|`[^`\n]+`)/).map(e=>e.startsWith("`")?e:e.replace(/\[(\d+)\]/g,"[$1](#source-$1)")).join(""):p,{displayContent:g,hasBufferedContent:f}=(0,n.useStreamBuffer)(h,m,{charsPerSecond:200,minTokenSize:3,adaptiveThreshold:5e3}),{observeRef:v,isRendered:b,isMobile:w}=(0,r.useLazyMathRenderer)({threshold:.01,rootMargin:"50px 0px",mobileOnly:!0});(0,a.useMathCopyButtons)(x),(0,s.useMathAccessibility)(x,m);let N=m||f,k=g.includes("$$")||g.includes("\\(");return w&&k&&!b?(0,t.jsx)("div",{ref:v,className:"markdown-content prose",children:(0,t.jsx)(u.MathSkeleton,{isDisplay:!0})}):(0,t.jsxs)("div",{ref:x,className:(0,o.cn)("markdown-content prose",N&&"streaming"),children:[(0,t.jsx)(d.MathErrorBoundary,{children:(0,t.jsx)(l.Streamdown,{components:{code:({className:e,children:r,...s})=>{let a=/language-(\w+)/.exec(e||""),n=a?.[1],o=String(r).replace(/\n$/,"");return"mermaid"===n?(0,t.jsx)(j,{code:o,config:{flowchart:{nodeSpacing:50,rankSpacing:50,curve:"basis"},sequence:{actorMargin:50,boxMargin:10,boxTextMargin:5,diagramMarginX:50,diagramMarginY:10,messageMargin:35},state:{titleTopMargin:25}}}):a||e?(0,t.jsx)(y,{code:o,language:n,children:(0,t.jsx)(c.CodeBlock,{code:o,language:n})}):(0,t.jsx)(c.CodeBlock,{code:o,inline:!0})},img:({src:e,alt:r,...s})=>(0,t.jsx)("img",{src:e,alt:r||"Image",className:"rounded-lg max-w-full h-auto my-4 block",style:{maxHeight:"600px",backgroundColor:"#fff"},loading:"lazy",onError:t=>{console.error("[Markdown] Image failed to load:",e),t.target.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='100'%3E%3Crect fill='%23f0f0f0' width='200' height='100'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='%23666'%3EImage failed to load%3C/text%3E%3C/svg%3E"},...s}),a:({href:e,children:r,...s})=>e?.startsWith("#source-")?(0,t.jsx)("a",{href:e,className:"citation-link",onClick:t=>{t.preventDefault();let r=document.querySelector(e);r&&r.scrollIntoView({behavior:"smooth",block:"center"})},...s,children:r}):(0,t.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",...s,children:r})},parseIncompleteMarkdown:m,controls:{code:!1,mermaid:!1},children:g})}),N&&(0,t.jsx)("span",{className:"streaming-cursor","aria-hidden":"true"})]})}e.s(["MarkdownContent",()=>w],833250)},285659,e=>{"use strict";var t=e.i(379492),r=e.i(283164);e.i(977101);var s=e.i(727630),a=e.i(813038),n=e.i(403950),o=e.i(644163),i=e.i(754622),l=e.i(328299),c=e.i(384078),d=e.i(985902),u=e.i(320287),m=e.i(696057);function p({recommendation:e,conversationId:p,onSwitch:x,onPreview:h}){let g=(0,s.useMutation)(r.api.conversations.dismissModelRecommendation),f=(0,s.useMutation)(r.api.users.updatePreferences);if((0,c.useEffect)(()=>{m.analytics.track("recommendation_shown",{conversationId:p,currentModel:e.currentModelId,suggestedModel:e.suggestedModelId,percentSaved:e.estimatedSavings.percentSaved,timestamp:Date.now()})},[p,e]),e.dismissed)return null;let v=u.MODEL_CONFIG[e.suggestedModelId];if(!v)return null;let b=async()=>{m.analytics.track("recommendation_accepted",{conversationId:p,from:e.currentModelId,to:e.suggestedModelId,savings:e.estimatedSavings.percentSaved,viaPreview:!1,timestamp:Date.now()}),x(e.suggestedModelId),g({conversationId:p});try{await f({preferences:{newChatModelSelection:"fixed",defaultModel:e.suggestedModelId}})}catch(e){console.error("[ModelRecommendationBanner] Failed to update global preference:",e)}window.dispatchEvent(new CustomEvent("focus-chat-input"))};return(0,t.jsx)(a.AnimatePresence,{children:(0,t.jsx)(n.motion.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.3,ease:"easeOut"},className:"mx-auto mb-4 max-w-3xl rounded-xl border border-border bg-card p-6 shadow-sm",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"rounded-full bg-blue-500/10 p-2",children:(0,t.jsx)(i.Lightbulb,{className:"h-5 w-5 text-blue-500"})}),(0,t.jsx)("h3",{className:"font-semibold",children:"Model Recommendation"})]}),(0,t.jsx)(d.Button,{variant:"ghost",size:"icon",onClick:()=>{m.analytics.track("recommendation_dismissed",{conversationId:p,currentModel:e.currentModelId,suggestedModel:e.suggestedModelId,secondsVisible:(Date.now()-e.createdAt)/1e3,timestamp:Date.now()}),g({conversationId:p})},className:"h-8 w-8",children:(0,t.jsx)(l.X,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-base leading-relaxed",children:e.reasoning}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e.estimatedSavings.costReduction}),(0,t.jsxs)("span",{className:"text-xs font-semibold text-green-500",children:[e.estimatedSavings.percentSaved,"% less"]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,t.jsxs)(d.Button,{variant:"outline",onClick:()=>{m.analytics.track("recommendation_preview_clicked",{conversationId:p,currentModel:e.currentModelId,suggestedModel:e.suggestedModelId,timestamp:Date.now()}),h(e.suggestedModelId)},className:"flex-1 justify-center border-border/60 hover:border-border",children:[(0,t.jsx)(o.Eye,{className:"h-4 w-4 mr-2"}),"Preview Comparison"]}),(0,t.jsxs)(d.Button,{onClick:b,className:"flex-1 justify-center bg-primary/90 hover:bg-primary text-primary-foreground",children:["Switch to ",v.name]})]})]})})})}e.s(["ModelRecommendationBanner",()=>p])},722434,e=>{"use strict";var t=e.i(379492),r=e.i(384078),s=e.i(799126);function a(e,t,r){return Math.min(Math.max(e,t),r)}e.i(708883);var n=e.i(696057),o=e.i(494962);let i=(0,r.createContext)(null);function l({children:e,defaultSpeed:l=1}){let[c,d]=(0,r.useState)({isVisible:!1,isLoading:!1,isPlaying:!1,duration:0,currentTime:0,speed:a(l??1,.5,2),sourceMessageId:void 0,previewText:"",totalChunks:0,currentChunk:0,isStreaming:!1}),u=function(e={}){let{defaultSpeed:t=1,onTimeUpdate:s,onEnded:n,onError:o}=e,i=(0,r.useRef)(null),l=(0,r.useRef)(null),c=(0,r.useRef)(null),d=(0,r.useRef)([]),u=(0,r.useRef)(!1),m=(0,r.useRef)(null),p=(0,r.useRef)(a(t,.5,2)),x=(0,r.useRef)(null),h=(0,r.useCallback)(()=>{if(!c.current||c.current.updating||0===d.current.length)return;let e=d.current.shift();if(e)try{c.current.appendBuffer(e)}catch(e){console.error("MSE appendBuffer failed",e)}},[]),g=(0,r.useCallback)(()=>{if(i.current&&(i.current.pause(),i.current.removeAttribute("src"),i.current.load()),m.current&&(URL.revokeObjectURL(m.current),m.current=null),l.current){try{"open"===l.current.readyState&&l.current.endOfStream()}catch(e){}l.current=null}c.current=null,d.current=[],u.current=!1,x.current&&(x.current.abort(),x.current=null)},[]),f=(0,r.useCallback)(async()=>{g(),x.current=new AbortController;let e=new MediaSource;l.current=e;let t=URL.createObjectURL(e);m.current=t;let r=new Audio;return r.src=t,i.current=r,r.playbackRate=p.current,"preservesPitch"in r&&(r.preservesPitch=!0),r.ontimeupdate=()=>{s?.(r.currentTime,r.duration)},r.onended=()=>{n?.()},r.onerror=e=>{console.error("Audio error",e),"string"!=typeof e&&e instanceof Event&&o?.(e)},await new Promise(t=>{e.addEventListener("sourceopen",()=>{try{let r=e.addSourceBuffer("audio/mpeg");c.current=r,r.addEventListener("updateend",()=>{h()}),t()}catch(e){console.error("MSE addSourceBuffer failed",e),t()}},{once:!0})}),c.current?r:null},[g,h,s,n,o]),v=(0,r.useCallback)(e=>{d.current.push(e),h()},[h]),b=(0,r.useCallback)(()=>{let e=setInterval(()=>{if(x.current?.signal.aborted)return void clearInterval(e);if(0===d.current.length&&c.current&&!c.current.updating){if(l.current&&"open"===l.current.readyState)try{l.current.endOfStream()}catch(e){}clearInterval(e)}},500)},[]),j=(0,r.useCallback)(async()=>{i.current&&await i.current.play()},[]),y=(0,r.useCallback)(()=>{i.current&&i.current.pause()},[]),w=(0,r.useCallback)(async()=>{i.current&&await i.current.play()},[]),N=(0,r.useCallback)(()=>{g()},[g]),k=(0,r.useCallback)(e=>{if(!i.current)return;let t=a((i.current.currentTime||0)+e,0,i.current.duration||1/0);Number.isFinite(t)&&(i.current.currentTime=t)},[]),_=(0,r.useCallback)(e=>{if(!i.current)return;let t=a(e,0,i.current.duration||1/0);Number.isFinite(t)&&(i.current.currentTime=t)},[]),C=(0,r.useCallback)(e=>{let t=a(e,.5,2);return p.current=t,i.current&&(i.current.playbackRate=t,"preservesPitch"in i.current&&(i.current.preservesPitch=!0)),t},[]);return{initializeAudio:f,appendBuffer:v,endStream:b,play:j,pause:y,resume:w,stop:N,seekBy:k,seekTo:_,setSpeed:C,cleanupAudio:g,getAbortSignal:(0,r.useCallback)(()=>x.current?.signal,[]),isAborted:(0,r.useCallback)(()=>x.current?.signal.aborted??!1,[]),speedRef:p}}({defaultSpeed:l,onTimeUpdate:(e,t)=>{d(r=>({...r,currentTime:e,duration:t}))},onEnded:()=>{d(e=>({...e,isPlaying:!1,isStreaming:!1})),n.analytics.track("tts_playback_completed",{playbackDurationMs:1e3*c.duration})},onError:e=>{console.error("Audio error",e)}});(0,r.useEffect)(()=>{let e=a(l??1,.5,2);u.setSpeed(e),d(t=>({...t,speed:e}))},[l,u.setSpeed]),(0,r.useEffect)(()=>()=>{u.cleanupAudio()},[u.cleanupAudio]);let m=(0,r.useCallback)(()=>{u.cleanupAudio(),d(e=>({...e,isVisible:!1,isPlaying:!1,isLoading:!1,currentTime:0,duration:0,sourceMessageId:void 0,previewText:"",totalChunks:0,currentChunk:0,isStreaming:!1}))},[u]),p=(0,r.useCallback)(async({text:e,messageId:t})=>{let r=function(e){let t=e??"";if(!t.trim())return"";try{let e=o.marked.parse(t),r="undefined"!=typeof document?document.createElement("div"):null;if(r)return r.innerHTML="string"==typeof e?e:String(e),(r.textContent||r.innerText||r.innerHTML).replace(/\s+/g," ").trim()}catch(e){console.error("Failed to strip markdown for TTS:",e)}return t.replace(/[`*_>#[\]()-]/g," ").replace(/\s+/g," ").trim()}(e);if(!r)return void s.toast.error("This message is empty after removing formatting.");let a=function(e,t=200){if(e.length<=t)return[e];let r=[],s=e;for(;s.length>0;){if(s.length<=t){r.push(s);break}let e=t,a=s.slice(0,t),n=Math.max(a.lastIndexOf(". "),a.lastIndexOf("! "),a.lastIndexOf("? "),a.lastIndexOf(".\n"),a.lastIndexOf("!\n"),a.lastIndexOf("?\n"));if(n>.3*t)e=n+1;else{let r=a.lastIndexOf(", ");if(r>.3*t)e=r+1;else{let r=a.lastIndexOf(" ");r>.3*t&&(e=r)}}r.push(s.slice(0,e).trim()),s=s.slice(e).trim()}return r.filter(e=>e.length>0)}(r),i=a.length;if(d(e=>({...e,isVisible:!0,isLoading:!0,isPlaying:!1,sourceMessageId:t,previewText:r.slice(0,220),currentTime:0,duration:0,totalChunks:i,currentChunk:0,isStreaming:i>1})),!await u.initializeAudio())return void s.toast.error("Browser does not support streaming audio playback.");try{await u.play(),d(e=>({...e,isPlaying:!0})),n.analytics.track("tts_initiated",{messageLength:r.length,voiceUsed:"default"});for(let e=0;e<a.length&&!u.isAborted();e++){d(t=>({...t,currentChunk:e+1}));let t=a[e],r=function(e,t,r){let s="https://intent-coyote-706.convex.cloud",a="",n=(a=s.includes(".convex.cloud")?s.replace(".convex.cloud",".convex.site"):s)?`${a}/tts`:"/tts",o=new URL(n,window.location.origin);return o.searchParams.set("text",e),t&&o.searchParams.set("voice",t),r&&o.searchParams.set("speed",r.toString()),o.toString()}(t,void 0,u.speedRef.current),s=await fetch(r,{signal:u.getAbortSignal()});if(!s.ok){console.error("TTS Fetch failed",s.status,s.statusText);continue}let n=await s.arrayBuffer();if(u.isAborted())break;u.appendBuffer(n),0===e&&d(e=>({...e,isLoading:!1}))}u.endStream(),d(e=>({...e,isLoading:!1}))}catch(e){if(u.isAborted())return;console.error("TTS error:",e),s.toast.error("Failed to stream audio"),u.cleanupAudio()}},[u]),x=(0,r.useCallback)(()=>{u.pause(),d(e=>({...e,isPlaying:!1}))},[u]),h=(0,r.useCallback)(async()=>{await u.resume(),d(e=>({...e,isPlaying:!0}))},[u]),g=(0,r.useCallback)(()=>{u.stop(),d(e=>({...e,isPlaying:!1,currentTime:0,currentChunk:0,isStreaming:!1}))},[u]),f=(0,r.useCallback)(e=>{u.seekBy(e)},[u]),v=(0,r.useCallback)(e=>{u.seekTo(e)},[u]),b=(0,r.useCallback)(e=>{let t=u.setSpeed(e);d(e=>({...e,speed:t}))},[u]);return(0,t.jsx)(i.Provider,{value:{state:c,playFromText:p,pause:x,resume:h,stop:g,seekBy:f,seekTo:v,setSpeed:b,close:m},children:e})}function c(){let e=(0,r.useContext)(i);if(!e)throw Error("useTTSPlayer must be used within TTSProvider");return e}e.s(["TTSProvider",()=>l,"useTTSPlayer",()=>c],722434)},755407,834507,834022,806831,445309,e=>{"use strict";var t=e.i(283164);e.i(977101);var r=e.i(727630),s=e.i(384078),a=e.i(799126);function n({messageId:e,conversationId:n,content:o,isFocused:i,isUser:l,isGenerating:c,readOnly:d,messageRef:u}){let m=(0,r.useMutation)(t.api.chat.deleteMessage),p=(0,r.useMutation)(t.api.bookmarks.create);(0,s.useEffect)(()=>{if(!i||d)return;let t=async t=>{let r=t.target;if("INPUT"===r.tagName||"TEXTAREA"===r.tagName||"true"===r.getAttribute("contenteditable"))return;let s=t.metaKey||t.ctrlKey;switch(t.key.toLowerCase()){case"r":if(!l&&!c&&!s){t.preventDefault();let r=new CustomEvent("open-regenerate-model-selector",{detail:{messageId:e}});window.dispatchEvent(r)}break;case"b":if(!s){t.preventDefault();try{await p({conversationId:n,messageId:e}),a.toast.success("Message bookmarked")}catch(e){a.toast.error("Failed to bookmark")}}break;case"c":s||(t.preventDefault(),await navigator.clipboard.writeText(o),a.toast.success("Copied to clipboard"));break;case"n":if(!s){t.preventDefault();let r=new CustomEvent("save-message-as-note",{detail:{messageId:e}});window.dispatchEvent(r)}break;case"delete":case"backspace":if(!s){t.preventDefault();try{await m({messageId:e});let t=u.current?.parentElement?.nextElementSibling?.querySelector('[tabindex="0"]');t?.focus(),a.toast.success("Message deleted")}catch(e){a.toast.error("Failed to delete")}}}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[i,d,l,c,e,n,o,p,m,u])}function o(e){return e<100?`${Math.round(e)}ms`:e<1e3?`${(e/1e3).toFixed(2)}s`:e<1e4?`${(e/1e3).toFixed(1)}s`:`${Math.round(e/1e3)}s`}function i(e){if(e<1)return"<1ms";if(e<1e3)return`${Math.round(e)}ms`;let t=e/1e3;if(t<10)return`${t.toFixed(1)}s`;if(t<60)return`${Math.round(t)}s`;let r=Math.floor(t/60),s=Math.round(t%60);return 0===s?`${r}m`:`${r}m ${s}s`}function l(e){return e<50}e.s(["useMessageKeyboardShortcuts",()=>n],755407),e.s(["formatDuration",()=>i,"formatTTFT",()=>o,"isCachedResponse",()=>l],834507);var c=e.i(379492),d=e.i(152088),u=e.i(359548),m=e.i(755430);let p=(0,m.default)("file-code",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}]]);e.s(["FileCode",()=>p],834022);var x=e.i(462957),h=e.i(650430);function g({documentId:e,title:t,documentType:r,language:s,version:a,lineCount:n,className:o}){let{documentId:i,setDocumentId:l}=(0,h.useCanvasContext)(),m=i===e,g="code"===r?p:x.FileText;return(0,c.jsxs)("button",{type:"button",onClick:()=>{m?l(null):l(e)},className:(0,d.cn)("flex items-center gap-3 p-3 rounded-lg border bg-card","hover:bg-accent/50 transition-colors w-full max-w-sm text-left",m&&"ring-2 ring-primary/50 border-primary/50",o),children:[(0,c.jsx)("div",{className:(0,d.cn)("p-2 rounded-md","code"===r?"bg-blue-500/10":"bg-amber-500/10"),children:(0,c.jsx)(g,{className:(0,d.cn)("h-4 w-4","code"===r?"text-blue-500":"text-amber-500")})}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsx)("div",{className:"font-medium text-sm truncate",children:t}),(0,c.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-1.5",children:[(0,c.jsx)("span",{children:s??("code"===r?"Code":"Document")}),a&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{className:"text-muted-foreground/50",children:"·"}),(0,c.jsxs)("span",{children:["v",a]})]}),n&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{className:"text-muted-foreground/50",children:"·"}),(0,c.jsxs)("span",{children:[n," lines"]})]})]})]}),(0,c.jsx)(u.ChevronRight,{className:(0,d.cn)("h-4 w-4 text-muted-foreground transition-transform shrink-0",m&&"rotate-90")})]})}function f({messageId:e,className:a}){let n="string"==typeof e&&e.startsWith("temp-"),o=(0,r.useQuery)(t.api.messages.toolCalls.getToolCalls,n?"skip":{messageId:e}),i=(0,s.useMemo)(()=>o?o.filter(e=>{if(!["createDocument","updateDocument"].includes(e.name))return!1;try{let t=e.result?JSON.parse(e.result):null;return t?.success&&t?.documentId}catch{return!1}}).map(e=>{let t=e.arguments?JSON.parse(e.arguments):{},r=e.result?JSON.parse(e.result):{};return{id:e.id,toolName:e.name,documentId:r.documentId,title:t.title??"Document",documentType:t.documentType??"prose",language:t.language,version:r.newVersion??1,lineCount:r.lineCount}}):[],[o]);return 0===i.length?null:(0,c.jsx)("div",{className:(0,d.cn)("mt-3 flex flex-wrap gap-2",a),children:i.map(e=>(0,c.jsx)(g,{documentId:e.documentId,title:e.title,documentType:e.documentType,language:e.language,version:e.version,lineCount:e.lineCount},e.id))})}e.s(["ArtifactList",()=>f],806831);var v=e.i(165002),b=e.i(681599),j=e.i(907347);function y({attachments:e}){return e&&0!==e.length?(0,c.jsx)("div",{className:"flex gap-2 mt-2 flex-wrap",children:e.map((e,t)=>(0,c.jsxs)(j.Badge,{variant:"secondary",className:"flex items-center gap-1.5 py-1 px-2",children:["image"===e.type?(0,c.jsx)(b.ImageIcon,{className:"w-3 h-3"}):(0,c.jsx)(v.FileIcon,{className:"w-3 h-3"}),(0,c.jsx)("span",{className:"text-xs truncate max-w-[120px]",children:e.name}),(0,c.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",(e.size/1024).toFixed(0),"KB)"]})]},t))}):null}var w=e.i(403950),N=e.i(985902);function k({url:e,alt:t,onClick:r}){let[a,n]=(0,s.useState)(!1);return(0,c.jsxs)("button",{type:"button",onClick:r,className:(0,d.cn)("relative overflow-hidden rounded-md","w-48 h-48 aspect-square","bg-surface-glass border border-border/20","hover:border-border/40 hover:scale-105","transition-all duration-200","cursor-pointer","focus:outline-none focus:ring-2 focus:ring-primary/50"),"aria-label":`View ${t}`,children:[!a&&(0,c.jsx)("div",{className:"absolute inset-0 bg-surface-glass animate-pulse"}),(0,c.jsx)("img",{src:e,alt:t,loading:"lazy",className:(0,d.cn)("w-full h-full object-cover","transition-opacity duration-200",a?"opacity-100":"opacity-0"),onLoad:()=>n(!0)})]})}function _({images:e,onImageClick:t}){let[r,a]=(0,s.useState)(!1),n=r?e:e.slice(0,4),o=e.length-4;return(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsx)(w.motion.div,{className:`grid gap-2 ${e.length>=3?"grid-cols-1 sm:grid-cols-2":"grid-cols-1"}`,variants:{container:{transition:{staggerChildren:.05}}},initial:"container",animate:"container",children:n.map((e,r)=>(0,c.jsx)(w.motion.div,{variants:{container:{opacity:0,scale:.8},item:{opacity:1,scale:1}},initial:"container",animate:"item",transition:{duration:.2},children:(0,c.jsx)(k,{url:e.url,alt:e.name,onClick:()=>t(r)})},e.storageId))}),!r&&o>0&&(0,c.jsxs)(N.Button,{variant:"outline",size:"sm",onClick:()=>a(!0),className:"w-full text-xs",children:["Show ",o," more ",1===o?"image":"images"]})]})}var C=e.i(813038),S=e.i(543621),M=e.i(278894);let T=(0,m.default)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var $=e.i(985612),A=e.i(328299),D=e.i(547608);let E=[100,150,200];function I({images:e,initialIndex:t,open:r,onClose:a}){let[n,o]=(0,s.useState)(t),[i,l]=(0,s.useState)(0),[m,p]=(0,s.useState)(0),x=e[n],h=e.length>1,g=()=>{p(1),o(t=>(t+1)%e.length)},f=()=>{p(-1),o(t=>(t-1+e.length)%e.length)},v=()=>{l(e=>Math.min(e+1,E.length-1))},b=()=>{l(e=>Math.max(e-1,0))};(0,s.useEffect)(()=>{l(0)},[]),(0,s.useEffect)(()=>{o(t)},[t]),(0,s.useEffect)(()=>{if(!r)return;let e=e=>{"Escape"===e.key?a():"ArrowLeft"===e.key&&h?f():"ArrowRight"===e.key&&h?g():"+"===e.key||"="===e.key?v():("-"===e.key||"_"===e.key)&&b()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r,h,g,f,a,v,b]);let j=async()=>{try{let e=await fetch(x.url),t=await e.blob(),r=window.URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download=x.name,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(r)}catch(e){console.error("Download failed:",e)}};return(0,c.jsx)(D.Dialog,{open:r,onOpenChange:a,children:(0,c.jsxs)(D.DialogContent,{className:(0,d.cn)("!max-w-none w-screen h-screen max-h-screen","p-0 border-0 rounded-none","bg-black/95 backdrop-blur-md"),showCloseButton:!1,children:[(0,c.jsx)(D.DialogTitle,{className:"sr-only",children:"Image Viewer"}),(0,c.jsx)(N.Button,{variant:"ghost",size:"icon",onClick:a,className:"absolute top-4 right-4 z-50 text-white hover:bg-white/10","aria-label":"Close",children:(0,c.jsx)(A.X,{className:"w-5 h-5"})}),(0,c.jsxs)("div",{className:"absolute top-4 right-16 z-50 flex gap-2",children:[(0,c.jsx)(N.Button,{variant:"ghost",size:"icon",onClick:b,disabled:0===i,className:"text-white hover:bg-white/10 disabled:opacity-30","aria-label":"Zoom out",children:(0,c.jsx)(T,{className:"w-5 h-5"})}),(0,c.jsxs)("div",{className:"flex items-center px-3 text-white text-sm bg-white/10 rounded-md",children:[E[i],"%"]}),(0,c.jsx)(N.Button,{variant:"ghost",size:"icon",onClick:v,disabled:i===E.length-1,className:"text-white hover:bg-white/10 disabled:opacity-30","aria-label":"Zoom in",children:(0,c.jsx)($.Plus,{className:"w-5 h-5"})}),(0,c.jsx)(N.Button,{variant:"ghost",size:"icon",onClick:j,className:"text-white hover:bg-white/10","aria-label":"Download",children:(0,c.jsx)(M.Download,{className:"w-5 h-5"})})]}),(0,c.jsx)("div",{className:"flex items-center justify-center w-full h-full overflow-auto p-4",children:(0,c.jsx)(C.AnimatePresence,{mode:"wait",custom:m,children:(0,c.jsx)(w.motion.div,{className:"flex items-center justify-center min-w-full min-h-full",custom:m,initial:{opacity:0,x:100*m},animate:{opacity:1,x:0},exit:{opacity:0,x:-100*m},transition:{duration:.2},children:(0,c.jsx)("img",{src:x.url,alt:x.name,className:"object-contain",style:{maxWidth:0===i?"100%":"none",maxHeight:0===i?"100%":"none",width:i>0?`${E[i]}%`:"auto",height:"auto",transition:"all 0.2s ease-out"}})},n)})}),h&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(N.Button,{variant:"ghost",size:"icon",onClick:f,className:"absolute left-4 top-1/2 -translate-y-1/2 text-white hover:bg-white/10 w-12 h-12","aria-label":"Previous image",children:(0,c.jsx)(S.ChevronLeft,{className:"w-8 h-8"})}),(0,c.jsx)(N.Button,{variant:"ghost",size:"icon",onClick:g,className:"absolute right-4 top-1/2 -translate-y-1/2 text-white hover:bg-white/10 w-12 h-12","aria-label":"Next image",children:(0,c.jsx)(u.ChevronRight,{className:"w-8 h-8"})})]}),h&&(0,c.jsxs)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 bg-white/10 backdrop-blur-sm rounded-full text-white text-sm",children:[n+1," / ",e.length]})]})})}function q({attachments:e,urls:t}){let[r,a]=(0,s.useState)(!1),[n,o]=(0,s.useState)(0),i=e.filter(e=>"image"===e.type),l=e.filter(e=>"image"!==e.type),d=i.map(e=>({storageId:e.storageId,url:t.get(e.storageId)||"",name:e.name})).filter(e=>e.url);return(0,c.jsxs)(c.Fragment,{children:[d.length>0&&(0,c.jsx)(_,{images:d,onImageClick:e=>{o(e),a(!0)}}),l.length>0&&(0,c.jsx)(y,{attachments:l}),d.length>0&&(0,c.jsx)(I,{images:d,initialIndex:n,open:r,onClose:()=>a(!1)})]})}e.s(["AttachmentRenderer",()=>q],445309)},261386,603658,255108,210882,e=>{"use strict";var t=e.i(755430);let r=(0,t.default)("bookmark-plus",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"12",x2:"12",y1:"7",y2:"13",key:"1cppfj"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]]);e.s(["BookmarkPlus",()=>r],261386);let s=(0,t.default)("calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);e.s(["Calculator",()=>s],603658);let a=(0,t.default)("cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);e.s(["Cloud",()=>a],255108);let n=(0,t.default)("folder-tree",[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]]);e.s(["FolderTree",()=>n],210882)},607199,e=>{"use strict";var t=e.i(379492),r=e.i(384078),s=e.i(833250),a=e.i(813038),n=e.i(403950),o=e.i(310165),i=e.i(261386),l=e.i(603658),c=e.i(560532),d=e.i(87056),u=e.i(755003),m=e.i(141477),p=e.i(359548),x=e.i(255108),h=e.i(455236),g=e.i(266796),f=e.i(644163),v=e.i(532314),b=e.i(462957),j=e.i(210882),y=e.i(336158),w=e.i(2138),N=e.i(134092),k=e.i(33928),_=e.i(79721);function C(e){if(!e.result)return Date.now()-e.timestamp>3e4?"error":"executing";try{let t=JSON.parse(e.result);if(t.error||!1===t.success)return"error"}catch{}return"complete"}var S=e.i(828982),M=e.i(834022),T=e.i(907347);function $({call:e,parsedArgs:r,parsedResult:s,state:a,ToolIcon:n}){return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:"font-medium text-muted-foreground",children:e.name||"Unknown tool"})]}),r&&(0,t.jsxs)("div",{className:"text-muted-foreground",children:[(0,t.jsx)("div",{className:"text-[11px] font-medium mb-1",children:"Arguments:"}),(0,t.jsx)("pre",{className:"text-[10px] bg-muted p-2 rounded overflow-x-auto whitespace-pre-wrap",children:JSON.stringify(r,null,2)})]}),s&&"executing"!==a&&(0,t.jsxs)("div",{className:"text-muted-foreground",children:[(0,t.jsx)("div",{className:"text-[11px] font-medium mb-1",children:"Result:"}),(0,t.jsx)("pre",{className:"text-[10px] bg-muted p-2 rounded max-h-48 overflow-y-auto whitespace-pre-wrap",children:JSON.stringify(s,null,2)})]})]})}var A=e.i(773492),D=e.i(212323);function E({parsedArgs:e,parsedResult:r,state:s,ToolIcon:a}){let n=r?.results||[],o=r?.answer;return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsxs)("span",{className:"font-mono text-muted-foreground",children:['"',e?.query,'"']})]}),r&&"executing"!==s&&(0,t.jsxs)("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:[o&&(0,t.jsx)("div",{className:"py-1.5 px-2 bg-muted/50 rounded-md border border-border/50",children:(0,t.jsx)("p",{className:"text-muted-foreground text-[11px] leading-relaxed",children:o})}),n.slice(0,5).map((e,r)=>(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"font-medium text-primary hover:underline",children:e.title}),(0,t.jsxs)("p",{className:"text-muted-foreground text-[11px] line-clamp-2",children:[e.content?.substring(0,150),e.content&&e.content.length>150?"...":""]})]},r)),0===n.length&&!o&&(0,t.jsx)("div",{className:"text-muted-foreground",children:"No results found"})]})]})}let I={saveMemory:function({parsedArgs:e,parsedResult:r,state:s,ToolIcon:a}){return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:"font-medium text-muted-foreground",children:"executing"===s?"Saving...":r?.success?"Saved":r?.duplicate?"Already exists":"Failed"})]}),(0,t.jsx)("div",{className:"text-muted-foreground",children:e?.content&&(0,t.jsxs)("span",{className:"italic",children:['"',e.content,'"']})}),r?.message&&"executing"!==s&&(0,t.jsx)("div",{className:r.success?"text-green-500":"text-amber-500",children:r.message})]})},searchMemories:function({parsedArgs:e,parsedResult:r,state:s,ToolIcon:a}){return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:"font-mono text-muted-foreground",children:e?.query})]}),r&&(0,t.jsxs)("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:[r.memories?.map((e,r)=>(0,t.jsxs)("div",{className:"py-0.5",children:[(0,t.jsxs)("span",{className:"font-medium text-primary",children:["[",e.category,"]"]})," ",(0,t.jsx)("span",{className:"text-muted-foreground",children:e.content})]},r)),0===r.found&&(0,t.jsx)("div",{className:"text-muted-foreground",children:"No memories found"}),"error"===s&&(0,t.jsx)("div",{className:"text-red-500",children:r.error||"Tool execution failed"})]})]})},webSearch:E,tavilySearch:E,tavilyAdvancedSearch:E,calculator:function({parsedArgs:e,parsedResult:r,state:s,ToolIcon:a}){return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:"font-mono text-muted-foreground",children:e?.expression})]}),r&&"executing"!==s&&(0,t.jsxs)("div",{className:"font-semibold text-primary",children:["= ",r.result]})]})},datetime:function({parsedArgs:e,parsedResult:r,state:s,ToolIcon:a}){return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:[e?.operation,e?.timezone&&` (${e.timezone})`]})]}),r&&"executing"!==s&&(0,t.jsx)("div",{className:"font-medium",children:r.formatted||r.readable})]})},urlReader:function({parsedArgs:e,parsedResult:r,state:s,ToolIcon:a}){let n=r?.content||"",o=n.substring(0,500);return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("a",{href:e?.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline truncate",children:e?.url})]}),r&&"executing"!==s&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"text-muted-foreground text-[11px]",children:[r.wordCount," words"]}),(0,t.jsx)("div",{className:"max-h-48 overflow-y-auto text-muted-foreground",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap font-sans text-[11px]",children:n.length>500?`${o}...`:n})})]})]})},codeExecution:function({parsedArgs:e,parsedResult:r,state:s,ToolIcon:a}){let n=r?.success===!1,o=r?.images;return(0,t.jsxs)("div",{className:"text-xs space-y-2 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:e?.language||"Code"}),n&&(0,t.jsx)("span",{className:"text-red-500 text-[10px]",children:"Failed"})]}),e?.code&&(0,t.jsx)("pre",{className:"bg-muted p-2 rounded text-[11px] overflow-x-auto max-h-32 overflow-y-auto",children:(0,t.jsx)("code",{children:e.code})}),r&&"executing"!==s&&(0,t.jsxs)("div",{className:"space-y-2",children:[o&&o.length>0&&(0,t.jsx)("div",{className:"space-y-2",children:o.map((e,r)=>(console.log("[CodeExecution] Rendering image:",e),e.url)?(0,t.jsx)("div",{className:"rounded overflow-hidden border border-border/40 bg-white",children:(0,t.jsx)("img",{src:e.url,alt:`Code execution output ${r+1}`,className:"w-full h-auto block",loading:"lazy",onError:t=>{console.error("[CodeExecution] Image failed to load:",e.url),t.target.style.display="none"}})},e.storageId||r):(0,t.jsxs)("div",{className:"p-2 bg-yellow-500/10 text-yellow-600 rounded text-[11px]",children:["Image ",r+1,": URL not available"]},r))}),(0,t.jsx)("div",{className:"text-muted-foreground",children:n?"Error:":"Output:"}),(0,t.jsx)("pre",{className:`p-2 rounded text-[11px] max-h-48 overflow-y-auto ${n?"bg-red-500/10 text-red-500":"bg-muted"}`,children:(0,t.jsx)("code",{children:(()=>{if(!r)return null;if(!1===r.success&&r.error)return r.error;let e=[];if(r.stdout&&e.push(r.stdout),r.stderr&&e.push(r.stderr),r.result){let t="string"==typeof r.result?r.result:JSON.stringify(r.result,null,2);t&&t!==e.join("\n")&&e.push(`Result: ${t}`)}return e.join("\n")||"(no output)"})()})}),r.executionTime&&!n&&(0,t.jsxs)("div",{className:"text-muted-foreground text-[11px]",children:["Executed in ",r.executionTime,"ms"]})]})]})},weather:function({parsedArgs:e,parsedResult:r,state:s,ToolIcon:a}){let n=r?.current,o=r?.units==="fahrenheit"?"°F":"°C";return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:e?.location})]}),n&&"executing"!==s&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"font-semibold",children:[n.temperature,o," • ",n.condition]}),n.feelsLike&&(0,t.jsxs)("div",{className:"text-muted-foreground",children:["Feels like ",n.feelsLike,o]}),r.forecast&&(0,t.jsx)("div",{className:"text-muted-foreground text-[11px]",children:r.forecast})]})]})},fileDocument:function({parsedResult:e,state:r,ToolIcon:s}){return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(s,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:"font-medium",children:e?.fileName||"Document"})]}),e&&"executing"!==r&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"text-muted-foreground text-[11px]",children:[e.wordCount," words"]}),e.content&&(0,t.jsx)("div",{className:"max-h-48 overflow-y-auto bg-muted p-2 rounded",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap font-sans text-[11px]",children:e.content})})]})]})},projectContext:function({parsedArgs:e,parsedResult:r,state:s,ToolIcon:a}){let n=e?.section||"context",o=r?.items||[];return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:[r?.project?.name," • ",n]})]}),o.length>0&&"executing"!==s&&(0,t.jsx)("div",{className:"max-h-48 overflow-y-auto space-y-1",children:o.map((e,r)=>(0,t.jsxs)("div",{className:"text-muted-foreground",children:["• ",e.title||e.name||e.content?.substring(0,50)]},r))})]})},deleteMemory:function({parsedResult:e,state:r,ToolIcon:s}){return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(s,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:e?.success?"text-green-500":"text-red-500",children:e?.success?"Deleted":"Failed to delete"})]}),e?.message&&"executing"!==r&&(0,t.jsx)("div",{className:"text-muted-foreground",children:e.message})]})},searchNotes:function({parsedArgs:e,parsedResult:r,state:s,ToolIcon:a}){let n=r?.results||[];return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsxs)("span",{className:"font-mono text-muted-foreground",children:['"',e?.query,'"']}),r?.totalResults!==void 0&&"executing"!==s&&(0,t.jsxs)("span",{className:"text-muted-foreground text-[10px]",children:["(",r.totalResults," found)"]})]}),r&&"executing"!==s&&(0,t.jsxs)("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:[n.slice(0,5).map((e,r)=>(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsx)("a",{href:e.url,className:"font-medium text-primary hover:underline",children:e.title||"Untitled"}),e.tags?.length>0&&(0,t.jsx)("span",{className:"ml-2 text-[10px] text-muted-foreground",children:e.tags.slice(0,3).map(e=>`#${e}`).join(" ")}),(0,t.jsxs)("p",{className:"text-muted-foreground text-[11px] line-clamp-2",children:[e.preview?.substring(0,150),e.preview&&e.preview.length>150?"...":""]})]},r)),0===n.length&&(0,t.jsx)("div",{className:"text-muted-foreground",children:"No notes found"})]})]})},searchTasks:function({parsedArgs:e,parsedResult:r,state:s,ToolIcon:a}){let n=r?.results||[];return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsxs)("span",{className:"font-mono text-muted-foreground",children:['"',e?.query,'"']}),r?.totalResults!==void 0&&"executing"!==s&&(0,t.jsxs)("span",{className:"text-muted-foreground text-[10px]",children:["(",r.totalResults," found)"]})]}),r&&"executing"!==s&&(0,t.jsxs)("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:[n.slice(0,5).map((e,r)=>(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("a",{href:e.url,className:"font-medium text-primary hover:underline",children:e.title}),(0,t.jsx)("span",{className:`text-[10px] ${(e=>{switch(e){case"completed":return"text-green-500";case"in_progress":return"text-blue-500";case"blocked":return"text-red-500";default:return"text-muted-foreground"}})(e.status)}`,children:e.status?.replace("_"," ")}),e.urgency&&"medium"!==e.urgency&&(0,t.jsx)("span",{className:`text-[9px] px-1 rounded ${(e=>{switch(e){case"urgent":return"bg-red-500/20 text-red-500";case"high":return"bg-orange-500/20 text-orange-500";case"medium":return"bg-yellow-500/20 text-yellow-500";default:return"bg-muted text-muted-foreground"}})(e.urgency)}`,children:e.urgency})]}),e.deadline&&(0,t.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:["Due: ",new Date(e.deadline).toLocaleDateString()]}),e.description&&(0,t.jsx)("p",{className:"text-muted-foreground text-[11px] line-clamp-1",children:e.description})]},r)),0===n.length&&(0,t.jsx)("div",{className:"text-muted-foreground",children:"No tasks found"})]})]})},searchFiles:function({parsedArgs:e,parsedResult:r,state:s,ToolIcon:a}){let n=r?.results||[];return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsxs)("span",{className:"font-mono text-muted-foreground",children:['"',e?.query,'"']}),r?.totalResults!==void 0&&"executing"!==s&&(0,t.jsxs)("span",{className:"text-muted-foreground text-[10px]",children:["(",r.totalResults," found)"]})]}),r&&"executing"!==s&&(0,t.jsxs)("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:[n.slice(0,5).map((e,r)=>(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[e.url?(0,t.jsx)("a",{href:e.url,className:"font-medium text-primary hover:underline",children:e.filename}):(0,t.jsx)("span",{className:"font-medium text-foreground",children:e.filename}),void 0!==e.page&&(0,t.jsxs)("span",{className:"text-[10px] text-muted-foreground bg-muted px-1 rounded",children:["p.",e.page]}),e.score&&(0,t.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:[(100*parseFloat(e.score)).toFixed(0),"%"]})]}),(0,t.jsxs)("p",{className:"text-muted-foreground text-[11px] line-clamp-2 font-mono bg-muted/50 p-1 rounded mt-0.5",children:[e.content?.substring(0,200),e.content&&e.content.length>200?"...":""]})]},r)),0===n.length&&(0,t.jsx)("div",{className:"text-muted-foreground",children:"No files found"})]})]})},queryHistory:function({parsedArgs:e,parsedResult:r,state:s,ToolIcon:a}){let n=r?.results||[];return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsxs)("span",{className:"font-mono text-muted-foreground",children:['"',e?.query,'"']}),r?.totalResults!==void 0&&"executing"!==s&&(0,t.jsxs)("span",{className:"text-muted-foreground text-[10px]",children:["(",r.totalResults," found)"]})]}),r&&"executing"!==s&&(0,t.jsxs)("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:[n.slice(0,5).map((e,r)=>(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("a",{href:e.url,className:"font-medium text-primary hover:underline truncate max-w-[200px]",children:e.conversationTitle||"Untitled conversation"}),(0,t.jsx)("span",{className:`text-[10px] ${(e=>{switch(e){case"user":return"text-blue-500";case"assistant":return"text-green-500";default:return"text-muted-foreground"}})(e.role)}`,children:(e=>{switch(e){case"user":return"You";case"assistant":return"Assistant";case"system":return"System";default:return e}})(e.role)}),e.timestamp&&(0,t.jsx)("span",{className:"text-[10px] text-muted-foreground",children:new Date(e.timestamp).toLocaleDateString()})]}),(0,t.jsxs)("p",{className:"text-muted-foreground text-[11px] line-clamp-2",children:[e.content?.substring(0,150),e.content&&e.content.length>150?"...":""]})]},r)),0===n.length&&(0,t.jsx)("div",{className:"text-muted-foreground",children:"No conversations found"})]})]})},searchAll:function({parsedArgs:e,parsedResult:r,state:s,ToolIcon:a}){let n=[];r?.notes?.results&&r.notes.results.forEach(e=>{n.push({type:"notes",item:e})}),r?.tasks?.results&&r.tasks.results.forEach(e=>{n.push({type:"tasks",item:e})}),r?.files?.results&&r.files.results.forEach(e=>{n.push({type:"files",item:e})}),r?.conversations?.results&&r.conversations.results.forEach(e=>{n.push({type:"conversations",item:e})});let o={notes:r?.notes?.totalResults||0,tasks:r?.tasks?.totalResults||0,files:r?.files?.totalResults||0,conversations:r?.conversations?.totalResults||0},i=o.notes+o.tasks+o.files+o.conversations;return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsxs)("span",{className:"font-mono text-muted-foreground",children:['"',e?.query,'"']}),"executing"!==s&&i>0&&(0,t.jsxs)("span",{className:"text-muted-foreground text-[10px]",children:["(",i," total)"]})]}),r&&"executing"!==s&&(0,t.jsxs)("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:[n.slice(0,8).map(({type:e,item:r},s)=>(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:`text-[9px] px-1.5 py-0.5 rounded ${(e=>{switch(e){case"notes":return"bg-purple-500/20 text-purple-500";case"tasks":return"bg-blue-500/20 text-blue-500";case"files":return"bg-green-500/20 text-green-500";case"conversations":return"bg-orange-500/20 text-orange-500";default:return"bg-muted text-muted-foreground"}})(e)}`,children:(e=>{switch(e){case"notes":return"Note";case"tasks":return"Task";case"files":return"File";case"conversations":return"Chat";default:return e}})(e)}),r.url?(0,t.jsx)("a",{href:r.url,className:"font-medium text-primary hover:underline truncate max-w-[200px]",children:r.title||r.filename||r.conversationTitle||"Untitled"}):(0,t.jsx)("span",{className:"font-medium text-foreground truncate max-w-[200px]",children:r.title||r.filename||r.conversationTitle||"Untitled"})]}),(0,t.jsx)("p",{className:"text-muted-foreground text-[11px] line-clamp-1 pl-10",children:(r.preview||r.content||r.description||"")?.substring(0,100)})]},s)),0===n.length&&(0,t.jsx)("div",{className:"text-muted-foreground",children:"No results found"}),n.length>8&&(0,t.jsxs)("div",{className:"text-muted-foreground text-[10px] pt-1",children:["+",n.length-8," more results"]})]})]})},manageTasks:function({parsedArgs:e,parsedResult:r,state:s,ToolIcon:a}){let n,o,i=e?.operation||"unknown",l=(e,r=!0)=>(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[r&&e.url?(0,t.jsx)("a",{href:e.url,className:`font-medium ${"completed"===e.status?"line-through text-muted-foreground":"text-primary hover:underline"}`,children:e.title}):(0,t.jsx)("span",{className:`font-medium ${"completed"===e.status?"line-through text-muted-foreground":""}`,children:e.title}),(0,t.jsx)("span",{className:`text-[10px] ${(e=>{switch(e){case"completed":return"text-green-500";case"in_progress":return"text-blue-500";case"cancelled":return"text-red-500";default:return"text-muted-foreground"}})(e.status)}`,children:e.status?.replace("_"," ")}),e.urgency&&"medium"!==e.urgency&&(0,t.jsx)("span",{className:`text-[9px] px-1 rounded ${(e=>{switch(e){case"urgent":return"bg-red-500/20 text-red-500";case"high":return"bg-orange-500/20 text-orange-500";case"medium":return"bg-yellow-500/20 text-yellow-500";default:return"bg-muted text-muted-foreground"}})(e.urgency)}`,children:e.urgency})]}),e.deadline&&(0,t.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:["Due: ",new Date(e.deadline).toLocaleDateString()]})]});return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:`font-medium ${"executing"===s?"text-muted-foreground":r?.success?"complete"===i||"delete"===i?"text-green-500":"text-muted-foreground":"text-amber-500"}`,children:(()=>{if("executing"===s)switch(i){case"create":return"Creating task...";case"update":return"Updating task...";case"complete":return"Completing task...";case"delete":return e?.confirmDelete?"Deleting task...":"Finding task...";case"list":return"Loading tasks...";default:return"Processing..."}if(!r?.success)return r?.ambiguous?"Multiple matches found":r?.message||"Failed";switch(i){case"create":return"Created task";case"update":return"Updated task";case"complete":return"Completed";case"delete":return r?.deleted?"Deleted":"Found (confirm to delete)";case"list":return`${r?.totalCount||0} tasks`;default:return"Done"}})()})]}),"executing"!==s&&(0,t.jsxs)(t.Fragment,{children:[("create"===i||"update"===i||"complete"===i||"delete"===i&&!r?.ambiguous)&&r?.task&&(0,t.jsx)("div",{className:"mt-1",children:l(r.task)}),"delete"===i&&r?.pendingDelete&&(0,t.jsx)("div",{className:"text-[10px] text-amber-500 mt-1",children:"Awaiting confirmation..."}),r?.ambiguous&&(0===(n=r?.candidates||[]).length?null:(0,t.jsxs)("div",{className:"space-y-1 mt-1",children:[(0,t.jsx)("div",{className:"text-[10px] text-muted-foreground",children:"Please specify which task:"}),n.slice(0,5).map((e,r)=>(0,t.jsx)("div",{children:l(e)},r))]})),"list"===i&&(0===(o=r?.tasks||[]).length?(0,t.jsx)("div",{className:"text-muted-foreground text-[11px] mt-1",children:r?.message||"No tasks found"}):(0,t.jsx)("div",{className:"space-y-1.5 max-h-48 overflow-y-auto mt-1",children:o.slice(0,10).map((e,r)=>(0,t.jsx)("div",{children:l(e)},r))})),!r?.success&&r?.error&&(0,t.jsx)("div",{className:"text-amber-500 text-[11px]",children:r.message})]})]})},createDocument:function({parsedArgs:e,parsedResult:r,state:s}){let a=e?.documentType==="code"?M.FileCode:b.FileText;return"executing"===s?(0,t.jsxs)("div",{className:"text-xs flex items-center gap-2 text-muted-foreground py-1",children:[(0,t.jsx)(w.Loader2,{className:"h-3 w-3 animate-spin"}),(0,t.jsxs)("span",{children:['Creating "',e?.title,'"...']})]}):r&&!r.success?(0,t.jsxs)("div",{className:"text-xs text-destructive py-1",children:["Failed: ",r.error]}):r?.success?(0,t.jsxs)("div",{className:"text-xs flex items-center gap-2 py-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-green-500",children:[(0,t.jsx)(S.Check,{className:"h-3 w-3"}),(0,t.jsx)("span",{children:"Created"})]}),(0,t.jsx)("span",{className:"text-muted-foreground/50",children:"·"}),(0,t.jsx)(a,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-muted-foreground truncate max-w-[200px]",children:e?.title??"Document"}),e?.language&&(0,t.jsx)(T.Badge,{variant:"secondary",className:"h-4 text-[10px] px-1",children:e.language}),r.lineCount&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-muted-foreground/50",children:"·"}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:[r.lineCount," lines"]})]})]}):null},updateDocument:function({parsedArgs:e,parsedResult:r,state:s}){return"executing"===s?(0,t.jsxs)("div",{className:"text-xs flex items-center gap-2 text-muted-foreground py-1",children:[(0,t.jsx)(w.Loader2,{className:"h-3 w-3 animate-spin"}),(0,t.jsx)("span",{children:e?.changeDescription||"Updating document..."})]}):r&&!r.success?(0,t.jsxs)("div",{className:"text-xs text-destructive py-1",children:["Failed: ",r.error]}):r?.success?(0,t.jsxs)("div",{className:"text-xs flex items-center gap-2 py-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-green-500",children:[(0,t.jsx)(S.Check,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:["Updated to v",r.newVersion]})]}),e?.changeDescription&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-muted-foreground/50",children:"·"}),(0,t.jsx)(k.RefreshCw,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-muted-foreground truncate max-w-[200px]",children:e.changeDescription})]})]}):null},readDocument:function({parsedResult:e,state:r}){return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsx)("div",{className:"text-[10px] font-medium text-muted-foreground/70 uppercase tracking-wide mb-0.5",children:"Read Document"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f.Eye,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:"font-mono text-muted-foreground",children:"Reading document..."})]}),e&&"executing"!==r&&(0,t.jsx)("div",{className:"text-muted-foreground",children:e.hasDocument?(0,t.jsxs)("span",{children:[e.title||"Document"," • ",e.lineCount," ","lines"]}):(0,t.jsx)("span",{children:"No document open"})})]})},enterDocumentMode:function({parsedArgs:e,state:r,ToolIcon:s}){return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(s,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"executing"===r?"Entering document mode...":"Document mode active"})]}),e?.reason&&"executing"!==r&&(0,t.jsx)("div",{className:"text-muted-foreground/80 text-[10px]",children:e.reason})]})},exitDocumentMode:function({state:e,ToolIcon:r}){return(0,t.jsx)("div",{className:"text-xs space-y-1 border-l-2 border-border/40 pl-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(r,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"executing"===e?"Exiting...":"Returned to chat"})]})})},resolveConflict:function({parsedArgs:e,parsedResult:r,state:s}){let a=e?.strategy;return(0,t.jsxs)("div",{className:"text-xs space-y-1 border-l-2 border-yellow-500/40 pl-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(()=>{switch(a){case"retry_with_read":return(0,t.jsx)(k.RefreshCw,{className:"h-3 w-3 text-blue-500"});case"force_replace":return(0,t.jsx)(o.AlertCircle,{className:"h-3 w-3 text-orange-500"});case"ask_user":return(0,t.jsx)(D.HelpCircle,{className:"h-3 w-3 text-purple-500"});default:return(0,t.jsx)(A.AlertTriangle,{className:"h-3 w-3 text-yellow-500"})}})(),(0,t.jsx)("span",{className:"font-mono text-muted-foreground",children:(()=>{switch(a){case"retry_with_read":return"Retrying with fresh read";case"force_replace":return"Force replacing";case"ask_user":return"Asking for user input";default:return"Resolving conflict"}})()})]}),e?.conflictDescription&&(0,t.jsx)("div",{className:"text-muted-foreground/80 text-[10px]",children:e.conflictDescription}),r&&"executing"!==s&&(0,t.jsx)("div",{className:"text-muted-foreground",children:r.success?(0,t.jsx)("span",{className:"text-[10px]",children:r.message}):(0,t.jsx)("span",{className:"text-destructive",children:r.error})})]})}};function q({toolCalls:e,partialToolCalls:s}){let[S,M]=(0,r.useState)({}),T=(0,r.useMemo)(()=>{let t=[...e||[]];if(s)for(let e of s)t.some(t=>t.id===e.id)||t.push(e);return t},[e,s]);if(0===T.length)return null;let A=T.some(e=>"executing"===C(e)),D=T.some(e=>"error"===C(e)),E=Object.values(S).some(Boolean),q=()=>{let e=!E,t={};for(let r of T)t[r.id]=e;M(t)};return(0,t.jsxs)("div",{className:"my-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:q,role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),q())},"aria-expanded":E,"aria-label":`${T.length} tool call${1===T.length?"":"s"}`,children:[A?(0,t.jsx)(w.Loader2,{className:"h-3 w-3 text-blue-500 animate-spin"}):D?(0,t.jsx)(o.AlertCircle,{className:"h-3 w-3 text-red-500"}):(0,t.jsx)(d.CheckCircle2,{className:"h-3 w-3 text-green-500"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground group-hover:text-foreground transition-colors",children:(()=>{let e=T.filter(e=>"searchMemories"===e.name),t=T.filter(e=>"saveMemory"===e.name),r=e.reduce((e,t)=>{if(t.result)try{let r=JSON.parse(t.result);return e+(r.found||0)}catch{}return e},0),s=t.filter(e=>{try{let t=JSON.parse(e.result||"{}");return!0===t.success}catch{return!1}}).length;if(A){let e=T.find(e=>"executing"===C(e));return function(e,t,r){switch(e){case"saveMemory":if(t)return"Saving to memory...";return"Saved to memory";case"searchMemories":if(t)return"Searching memories...";return"Memory search (0 results)";case"calculator":if(t)return"Calculating...";return"= undefined";case"datetime":if(t)return"Getting date/time...";return"Date/time";case"webSearch":case"tavilySearch":case"tavilyAdvancedSearch":if(t)return"Searching the web...";return"Web search (0 results)";case"urlReader":if(t)return"Reading URL...";return"Read URL (0 words)";case"fileDocument":if(t)return"Processing document...";return"Document (0 words)";case"codeExecution":if(t)return"Executing code...";return"Code executed (0ms)";case"weather":if(t)return"Fetching weather...";return"Weather Forecast";case"projectContext":if(t)return"Loading project context...";!0;return"Project: Unknown";case"manageTasks":{let e;if(t)return"Managing tasks...";if("create"===e)return"Created: task";if("complete"===e)return"Completed: task";if("delete"===e)return"Ready to delete";if("update"===e)return"Updated: task";if("list"===e)return"0 tasks";return"Task manager"}case"createDocument":if(t)return"Creating document...";return'Created "document"';case"updateDocument":if(t)return"Updating document...";return"Updated to vundefined";case"readDocument":if(t)return"Reading document...";return"No document";case"enterDocumentMode":if(t)return"Entering document mode...";return"Document mode";case"exitDocumentMode":if(t)return"Exiting...";return"Back to chat";default:if(t)return"Processing...";return"Done"}}(e?.name||"",!0,0)}let a=[];return e.length>0&&a.push(`${r} memor${1!==r?"ies":"y"} found`),t.length>0&&a.push(`${s} saved`),a.join(", ")||"Tool calls"})()}),(0,t.jsx)("div",{className:"flex-1 border-t border-dashed border-border/40 group-hover:border-border/60 transition-colors"}),E?(0,t.jsx)(m.ChevronDown,{className:"h-3 w-3 text-muted-foreground group-hover:text-foreground transition-colors"}):(0,t.jsx)(p.ChevronRight,{className:"h-3 w-3 text-muted-foreground group-hover:text-foreground transition-colors"})]}),(0,t.jsx)(a.AnimatePresence,{children:E&&(0,t.jsx)(n.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,ease:[.2,0,0,1]},className:"overflow-hidden",children:(0,t.jsx)("div",{className:"mt-2 space-y-2 pl-2",children:T.map(e=>{let r,s,a=C(e),n=function(e){switch(e){case"saveMemory":return i.BookmarkPlus;case"searchMemories":default:return _.Search;case"calculator":return l.Calculator;case"datetime":return c.Calendar;case"webSearch":case"tavilySearch":case"tavilyAdvancedSearch":return y.Globe;case"urlReader":return g.ExternalLink;case"fileDocument":case"createDocument":return b.FileText;case"codeExecution":return h.Code;case"weather":return x.Cloud;case"projectContext":return j.FolderTree;case"manageTasks":return u.CheckSquare;case"updateDocument":return k.RefreshCw;case"readDocument":return f.Eye;case"enterDocumentMode":return v.FileEdit;case"exitDocumentMode":return N.MessageSquare}}(e.name);try{r=JSON.parse(e.arguments),s=e.result?JSON.parse(e.result):null}catch{r=e.arguments,s=e.result}let o=I[e.name]||$;return(0,t.jsx)(o,{call:e,parsedArgs:r,parsedResult:s,state:a,ToolIcon:n},e.id)})})})})]})}function B({content:e,toolCalls:a,partialToolCalls:n,isStreaming:o=!1}){let i=(0,r.useMemo)(()=>{let e=[...a||[]];if(n)for(let t of n)e.some(e=>e.id===t.id)||e.push(t);return e},[a,n]),l=(0,r.useMemo)(()=>{if(0===i.length)return e?[{type:"text",content:e}]:[];let t=[...i].sort((e,t)=>{let r=e.textPosition??1/0,s=t.textPosition??1/0;return r!==s?r-s:e.timestamp-t.timestamp});if(!t.some(e=>void 0!==e.textPosition&&null!==e.textPosition))return[{type:"tool",toolCalls:t},...e?[{type:"text",content:e}]:[]];let r=[],s=0,a=new Map;for(let r of t){let t=r.textPosition??e.length,s=a.get(t)||[];s.push(r),a.set(t,s)}for(let t of Array.from(a.keys()).sort((e,t)=>e-t)){if(t>s){let a=e.slice(s,t);a.trim()&&r.push({type:"text",content:a})}let n=a.get(t);r.push({type:"tool",toolCalls:n}),s=t}if(s<e.length){let t=e.slice(s);t.trim()&&r.push({type:"text",content:t})}return r},[e,i]);return 0===l.length?null:(0,t.jsx)("div",{className:"inline-tool-content space-y-2",children:l.map((e,r)=>"text"===e.type&&e.content?(0,t.jsx)(s.MarkdownContent,{content:e.content,isStreaming:o&&r===l.length-1},`text-${r}`):"tool"===e.type&&e.toolCalls?(0,t.jsx)(q,{toolCalls:e.toolCalls,partialToolCalls:[]},`tool-${r}`):null)})}e.s(["InlineToolCallContent",()=>B],607199)},576865,546210,e=>{"use strict";var t=e.i(379492);e.i(977101);var r=e.i(727630),s=e.i(851278);let a=(0,e.i(755430).default)("bookmark-check",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]]);var n=e.i(384078),o=e.i(799126),i=e.i(985902),l=e.i(547608),c=e.i(610012),d=e.i(173554),u=e.i(541247),m=e.i(465986),p=e.i(696057),x=e.i(283164);function h({messageId:e,conversationId:h}){let[g,f]=(0,n.useState)(!1),[v,b]=(0,n.useState)(""),[j,y]=(0,n.useState)(""),w="string"==typeof e&&e.startsWith("temp-"),N=(0,r.useQuery)(x.api.bookmarks.getByMessage,w?"skip":{messageId:e}),k=(0,r.useMutation)(x.api.bookmarks.create),_=(0,r.useMutation)(x.api.bookmarks.remove),C=(0,r.useMutation)(x.api.bookmarks.update),S=(0,r.useMutation)(x.api.usage.mutations.recordAction),M=!!N,T=async()=>{if(M&&N)try{await _({bookmarkId:N._id}),o.toast.success("Bookmark removed"),p.analytics.track("bookmark_deleted",{source:"message"})}catch(e){o.toast.error("Failed to remove bookmark")}else f(!0)},$=async()=>{try{let t=j?j.split(",").map(e=>e.trim()):void 0;M&&N?(await C({bookmarkId:N._id,note:v||void 0,tags:t}),o.toast.success("Bookmark updated"),p.analytics.track("bookmark_updated",{hasNote:!!v,tagCount:t?.length||0})):(await k({messageId:e,conversationId:h,note:v||void 0,tags:t}),o.toast.success("Bookmark created"),p.analytics.track("bookmark_created",{source:"message",hasNote:!!v,tagCount:t?.length||0}),S({actionType:"bookmark_message",resourceId:e})),f(!1),b(""),y("")}catch(e){o.toast.error("Failed to save bookmark")}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(m.Tooltip,{children:[(0,t.jsx)(m.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(i.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-muted-foreground/70 hover:bg-background/20 hover:text-foreground",onClick:T,children:[M?(0,t.jsx)(a,{className:"h-4 w-4 text-primary"}):(0,t.jsx)(s.Bookmark,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:M?"Remove bookmark":"Bookmark message"})]})}),(0,t.jsx)(m.TooltipContent,{children:(0,t.jsx)("p",{children:M?"Remove bookmark (B)":"Bookmark message (B)"})})]}),(0,t.jsx)(l.Dialog,{open:g,onOpenChange:f,children:(0,t.jsxs)(l.DialogContent,{children:[(0,t.jsx)(l.DialogHeader,{children:(0,t.jsx)(l.DialogTitle,{children:M?"Edit Bookmark":"Add Bookmark"})}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.Label,{htmlFor:"note",children:"Note (optional)"}),(0,t.jsx)(u.Textarea,{id:"note",placeholder:"Add a note about why you bookmarked this...",value:v,onChange:e=>b(e.target.value),rows:3})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.Label,{htmlFor:"tags",children:"Tags (optional)"}),(0,t.jsx)(c.Input,{id:"tags",placeholder:"important, code, reference (comma-separated)",value:j,onChange:e=>y(e.target.value)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Separate tags with commas"})]})]}),(0,t.jsxs)(l.DialogFooter,{children:[(0,t.jsx)(i.Button,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),(0,t.jsxs)(i.Button,{onClick:$,children:[M?"Update":"Save"," Bookmark"]})]})]})})]})}e.s(["BookmarkButton",()=>h],576865);var g=e.i(760087),f=e.i(126312),v=e.i(628876);function b({message:e}){let s=(0,r.useMutation)(x.api.chat.deleteMessage),a=async()=>{try{await s({messageId:e._id}),p.analytics.track("message_deleted",{messageId:e._id,conversationId:e.conversationId})}catch(e){console.error("Failed to delete:",e)}};return(0,t.jsxs)(v.DropdownMenu,{children:[(0,t.jsxs)(m.Tooltip,{children:[(0,t.jsx)(m.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(v.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(i.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-muted-foreground/70 hover:bg-background/20 hover:text-foreground",children:[(0,t.jsx)(g.MoreHorizontal,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"sr-only",children:"More actions"})]})})}),(0,t.jsx)(m.TooltipContent,{children:(0,t.jsx)("p",{children:"More actions"})})]}),(0,t.jsx)(v.DropdownMenuContent,{align:"end",className:"w-48",children:(0,t.jsxs)(v.DropdownMenuItem,{onClick:a,className:"text-destructive focus:text-destructive",children:[(0,t.jsx)(f.Trash2,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Delete"})]})})]})}e.s(["MessageActionsMenu",()=>b],546210)},35889,418368,615994,e=>{"use strict";var t=e.i(379492),r=e.i(283164);e.i(977101);var s=e.i(727630),a=e.i(851278),n=e.i(983300),o=e.i(462957),i=e.i(788410),l=e.i(760087),c=e.i(755589),d=e.i(952244),u=e.i(126312),m=e.i(430387),p=e.i(384078),x=e.i(985902),h=e.i(628876),g=e.i(465986),f=e.i(774247);function v({message:e,isGenerating:v,isUser:b,onCopy:j,onSaveAsNote:y,onBookmark:w,onCreatePresentation:N}){let[k,_]=(0,p.useState)(!1),C=(0,m.useRouter)(),S=(0,s.useMutation)(r.api.chat.regenerate),M=(0,s.useMutation)(r.api.chat.deleteMessage),T=(0,s.useMutation)(r.api.chat.branchFromMessage),$=async t=>{try{await S({messageId:e._id,modelId:t})}catch(e){console.error("Failed to regenerate:",e)}},A=async()=>{try{let t=await T({messageId:e._id});C.push(`/chat/${t}`)}catch(e){console.error("Failed to branch:",e)}},D=async()=>{try{await M({messageId:e._id})}catch(e){console.error("Failed to delete:",e)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.DropdownMenu,{children:[(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(h.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(x.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-muted-foreground/70 hover:bg-background/20 hover:text-foreground",children:[(0,t.jsx)(l.MoreHorizontal,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"sr-only",children:"Actions"})]})})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsx)("p",{children:"Actions"})})]}),(0,t.jsxs)(h.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,t.jsxs)(h.DropdownMenuItem,{onClick:j,children:[(0,t.jsx)(n.Copy,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Copy"})]}),w&&(0,t.jsxs)(h.DropdownMenuItem,{onClick:w,children:[(0,t.jsx)(a.Bookmark,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Bookmark"})]}),y&&(0,t.jsxs)(h.DropdownMenuItem,{onClick:y,children:[(0,t.jsx)(o.FileText,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Save as Note"})]}),N&&(0,t.jsxs)(h.DropdownMenuItem,{onClick:N,children:[(0,t.jsx)(c.Presentation,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Create Presentation"})]}),(w||y||N)&&(0,t.jsx)(h.DropdownMenuSeparator,{}),!b&&!v&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.DropdownMenuItem,{onClick:()=>_(!0),children:[(0,t.jsx)(d.RotateCcw,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Regenerate"})]}),(0,t.jsx)(h.DropdownMenuSeparator,{})]}),(0,t.jsxs)(h.DropdownMenuItem,{onClick:A,children:[(0,t.jsx)(i.GitBranch,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Branch conversation"})]}),(0,t.jsx)(h.DropdownMenuSeparator,{}),(0,t.jsxs)(h.DropdownMenuItem,{onClick:D,className:"text-destructive focus:text-destructive",children:[(0,t.jsx)(u.Trash2,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Delete"})]})]})]}),(0,t.jsx)(f.QuickModelSwitcher,{open:k,onOpenChange:_,currentModel:e.model||"",onSelectModel:e=>{$(e)},mode:"single",showTrigger:!1})]})}e.s(["MessageActionsMenuMobile",()=>v],35889);var b=e.i(755430);let j=(0,b.default)("volume-2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);e.s(["Volume2",()=>j],418368);let y=(0,b.default)("volume-x",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);e.s(["VolumeX",()=>y],615994)},519297,793383,831709,358262,913617,76433,869974,279241,e=>{"use strict";var t=e.i(379492),r=e.i(283164);e.i(977101);var s=e.i(727630),a=e.i(828982),n=e.i(983300),o=e.i(462957),i=e.i(788410),l=e.i(242890),c=e.i(755589),d=e.i(952244),u=e.i(654270),m=e.i(430387),p=e.i(384078),x=e.i(807017),h=e.i(985902),g=e.i(465986),f=e.i(152823),v=e.i(943111),b=e.i(432593),j=e.i(152088),y=e.i(576865),w=e.i(546210),N=e.i(35889),k=e.i(774247),_=e.i(2138),C=e.i(418368),S=e.i(615994),M=e.i(722434);function T({text:e,messageId:r,className:s}){let{state:a,playFromText:n,pause:o,resume:i,seekTo:l}=(0,M.useTTSPlayer)(),c=a.sourceMessageId===r,d=a.isLoading&&c,u=a.isPlaying&&c,m=async()=>{if(e.trim()){if(c&&!a.isLoading)return u?void o():(a.duration&&a.currentTime>=a.duration-.25&&l(0),void await i());await n({text:e,messageId:r})}};return(0,t.jsxs)(h.Button,{variant:"ghost",size:"sm",onClick:m,disabled:d||!e.trim(),className:(0,j.cn)("h-6 w-6 p-0 text-muted-foreground/70 hover:bg-background/20 hover:text-foreground",s),title:u?"Pause text-to-speech":"Play with text-to-speech",children:[d?(0,t.jsx)(_.Loader2,{className:"w-3.5 h-3.5 animate-spin"}):u?(0,t.jsx)(S.VolumeX,{className:"w-3.5 h-3.5"}):(0,t.jsx)(C.Volume2,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{className:"sr-only",children:d?"Generating...":u?"Stop":"Play"})]})}function $({message:e,nextMessage:_,readOnly:C,onEdit:S}){let[M,$]=(0,p.useState)(!1),[A,D]=(0,p.useState)(!1),[E,I]=(0,p.useState)(!1),q=(0,m.useRouter)();(0,s.useQuery)(r.api.users.getCurrentUser);let B=(0,s.useMutation)(r.api.chat.retryMessage),R=(0,s.useMutation)(r.api.chat.stopGeneration),L=(0,s.useMutation)(r.api.chat.regenerate),F=(0,s.useMutation)(r.api.chat.branchFromMessage),P=(0,s.useMutation)(r.api.usage.mutations.recordAction),z=(0,s.useQuery)(r.api.sources.operations.getSources,"assistant"!==e.role||e._id.startsWith("temp_")?"skip":{messageId:e._id}),{isMobile:O}=(0,v.useMobileDetect)(),U=(0,f.useFeatureToggles)();(0,b.useUserPreference)("alwaysShowMessageActions");let G=(0,b.useUserPreference)("ttsEnabled"),H="user"===e.role,V=["pending","generating"].includes(e.status),Z=H&&_?.status==="error"&&!V;(0,p.useEffect)(()=>{let t=t=>{t.detail.messageId===e._id&&D(!0)};return window.addEventListener("save-message-as-note",t),()=>{window.removeEventListener("save-message-as-note",t)}},[e._id]),(0,p.useEffect)(()=>{let t=t=>{t.detail.messageId!==e._id||H||V||I(!0)};return window.addEventListener("open-regenerate-model-selector",t),()=>{window.removeEventListener("open-regenerate-model-selector",t)}},[e._id,H,V]);let W=async()=>{let t=e.content||e.partialContent||"";if("assistant"===e.role&&z?.length)for(let e of(t+="\n\n**Sources:**\n",z))t+=`- [${e.position}] [${e.title||e.url}](${e.url})
`;await navigator.clipboard.writeText(t),$(!0),setTimeout(()=>$(!1),2e3),P({actionType:"copy_message",resourceId:e._id})},X=async()=>{try{let t=await F({messageId:e._id});P({actionType:"branch_message",resourceId:e._id}),q.push(`/chat/${t}`)}catch(e){console.error("Failed to branch:",e)}},K=async t=>{try{await L({messageId:e._id,modelId:t}),P({actionType:"regenerate_message",resourceId:e._id})}catch(e){console.error("Failed to regenerate:",e)}},Q=()=>{P({actionType:"create_presentation",resourceId:e._id}),q.push(`/slides/new?conversationId=${e.conversationId}&messageId=${e._id}`)},[J,Y]=(0,p.useState)(!1),ee=()=>{P({actionType:"save_as_note",resourceId:e._id}),D(!0)};return O&&!C?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)(N.MessageActionsMenuMobile,{message:e,isGenerating:V,isUser:H,onCopy:W,onSaveAsNote:U.showNotes?ee:void 0,onBookmark:U.showBookmarks?()=>{Y(!0)}:void 0,onCreatePresentation:U.showSlides&&!H&&(e.content||e.partialContent)?Q:void 0})}),(0,t.jsx)(x.CreateNoteDialog,{open:A,onOpenChange:D,initialContent:e.content||e.partialContent||"",sourceMessageId:e._id,sourceConversationId:e.conversationId}),U.showBookmarks&&(0,t.jsx)(y.BookmarkButton,{messageId:e._id,conversationId:e.conversationId})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,j.cn)("flex items-center gap-2","transition-all duration-200"),children:[(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(h.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-muted-foreground/70 hover:bg-background/20 hover:text-foreground",onClick:W,children:[M?(0,t.jsx)(a.Check,{className:"w-3.5 h-3.5"}):(0,t.jsx)(n.Copy,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{className:"sr-only",children:M?"Copied":"Copy"})]})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsx)("p",{children:M?"Copied!":"Copy message (C)"})})]}),!C&&(0,t.jsxs)(t.Fragment,{children:[H&&S&&(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(h.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-muted-foreground/70 hover:bg-background/20 hover:text-foreground",onClick:S,children:[(0,t.jsx)(l.Pencil,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{className:"sr-only",children:"Edit"})]})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsx)("p",{children:"Edit message (E)"})})]}),Z&&(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(h.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-muted-foreground/70 hover:bg-background/20 hover:text-foreground",onClick:()=>B({messageId:e._id}),children:[(0,t.jsx)(d.RotateCcw,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{className:"sr-only",children:"Retry"})]})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsx)("p",{children:"Retry message"})})]}),V&&(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(h.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-muted-foreground/70 hover:bg-background/20 hover:text-foreground",onClick:()=>R({conversationId:e.conversationId}),children:[(0,t.jsx)(u.Square,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{className:"sr-only",children:"Stop"})]})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsx)("p",{children:"Stop generation"})})]}),U.showBookmarks&&(0,t.jsx)(y.BookmarkButton,{messageId:e._id,conversationId:e.conversationId}),U.showNotes&&(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(h.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-muted-foreground/70 hover:bg-background/20 hover:text-foreground",onClick:ee,children:[(0,t.jsx)(o.FileText,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{className:"sr-only",children:"Save as Note"})]})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsx)("p",{children:"Save as note (N)"})})]}),U.showSlides&&!H&&(e.content||e.partialContent)&&(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(h.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-muted-foreground/70 hover:bg-background/20 hover:text-foreground",onClick:Q,children:[(0,t.jsx)(c.Presentation,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{className:"sr-only",children:"Create Presentation"})]})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsx)("p",{children:"Create presentation"})})]}),(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(h.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-muted-foreground/70 hover:bg-background/20 hover:text-foreground",onClick:X,children:[(0,t.jsx)(i.GitBranch,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{className:"sr-only",children:"Branch"})]})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsx)("p",{children:"Branch conversation (B)"})})]}),!H&&!V&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(h.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-muted-foreground/70 hover:bg-background/20 hover:text-foreground",onClick:()=>I(!0),children:[(0,t.jsx)(d.RotateCcw,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{className:"sr-only",children:"Regenerate"})]})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsx)("p",{children:"Regenerate response (R)"})})]}),(0,t.jsx)(k.QuickModelSwitcher,{open:E,onOpenChange:I,currentModel:e.model||"",onSelectModel:e=>{K(e)},mode:"single",showTrigger:!1})]}),!H&&"complete"===e.status&&G&&(e.content||e.partialContent)&&(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(T,{text:e.content||e.partialContent||"",messageId:e._id})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsx)("p",{children:"Play with text-to-speech"})})]}),(0,t.jsx)(w.MessageActionsMenu,{message:e,isGenerating:V,isUser:H})]})]}),(0,t.jsx)(x.CreateNoteDialog,{open:A,onOpenChange:D,initialContent:e.content||e.partialContent||"",sourceMessageId:e._id,sourceConversationId:e.conversationId})]})}e.s(["MessageActions",()=>$],519297);var A=e.i(813038),D=e.i(403950),E=e.i(141477),I=e.i(359548);function q({messageId:e}){let a=(0,m.useRouter)(),[n,o]=(0,p.useState)(!1),l="string"==typeof e&&e.startsWith("temp-"),c=(0,s.useQuery)(r.api.conversations.getChildBranchesFromMessage,l?"skip":{messageId:e});return c&&0!==c.length?(0,t.jsxs)("div",{className:"my-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:()=>o(!n),role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),o(!n))},"aria-expanded":n,"aria-label":`${c.length} branch${1===c.length?"":"es"} from this message`,children:[(0,t.jsxs)("span",{className:"text-xs text-muted-foreground group-hover:text-foreground transition-colors",children:["Branches (",c.length,")"]}),(0,t.jsx)("div",{className:"flex-1 border-t border-dashed border-border/40 group-hover:border-border/60 transition-colors"}),n?(0,t.jsx)(E.ChevronDown,{className:"h-3 w-3 text-muted-foreground group-hover:text-foreground transition-colors"}):(0,t.jsx)(I.ChevronRight,{className:"h-3 w-3 text-muted-foreground group-hover:text-foreground transition-colors"})]}),(0,t.jsx)(A.AnimatePresence,{children:n&&(0,t.jsx)(D.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,ease:[.2,0,0,1]},className:"overflow-hidden",children:(0,t.jsx)("div",{className:"mt-2 space-y-1 pl-2",children:c.map(e=>(0,t.jsx)(h.Button,{variant:"ghost",size:"sm",className:"w-full justify-start h-auto py-2 px-2 text-left font-normal hover:bg-accent/50",onClick:t=>{t.stopPropagation(),a.push(`/chat/${e._id}`)},children:(0,t.jsxs)("div",{className:"flex items-start gap-2 w-full min-w-0",children:[(0,t.jsx)(i.GitBranch,{className:"h-3.5 w-3.5 mt-0.5 flex-shrink-0 text-muted-foreground"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm truncate",children:e.title}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})},e._id))})})})]}):null}e.s(["MessageBranchIndicator",()=>q],793383);var B=e.i(644163),R=e.i(562940),L=e.i(346596),F=e.i(328299),P=e.i(480494),z=e.i(907347),O=e.i(313318),U=e.i(696057),G=e.i(833250);function H({onVote:e,isVoted:r,hasVoted:s,label:n}){return(0,t.jsx)("div",{className:"flex gap-2",children:s?r?(0,t.jsxs)("div",{className:"flex-1 flex items-center justify-center gap-2 text-sm font-medium text-primary py-2 border rounded-md bg-primary/10 border-primary/20",children:[(0,t.jsx)(a.Check,{className:"w-4 h-4"}),"Voted"]}):null:(0,t.jsx)(h.Button,{size:"sm",variant:"outline",onClick:e,className:"flex-1 hover:bg-primary hover:text-primary-foreground transition-all duration-200",children:n})})}let V=(0,p.forwardRef)(({message:e,index:r,showModelName:s,showStats:a,onVote:n,isVoted:o,hasVoted:i,duration:l},c)=>{let d=["pending","generating"].includes(e.status),u=e.partialContent||e.content||"",m=e.model?.split(":")[1]||e.model;return(0,t.jsxs)("div",{ref:c,className:"flex flex-col h-full border rounded-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex flex-col items-start gap-2 p-3 border-b bg-muted/30",children:[(0,t.jsx)("div",{children:s?(0,t.jsx)(z.Badge,{variant:"secondary",children:m}):(0,t.jsxs)(z.Badge,{variant:"outline",children:["Model ",r+1]})}),a&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground flex gap-2 w-full overflow-hidden text-ellipsis whitespace-nowrap pl-2",children:[(0,t.jsxs)("span",{children:[e.inputTokens?.toLocaleString()||0," in"]}),(0,t.jsx)("span",{children:"•"}),(0,t.jsxs)("span",{children:[e.outputTokens?.toLocaleString()||0," out"]}),(0,t.jsx)("span",{children:"•"}),(0,t.jsxs)("span",{className:"font-mono",children:["$",e.cost?.toFixed(4)||"0.0000"]}),void 0!==l&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:"•"}),(0,t.jsx)("span",{className:"font-mono",children:null===l?"—":l<1e3?`${l}ms`:`${(l/1e3).toFixed(1)}s`})]})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:u?(0,t.jsx)(G.MarkdownContent,{content:u,isStreaming:d}):(0,t.jsxs)("div",{className:"flex gap-1 items-center h-6",children:[(0,t.jsx)("span",{className:"w-2 h-2 bg-primary/40 rounded-full animate-bounce"}),(0,t.jsx)("span",{className:"w-2 h-2 bg-primary/40 rounded-full animate-bounce delay-150"}),(0,t.jsx)("span",{className:"w-2 h-2 bg-primary/40 rounded-full animate-bounce delay-300"})]})}),"complete"===e.status&&(0,t.jsx)("div",{className:"p-3 border-t",children:(0,t.jsx)(H,{onVote:n,isVoted:o,hasVoted:i,label:"This is better"})})]})});V.displayName="ComparisonPanel";var Z=e.i(547608),W=e.i(173554),X=e.i(573511),K=e.i(680707),Q=e.i(320287);function J({open:e,messages:r,onConfirm:s,onClose:a}){let n=Object.values(Q.MODEL_CONFIG).filter(e=>!e.isLocal),[o,i]=(0,p.useState)(n[0]?.id||""),[l,c]=(0,p.useState)("same-chat"),d=(0,p.useMemo)(()=>Math.ceil(r.map(e=>e.content).join("\n\n").length/4),[r]),u=d/1e3*.003;return(0,t.jsx)(Z.Dialog,{open:e,onOpenChange:a,children:(0,t.jsxs)(Z.DialogContent,{children:[(0,t.jsxs)(Z.DialogHeader,{children:[(0,t.jsx)(Z.DialogTitle,{children:"Consolidate Responses"}),(0,t.jsxs)(Z.DialogDescription,{children:["Synthesize all ",r.length," responses into one comprehensive answer."]})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Consolidation mode"}),(0,t.jsxs)(X.RadioGroup,{value:l,onValueChange:e=>c(e),children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(X.RadioGroupItem,{value:"same-chat",id:"same-chat"}),(0,t.jsxs)(W.Label,{htmlFor:"same-chat",className:"cursor-pointer",children:[(0,t.jsx)("div",{className:"font-medium",children:"Same chat"}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Replace comparison with consolidated response"})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(X.RadioGroupItem,{value:"new-chat",id:"new-chat"}),(0,t.jsxs)(W.Label,{htmlFor:"new-chat",className:"cursor-pointer",children:[(0,t.jsx)("div",{className:"font-medium",children:"New chat"}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Create separate conversation with consolidated response"})]})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Which model should consolidate?"}),(0,t.jsxs)(K.Select,{value:o,onValueChange:i,children:[(0,t.jsx)(K.SelectTrigger,{children:(0,t.jsx)(K.SelectValue,{})}),(0,t.jsx)(K.SelectContent,{children:n.map(e=>(0,t.jsx)(K.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{className:"bg-muted p-3 rounded space-y-1 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Estimated input tokens:"}),(0,t.jsx)("span",{className:"font-mono",children:d.toLocaleString()})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Estimated cost:"}),(0,t.jsxs)("span",{className:"font-mono",children:["$",u.toFixed(4)]})]})]})]}),(0,t.jsxs)(Z.DialogFooter,{children:[(0,t.jsx)(h.Button,{variant:"outline",onClick:a,children:"Cancel"}),(0,t.jsxs)(h.Button,{onClick:()=>{s(o,l)},children:["Consolidate with"," ",n.find(e=>e.id===o)?.name]})]})]})})}function Y({assistantMessages:e,comparisonGroupId:a,showModelNames:n,onVote:o,onConsolidate:i,onToggleModelNames:l,onExit:c,hideConsolidateButton:d=!1}){let[u,m]=(0,p.useState)(!0),[x,f]=(0,p.useState)(!1),[v,y]=(0,p.useState)();(0,s.useQuery)(r.api.users.getCurrentUser);let w=(0,b.useUserPreference)("showComparisonStatistics"),{register:N}=function(e=!0){let t=(0,p.useRef)(new Set),r=(0,p.useRef)(!1);return{register:(0,p.useCallback)(s=>{if(!s)return;t.current.add(s);let a=()=>{if(!e||r.current)return;r.current=!0;let a=s.scrollTop/(s.scrollHeight-s.clientHeight);requestAnimationFrame(()=>{for(let e of t.current)e!==s&&(e.scrollTop=a*(e.scrollHeight-e.clientHeight));r.current=!1})};return s.addEventListener("scroll",a,{passive:!0}),()=>{s.removeEventListener("scroll",a),t.current.delete(s)}},[e])}}(u),k=(0,P.useMediaQuery)("(max-width: 1024px)"),_=(0,p.useMemo)(()=>[...e].sort((e,t)=>e.createdAt-t.createdAt),[e]),C=(0,p.useMemo)(()=>e.reduce((e,t)=>e+(t.cost||0),0),[e]),S=(0,p.useMemo)(()=>e.reduce((e,t)=>e+(t.inputTokens||0),0),[e]),M=(0,p.useMemo)(()=>e.reduce((e,t)=>e+(t.outputTokens||0),0),[e]),T=(0,p.useMemo)(()=>_.map(e=>e.generationCompletedAt?e.generationCompletedAt-e.createdAt:null),[_]),$=e=>null===e?"—":e<1e3?`${e}ms`:`${(e/1e3).toFixed(1)}s`,A=e.every(e=>"complete"===e.status),D=(e,t)=>{let r;y(e),o(e,r=2===_.length?0===t?"left_better":"right_better":"left_better");let s=_.find(t=>t._id===e);U.analytics.track("comparison_voted",{rating:r,winnerModel:s?.model,modelCount:_.length,comparisonGroupId:a})},E=(e,t)=>{f(!1),i(e,t),U.analytics.track("consolidation_created",{mode:t,model:e,modelCount:_.length})};return k?(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 border-b",children:[!d&&(0,t.jsxs)("h3",{className:"font-medium",children:["Comparing ",e.length," models"]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 ml-auto",children:[!d&&(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(h.Button,{size:"icon",variant:"ghost",onClick:l,className:"h-8 w-8",children:n?(0,t.jsx)(R.EyeOff,{className:"w-4 h-4"}):(0,t.jsx)(B.Eye,{className:"w-4 h-4"})})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsxs)("p",{children:[n?"Hide":"Show"," model names"]})})]}),c&&(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(h.Button,{size:"icon",variant:"ghost",onClick:c,children:(0,t.jsx)(F.X,{className:"w-4 h-4"})})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsx)("p",{children:"Exit comparison (Esc)"})})]})]})]}),(0,t.jsxs)(O.Tabs,{defaultValue:_[0]._id,className:"flex-1",children:[(0,t.jsx)(O.TabsList,{className:"w-full justify-start overflow-x-auto sticky top-0 z-10 no-scrollbar px-1",children:_.map((e,r)=>(0,t.jsx)(O.TabsTrigger,{value:e._id,className:"flex-shrink-0 min-w-[100px]",children:n?e.model?.split(":")[1]||e.model:`Model ${r+1}`},e._id))}),_.map((e,r)=>(0,t.jsx)(O.TabsContent,{value:e._id,className:"flex-1",children:(0,t.jsx)(V,{message:e,index:r,showModelName:n,showStats:w,onVote:()=>D(e._id,r),isVoted:v===e._id,hasVoted:void 0!==v,duration:T[r]})},e._id))]}),(0,t.jsxs)("div",{className:"p-3 border-t space-y-2",children:[w&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Total Cost"}),(0,t.jsxs)("span",{className:"font-mono",children:["$",C.toFixed(4)]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Avg Response Time"}),(0,t.jsx)("span",{className:"font-mono",children:$(T.filter(e=>null!==e).length>0?T.filter(e=>null!==e).reduce((e,t)=>e+t,0)/T.filter(e=>null!==e).length:null)})]})]}),A&&!d&&(0,t.jsxs)(h.Button,{onClick:()=>f(!0),className:"w-full",variant:"secondary",children:[(0,t.jsx)(L.Sparkles,{className:"w-4 h-4 mr-2"}),"Consolidate Responses"]})]}),(0,t.jsx)(J,{open:x,comparisonGroupId:a,messages:_,onConfirm:E,onClose:()=>f(!1)})]}):(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 border-b",children:[(0,t.jsx)("div",{className:"flex items-center gap-3",children:!d&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("h3",{className:"font-medium",children:["Comparing ",e.length," models"]}),(0,t.jsx)(z.Badge,{variant:"outline",children:u?"Sync On":"Sync Off"})]})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[!d&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.Button,{size:"sm",variant:"ghost",onClick:()=>m(!u),children:"Toggle Sync"}),(0,t.jsx)(h.Button,{size:"sm",variant:"ghost",onClick:l,className:"gap-2",children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(R.EyeOff,{className:"w-4 h-4"}),"Hide Names"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(B.Eye,{className:"w-4 h-4"}),"Show Names"]})})]}),c&&(0,t.jsx)(h.Button,{size:"icon",variant:"ghost",onClick:c,children:(0,t.jsx)(F.X,{className:"w-4 h-4"})})]})]}),(0,t.jsx)("div",{className:(0,j.cn)("flex-1 grid gap-4 p-4 overflow-hidden",2===e.length&&"grid-cols-2",3===e.length&&"grid-cols-3",4===e.length&&"grid-cols-2 lg:grid-cols-4"),children:_.map((e,r)=>(0,t.jsx)(V,{ref:N,message:e,index:r,showModelName:n,showStats:w,onVote:()=>D(e._id,r),isVoted:v===e._id,hasVoted:void 0!==v,duration:T[r]},e._id))}),(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 border-t",children:[w&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Total Cost:"}),(0,t.jsxs)("span",{className:"font-mono text-lg",children:["$",C.toFixed(4)]})]}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:[S.toLocaleString()," input +"," ",M.toLocaleString()," output tokens"]}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Avg response:"," ",$(T.filter(e=>null!==e).length>0?T.filter(e=>null!==e).reduce((e,t)=>e+t,0)/T.filter(e=>null!==e).length:null)]})]}),A&&!d&&(0,t.jsxs)(h.Button,{onClick:()=>f(!0),variant:"secondary",className:w?"":"ml-auto",children:[(0,t.jsx)(L.Sparkles,{className:"w-4 h-4 mr-2"}),"Consolidate Responses"]})]}),(0,t.jsx)(J,{open:x,comparisonGroupId:a,messages:_,onConfirm:E,onClose:()=>f(!1)})]})}function ee({originalResponses:e,showOriginals:r,onToggle:s}){return 0===e.length?null:(0,t.jsxs)("div",{className:"mt-4 border-t border-border/10 pt-4",children:[(0,t.jsxs)(h.Button,{variant:"ghost",size:"sm",onClick:s,className:"gap-2 text-xs",children:[(0,t.jsx)(E.ChevronDown,{className:(0,j.cn)("w-3 h-3 transition-transform",r&&"rotate-180")}),r?"Hide":"Show"," original ",e.length," ","response",1!==e.length?"s":""]}),r&&(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(Y,{assistantMessages:e,comparisonGroupId:e[0]?.comparisonGroupId||"",showModelNames:!0,onVote:()=>{},onConsolidate:()=>{},onToggleModelNames:()=>{},hideConsolidateButton:!0})})]})}e.s(["ComparisonView",()=>Y],831709),e.s(["MessageConsolidationToggle",()=>ee],358262);var et=e.i(541247);function er({editedContent:e,onContentChange:r,onSave:s,onCancel:n}){return(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(et.Textarea,{value:e,onChange:e=>r(e.target.value),className:"min-h-[100px] resize-none font-normal",autoFocus:!0}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(h.Button,{size:"sm",onClick:s,className:"h-8",disabled:!e.trim(),children:[(0,t.jsx)(a.Check,{className:"w-3.5 h-3.5 mr-1.5"}),"Save"]}),(0,t.jsxs)(h.Button,{size:"sm",variant:"outline",onClick:n,className:"h-8",children:[(0,t.jsx)(F.X,{className:"w-3.5 h-3.5 mr-1.5"}),"Cancel"]})]})]})}function es({isThinkingModel:e}){return e?(0,t.jsxs)("div",{className:"flex items-center gap-2 h-6 text-xs font-medium text-muted-foreground uppercase tracking-widest",children:[(0,t.jsx)(_.Loader2,{className:"w-3 h-3 animate-spin text-primary"}),(0,t.jsx)("span",{children:"Thinking..."})]}):(0,t.jsxs)("div",{className:"flex gap-1 items-center h-6",children:[(0,t.jsx)("span",{className:"w-2 h-2 bg-primary/40 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,t.jsx)("span",{className:"w-2 h-2 bg-primary/40 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,t.jsx)("span",{className:"w-2 h-2 bg-primary/40 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})}function ea({messageId:e}){let a=(0,m.useRouter)(),[n,i]=(0,p.useState)(!1),l="string"==typeof e&&e.startsWith("temp-"),c=(0,s.useQuery)(r.api.notes.getNotesFromMessage,l?"skip":{messageId:e});return c&&0!==c.length?(0,t.jsxs)("div",{className:"my-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:()=>i(!n),role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),i(!n))},"aria-expanded":n,"aria-label":`${c.length} note${1===c.length?"":"s"} from this message`,children:[(0,t.jsxs)("span",{className:"text-xs text-muted-foreground group-hover:text-foreground transition-colors",children:["Notes (",c.length,")"]}),(0,t.jsx)("div",{className:"flex-1 border-t border-dashed border-border/40 group-hover:border-border/60 transition-colors"}),n?(0,t.jsx)(E.ChevronDown,{className:"h-3 w-3 text-muted-foreground group-hover:text-foreground transition-colors"}):(0,t.jsx)(I.ChevronRight,{className:"h-3 w-3 text-muted-foreground group-hover:text-foreground transition-colors"})]}),(0,t.jsx)(A.AnimatePresence,{children:n&&(0,t.jsx)(D.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,ease:[.2,0,0,1]},className:"overflow-hidden",children:(0,t.jsx)("div",{className:"mt-2 space-y-1 pl-2",children:c.map(e=>(0,t.jsx)(h.Button,{variant:"ghost",size:"sm",className:"w-full justify-start h-auto py-2 px-2 text-left font-normal hover:bg-accent/50",onClick:t=>{t.stopPropagation(),a.push(`/notes?note=${e._id}`)},children:(0,t.jsxs)("div",{className:"flex items-start gap-2 w-full min-w-0",children:[(0,t.jsx)(o.FileText,{className:"h-3.5 w-3.5 mt-0.5 flex-shrink-0 text-muted-foreground"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm truncate",children:e.title}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})},e._id))})})})]}):null}e.s(["MessageEditMode",()=>er],913617),e.s(["MessageLoadingState",()=>es],76433),e.s(["MessageNotesIndicator",()=>ea],869974);var en=e.i(108665),eo=e.i(834507);function ei({modelName:e,ttft:r,isCached:s,tokensPerSecond:a,inputTokens:n,outputTokens:o,status:i,showStats:l}){return(0,t.jsxs)("div",{className:"mt-3 pt-3 border-t border-border/10 flex flex-wrap items-center gap-2 transition-opacity duration-300",children:[(0,t.jsx)(z.Badge,{variant:"outline",className:"text-[10px] h-5 bg-background/50 backdrop-blur border-border/50 text-muted-foreground",children:e}),"stopped"===i&&(0,t.jsx)(g.TooltipProvider,{children:(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(z.Badge,{variant:"outline",className:"text-[10px] h-5 bg-amber-500/10 backdrop-blur border-amber-500/30 text-amber-600 dark:text-amber-400",children:[(0,t.jsx)(u.Square,{className:"w-2.5 h-2.5 mr-1 fill-current"}),"Stopped"]})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsx)("div",{className:"font-semibold",children:"Generation Stopped"}),(0,t.jsx)("div",{className:"text-muted-foreground",children:"You stopped this response"})]})})]})}),l&&(0,t.jsxs)(t.Fragment,{children:[null!==r&&(0,t.jsx)(g.TooltipProvider,{children:s?(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(z.Badge,{variant:"outline",className:"text-[10px] h-5 bg-background/50 backdrop-blur border-border/50 text-muted-foreground",children:[(0,t.jsx)(en.Zap,{className:"w-3 h-3 mr-1"}),"cached"]})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsx)("div",{className:"font-semibold",children:"Cached Response"}),(0,t.jsx)("div",{className:"text-muted-foreground",children:"Served instantly from cache"})]})})]}):(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(z.Badge,{variant:"outline",className:(0,j.cn)("text-[10px] h-5 font-mono tabular-nums cursor-help bg-background/50 backdrop-blur border-border/50 text-muted-foreground","generating"===i&&"animate-pulse"),children:["TTFT: ",(0,eo.formatTTFT)(r)]})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsx)("div",{className:"font-semibold",children:"Time to First Token"}),(0,t.jsx)("div",{className:"text-muted-foreground",children:"generating"===i?"AI started responding":"How long until AI started responding"})]})})]})}),a&&"complete"===i&&(0,t.jsx)(g.TooltipProvider,{children:(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(z.Badge,{variant:"outline",className:"text-[10px] h-5 font-mono tabular-nums cursor-help bg-background/50 backdrop-blur border-border/50 text-muted-foreground",children:["TPS: ",Math.round(a)," t/s"]})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsx)("div",{className:"font-semibold",children:"Tokens Per Second"}),(0,t.jsxs)("div",{className:"text-muted-foreground",children:["Generation speed: ",Math.round(a)," tokens/sec"]})]})})]})}),(void 0!==n||void 0!==o)&&(0,t.jsx)(g.TooltipProvider,{children:(0,t.jsxs)(g.Tooltip,{children:[(0,t.jsx)(g.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(z.Badge,{variant:"outline",className:"text-[10px] h-5 font-mono tabular-nums cursor-help bg-background/50 backdrop-blur border-border/50 text-muted-foreground",children:[n||0,"/",o||0]})}),(0,t.jsx)(g.TooltipContent,{children:(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsx)("div",{className:"font-semibold",children:"Token Count"}),(0,t.jsxs)("div",{className:"text-muted-foreground",children:["Input: ",n?.toLocaleString()||0]}),(0,t.jsxs)("div",{className:"text-muted-foreground",children:["Output: ",o?.toLocaleString()||0]}),(0,t.jsxs)("div",{className:"text-muted-foreground font-semibold mt-1",children:["Total:"," ",((n||0)+(o||0)).toLocaleString()]})]})})]})})]})]})}e.s(["MessageStatsBadges",()=>ei],279241)},94584,e=>{"use strict";var t=e.i(379492),r=e.i(283164);e.i(977101);var s=e.i(727630),a=e.i(310165),n=e.i(384078),o=e.i(799126),i=e.i(565833),l=e.i(152823),c=e.i(755407),d=e.i(432593),u=e.i(320287),m=e.i(241362),p=e.i(152088),x=e.i(834507),h=e.i(791408),g=e.i(806831),f=e.i(445309),v=e.i(607199),b=e.i(519297),j=e.i(793383),y=e.i(358262),w=e.i(913617),N=e.i(76433),k=e.i(869974),_=e.i(279241),C=e.i(285659),S=e.i(813038),M=e.i(403950),T=e.i(62551),$=e.i(141477),A=e.i(2138);function D({reasoning:e,partialReasoning:a,thinkingStartedAt:o,thinkingCompletedAt:i,reasoningTokens:l,isThinking:c=!1}){(0,s.useQuery)(r.api.users.getCurrentUser);let u=(0,d.useUserPreference)("reasoning"),[m,h]=(0,n.useState)(u.autoExpand);(0,n.useEffect)(()=>{h(u.autoExpand)},[u.autoExpand]);let g=e||a,f=i&&o;if(!u.showByDefault||c&&!u.showDuringStreaming||!g&&!f&&!c)return null;let v=i&&o?i-o:null;return(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("button",{onClick:()=>h(!m),className:(0,p.cn)("w-full flex items-center gap-2 px-4 py-2.5","bg-muted/20 hover:bg-muted/30","backdrop-blur-xl rounded-xl","transition-colors duration-200","text-sm text-muted-foreground",c&&"animate-pulse"),children:[c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(A.Loader2,{className:"w-4 h-4 animate-spin"}),(0,t.jsx)("span",{children:"Thinking..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(T.Brain,{className:"w-4 h-4"}),(0,t.jsxs)("span",{children:[null!==v?(0,t.jsxs)(t.Fragment,{children:["Thought for ",(0,x.formatDuration)(v)]}):"Reasoning",l&&` (${l} tokens)`]})]}),(0,t.jsx)($.ChevronDown,{className:(0,p.cn)("w-4 h-4 ml-auto transition-transform duration-200",m&&"rotate-180")})]}),(0,t.jsx)(S.AnimatePresence,{children:m&&g&&(0,t.jsx)(M.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:(0,t.jsx)("div",{className:(0,p.cn)("mt-2 p-4 rounded-xl","bg-muted/10 backdrop-blur-xl","border border-border/50","max-h-[400px] overflow-y-auto","font-mono text-sm text-foreground/80","whitespace-pre-wrap break-words"),children:g?(0,t.jsxs)(t.Fragment,{children:[g,c&&(0,t.jsx)("span",{className:"inline-block w-2 h-4 ml-1 bg-primary/50 animate-pulse"})]}):(0,t.jsxs)("p",{className:"text-xs text-muted-foreground italic",children:["Full reasoning hidden by provider. Model used"," ",l||0," reasoning tokens."]})})})})]})}var E=e.i(150187),I=e.i(266796),q=e.i(907347),B=e.i(985902),R=e.i(264036),L=e.i(319226);function F({messageId:e,className:a}){let[o,i]=(0,n.useState)(!1),l="string"==typeof e&&e.startsWith("temp-"),c=(0,s.useQuery)(r.api.sources.operations.getSources,l?"skip":{messageId:e});if(!c||0===c.length)return null;let d=c.length;return(0,t.jsxs)("div",{className:(0,p.cn)("mt-4 space-y-2",a),children:[(0,t.jsxs)(B.Button,{variant:"ghost",size:"sm",onClick:()=>i(!o),className:"gap-2 text-muted-foreground hover:text-foreground",children:[o?(0,t.jsx)(E.ChevronUp,{className:"h-4 w-4"}):(0,t.jsx)($.ChevronDown,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:["Used ",d," ",1===d?"source":"sources"]})]}),o&&(0,t.jsx)("div",{className:"grid gap-2 sm:grid-cols-2",children:c.map((e,r)=>(0,t.jsx)(P,{source:e,position:e.position||r+1},e.position||r))})]})}function P({source:e,position:r}){let s,a=e.metadata?.title||e.title||e.url,n=e.snippet||e.metadata?.description||"",o=e.metadata?.favicon;try{s=new URL(e.url).hostname.replace("www.","")}catch{s=e.url}let i=(0,t.jsx)(R.Card,{className:"group relative overflow-hidden p-3 transition-all hover:border-primary/50 hover:shadow-md cursor-pointer",children:(0,t.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex gap-3",onClick:e=>{if(window.innerWidth<640)return},children:[(0,t.jsx)(q.Badge,{variant:"secondary",className:"h-6 w-6 shrink-0 items-center justify-center rounded-full p-0 text-xs font-semibold",children:r}),(0,t.jsxs)("div",{className:"min-w-0 flex-1 space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[o&&(0,t.jsx)("img",{src:o,alt:"",className:"h-4 w-4 rounded",onError:e=>{e.currentTarget.style.display="none"}}),(0,t.jsx)("span",{className:"truncate",children:s})]}),(0,t.jsx)("h4",{className:"line-clamp-2 text-sm font-medium leading-tight group-hover:underline",children:a}),n&&(0,t.jsxs)("p",{className:"line-clamp-2 text-xs text-muted-foreground",children:[n.slice(0,120),n.length>120?"...":""]})]}),(0,t.jsx)("div",{className:"shrink-0 text-muted-foreground opacity-0 transition-opacity group-hover:opacity-100",children:(0,t.jsx)(I.ExternalLink,{className:"h-4 w-4"})})]})});return(0,t.jsxs)(L.HoverCard,{openDelay:300,children:[(0,t.jsx)(L.HoverCardTrigger,{asChild:!0,children:i}),(0,t.jsx)(L.HoverCardContent,{side:"top",className:"w-80",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:s}),(0,t.jsx)("h4",{className:"font-semibold",children:a}),n&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:n}),(0,t.jsx)(B.Button,{asChild:!0,size:"sm",variant:"outline",className:"w-full gap-2",children:(0,t.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:["Open source",(0,t.jsx)(I.ExternalLink,{className:"h-3 w-3"})]})})]})})]})}function z({error:e}){let[r,s]=(0,n.useState)(!1);return(0,t.jsxs)("div",{className:"flex flex-col gap-3 p-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-amber-500/90 dark:text-amber-400/90",children:[(0,t.jsx)(a.AlertCircle,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"font-medium text-sm",children:"Unable to generate response"})]}),(0,t.jsx)("div",{className:"bg-muted/30 rounded-md p-3 border border-border/50",children:(0,t.jsx)("p",{className:"text-sm leading-relaxed opacity-90 break-words",children:e})}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[(0,t.jsx)("span",{children:"Try a different model or"}),(0,t.jsx)("button",{type:"button",onClick:()=>s(!0),className:"underline hover:text-foreground transition-colors cursor-pointer",children:"contact support"})]}),(0,t.jsx)(h.FeedbackModal,{open:r,onOpenChange:s})]})}let O=(0,n.memo)(function({message:e,nextMessage:a,readOnly:h,isCollaborative:S,senderUser:M}){let[T,$]=(0,n.useState)(!1),[A,E]=(0,n.useState)(!1),[I,q]=(0,n.useState)(!1),[B,R]=(0,n.useState)(""),L=(0,n.useRef)(null),P="user"===e.role,O=["pending","generating"].includes(e.status),U="error"===e.status;e.status;let G="string"==typeof e._id&&e._id.startsWith("temp-"),H=(0,s.useMutation)(r.api.chat.editMessage),V=(0,s.useMutation)(r.api.conversations.updateModel),Z=(0,d.useUserPreference)("alwaysShowMessageActions"),W=(0,d.useUserPreference)("showMessageStatistics"),X=(0,l.useFeatureToggles)(),K=(0,s.useQuery)(r.api.messages.getOriginalResponses,e.isConsolidation&&!G?{consolidatedMessageId:e._id}:"skip"),Q=(0,s.useQuery)(r.api.conversations.get,{conversationId:e.conversationId}),J=e.partialContent||e.content||"",Y=e.model?(0,m.getModelConfig)(e.model):null,ee=Y?.name||e.model?.split(":")[1]||e.model,et=!!Y?.reasoning||Y?.capabilities?.includes("extended-thinking")||Y?.capabilities?.includes("thinking")||!1,er=e.firstTokenAt&&e.generationStartedAt?e.firstTokenAt-e.generationStartedAt:null,es=null!==er&&(0,x.isCachedResponse)(er),ea=(0,s.useQuery)(r.api.messages.getAttachments,G?"skip":{messageId:e._id}),en=ea?.map(e=>e.storageId)||[],eo=(0,s.useQuery)(r.api.files.getAttachmentUrls,en.length>0?{storageIds:en}:"skip"),ei=new Map(eo?.map(e=>[e.storageId,e.url]).filter(e=>null!==e[1])||[]),el=(0,s.useQuery)(r.api.messages.getToolCalls,G?"skip":{messageId:e._id,includePartial:!0}),ec=el?.filter(e=>!e.isPartial),ed=el?.filter(e=>e.isPartial),eu=async t=>{try{await V({conversationId:e.conversationId,model:t}),o.toast.success(`Switched to ${u.MODEL_CONFIG[t]?.name||t}`)}catch(e){o.toast.error("Failed to switch model"),console.error("[ChatMessage] Model switch error:",e)}},em=async()=>{try{await H({messageId:e._id,content:B}),q(!1),o.toast.success("Message updated")}catch(e){o.toast.error("Failed to update message"),console.error("[ChatMessage] Edit error:",e)}};(0,c.useMessageKeyboardShortcuts)({messageId:e._id,conversationId:e.conversationId,content:J,isFocused:A,isUser:P,isGenerating:O,readOnly:h,messageRef:L});let ep=(0,p.cn)("relative rounded-[2rem] rounded-tr-sm","px-5 py-3 sm:px-6 sm:py-4 text-sm sm:text-base leading-relaxed","bg-primary/10 text-foreground backdrop-blur-sm","border border-primary/20","shadow-sm hover:shadow-md","transition-all duration-300","[&_.prose]:text-foreground","font-medium tracking-wide"),ex=(0,p.cn)("relative rounded-[2rem] rounded-tl-sm","px-5 py-3 sm:px-6 sm:py-4 text-sm sm:text-base leading-relaxed","bg-surface-glass border border-surface-glass-border backdrop-blur-xl","shadow-sm hover:shadow-md hover:border-primary/20","transition-all duration-300","[&_.prose]:text-foreground"),eh=(0,p.cn)("relative group",P?"ml-auto mr-4 max-w-[90%] sm:max-w-[75%]":"mr-auto ml-4 max-w-[95%] sm:max-w-[85%]");return(0,t.jsx)("div",{className:(0,p.cn)("flex w-full mb-10",P?"justify-end":"justify-start"),children:(0,t.jsxs)("div",{className:eh,children:[(0,t.jsx)("div",{ref:L,id:`message-${e._id}`,onFocus:()=>E(!0),onBlur:()=>E(!1),className:(0,p.cn)("chat-message",P?ep:ex,A&&"ring-2 ring-primary/50"),"data-testid":"message","data-message-id":e._id,"data-message-role":e.role,"data-status":e.status,"aria-label":`${P?"Your":"Assistant"} message`,"aria-keyshortcuts":"r b c delete",children:U?(0,t.jsx)(z,{error:e.error}):(0,t.jsxs)(t.Fragment,{children:[S&&M&&(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-border/20",children:[(0,t.jsxs)(i.Avatar,{className:"h-5 w-5",children:[(0,t.jsx)(i.AvatarImage,{src:M.imageUrl}),(0,t.jsx)(i.AvatarFallback,{className:"text-[10px]",children:M.name?.[0]?.toUpperCase()||"?"})]}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground font-medium",children:P?M.name||"User":`Triggered by ${M.name||"User"}`})]}),"assistant"===e.role&&(e.reasoning||e.partialReasoning||e.thinkingStartedAt)&&(0,t.jsx)(D,{reasoning:e.reasoning,partialReasoning:e.partialReasoning,thinkingStartedAt:e.thinkingStartedAt,thinkingCompletedAt:e.thinkingCompletedAt,reasoningTokens:e.reasoningTokens,isThinking:O&&!!e.partialReasoning}),I?(0,t.jsx)(w.MessageEditMode,{editedContent:B,onContentChange:R,onSave:em,onCancel:()=>{q(!1),R("")}}):(0,t.jsx)(t.Fragment,{children:J||ec?.length||ed?.length?(0,t.jsx)("div",{"data-testid":"message-content",children:(0,t.jsx)(v.InlineToolCallContent,{content:J||"",toolCalls:ec,partialToolCalls:ed,isStreaming:O})}):O?(0,t.jsx)(N.MessageLoadingState,{isThinkingModel:et&&!!e.thinkingStartedAt}):null}),(0,t.jsx)(g.ArtifactList,{messageId:e._id}),(0,t.jsx)(F,{messageId:e._id}),ea&&ea.length>0&&ei.size>0&&(0,t.jsx)("div",{className:"mt-3 pt-3 border-t border-border/10",children:(0,t.jsx)(f.AttachmentRenderer,{attachments:ea,urls:ei})}),e.isConsolidation&&K&&(0,t.jsx)(y.MessageConsolidationToggle,{originalResponses:K,showOriginals:T,onToggle:()=>$(!T)}),!P&&(0,t.jsxs)(t.Fragment,{children:["generating"===e.status&&(0,t.jsx)("div",{role:"status","aria-live":"polite",className:"sr-only",children:et&&e.thinkingStartedAt?"AI is thinking about your question":"AI is generating a response"}),"complete"===e.status&&(0,t.jsxs)("div",{role:"status","aria-live":"polite",className:"sr-only",children:[er&&`Response generated in ${(0,x.formatTTFT)(er)}`,e.tokensPerSecond&&` at ${Math.round(e.tokensPerSecond)} tokens per second`]}),"error"===e.status&&(0,t.jsxs)("div",{role:"alert","aria-live":"assertive",className:"sr-only",children:["Error generating response: ",e.error]}),"stopped"===e.status&&(0,t.jsx)("div",{role:"status","aria-live":"polite",className:"sr-only",children:"Generation was stopped by user"})]}),!h&&(0,t.jsx)(j.MessageBranchIndicator,{messageId:e._id}),!h&&X.showNotes&&(0,t.jsx)(k.MessageNotesIndicator,{messageId:e._id}),!P&&("complete"===e.status||"generating"===e.status||"stopped"===e.status)&&ee&&(0,t.jsx)(_.MessageStatsBadges,{modelName:ee,ttft:er,isCached:es,tokensPerSecond:e.tokensPerSecond,inputTokens:e.inputTokens,outputTokens:e.outputTokens,status:e.status,showStats:W})]})}),!h&&!P&&"complete"===e.status&&Q?.modelRecommendation&&!Q.modelRecommendation.dismissed&&(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(C.ModelRecommendationBanner,{recommendation:Q.modelRecommendation,conversationId:e.conversationId,onSwitch:eu,onPreview:e=>{let t=new CustomEvent("open-model-preview",{detail:{modelId:e}});window.dispatchEvent(t)}})}),!O&&(0,t.jsx)("div",{className:(0,p.cn)("absolute z-10",P?"right-5 sm:right-6":"left-5 sm:left-6","-bottom-8","flex justify-end","transition-opacity duration-200 ease-out",Z?"opacity-100":"opacity-0 group-hover:opacity-100",!Z&&"pointer-events-none group-hover:pointer-events-auto"),children:(0,t.jsx)(b.MessageActions,{message:e,nextMessage:a,readOnly:h,onEdit:P?()=>{R(e.content||""),q(!0)}:void 0})})]})})},(e,t)=>e.message._id===t.message._id&&e.message.partialContent===t.message.partialContent&&e.message.status===t.message.status&&e.nextMessage?.status===t.nextMessage?.status&&e.isCollaborative===t.isCollaborative&&e.senderUser?.name===t.senderUser?.name);e.s(["ChatMessage",0,O],94584)}]);